# 29. í”„ë¡œë•ì…˜ ë°°í¬ ì „ëžµ

> **í•™ìŠµ ëª©í‘œ**: ë‹¤ì–‘í•œ ë°°í¬ ì „ëžµ(Recreate, Rolling Update, Blue-Green, Canary)ì„ ì´í•´í•˜ê³ , ìƒí™©ì— ë§žëŠ” ìµœì ì˜ ë°°í¬ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

**â±ï¸ ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: 3-4ì‹œê°„
**ë‚œì´ë„**: â­â­â­â­â­ (5ê°œ/5ê°œ)

---

## ëª©ì°¨
1. [ì™œ ë°°í¬ ì „ëžµì´ ì¤‘ìš”í•œê°€](#ì™œ-ë°°í¬-ì „ëžµì´-ì¤‘ìš”í•œê°€)
2. [ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°](#ì‹¤ìƒí™œ-ë¹„ìœ ë¡œ-ì´í•´í•˜ê¸°)
3. [ë°°í¬ ì „ëžµì˜ ì¢…ë¥˜](#ë°°í¬-ì „ëžµì˜-ì¢…ë¥˜)
4. [Recreate ë°°í¬](#1-recreate-ë°°í¬)
5. [Rolling Update](#2-rolling-update-ìˆœì°¨-ë°°í¬)
6. [Blue-Green ë°°í¬](#3-blue-green-ë°°í¬)
7. [Canary ë°°í¬](#4-canary-ë°°í¬)
8. [A/B Testing](#5-ab-testing)
9. [LK-Trade ë°°í¬ ì „ëžµ](#6-lk-trade-í”„ë¡œì íŠ¸-ë°°í¬-ì „ëžµ)
10. [ì£¼ë‹ˆì–´ ê°œë°œìž ì‹œë‚˜ë¦¬ì˜¤](#ì£¼ë‹ˆì–´-ê°œë°œìž-ì‹œë‚˜ë¦¬ì˜¤)
11. [FAQ](#faq)
12. [ë©´ì ‘ ì§ˆë¬¸](#ë©´ì ‘-ì§ˆë¬¸)

---

## ðŸ’¡ ì™œ ë°°í¬ ì „ëžµì´ ì¤‘ìš”í•œê°€?

### ì‹¤ë¬´ ë°°ê²½

**"í”„ë¡œë•ì…˜ ë°°í¬ ì¤‘ ìž¥ì• ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ëŒ€ì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"**

#### âŒ ë°°í¬ ì „ëžµì´ ì—†ìœ¼ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œ

```
ë¬¸ì œ 1: ì „ì²´ ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ìž„ ë°œìƒ
- ì¦ìƒ: ëª¨ë“  ì„œë²„ë¥¼ í•œ ë²ˆì— ì—…ë°ì´íŠ¸
- ëŒ€ì‘: ìƒˆ ë²„ì „ì— ë²„ê·¸ê°€ ìžˆìœ¼ë©´ ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨
- ì˜í–¥: í‰ê·  5-10ë¶„ ë‹¤ìš´íƒ€ìž„, ëª¨ë“  ì‚¬ìš©ìž ì˜í–¥
- ë¹„ìš©: 1ë¶„ë‹¹ $694 ì†ì‹¤, 10ë¶„ = $6,940 ì†ì‹¤

ë¬¸ì œ 2: ëŠë¦° ë¡¤ë°±ìœ¼ë¡œ í”¼í•´ í™•ëŒ€
- ì¦ìƒ: "ì–´? ë°°í¬ í›„ ì—ëŸ¬ìœ¨ì´ ê¸‰ì¦í–ˆì–´ìš”!"
- ëŒ€ì‘: ìˆ˜ë™ ë¡¤ë°± ì‹œë„ (15ë¶„ ì†Œìš”)
- ì˜í–¥: ê¸´ ë³µêµ¬ ì‹œê°„ ë™ì•ˆ ê³ ê° ì´íƒˆ
- ë¹„ìš©: 15ë¶„ Ã— $694 = $10,410 + ê³ ê° ì‹ ë¢°ë„ í•˜ë½

ë¬¸ì œ 3: í…ŒìŠ¤íŠ¸ê°€ ë¶ˆì¶©ë¶„í•œ ë°°í¬
- ì¦ìƒ: "ë¡œì»¬ì—ì„œëŠ” ëëŠ”ë° í”„ë¡œë•ì…˜ì—ì„œ ì•ˆë¼ìš”"
- ëŒ€ì‘: ê¸‰í•˜ê²Œ í•«í”½ìŠ¤ ë°°í¬ ë°˜ë³µ
- ì˜í–¥: ë¶ˆì•ˆì •í•œ ì„œë¹„ìŠ¤, ê°œë°œìž ì•¼ê·¼
- ë¹„ìš©: ê°œë°œìž 3ëª… Ã— 5ì‹œê°„ Ã— $50 = $750
```

#### âœ… ì²´ê³„ì  ë°°í¬ ì „ëžµì„ ì ìš©í•˜ë©´

```
í•´ê²°ì±… 1: ë¬´ì¤‘ë‹¨ ë°°í¬ë¡œ ì•ˆì •ì„± í™•ë³´
- ë°©ë²•: Rolling Update ë˜ëŠ” Blue-Green ë°°í¬
- íš¨ê³¼: ë‹¤ìš´íƒ€ìž„ 0ë¶„, ì‚¬ìš©ìž ê²½í—˜ ìœ ì§€
- ì ˆê°: ë‹¤ìš´íƒ€ìž„ ë¹„ìš© 100% ì ˆê°

í•´ê²°ì±… 2: ë¹ ë¥¸ ë¡¤ë°±ìœ¼ë¡œ í”¼í•´ ìµœì†Œí™”
- ë°©ë²•: Blue-Green ë°°í¬ (1-2ì´ˆ ë‚´ ë¡¤ë°±)
- íš¨ê³¼: ë¬¸ì œ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µê·€
- ì ˆê°: ë³µêµ¬ ì‹œê°„ 15ë¶„ â†’ 10ì´ˆ (99% ë‹¨ì¶•)

í•´ê²°ì±… 3: ì ì§„ì  ë°°í¬ë¡œ ìœ„í—˜ ë¶„ì‚°
- ë°©ë²•: Canary ë°°í¬ (5% â†’ 25% â†’ 50% â†’ 100%)
- íš¨ê³¼: ì†Œìˆ˜ ì‚¬ìš©ìžì—ê²Œ ë¨¼ì € í…ŒìŠ¤íŠ¸, ë¬¸ì œ ì¡°ê¸° ë°œê²¬
- ì ˆê°: ì „ì²´ ìž¥ì•  ìœ„í—˜ 95% ê°ì†Œ
```

### ìˆ˜ì¹˜ë¡œ ë³´ëŠ” íš¨ê³¼

| ì§€í‘œ | Before (ë¬´ê³„íš ë°°í¬) | After (ì „ëžµì  ë°°í¬) | ê°œì„ ìœ¨ |
|------|---------------------|-------------------|--------|
| í‰ê·  ë‹¤ìš´íƒ€ìž„ | 10ë¶„ | 0ë¶„ | **100%â†“** |
| ë°°í¬ ì‹¤íŒ¨ìœ¨ | 20% | 2% | **90%â†“** |
| í‰ê·  ë³µêµ¬ ì‹œê°„ (MTTR) | 15ë¶„ | 30ì´ˆ | **97%â†“** |
| ë°°í¬ ë¹ˆë„ | ì£¼ 1íšŒ | ì¼ 5íšŒ | **3500%â†‘** |
| ì‚¬ìš©ìž ì˜í–¥ ë²”ìœ„ | 100% | 5% (Canary) | **95%â†“** |
| ì›”ê°„ ë‹¤ìš´íƒ€ìž„ ë¹„ìš© | $27,760 | $0 | **100%â†“** |

---

## ðŸ” ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

### ë¹„ìœ  1: í•­ê³µì‚¬ì˜ ë¹„í–‰ê¸° êµì²´ ì „ëžµ

```
í•­ê³µì‚¬ê°€ ì‹ í˜• ë¹„í–‰ê¸°ë¥¼ ë„ìž…í•˜ëŠ” ë°©ë²•:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ ìœ„í—˜í•œ ë°©ë²•: ëª¨ë“  ë¹„í–‰ê¸°ë¥¼ í•œ ë²ˆì— êµì²´             â”‚
â”‚                                                         â”‚
â”‚ 1. ì˜¤ì „ 6ì‹œ: ëª¨ë“  ê¸°ì¡´ ë¹„í–‰ê¸° ìš´í•­ ì¤‘ë‹¨                â”‚
â”‚ 2. ì˜¤ì „ 6ì‹œ~ì˜¤í›„ 2ì‹œ: ì‹ í˜• ë¹„í–‰ê¸°ë¡œ êµì²´ (8ì‹œê°„)      â”‚
â”‚ 3. ì˜¤í›„ 2ì‹œ: ì‹ í˜• ë¹„í–‰ê¸° ìš´í•­ ì‹œìž‘                     â”‚
â”‚                                                         â”‚
â”‚ ë¬¸ì œ:                                                   â”‚
â”‚ - 8ì‹œê°„ ë™ì•ˆ í•­ê³µíŽ¸ ì „ë©´ ì¤‘ë‹¨                          â”‚
â”‚ - ì‹ í˜• ë¹„í–‰ê¸°ì— ë¬¸ì œ ë°œìƒ ì‹œ ëª¨ë“  í•­ê³µíŽ¸ ë§ˆë¹„         â”‚
â”‚ - ìŠ¹ê° ë¶ˆë§Œ í­ì¦, í•­ê³µì‚¬ ì‹ ë¢°ë„ ì¶”ë½                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ì•ˆì „í•œ ë°©ë²•: ì ì§„ì  êµì²´ (Rolling Update)           â”‚
â”‚                                                         â”‚
â”‚ 1. ì²«ì§¸ ë‚ : ë¹„í–‰ê¸° 1ëŒ€ë§Œ ì‹ í˜•ìœ¼ë¡œ êµì²´                 â”‚
â”‚    â†’ ë¬¸ì œ ì—†ìœ¼ë©´ ê³„ì† ìš´í•­                             â”‚
â”‚ 2. ë‘˜ì§¸ ë‚ : 2ëŒ€ ì¶”ê°€ êµì²´                              â”‚
â”‚ 3. í•œ ë‹¬ê°„ ì ì§„ì ìœ¼ë¡œ ì „ì²´ êµì²´                        â”‚
â”‚                                                         â”‚
â”‚ ìž¥ì :                                                   â”‚
â”‚ - ë¬´ì¤‘ë‹¨ ìš´í•­ (ìŠ¹ê° ë¶ˆíŽ¸ ì—†ìŒ)                         â”‚
â”‚ - ì‹ í˜• ë¹„í–‰ê¸° ë¬¸ì œ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨ ê°€ëŠ¥             â”‚
â”‚ - ê¸°ì¡´ ë¹„í–‰ê¸°ë¡œ ë°±ì—… ê°€ëŠ¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker ë°°í¬ë„ ë™ì¼:
ê¸°ì¡´ ì»¨í…Œì´ë„ˆ = ê¸°ì¡´ ë¹„í–‰ê¸°
ìƒˆ ì»¨í…Œì´ë„ˆ = ì‹ í˜• ë¹„í–‰ê¸°
ì‚¬ìš©ìž íŠ¸ëž˜í”½ = ìŠ¹ê°
```

### ë¹„ìœ  2: êµëŸ‰ êµì²´ ê³µì‚¬ (Blue-Green ë°°í¬)

```
ì˜¤ëž˜ëœ ë‹¤ë¦¬ë¥¼ ìƒˆ ë‹¤ë¦¬ë¡œ êµì²´í•˜ëŠ” ë°©ë²•:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ êµëŸ‰ êµì²´ ì „ëžµ                                          â”‚
â”‚                                                         â”‚
â”‚ 1ë‹¨ê³„: ê¸°ì¡´ ë‹¤ë¦¬ (Blue) ìš´ì˜ ì¤‘                         â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ëª¨ë“  ì°¨ëŸ‰ í†µí–‰                   â”‚
â”‚    [ê¸°ì¡´ ë‹¤ë¦¬]                                          â”‚
â”‚                                                         â”‚
â”‚ 2ë‹¨ê³„: ìƒˆ ë‹¤ë¦¬ (Green) ê±´ì„¤ (ìš´í–‰ ì¤‘ë‹¨ ì—†ìŒ)           â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ì°¨ëŸ‰ í†µí–‰ ê³„ì†                   â”‚
â”‚    [ê¸°ì¡´ ë‹¤ë¦¬]                                          â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ê±´ì„¤ ì¤‘                          â”‚
â”‚    [ìƒˆ ë‹¤ë¦¬]                                            â”‚
â”‚                                                         â”‚
â”‚ 3ë‹¨ê³„: ìƒˆ ë‹¤ë¦¬ ì™„ì„± í›„ í…ŒìŠ¤íŠ¸                           â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ì°¨ëŸ‰ í†µí–‰ ê³„ì†                   â”‚
â”‚    [ê¸°ì¡´ ë‹¤ë¦¬]                                          â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† í…ŒìŠ¤íŠ¸ ì°¨ëŸ‰ë§Œ í†µê³¼               â”‚
â”‚    [ìƒˆ ë‹¤ë¦¬] âœ…                                         â”‚
â”‚                                                         â”‚
â”‚ 4ë‹¨ê³„: íŠ¸ëž˜í”½ ì „í™˜ (1-2ì´ˆ)                              â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† í†µí–‰ ì¤‘ë‹¨                        â”‚
â”‚    [ê¸°ì¡´ ë‹¤ë¦¬]                                          â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ëª¨ë“  ì°¨ëŸ‰ í†µí–‰ ì‹œìž‘              â”‚
â”‚    [ìƒˆ ë‹¤ë¦¬] âœ…                                         â”‚
â”‚                                                         â”‚
â”‚ 5ë‹¨ê³„: ë¬¸ì œ ì—†ìœ¼ë©´ ê¸°ì¡´ ë‹¤ë¦¬ ì² ê±°                       â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â† ëª¨ë“  ì°¨ëŸ‰ í†µí–‰                   â”‚
â”‚    [ìƒˆ ë‹¤ë¦¬] âœ…                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker Blue-Green:
- Blue = í˜„ìž¬ ìš´ì˜ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ
- Green = ìƒˆ ë²„ì „ ì»¨í…Œì´ë„ˆ
- ë¡œë“œ ë°¸ëŸ°ì„œê°€ íŠ¸ëž˜í”½ì„ Blue â†’ Greenìœ¼ë¡œ ì¦‰ì‹œ ì „í™˜
- ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ Blueë¡œ ë‹¤ì‹œ ì „í™˜
```

### ë¹„ìœ  3: ì‹ ë©”ë‰´ ì¶œì‹œ (Canary ë°°í¬)

```
ë ˆìŠ¤í† ëž‘ì—ì„œ ìƒˆ ë©”ë‰´ë¥¼ ì¶œì‹œí•˜ëŠ” ì „ëžµ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ ìœ„í—˜í•œ ë°©ë²•: ì „ì²´ ë©”ë‰´ë¥¼ í•œ ë²ˆì— ë³€ê²½               â”‚
â”‚                                                         â”‚
â”‚ ì›”ìš”ì¼: ëª¨ë“  ë©”ë‰´íŒì„ ìƒˆ ë©”ë‰´ë¡œ êµì²´                   â”‚
â”‚ ê²°ê³¼: ì†ë‹˜ë“¤ì´ ìƒˆ ë©”ë‰´ë¥¼ ì‹«ì–´í•¨ â†’ ë§¤ì¶œ ê¸‰ê°            â”‚
â”‚       ë‹¤ì‹œ ì´ì „ ë©”ë‰´ë¡œ ë³µêµ¬í•˜ê¸° ì–´ë ¤ì›€                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ì•ˆì „í•œ ë°©ë²•: ì†Œìˆ˜ ê³ ê°ë¶€í„° í…ŒìŠ¤íŠ¸ (Canary)          â”‚
â”‚                                                         â”‚
â”‚ 1ì£¼ì°¨: 5% ê³ ê°ì—ê²Œë§Œ ìƒˆ ë©”ë‰´ ì œê³µ                      â”‚
â”‚   â†’ í”¼ë“œë°± ìˆ˜ì§‘: "ë§›ìžˆì–´ìš”!" âœ…                        â”‚
â”‚                                                         â”‚
â”‚ 2ì£¼ì°¨: 25% ê³ ê°ìœ¼ë¡œ í™•ëŒ€                                â”‚
â”‚   â†’ í”¼ë“œë°±: "ìž¬ë£Œê°€ ë¶€ì¡±í•´ìš”" âš ï¸                      â”‚
â”‚   â†’ ìž¬ë£Œ ê³µê¸‰ëŸ‰ ì¡°ì •                                    â”‚
â”‚                                                         â”‚
â”‚ 3ì£¼ì°¨: 50% ê³ ê°ìœ¼ë¡œ í™•ëŒ€                                â”‚
â”‚   â†’ í”¼ë“œë°±: "ì¡°ë¦¬ ì‹œê°„ì´ ë„ˆë¬´ ê¸¸ì–´ìš”" âš ï¸              â”‚
â”‚   â†’ ì¡°ë¦¬ í”„ë¡œì„¸ìŠ¤ ê°œì„                                   â”‚
â”‚                                                         â”‚
â”‚ 4ì£¼ì°¨: 100% ì „ë©´ ì¶œì‹œ                                   â”‚
â”‚   â†’ ëª¨ë“  ë¬¸ì œ í•´ê²° ì™„ë£Œ âœ…                             â”‚
â”‚   â†’ ì„±ê³µì ì¸ ì‹ ë©”ë‰´ ì¶œì‹œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker Canary:
- 5% â†’ 25% â†’ 50% â†’ 100%ë¡œ ì ì§„ì  íŠ¸ëž˜í”½ ì¦ê°€
- ê° ë‹¨ê³„ì—ì„œ ì—ëŸ¬ìœ¨, ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
- ë¬¸ì œ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨í•˜ê³  ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
```

---

## ë°°í¬ ì „ëžµì˜ ì¢…ë¥˜

### 1. ë°°í¬ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ

```
âŒ ë¬´ê³„íš ë°°í¬ (All at Once)
===========================

15:00 - ìƒˆ ë²„ì „ ë°°í¬ ì‹œìž‘
15:01 - ëª¨ë“  ì„œë²„ë¥¼ ë™ì‹œì— ìƒˆ ë²„ì „ìœ¼ë¡œ êµì²´
15:02 - ì¹˜ëª…ì ì¸ ë²„ê·¸ ë°œê²¬!
15:03 - ëª¨ë“  ì‚¬ìš©ìžê°€ ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
15:04 - ê¸´ê¸‰ ë¡¤ë°± ì‹œë„
15:10 - ë¡¤ë°± ì™„ë£Œ, 6ë¶„ê°„ ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨
ê²°ê³¼: ë§¤ì¶œ ì†ì‹¤, ê³ ê° ì´íƒˆ, ë¸Œëžœë“œ ì´ë¯¸ì§€ ì†ìƒ ðŸ’€


âœ… Canary ë°°í¬ (ì ì§„ì )
=======================

15:00 - ìƒˆ ë²„ì „ ë°°í¬ ì‹œìž‘
15:01 - 5%ì˜ íŠ¸ëž˜í”½ë§Œ ìƒˆ ë²„ì „ìœ¼ë¡œ ì „í™˜
15:02 - 5% ì‚¬ìš©ìž ëª¨ë‹ˆí„°ë§ â†’ ë²„ê·¸ ë°œê²¬!
15:03 - ì¦‰ì‹œ ìƒˆ ë²„ì „ ì¤‘ë‹¨
15:04 - 95%ì˜ ì‚¬ìš©ìžëŠ” ì˜í–¥ ì—†ìŒ
ê²°ê³¼: 5%ë§Œ ìž ê¹ ì˜í–¥, ë¹ ë¥¸ ëŒ€ì‘, í”¼í•´ ìµœì†Œí™” âœ¨
```

### 2. ë‹¤ìš´íƒ€ìž„ì˜ ë¹„ìš©

```
ë‹¤ìš´íƒ€ìž„ ë¹„ìš© ê³„ì‚°
=================

ê°€ì •:
- ì¼ í‰ê·  ê±°ëž˜ì•¡: $1,000,000
- 1ì‹œê°„ ë‹¤ìš´íƒ€ìž„ ë¹„ìš©: $1,000,000 / 24 = $41,667
- 1ë¶„ ë‹¤ìš´íƒ€ìž„ ë¹„ìš©: $694

ì‹œë‚˜ë¦¬ì˜¤ë³„ ë¹„ìš©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°°í¬ ì „ëžµ           â”‚ ë‹¤ìš´íƒ€ìž„     â”‚ ë¹„ìš©        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ All at Once         â”‚ 5ë¶„          â”‚ $3,470      â”‚
â”‚ Rolling Update      â”‚ 0ë¶„ (ë¬´ì¤‘ë‹¨) â”‚ $0          â”‚
â”‚ Blue-Green          â”‚ 30ì´ˆ (ì „í™˜)  â”‚ $347        â”‚
â”‚ Canary (ë²„ê·¸ ë°œê²¬)  â”‚ 0ë¶„ (5%ë§Œ)   â”‚ ~$0         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

+ ê³ ê° ì‹ ë¢°ë„ í•˜ë½
+ ë¸Œëžœë“œ ì´ë¯¸ì§€ ì†ìƒ
+ ê²½ìŸì‚¬ë¡œ ì´íƒˆ
```

---

## ë°°í¬ ì „ëžµì˜ ì¢…ë¥˜

### 1. ì „ì²´ ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì „ëžµ             â”‚ ë‹¤ìš´íƒ€ìž„     â”‚ ë¡¤ë°± ì†ë„ â”‚ ë¦¬ì†ŒìŠ¤    â”‚ ë³µìž¡ë„       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Recreate         â”‚ ìžˆìŒ (5ë¶„+)  â”‚ ëŠë¦¼      â”‚ 1ë°°       â”‚ ë‚®ìŒ         â”‚
â”‚ Rolling Update   â”‚ ì—†ìŒ         â”‚ ëŠë¦¼      â”‚ 1ë°°       â”‚ ì¤‘ê°„         â”‚
â”‚ Blue-Green       â”‚ ê±°ì˜ ì—†ìŒ    â”‚ ë§¤ìš° ë¹ ë¦„ â”‚ 2ë°°       â”‚ ì¤‘ê°„         â”‚
â”‚ Canary           â”‚ ì—†ìŒ         â”‚ ë¹ ë¦„      â”‚ 1.1ë°°     â”‚ ë†’ìŒ         â”‚
â”‚ A/B Testing      â”‚ ì—†ìŒ         â”‚ ë¹ ë¦„      â”‚ 1.2ë°°     â”‚ ë†’ìŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Recreate ë°°í¬

ê°€ìž¥ ê°„ë‹¨í•˜ì§€ë§Œ ë‹¤ìš´íƒ€ìž„ì´ ë°œìƒí•©ë‹ˆë‹¤.

### ë™ìž‘ ë°©ì‹

```
ì‹œê°„ íë¦„
=========

ê¸°ì¡´ ë²„ì „ (v1.0)
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚  â† 3ê°œì˜ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
   |       |       |
   â†“       â†“       â†“
  Stop    Stop    Stop    â† ëª¨ë‘ ì¤‘ì§€ (ë‹¤ìš´íƒ€ìž„ ì‹œìž‘!)
   X       X       X

   â³ ë‹¤ìš´íƒ€ìž„ (5-10ë¶„)

   â†“       â†“       â†“
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚  â† ìƒˆ ë²„ì „ ì‹œìž‘ (ë‹¤ìš´íƒ€ìž„ ì¢…ë£Œ)
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
```

### docker-compose ì˜ˆì‹œ

```yaml
# docker-compose.yml
version: '3.8'

services:
  user-service:
    image: lk-trade/user-service:${VERSION}
    deploy:
      replicas: 3
      # ê¸°ë³¸ ì „ëžµ (Recreate)
```

```bash
# ë°°í¬ ëª…ë ¹
export VERSION=2.0.0
docker-compose down
docker-compose pull
docker-compose up -d

# ë‹¤ìš´íƒ€ìž„: docker-compose downë¶€í„° up -d ì™„ë£Œê¹Œì§€
```

### ìž¥ë‹¨ì 

```
âœ… ìž¥ì :
- êµ¬í˜„ì´ ë§¤ìš° ê°„ë‹¨
- ë²„ì „ ì¶©ëŒ ì—†ìŒ (í•œ ë²ˆì— í•˜ë‚˜ì˜ ë²„ì „ë§Œ ì‹¤í–‰)
- ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì  (ì¶”ê°€ ì„œë²„ ë¶ˆí•„ìš”)

âŒ ë‹¨ì :
- ë‹¤ìš´íƒ€ìž„ ë°œìƒ (5-10ë¶„)
- ì‚¬ìš©ìž ê²½í—˜ ì €í•˜
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ëŠ” ë¶€ì í•©
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½
- ì‚¬ìš©ìžê°€ ì—†ëŠ” ì‹œê°„ëŒ€ (ìƒˆë²½)
- ìœ ì§€ë³´ìˆ˜ ì°½êµ¬ (maintenance window) í™œìš©

---

## 2. Rolling Update (ìˆœì°¨ ë°°í¬)

ë¬´ì¤‘ë‹¨ìœ¼ë¡œ ì ì§„ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

### ë™ìž‘ ë°©ì‹

```
ì‹œê°„ íë¦„
=========

ì´ˆê¸° ìƒíƒœ (v1.0)
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚  (4ê°œ ì¸ìŠ¤í„´ìŠ¤)
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
   â†“
1ë‹¨ê³„: í•˜ë‚˜ì”© êµì²´
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v2  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚  â† 1ê°œ ì—…ë°ì´íŠ¸
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
   â†“
2ë‹¨ê³„
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚  â† 2ê°œ ì—…ë°ì´íŠ¸
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
   â†“
3ë‹¨ê³„
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v1  â”‚  â† 3ê°œ ì—…ë°ì´íŠ¸
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
   â†“
ì™„ë£Œ
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚  â† ëª¨ë‘ ì—…ë°ì´íŠ¸
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

âœ… ì „ì²´ ê³¼ì •ì—ì„œ ë‹¤ìš´íƒ€ìž„ ì—†ìŒ!
```

### Docker Swarmìœ¼ë¡œ Rolling Update

```bash
# Swarm ì´ˆê¸°í™”
docker swarm init

# Stack ë°°í¬
docker stack deploy -c docker-stack.yml lk-trade
```

```yaml
# docker-stack.yml
version: '3.8'

services:
  user-service:
    image: lk-trade/user-service:${VERSION:-latest}
    deploy:
      replicas: 4
      update_config:
        parallelism: 1        # í•œ ë²ˆì— 1ê°œì”© ì—…ë°ì´íŠ¸
        delay: 10s            # ê° ì—…ë°ì´íŠ¸ ì‚¬ì´ ëŒ€ê¸° ì‹œê°„
        failure_action: rollback  # ì‹¤íŒ¨ ì‹œ ìžë™ ë¡¤ë°±
        monitor: 60s          # ëª¨ë‹ˆí„°ë§ ì‹œê°„
        max_failure_ratio: 0.25   # 25% ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
        order: stop-first     # ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ í›„ ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œìž‘
      rollback_config:
        parallelism: 1
        delay: 10s
        failure_action: pause
        monitor: 60s
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    networks:
      - lk-trade-network

networks:
  lk-trade-network:
    driver: overlay
```

### ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

```bash
# ìƒˆ ë²„ì „ ë°°í¬
export VERSION=2.0.0
docker stack deploy -c docker-stack.yml lk-trade

# ë°°í¬ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
watch -n 1 'docker service ps lk-trade_user-service'

# ì¶œë ¥:
ID            NAME                         IMAGE                    NODE    DESIRED STATE  CURRENT STATE
abc123...     lk-trade_user-service.1      lk-trade/user-service:2.0.0  node1   Running        Running 30 seconds ago
def456...     lk-trade_user-service.2      lk-trade/user-service:2.0.0  node1   Running        Running 20 seconds ago
ghi789...     lk-trade_user-service.3      lk-trade/user-service:2.0.0  node1   Running        Running 10 seconds ago
jkl012...     lk-trade_user-service.4      lk-trade/user-service:1.0.0  node1   Shutdown       Shutdown 5 seconds ago

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker service ls
docker service logs -f lk-trade_user-service

# ë¡¤ë°± (ë¬¸ì œ ë°œìƒ ì‹œ)
docker service rollback lk-trade_user-service

# ë˜ëŠ” ì´ì „ ë²„ì „ìœ¼ë¡œ ìž¬ë°°í¬
export VERSION=1.0.0
docker stack deploy -c docker-stack.yml lk-trade
```

### ìž¥ë‹¨ì 

```
âœ… ìž¥ì :
- ë¬´ì¤‘ë‹¨ ë°°í¬ (Zero Downtime)
- ì ì§„ì  ì—…ë°ì´íŠ¸ë¡œ ìœ„í—˜ ë¶„ì‚°
- ìžë™ í—¬ìŠ¤ì²´í¬ ë° ë¡¤ë°±
- ì¶”ê°€ ë¦¬ì†ŒìŠ¤ ë¶ˆí•„ìš”

âŒ ë‹¨ì :
- ë°°í¬ ì‹œê°„ì´ ê¹€ (ì „ì²´ ì—…ë°ì´íŠ¸ê¹Œì§€)
- v1ê³¼ v2ê°€ ë™ì‹œì— ì‹¤í–‰ë¨ (í˜¸í™˜ì„± í•„ìš”)
- ë¡¤ë°±ì´ ëŠë¦¼ (ë‹¤ì‹œ rolling)
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì¼ë°˜ì ì¸ í”„ë¡œë•ì…˜ ë°°í¬
- ë¦¬ì†ŒìŠ¤ê°€ ì œí•œì ì¸ í™˜ê²½
- ë²„ì „ ê°„ í˜¸í™˜ì„±ì´ ë³´ìž¥ë˜ëŠ” ê²½ìš°

---

## 3. Blue-Green ë°°í¬

ë‘ ê°œì˜ ë™ì¼í•œ í™˜ê²½ì„ ìš´ì˜í•˜ê³  ì¦‰ì‹œ ì „í™˜í•©ë‹ˆë‹¤.

### ë™ìž‘ ë°©ì‹

```
Blue (ê¸°ì¡´ í™˜ê²½, v1.0)          Green (ìƒˆ í™˜ê²½, v2.0)
=========================        =========================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancer         â”‚        â”‚                       â”‚
â”‚   â†“                   â”‚        â”‚                       â”‚
â”‚ Blue Environment      â”‚        â”‚ Green Environment     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚      â”‚        â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚        â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   â†‘                   â”‚        â”‚                       â”‚
â”‚ 100% íŠ¸ëž˜í”½           â”‚        â”‚ 0% íŠ¸ëž˜í”½             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â†“ í…ŒìŠ¤íŠ¸ ì™„ë£Œ, ì „í™˜ ì¤€ë¹„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancer         â”‚        â”‚                       â”‚
â”‚       â†“               â”‚        â”‚                       â”‚
â”‚ Blue Environment      â”‚        â”‚ Green Environment     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚      â”‚        â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚        â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                       â”‚        â”‚   â†‘                   â”‚
â”‚ 0% íŠ¸ëž˜í”½             â”‚        â”‚ 100% íŠ¸ëž˜í”½           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â†“ ë¬¸ì œ ì—†ìœ¼ë©´ Blue í™˜ê²½ ì¢…ë£Œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Green Environment     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   â†‘                   â”‚
â”‚ 100% íŠ¸ëž˜í”½           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â†“ Greenì´ ì´ì œ Blueê°€ ë¨
```

### Nginxë¥¼ ì´ìš©í•œ Blue-Green ë°°í¬

```yaml
# docker-compose.blue-green.yml
version: '3.8'

services:
  # Nginx ë¡œë“œ ë°¸ëŸ°ì„œ
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/upstream.conf:/etc/nginx/conf.d/upstream.conf:ro
    networks:
      - lk-trade-network
    depends_on:
      - user-service-blue
      - user-service-green

  # Blue í™˜ê²½ (í˜„ìž¬ ìš´ì˜)
  user-service-blue:
    image: lk-trade/user-service:1.0.0
    container_name: user-service-blue
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DEPLOYMENT_COLOR=blue
    networks:
      - lk-trade-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:8080/actuator/health"]
      interval: 10s
      timeout: 3s
      retries: 3

  # Green í™˜ê²½ (ìƒˆ ë²„ì „)
  user-service-green:
    image: lk-trade/user-service:2.0.0
    container_name: user-service-green
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DEPLOYMENT_COLOR=green
    networks:
      - lk-trade-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:8080/actuator/health"]
      interval: 10s
      timeout: 3s
      retries: 3

networks:
  lk-trade-network:
    driver: bridge
```

```nginx
# nginx/upstream.conf (ì´ˆê¸° ìƒíƒœ: Blue)
upstream user_service {
    server user-service-blue:8080 max_fails=3 fail_timeout=30s;
    # server user-service-green:8080 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;

    location / {
        proxy_pass http://user_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # í—¬ìŠ¤ ì²´í¬ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼ ì„¤ì •
        proxy_connect_timeout 2s;
        proxy_send_timeout 2s;
        proxy_read_timeout 2s;
    }

    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### Blue-Green ì „í™˜ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# scripts/blue-green-deploy.sh

set -e

CURRENT_ENV=${1:-blue}
NEW_ENV=${2:-green}

if [ "$CURRENT_ENV" != "blue" ] && [ "$CURRENT_ENV" != "green" ]; then
    echo "âŒ Invalid environment. Use 'blue' or 'green'"
    exit 1
fi

if [ "$CURRENT_ENV" == "blue" ]; then
    NEW_ENV="green"
else
    NEW_ENV="blue"
fi

echo "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Blue-Green Deployment                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Current Environment: $CURRENT_ENV
New Environment:     $NEW_ENV
"

# 1. ìƒˆ í™˜ê²½ í—¬ìŠ¤ ì²´í¬
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1ï¸âƒ£  Health Check: $NEW_ENV environment"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

MAX_RETRIES=30
RETRY=0

while [ $RETRY -lt $MAX_RETRIES ]; do
    if docker exec user-service-$NEW_ENV wget -q --spider http://localhost:8080/actuator/health; then
        echo "âœ… $NEW_ENV environment is healthy"
        break
    fi
    RETRY=$((RETRY+1))
    echo "â³ Waiting for $NEW_ENV to be ready... ($RETRY/$MAX_RETRIES)"
    sleep 2
done

if [ $RETRY -eq $MAX_RETRIES ]; then
    echo "âŒ $NEW_ENV environment health check failed"
    exit 1
fi

# 2. ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "2ï¸âƒ£  Smoke Tests"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# ê¸°ë³¸ API í…ŒìŠ¤íŠ¸
if ! docker exec user-service-$NEW_ENV wget -q -O- http://localhost:8080/actuator/info > /dev/null; then
    echo "âŒ Smoke test failed"
    exit 1
fi

echo "âœ… Smoke tests passed"

# 3. íŠ¸ëž˜í”½ ì „í™˜
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "3ï¸âƒ£  Traffic Switch"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

read -p "Switch traffic to $NEW_ENV? (yes/no): " CONFIRM
if [ "$CONFIRM" != "yes" ]; then
    echo "Deployment cancelled"
    exit 0
fi

# Nginx ì„¤ì • ë³€ê²½
cat > nginx/upstream.conf <<EOF
upstream user_service {
    server user-service-$NEW_ENV:8080 max_fails=3 fail_timeout=30s;
    # server user-service-$CURRENT_ENV:8080 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;

    location / {
        proxy_pass http://user_service;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;

        proxy_connect_timeout 2s;
        proxy_send_timeout 2s;
        proxy_read_timeout 2s;
    }
}
EOF

# Nginx ìž¬ì‹œìž‘
docker exec nginx nginx -s reload
echo "âœ… Traffic switched to $NEW_ENV"

# 4. ëª¨ë‹ˆí„°ë§
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "4ï¸âƒ£  Monitoring (60 seconds)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Press Ctrl+C to stop monitoring and rollback"
echo ""

for i in {1..60}; do
    if ! docker exec user-service-$NEW_ENV wget -q --spider http://localhost:8080/actuator/health; then
        echo ""
        echo "âŒ Health check failed during monitoring!"
        echo "ðŸ”„ Rolling back to $CURRENT_ENV..."

        # ë¡¤ë°±
        cat > nginx/upstream.conf <<EOF
upstream user_service {
    server user-service-$CURRENT_ENV:8080 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    location / {
        proxy_pass http://user_service;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
    }
}
EOF
        docker exec nginx nginx -s reload
        echo "âœ… Rolled back to $CURRENT_ENV"
        exit 1
    fi
    echo -n "."
    sleep 1
done

echo ""
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "5ï¸âƒ£  Cleanup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

read -p "Stop $CURRENT_ENV environment? (yes/no): " CLEANUP
if [ "$CLEANUP" == "yes" ]; then
    docker-compose stop user-service-$CURRENT_ENV
    echo "âœ… $CURRENT_ENV environment stopped"
else
    echo "âš ï¸  $CURRENT_ENV environment is still running"
    echo "   You can manually stop it later with:"
    echo "   docker-compose stop user-service-$CURRENT_ENV"
fi

echo ""
echo "âœ… Blue-Green deployment completed successfully!"
echo ""
echo "Current active environment: $NEW_ENV"
```

### ì‚¬ìš© ë°©ë²•

```bash
# 1. ì´ˆê¸° ìƒíƒœ: Blue ìš´ì˜ ì¤‘
docker-compose -f docker-compose.blue-green.yml up -d user-service-blue nginx

# 2. Green í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬
docker-compose -f docker-compose.blue-green.yml up -d user-service-green

# 3. Blue â†’ Green ì „í™˜
bash scripts/blue-green-deploy.sh blue

# 4. ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°± (Green â†’ Blue)
bash scripts/blue-green-rollback.sh green
```

### ìž¥ë‹¨ì 

```
âœ… ìž¥ì :
- ê±°ì˜ ì¦‰ì‹œ ì „í™˜ (1-2ì´ˆ)
- ë§¤ìš° ë¹ ë¥¸ ë¡¤ë°± (1-2ì´ˆ)
- í”„ë¡œë•ì…˜ê³¼ ë™ì¼í•œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- v1ê³¼ v2ê°€ ê²©ë¦¬ë¨

âŒ ë‹¨ì :
- ë¦¬ì†ŒìŠ¤ 2ë°° í•„ìš”
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë³µìž¡
- ì¸í”„ë¼ ë¹„ìš© ì¦ê°€
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì¤‘ìš”í•œ í”„ë¡œë•ì…˜ ë°°í¬
- ë¹ ë¥¸ ë¡¤ë°±ì´ í•„ìˆ˜ì¸ ê²½ìš°
- ë¦¬ì†ŒìŠ¤ê°€ ì¶©ë¶„í•œ í™˜ê²½

---

## 4. Canary ë°°í¬

ì†Œìˆ˜ì˜ ì‚¬ìš©ìžì—ê²Œ ë¨¼ì € ë°°í¬í•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

### ë™ìž‘ ë°©ì‹

```
ì‹œê°„ íë¦„
=========

ì´ˆê¸°: 5% Canary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancer                                 â”‚
â”‚                                               â”‚
â”‚  5% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”  Canary (v2.0)              â”‚
â”‚         â”‚ v2  â”‚                               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                               â”‚
â”‚ 95% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”     â”‚
â”‚         â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ ëª¨ë‹ˆí„°ë§ (15ë¶„) â†’ ë¬¸ì œ ì—†ìŒ

25% Canary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 25% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  Canary (v2.0)       â”‚
â”‚         â”‚ v2  â”‚ â”‚ v2  â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                               â”‚
â”‚ 75% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚ v1  â”‚ â”‚ v1  â”‚ â”‚ v1  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ ëª¨ë‹ˆí„°ë§ (15ë¶„) â†’ ë¬¸ì œ ì—†ìŒ

50% Canary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 50% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                               â”‚
â”‚ 50% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚ v1  â”‚ â”‚ v1  â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ ëª¨ë‹ˆí„°ë§ (15ë¶„) â†’ ë¬¸ì œ ì—†ìŒ

100% ì „í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚100% â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚         â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚ â”‚ v2  â”‚      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traefikì„ ì´ìš©í•œ Canary ë°°í¬

```yaml
# docker-compose.canary.yml
version: '3.8'

services:
  # Traefik (ë¡œë“œ ë°¸ëŸ°ì„œ)
  traefik:
    image: traefik:v2.10
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"  # Traefik ëŒ€ì‹œë³´ë“œ
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - lk-trade-network

  # Stable ë²„ì „ (v1.0)
  user-service-stable:
    image: lk-trade/user-service:1.0.0
    deploy:
      replicas: 4
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.user-stable.rule=Host(`api.lk-trade.com`)"
        - "traefik.http.services.user-stable.loadbalancer.server.port=8080"
        - "traefik.http.services.user-stable.loadbalancer.sticky.cookie=true"
        # ê°€ì¤‘ì¹˜: 95%
        - "traefik.http.services.user-stable.loadbalancer.weight=95"
    networks:
      - lk-trade-network

  # Canary ë²„ì „ (v2.0)
  user-service-canary:
    image: lk-trade/user-service:2.0.0
    deploy:
      replicas: 1
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.user-canary.rule=Host(`api.lk-trade.com`)"
        - "traefik.http.services.user-canary.loadbalancer.server.port=8080"
        - "traefik.http.services.user-canary.loadbalancer.sticky.cookie=true"
        # ê°€ì¤‘ì¹˜: 5%
        - "traefik.http.services.user-canary.loadbalancer.weight=5"
    networks:
      - lk-trade-network

networks:
  lk-trade-network:
    driver: overlay
```

### Canary ë°°í¬ ìžë™í™” ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# scripts/canary-deploy.sh

set -e

NEW_VERSION=$1
CANARY_PERCENTAGES=(5 25 50 100)
MONITORING_DURATION=900  # 15ë¶„ (ì´ˆ)

if [ -z "$NEW_VERSION" ]; then
    echo "Usage: $0 <new-version>"
    echo "Example: $0 2.0.0"
    exit 1
fi

echo "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Canary Deployment                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

New Version: $NEW_VERSION
Canary Stages: ${CANARY_PERCENTAGES[@]}%
Monitoring Duration: $MONITORING_DURATION seconds per stage
"

# Prometheus ë©”íŠ¸ë¦­ ì²´í¬ í•¨ìˆ˜
check_metrics() {
    local version=$1

    # ì—ëŸ¬ìœ¨ ì²´í¬
    ERROR_RATE=$(curl -s "http://localhost:9090/api/v1/query?query=rate(http_requests_total{status=~\"5..\",version=\"$version\"}[5m])" | jq -r '.data.result[0].value[1] // 0')

    # ì‘ë‹µ ì‹œê°„ ì²´í¬
    AVG_RESPONSE_TIME=$(curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,http_request_duration_seconds{version=\"$version\"})" | jq -r '.data.result[0].value[1] // 0')

    echo "  Error Rate: $ERROR_RATE"
    echo "  P95 Response Time: ${AVG_RESPONSE_TIME}s"

    # ìž„ê³„ê°’ ì²´í¬
    if (( $(echo "$ERROR_RATE > 0.01" | bc -l) )); then
        echo "  âŒ Error rate too high (>1%)"
        return 1
    fi

    if (( $(echo "$AVG_RESPONSE_TIME > 1.0" | bc -l) )); then
        echo "  âŒ Response time too slow (>1s)"
        return 1
    fi

    return 0
}

# Canary ë‹¨ê³„ë³„ ë°°í¬
for PERCENTAGE in "${CANARY_PERCENTAGES[@]}"; do
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ðŸš€ Deploying Canary: $PERCENTAGE%"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

    # ê°€ì¤‘ì¹˜ ê³„ì‚°
    STABLE_WEIGHT=$((100 - PERCENTAGE))
    CANARY_WEIGHT=$PERCENTAGE

    # Docker Compose íŒŒì¼ ì—…ë°ì´íŠ¸
    cat > docker-compose.canary-weights.yml <<EOF
version: '3.8'

services:
  user-service-stable:
    image: lk-trade/user-service:1.0.0
    deploy:
      labels:
        - "traefik.http.services.user-stable.loadbalancer.weight=$STABLE_WEIGHT"

  user-service-canary:
    image: lk-trade/user-service:$NEW_VERSION
    deploy:
      labels:
        - "traefik.http.services.user-canary.loadbalancer.weight=$CANARY_WEIGHT"
EOF

    # ë°°í¬
    docker stack deploy -c docker-compose.canary.yml -c docker-compose.canary-weights.yml lk-trade

    echo "â³ Monitoring for $MONITORING_DURATION seconds..."

    # ëª¨ë‹ˆí„°ë§
    ELAPSED=0
    while [ $ELAPSED -lt $MONITORING_DURATION ]; do
        sleep 30
        ELAPSED=$((ELAPSED + 30))

        echo ""
        echo "[$ELAPSED/${MONITORING_DURATION}s] Checking metrics..."

        if ! check_metrics "$NEW_VERSION"; then
            echo ""
            echo "âŒ Canary deployment failed at $PERCENTAGE%"
            echo "ðŸ”„ Rolling back..."

            # ë¡¤ë°±
            docker stack deploy -c docker-compose.stable-only.yml lk-trade

            echo "âœ… Rolled back to stable version"
            exit 1
        fi

        echo "  âœ… Metrics OK"
    done

    echo ""
    echo "âœ… Canary $PERCENTAGE% successful"
    echo ""

    if [ $PERCENTAGE -ne 100 ]; then
        read -p "Continue to next stage? (yes/no): " CONTINUE
        if [ "$CONTINUE" != "yes" ]; then
            echo "Deployment paused at $PERCENTAGE%"
            exit 0
        fi
    fi
done

echo "
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Canary deployment completed successfully!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Version $NEW_VERSION is now serving 100% of traffic.
"
```

### ìž¥ë‹¨ì 

```
âœ… ìž¥ì :
- ìœ„í—˜ ìµœì†Œí™” (ì†Œìˆ˜ ì‚¬ìš©ìžë§Œ ì˜í–¥)
- ì‹¤ì œ ì‚¬ìš©ìž í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
- ì ì§„ì  íŠ¸ëž˜í”½ ì¦ê°€
- ë¹ ë¥¸ ë¬¸ì œ ê°ì§€ ë° ë¡¤ë°±

âŒ ë‹¨ì :
- êµ¬í˜„ ë³µìž¡ë„ ë†’ìŒ
- ëª¨ë‹ˆí„°ë§ í•„ìˆ˜
- ë°°í¬ ì‹œê°„ ê¹€ (ë‹¨ê³„ë³„ ëª¨ë‹ˆí„°ë§)
- ì¸í”„ë¼ ë³µìž¡ì„± ì¦ê°€
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì¤‘ëŒ€í•œ ë³€ê²½ ì‚¬í•­
- ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶œì‹œ
- ëŒ€ê·œëª¨ ì‚¬ìš©ìž ëŒ€ìƒ ì„œë¹„ìŠ¤

---

## 5. A/B Testing

ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ ê¸°ë°˜ìœ¼ë¡œ ë‘ ë²„ì „ì„ ë¹„êµí•©ë‹ˆë‹¤.

### Canary vs A/B Testing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚ Canary            â”‚ A/B Testing      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ëª©ì             â”‚ ì•ˆì •ì„± ê²€ì¦       â”‚ ë¹„ì¦ˆë‹ˆìŠ¤ ê²€ì¦    â”‚
â”‚ ì‚¬ìš©ìž ì„ íƒ     â”‚ ëžœë¤              â”‚ ì˜ë„ì  ê·¸ë£¹ ë¶„ë¦¬ â”‚
â”‚ ëª¨ë‹ˆí„°ë§ ì§€í‘œ   â”‚ ì—ëŸ¬ìœ¨, ì‘ë‹µì‹œê°„  â”‚ ì „í™˜ìœ¨, ë§¤ì¶œ     â”‚
â”‚ ê¸°ê°„            â”‚ ì§§ìŒ (ë¶„~ì‹œê°„)    â”‚ ê¸¸ìŒ (ì¼~ì£¼)     â”‚
â”‚ ìµœì¢… ê²°ì •       â”‚ ìžë™ (ë©”íŠ¸ë¦­)     â”‚ ìˆ˜ë™ (ë¹„ì¦ˆë‹ˆìŠ¤)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬í˜„ ì˜ˆì‹œ

```yaml
# docker-compose.ab-testing.yml
version: '3.8'

services:
  traefik:
    image: traefik:v2.10
    command:
      - "--providers.docker=true"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - lk-trade-network

  # ë²„ì „ A (ê¸°ì¡´ UI)
  frontend-a:
    image: lk-trade/frontend:1.0.0-old-ui
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.frontend-a.rule=Host(`lk-trade.com`) && Header(`X-AB-Test`, `A`)"
        - "traefik.http.services.frontend-a.loadbalancer.server.port=80"
        - "traefik.http.middlewares.ab-test-a.headers.customrequestheaders.X-AB-Group=A"
    environment:
      - AB_TEST_GROUP=A
      - FEATURE_NEW_CHECKOUT=false
    networks:
      - lk-trade-network

  # ë²„ì „ B (ìƒˆ UI)
  frontend-b:
    image: lk-trade/frontend:2.0.0-new-ui
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.frontend-b.rule=Host(`lk-trade.com`) && Header(`X-AB-Test`, `B`)"
        - "traefik.http.services.frontend-b.loadbalancer.server.port=80"
        - "traefik.http.middlewares.ab-test-b.headers.customrequestheaders.X-AB-Group=B"
    environment:
      - AB_TEST_GROUP=B
      - FEATURE_NEW_CHECKOUT=true
    networks:
      - lk-trade-network

networks:
  lk-trade-network:
    driver: overlay
```

ì‚¬ìš©ìžë¥¼ ê·¸ë£¹ë³„ë¡œ ë¶„ë¦¬:

```javascript
// frontend/ab-test.js
function getABTestGroup() {
    // ì¿ í‚¤ì—ì„œ ê·¸ë£¹ í™•ì¸
    let group = getCookie('ab_test_group');

    if (!group) {
        // 50/50 ëžœë¤ ë°°ì •
        group = Math.random() < 0.5 ? 'A' : 'B';
        setCookie('ab_test_group', group, 30);  // 30ì¼
    }

    return group;
}

// API ìš”ì²­ ì‹œ í—¤ë” ì¶”ê°€
fetch('/api/orders', {
    headers: {
        'X-AB-Test': getABTestGroup()
    }
});

// ì´ë²¤íŠ¸ íŠ¸ëž˜í‚¹
function trackEvent(eventName, data) {
    analytics.track(eventName, {
        ...data,
        ab_test_group: getABTestGroup(),
        timestamp: new Date().toISOString()
    });
}

// ì˜ˆ: ì²´í¬ì•„ì›ƒ ì™„ë£Œ íŠ¸ëž˜í‚¹
trackEvent('checkout_completed', {
    order_id: orderId,
    amount: orderAmount
});
```

---

## 6. LK-Trade í”„ë¡œì íŠ¸ ë°°í¬ ì „ëžµ

### ê¶Œìž¥ ì „ëžµ

```
ì„œë¹„ìŠ¤ë³„ ë°°í¬ ì „ëžµ
=================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì„œë¹„ìŠ¤             â”‚ ë°°í¬ ì „ëžµ        â”‚ ì´ìœ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user-service       â”‚ Blue-Green       â”‚ ì¤‘ìš”ë„ ë†’ìŒ â”‚
â”‚ trade-service      â”‚ Canary           â”‚ ìœ„í—˜ë„ ë†’ìŒ â”‚
â”‚ account-service    â”‚ Rolling Update   â”‚ ì¼ë°˜ì       â”‚
â”‚ strategy-service   â”‚ Rolling Update   â”‚ ì¼ë°˜ì       â”‚
â”‚ notification       â”‚ Recreate         â”‚ ì¤‘ìš”ë„ ë‚®ìŒ â”‚
â”‚ admin              â”‚ Recreate         â”‚ ì‚¬ìš©ìž ì ìŒ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Makefile í†µí•©

```makefile
# Makefile
.PHONY: deploy-blue-green deploy-canary deploy-rolling

# Blue-Green ë°°í¬
deploy-blue-green:
	@echo "ðŸ”µðŸŸ¢ Blue-Green Deployment"
	@read -p "Enter service name: " service; \
	read -p "Enter new version: " version; \
	bash scripts/blue-green-deploy.sh $$service $$version

# Canary ë°°í¬
deploy-canary:
	@echo "ðŸ¤ Canary Deployment"
	@read -p "Enter service name: " service; \
	read -p "Enter new version: " version; \
	bash scripts/canary-deploy.sh $$service $$version

# Rolling Update
deploy-rolling:
	@echo "ðŸ”„ Rolling Update"
	@read -p "Enter service name: " service; \
	read -p "Enter new version: " version; \
	export VERSION=$$version && docker stack deploy -c docker-stack.yml lk-trade

# ë¡¤ë°±
rollback:
	@echo "âª Rollback"
	@read -p "Enter service name: " service; \
	docker service rollback lk-trade_$$service

# ë°°í¬ ìƒíƒœ í™•ì¸
deploy-status:
	@docker service ls
	@echo ""
	@docker service ps lk-trade_user-service --format "table {{.Name}}\t{{.Image}}\t{{.CurrentState}}"
```

---

## ðŸ‘¨â€ðŸ’» ì£¼ë‹ˆì–´ ê°œë°œìž ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì²« í”„ë¡œë•ì…˜ ë°°í¬ - ì „ì²´ ì„œë¹„ìŠ¤ ë‹¤ìš´

**ìƒí™©**:
```
ì£¼ë‹ˆì–´ Aì˜ ì²« í”„ë¡œë•ì…˜ ë°°í¬
íŒ€ìž¥: "user-service 2.0 ë²„ì „ í”„ë¡œë•ì…˜ ë°°í¬ ë¶€íƒí•´ìš”"
ì£¼ë‹ˆì–´ A: "ë„¤! (ë‘ê·¼ë‘ê·¼)"

15:00 - docker-compose down
15:01 - docker-compose pull
15:02 - docker-compose up -d
15:03 - ìŠ¬ëž™ì— ì•Œë¦¼ í­ì£¼: "ì„œë¹„ìŠ¤ ì•ˆë¼ìš”!"
15:04 - íŒ€ìž¥: "ì™œ ì „ì²´ ì„œë¹„ìŠ¤ê°€ ë‹¤ìš´ëì£ ?"
ì£¼ë‹ˆì–´ A: (ì‹ì€ë•€) "...docker-compose down í•˜ë©´ ì•ˆëë‚˜ìš”?"
```

**ë¬¸ì œì **:
- `docker-compose down`: ëª¨ë“  ì»¨í…Œì´ë„ˆ ì¤‘ì§€ â†’ ì „ì²´ ë‹¤ìš´íƒ€ìž„
- ìƒˆ ë²„ì „ì— ë²„ê·¸ ìžˆì„ ê²½ìš° ëª¨ë“  ì‚¬ìš©ìž ì˜í–¥
- ë¡¤ë°±ì—ë„ ì‹œê°„ ì†Œìš”

**ì˜¬ë°”ë¥¸ í•´ê²°**:
```bash
# âŒ ìž˜ëª»ëœ ë°©ë²•
docker-compose down  # ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨!
docker-compose up -d

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• 1: Rolling Update (Docker Swarm)
docker stack deploy -c docker-stack.yml lk-trade
# â†’ ìžë™ìœ¼ë¡œ í•˜ë‚˜ì”© ì—…ë°ì´íŠ¸, ë¬´ì¤‘ë‹¨ ë°°í¬

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• 2: Blue-Green ë°°í¬
bash scripts/blue-green-deploy.sh
# â†’ ìƒˆ ë²„ì „ ì¤€ë¹„ í›„ ì¦‰ì‹œ ì „í™˜, ë¡¤ë°± ìš©ì´

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• 3: ì„œë¹„ìŠ¤ë³„ ê°œë³„ ì—…ë°ì´íŠ¸
docker-compose up -d --no-deps user-service
# â†’ user-serviceë§Œ ì—…ë°ì´íŠ¸, ë‹¤ë¥¸ ì„œë¹„ìŠ¤ëŠ” ê³„ì† ìš´ì˜
```

**ë°°ìš´ ì **:
- í”„ë¡œë•ì…˜ ë°°í¬ëŠ” ì ˆëŒ€ `docker-compose down` ì‚¬ìš© ê¸ˆì§€
- Rolling Updateë‚˜ Blue-Green ë°°í¬ ì‚¬ìš©
- ë°°í¬ ì „ ë°˜ë“œì‹œ íŒ€ìž¥/ì‹œë‹ˆì–´ì—ê²Œ ë¦¬ë·° ë°›ê¸°

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë°°í¬ í›„ ë²„ê·¸ ë°œê²¬ - ë¹ ë¥¸ ë¡¤ë°±

**ìƒí™©**:
```
ì£¼ë‹ˆì–´ B: Blue-Green ë°°í¬ ì‹œë„

15:00 - Green í™˜ê²½ì— v2.0 ë°°í¬ ì™„ë£Œ
15:05 - Blue â†’ Green íŠ¸ëž˜í”½ ì „í™˜
15:06 - ëª¨ë‹ˆí„°ë§: "ì—ëŸ¬ìœ¨ ê¸‰ì¦!"
        ì—ëŸ¬ìœ¨: 0.1% â†’ 5% (50ë°° ì¦ê°€)
15:07 - ì£¼ë‹ˆì–´ B (ë‹¹í™©): "ì–´ë–»ê²Œ í•˜ì£ ?!"
ì‹œë‹ˆì–´: "ì¹¨ì°©í•˜ê²Œ ë¡¤ë°±í•˜ì„¸ìš”"
```

**ë‹¨ê³„ë³„ í•´ê²°**:
```bash
# Step 1: ì¦‰ì‹œ Green â†’ Blue ë¡¤ë°± (10ì´ˆ ì†Œìš”)
# nginx/upstream.conf ìˆ˜ì •
upstream user_service {
    server user-service-blue:8080;  # Green â†’ Blueë¡œ ë³µê·€
}

# Nginx ìž¬ì‹œìž‘
docker exec nginx nginx -s reload

# Step 2: í™•ì¸
curl http://localhost/health
# {"status":"UP","version":"1.0"}  â† v1.0ìœ¼ë¡œ ë³µê·€

# Step 3: Green í™˜ê²½ì—ì„œ ë¡œê·¸ í™•ì¸
docker logs user-service-green | grep ERROR

# ì¶œë ¥:
# NullPointerException at AccountController.getBalance()
# ì•„í•˜! v2.0ì˜ ë²„ê·¸ ë°œê²¬

# Step 4: ë²„ê·¸ ìˆ˜ì • í›„ ìž¬ë°°í¬
# ì½”ë“œ ìˆ˜ì • â†’ v2.1ë¡œ ë‹¤ì‹œ Green ë°°í¬ â†’ í…ŒìŠ¤íŠ¸ â†’ ì „í™˜
```

**ë°°ìš´ ì **:
- Blue-Green ë°°í¬ëŠ” ë¡¤ë°±ì´ ë§¤ìš° ë¹ ë¦„ (10ì´ˆ ì´ë‚´)
- ë°°í¬ í›„ ìµœì†Œ 30-60ë¶„ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜
- ì—ëŸ¬ìœ¨, ì‘ë‹µ ì‹œê°„, CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  í™•ì¸

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: Canary ë°°í¬ë¡œ ìœ„í—˜ ìµœì†Œí™”

**ìƒí™©**:
```
ì£¼ë‹ˆì–´ C: ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ í›„ ë°°í¬ (ë‘ë ¤ì›€ ê°€ë“)

"ì´ë²ˆ ì—…ë°ì´íŠ¸ëŠ” í•µì‹¬ ë¡œì§ì„ ë§Žì´ ë°”ê¿¨ì–´ìš”.
 í•œ ë²ˆì— ì „ì²´ ë°°í¬í•˜ê¸°ì—” ë„ˆë¬´ ìœ„í—˜í•´ìš”..."

ì‹œë‹ˆì–´: "Canary ë°°í¬ë¥¼ í•´ë³´ì„¸ìš”. 5%ë¶€í„° ì‹œìž‘í•˜ë©´ ë¼ìš”."
```

**ë‹¨ê³„ë³„ ì‹¤í–‰**:
```bash
# Step 1: 5% Canary ë°°í¬
cat > docker-compose.canary.yml <<EOF
services:
  user-service-stable:
    image: user-service:1.0
    deploy:
      replicas: 19  # 95%

  user-service-canary:
    image: user-service:2.0
    deploy:
      replicas: 1   # 5%
EOF

docker stack deploy -c docker-compose.canary.yml lk-trade

# Step 2: 15ë¶„ê°„ ëª¨ë‹ˆí„°ë§
echo "Monitoring Canary 5%..."
for i in {1..15}; do
    ERROR_RATE=$(docker stats user-service-canary --no-stream | grep user-service-canary)
    echo "$ië¶„: $ERROR_RATE"
    sleep 60
done

# Step 3: ë¬¸ì œ ì—†ìœ¼ë©´ 25%ë¡œ í™•ëŒ€
docker service scale lk-trade_user-service-canary=5
docker service scale lk-trade_user-service-stable=15

# Step 4: ê³„ì† ëª¨ë‹ˆí„°ë§ í›„ 50%, 100%ë¡œ í™•ëŒ€
```

**ë°°ìš´ ì **:
- ëŒ€ê·œëª¨ ë³€ê²½ì€ Canary ë°°í¬ í•„ìˆ˜
- ê° ë‹¨ê³„ë§ˆë‹¤ ì¶©ë¶„í•œ ëª¨ë‹ˆí„°ë§ ì‹œê°„ í™•ë³´
- ë¬¸ì œ ë°œê²¬ ì‹œ Canaryë§Œ ì¤‘ë‹¨í•˜ë©´ 95%ëŠ” ì•ˆì „

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ë°°í¬ ì „ëžµ ì„ íƒ ì‹¤ìˆ˜

**ìƒí™©**:
```
ì£¼ë‹ˆì–´ D: ê°œë°œ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ë˜ ë°©ì‹ì„ í”„ë¡œë•ì…˜ì— ê·¸ëŒ€ë¡œ ì ìš©

# ê°œë°œ í™˜ê²½ (ë¬¸ì œ ì—†ìŒ)
docker-compose down
docker-compose up -d

# í”„ë¡œë•ì…˜ í™˜ê²½ (í° ë¬¸ì œ!)
docker-compose -f docker-compose.prod.yml down  # â† ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨!
docker-compose -f docker-compose.prod.yml up -d

ê²°ê³¼: 5ë¶„ê°„ ì „ì²´ ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ìž„
íŒ€ìž¥: "ì™œ í”„ë¡œë•ì…˜ì—ì„œ downì„ ì‚¬ìš©í–ˆë‚˜ìš”?"
```

**í™˜ê²½ë³„ ì˜¬ë°”ë¥¸ ë°°í¬ ë°©ì‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í™˜ê²½        â”‚ ë°°í¬ ë°©ì‹        â”‚ ë‹¤ìš´íƒ€ìž„        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë¡œì»¬ ê°œë°œ   â”‚ docker-compose   â”‚ OK (í˜¼ìž ì‚¬ìš©)  â”‚
â”‚             â”‚ down & up        â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê°œë°œ ì„œë²„   â”‚ docker-compose   â”‚ OK (ê°œë°œíŒ€ë§Œ)   â”‚
â”‚             â”‚ up -d --build    â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìŠ¤í…Œì´ì§•    â”‚ Rolling Update   â”‚ ê¶Œìž¥ (ë¬´ì¤‘ë‹¨)   â”‚
â”‚             â”‚ ë˜ëŠ” Blue-Green  â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í”„ë¡œë•ì…˜    â”‚ Blue-Green       â”‚ í•„ìˆ˜ (ë¬´ì¤‘ë‹¨)   â”‚
â”‚             â”‚ ë˜ëŠ” Canary      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë°°ìš´ ì **:
- ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì€ ë°°í¬ ë°©ì‹ì´ ë‹¤ë¦„
- í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¬´ì¤‘ë‹¨ ë°°í¬ í•„ìˆ˜
- ë°°í¬ ì „ í•­ìƒ í™˜ê²½ í™•ì¸ (`echo $ENV`)

---

## â“ FAQ

<details>
<summary><strong>Q1: Rolling Updateì™€ Blue-Green ì¤‘ ì–´ë–¤ ê²ƒì„ ì„ íƒí•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**A**: **ë¦¬ì†ŒìŠ¤ì™€ ë¡¤ë°± ì†ë„ ìš”êµ¬ì‚¬í•­**ì— ë”°ë¼ ì„ íƒí•˜ì„¸ìš”.

**ìƒì„¸ ì„¤ëª…**:

**Rolling Update ì„ íƒ ê¸°ì¤€**:
```
âœ… ì„ íƒí•˜ëŠ” ê²½ìš°:
- ë¦¬ì†ŒìŠ¤ê°€ ì œí•œì ì¸ ê²½ìš° (ì„œë²„ ë¹„ìš© ì ˆê°)
- ë°°í¬ ë¹ˆë„ê°€ ë†’ì€ ê²½ìš° (ì¼ 10íšŒ+)
- ë²„ì „ ê°„ í˜¸í™˜ì„±ì´ ë³´ìž¥ë˜ëŠ” ê²½ìš°
- ë¡¤ë°±ì´ 3-5ë¶„ ì´ë‚´ë©´ OK

ì˜ˆ: ì¼ë°˜ì ì¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤, ìž‘ì€ ì—…ë°ì´íŠ¸
```

**Blue-Green ì„ íƒ ê¸°ì¤€**:
```
âœ… ì„ íƒí•˜ëŠ” ê²½ìš°:
- ì¦‰ì‹œ ë¡¤ë°±ì´ í•„ìš”í•œ ê²½ìš° (ê¸ˆìœµ, ê²°ì œ ì„œë¹„ìŠ¤)
- ë¦¬ì†ŒìŠ¤ê°€ ì¶©ë¶„í•œ ê²½ìš° (ì„œë²„ 2ë°°)
- ëŒ€ê·œëª¨ ë³€ê²½ ì‚¬í•­
- í”„ë¡œë•ì…˜ê³¼ ë™ì¼í•œ í™˜ê²½ì—ì„œ ì‚¬ì „ í…ŒìŠ¤íŠ¸ í•„ìš”

ì˜ˆ: ê²°ì œ ì„œë¹„ìŠ¤, ì¤‘ìš” API, ëŒ€ê·œëª¨ DB ë§ˆì´ê·¸ë ˆì´ì…˜ í¬í•¨ ë°°í¬
```

**ì‹¤ì „ ë¹„êµ**:
```bash
# ì‹œë‚˜ë¦¬ì˜¤: user-service ë°°í¬ (4ê°œ ì¸ìŠ¤í„´ìŠ¤)

Rolling Update:
- ë¦¬ì†ŒìŠ¤: 4ê°œ ì¸ìŠ¤í„´ìŠ¤ (ê¸°ì¡´ê³¼ ë™ì¼)
- ë°°í¬ ì‹œê°„: 5ë¶„ (í•˜ë‚˜ì”© ì—…ë°ì´íŠ¸)
- ë¡¤ë°± ì‹œê°„: 5ë¶„ (ë‹¤ì‹œ í•˜ë‚˜ì”© ë˜ëŒë¦¼)
- ë¹„ìš©: $0 (ì¶”ê°€ ë¦¬ì†ŒìŠ¤ ì—†ìŒ)

Blue-Green:
- ë¦¬ì†ŒìŠ¤: 8ê°œ ì¸ìŠ¤í„´ìŠ¤ (Blue 4ê°œ + Green 4ê°œ)
- ë°°í¬ ì‹œê°„: 2ë¶„ (Green ì¤€ë¹„ + ì „í™˜)
- ë¡¤ë°± ì‹œê°„: 10ì´ˆ (íŠ¸ëž˜í”½ë§Œ ì „í™˜)
- ë¹„ìš©: $100/ì›” (ì„œë²„ 2ë°° ì‚¬ìš© ê¸°ê°„ ë™ì•ˆ)
```

**Best Practice**:
- **ì¼ë°˜ì ì¸ ë°°í¬**: Rolling Update
- **ì¤‘ìš”í•œ ë°°í¬**: Blue-Green
- **ë§¤ìš° ì¤‘ìš”í•œ ë°°í¬**: Canary â†’ Blue-Green ì¡°í•©

</details>

<details>
<summary><strong>Q2: Canary ë°°í¬ ì‹œ ëª‡ í¼ì„¼íŠ¸ë¶€í„° ì‹œìž‘í•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**A**: **5%ì—ì„œ ì‹œìž‘í•˜ì—¬ 25% â†’ 50% â†’ 100%ë¡œ ì§„í–‰**í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ìž…ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**Canary ë¹„ìœ¨ ê²°ì • ê¸°ì¤€**:
```
ì‚¬ìš©ìž ê·œëª¨ì— ë”°ë¥¸ Canary ì‹œìž‘ ë¹„ìœ¨:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¼ì¼ ì‚¬ìš©ìž ìˆ˜ â”‚ ì‹œìž‘ ë¹„ìœ¨    â”‚ ì˜í–¥ ì‚¬ìš©ìž â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1,000ëª…        â”‚ 10%          â”‚ 100ëª…       â”‚
â”‚ 10,000ëª…       â”‚ 5%           â”‚ 500ëª…       â”‚
â”‚ 100,000ëª…      â”‚ 1%           â”‚ 1,000ëª…     â”‚
â”‚ 1,000,000ëª…+   â”‚ 0.1-1%       â”‚ 1,000-10këª… â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì›ì¹™: ìµœì†Œ 100-1,000ëª…ì˜ ì‚¬ìš©ìžì—ê²Œ í…ŒìŠ¤íŠ¸
```

**ì¼ë°˜ì ì¸ Canary ë‹¨ê³„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„  â”‚ ë¹„ìœ¨     â”‚ ëª¨ë‹ˆí„°ë§ ì‹œê°„â”‚ ëª©ì         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ë‹¨ê³„ â”‚ 5%       â”‚ 15-30ë¶„      â”‚ ê¸°ë³¸ ê²€ì¦   â”‚
â”‚ 2ë‹¨ê³„ â”‚ 25%      â”‚ 15-30ë¶„      â”‚ ë¶€í•˜ ê²€ì¦   â”‚
â”‚ 3ë‹¨ê³„ â”‚ 50%      â”‚ 15-30ë¶„      â”‚ ëŒ€ê·œëª¨ ê²€ì¦ â”‚
â”‚ 4ë‹¨ê³„ â”‚ 100%     â”‚ 1-2ì‹œê°„      â”‚ ì „ì²´ ë°°í¬   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì´ ì†Œìš” ì‹œê°„: 2-3ì‹œê°„
```

**ë³€ê²½ ê·œëª¨ì— ë”°ë¥¸ ì¡°ì •**:
```
ìž‘ì€ ë³€ê²½ (ë²„ê·¸ ìˆ˜ì •, ë§ˆì´ë„ˆ ì—…ë°ì´íŠ¸):
5% â†’ 50% â†’ 100%
ëª¨ë‹ˆí„°ë§: ê° 10ë¶„
ì´ ì‹œê°„: 30ë¶„

ì¤‘ê°„ ë³€ê²½ (ìƒˆ ê¸°ëŠ¥ ì¶”ê°€):
5% â†’ 25% â†’ 50% â†’ 100%
ëª¨ë‹ˆí„°ë§: ê° 15ë¶„
ì´ ì‹œê°„: 1ì‹œê°„

í° ë³€ê²½ (ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§):
1% â†’ 5% â†’ 10% â†’ 25% â†’ 50% â†’ 100%
ëª¨ë‹ˆí„°ë§: ê° 30ë¶„
ì´ ì‹œê°„: 3ì‹œê°„
```

**ìžë™í™” ì˜ˆì‹œ**:
```bash
#!/bin/bash
# scripts/canary-deploy.sh

PERCENTAGES=(5 25 50 100)
MONITOR_TIME=900  # 15ë¶„

for percent in "${PERCENTAGES[@]}"; do
    echo "Deploying Canary: $percent%"

    # íŠ¸ëž˜í”½ ë¹„ìœ¨ ì¡°ì •
    adjust_traffic_weight $percent

    # ëª¨ë‹ˆí„°ë§
    for ((i=0; i<$MONITOR_TIME; i+=30)); do
        ERROR_RATE=$(get_error_rate)
        if (( $(echo "$ERROR_RATE > 0.01" | bc -l) )); then
            echo "Error rate too high! Rolling back..."
            rollback_canary
            exit 1
        fi
        sleep 30
    done

    echo "Canary $percent% successful"
done
```

**í•µì‹¬**:
- ì‹œìž‘ ë¹„ìœ¨: 5% (ì‚¬ìš©ìž 10ë§Œëª… ì´í•˜)
- ê° ë‹¨ê³„: 15-30ë¶„ ëª¨ë‹ˆí„°ë§
- ìžë™ ë¡¤ë°± ê¸°ì¤€ ì„¤ì • (ì—ëŸ¬ìœ¨ > 1%)

</details>

<details>
<summary><strong>Q3: Blue-Green ë°°í¬ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?</strong></summary>

**A**: **í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ë‹¨ê³„ì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜**í•´ì•¼ í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ë¬¸ì œ ìƒí™©**:
```
Blue (v1.0): users í…Œì´ë¸”ì— `name` ì»¬ëŸ¼ ì‚¬ìš©
Green (v2.0): `name` ì»¬ëŸ¼ì„ `first_name`, `last_name`ìœ¼ë¡œ ë¶„ë¦¬

ë¬¸ì œ:
1. Green ë°°í¬ ì „ DB ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ Blueê°€ ë™ìž‘ ì•ˆ í•¨
2. Green ë°°í¬ í›„ DB ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ Greenì´ ë™ìž‘ ì•ˆ í•¨
```

**í•´ê²° ë°©ë²•: 3ë‹¨ê³„ ë§ˆì´ê·¸ë ˆì´ì…˜**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ë‹¨ê³„: ì»¬ëŸ¼ ì¶”ê°€ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)                â”‚
â”‚                                                     â”‚
â”‚ Migration v1:                                       â”‚
â”‚   ALTER TABLE users ADD COLUMN first_name VARCHAR; â”‚
â”‚   ALTER TABLE users ADD COLUMN last_name VARCHAR;  â”‚
â”‚   -- ê¸°ì¡´ name ì»¬ëŸ¼ ìœ ì§€!                          â”‚
â”‚                                                     â”‚
â”‚ ìƒíƒœ:                                               â”‚
â”‚   Blue (v1.0): name ì‚¬ìš© (ì—¬ì „ížˆ ë™ìž‘)             â”‚
â”‚   DB: name, first_name, last_name ëª¨ë‘ ì¡´ìž¬        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ë‹¨ê³„: Green (v2.0) ë°°í¬                            â”‚
â”‚                                                     â”‚
â”‚ Green ì½”ë“œ:                                         â”‚
â”‚   - first_name, last_name ì‚¬ìš©                     â”‚
â”‚   - name ì»¬ëŸ¼ ì½ê¸° ì§€ì› (fallback)                 â”‚
â”‚                                                     â”‚
â”‚ Blue â†’ Green íŠ¸ëž˜í”½ ì „í™˜                            â”‚
â”‚   - ë¬¸ì œ ì—†ìœ¼ë©´ Greenìœ¼ë¡œ ì™„ì „ ì „í™˜                â”‚
â”‚   - ë¬¸ì œ ìžˆìœ¼ë©´ Blueë¡œ ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ë‹¨ê³„: ê¸°ì¡´ ì»¬ëŸ¼ ì œê±° (ì¶©ë¶„í•œ ì‹œê°„ í›„)             â”‚
â”‚                                                     â”‚
â”‚ Green ë°°í¬ í›„ 1-2ì£¼ ë’¤:                             â”‚
â”‚   Migration v2:                                     â”‚
â”‚   ALTER TABLE users DROP COLUMN name;              â”‚
â”‚                                                     â”‚
â”‚ ì´ì œ Green (v2.0)ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ì•ˆì „               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì½”ë“œ ì˜ˆì‹œ**:

**v1.5 (ì¤‘ê°„ ë²„ì „): ë‘ ë°©ì‹ ëª¨ë‘ ì§€ì›**
```kotlin
// User.kt (v1.5)
@Entity
data class User(
    @Column(name = "first_name")
    val firstName: String?,

    @Column(name = "last_name")
    val lastName: String?,

    @Column(name = "name")
    @Deprecated("Use firstName and lastName")
    val name: String?
) {
    // í•˜ìœ„ í˜¸í™˜ì„± ë³´ìž¥
    fun getFullName(): String {
        return if (firstName != null && lastName != null) {
            "$firstName $lastName"
        } else {
            name ?: ""
        }
    }
}
```

**v2.0 (ìµœì¢… ë²„ì „): ìƒˆ ë°©ì‹ë§Œ ì‚¬ìš©**
```kotlin
// User.kt (v2.0)
@Entity
data class User(
    @Column(name = "first_name")
    val firstName: String,

    @Column(name = "last_name")
    val lastName: String
) {
    fun getFullName(): String = "$firstName $lastName"
}
```

**Best Practice**:
1. **í™•ìž¥ ë‹¨ê³„**: ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ (ê¸°ì¡´ ì»¬ëŸ¼ ìœ ì§€)
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„**: ìƒˆ ë²„ì „ ë°°í¬ (ì–‘ìª½ ì§€ì›)
3. **ì •ë¦¬ ë‹¨ê³„**: ê¸°ì¡´ ì»¬ëŸ¼ ì œê±° (ì¶©ë¶„í•œ ì‹œê°„ í›„)

</details>

<details>
<summary><strong>Q4: ë°°í¬ ì¤‘ ë¡¤ë°± ê¸°ì¤€ì€ ë¬´ì—‡ì¸ê°€ìš”?</strong></summary>

**A**: **ì—ëŸ¬ìœ¨, ì‘ë‹µ ì‹œê°„, ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ìžë™/ìˆ˜ë™ ë¡¤ë°±**í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ìžë™ ë¡¤ë°± ê¸°ì¤€**:
```yaml
# ë¡¤ë°± ìž„ê³„ê°’ (ìžë™)
rollback_criteria:
  error_rate:
    threshold: 1.0%        # ì—ëŸ¬ìœ¨ 1% ì´ˆê³¼ ì‹œ
    baseline: 0.1%         # í‰ì†Œ ì—ëŸ¬ìœ¨
    multiplier: 10x        # 10ë°° ì¦ê°€ ì‹œ ë¡¤ë°±

  response_time:
    p95_threshold: 2000ms  # P95 ì‘ë‹µì‹œê°„ 2ì´ˆ ì´ˆê³¼
    p99_threshold: 5000ms  # P99 ì‘ë‹µì‹œê°„ 5ì´ˆ ì´ˆê³¼
    baseline_p95: 200ms    # í‰ì†Œ P95

  resource_usage:
    cpu_threshold: 90%     # CPU 90% ì´ˆê³¼
    memory_threshold: 90%  # ë©”ëª¨ë¦¬ 90% ì´ˆê³¼

  health_check:
    consecutive_failures: 3  # ì—°ì† 3íšŒ ì‹¤íŒ¨ ì‹œ
```

**ì‹¤ì „ ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸**:
```bash
#!/bin/bash
# scripts/auto-rollback-monitor.sh

DEPLOY_VERSION=$1
BASELINE_ERROR_RATE=0.001  # 0.1%
THRESHOLD_ERROR_RATE=0.01   # 1%

monitor_deployment() {
    for i in {1..30}; do  # 30ë¶„ ëª¨ë‹ˆí„°ë§
        # ì—ëŸ¬ìœ¨ í™•ì¸
        CURRENT_ERROR_RATE=$(get_error_rate $DEPLOY_VERSION)

        if (( $(echo "$CURRENT_ERROR_RATE > $THRESHOLD_ERROR_RATE" | bc -l) )); then
            echo "ðŸš¨ Error rate too high: $CURRENT_ERROR_RATE"
            echo "Threshold: $THRESHOLD_ERROR_RATE"
            echo "Initiating automatic rollback..."
            rollback_deployment
            send_slack_alert "Automatic rollback triggered"
            return 1
        fi

        # P95 ì‘ë‹µ ì‹œê°„ í™•ì¸
        P95_RESPONSE=$(get_p95_response_time $DEPLOY_VERSION)
        if (( $(echo "$P95_RESPONSE > 2000" | bc -l) )); then
            echo "ðŸš¨ P95 response time too high: ${P95_RESPONSE}ms"
            rollback_deployment
            return 1
        fi

        # CPU ì‚¬ìš©ë¥  í™•ì¸
        CPU_USAGE=$(get_cpu_usage $DEPLOY_VERSION)
        if (( $(echo "$CPU_USAGE > 90" | bc -l) )); then
            echo "ðŸš¨ CPU usage too high: ${CPU_USAGE}%"
            rollback_deployment
            return 1
        fi

        echo "âœ… Minute $i: All metrics OK"
        sleep 60
    done

    echo "âœ… Deployment successful after 30 minutes monitoring"
    return 0
}
```

**ìˆ˜ë™ ë¡¤ë°± íŒë‹¨ ê¸°ì¤€**:
```
ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ:
â–¡ ê±°ëž˜ ì„±ê³µë¥  ê°ì†Œ (ê²°ì œ, ì£¼ë¬¸)
â–¡ ì‚¬ìš©ìž ì´íƒˆë¥  ì¦ê°€
â–¡ ê³ ê° ë¶ˆë§Œ ì ‘ìˆ˜ ì¦ê°€
â–¡ í•µì‹¬ ê¸°ëŠ¥ ì‚¬ìš© ê°ì†Œ

ê¸°ìˆ  ì§€í‘œ:
â–¡ ë°ì´í„° ì •í•©ì„± ë¬¸ì œ
â–¡ ì™¸ë¶€ API ì—°ë™ ì‹¤íŒ¨
â–¡ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ íŒ¨í„´
â–¡ ë¡œê·¸ì— ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬

ê²½í—˜ì  íŒë‹¨:
â–¡ "ë­”ê°€ ì´ìƒí•œë°?" ëŠë‚Œ
â–¡ íŒ€ì›ë“¤ì˜ ìš°ë ¤
â–¡ ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€

ì›ì¹™: "ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ë¡¤ë°±í•˜ë¼"
```

**ë¡¤ë°± ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤**:
```
ë°°í¬ í›„ ëª¨ë‹ˆí„°ë§
    â†“
ì§€í‘œ í™•ì¸ (1ë¶„ë§ˆë‹¤)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìž„ê³„ê°’ ì´ˆê³¼?      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
      Yes       No
      â†“         â†“
  [ìžë™ ë¡¤ë°±]  [ê³„ì† ëª¨ë‹ˆí„°ë§]
      â†“
  ìŠ¬ëž™ ì•Œë¦¼ ë°œì†¡
      â†“
  ì›ì¸ ë¶„ì„
      â†“
  ìˆ˜ì • í›„ ìž¬ë°°í¬
```

**í•µì‹¬**:
- ìžë™ ë¡¤ë°±: ëª…í™•í•œ ìˆ˜ì¹˜ ê¸°ì¤€
- ìˆ˜ë™ ë¡¤ë°±: ë¹„ì¦ˆë‹ˆìŠ¤ íŒë‹¨ + ì§ê°
- "ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ë¡¤ë°±" ì›ì¹™

</details>

<details>
<summary><strong>Q5: Rolling Update ì‹œ v1ê³¼ v2ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ”ë° ë¬¸ì œ ì—†ë‚˜ìš”?</strong></summary>

**A**: **ë²„ì „ ê°„ í˜¸í™˜ì„±(backward compatibility)ì„ ìœ ì§€**í•˜ë©´ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ë¬¸ì œ ìƒí™©**:
```
Rolling Update ì¤‘:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1.0 (ê¸°ì¡´)  â”‚ v2.0 (ìƒˆ ë²„ì „)       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚ ì»¨í…Œì´ë„ˆ 1   â”‚ ì»¨í…Œì´ë„ˆ 3 (ì—…ë°ì´íŠ¸)â”‚
â”‚ ì»¨í…Œì´ë„ˆ 2   â”‚ ì»¨í…Œì´ë„ˆ 4 (ì—…ë°ì´íŠ¸)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‚¬ìš©ìž ìš”ì²­ì´ v1ê³¼ v2ì— ì„žì—¬ì„œ ì „ë‹¬ë¨
â†’ ë²„ì „ ê°„ í˜¸í™˜ì„± í•„ìˆ˜!
```

**í˜¸í™˜ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸**:

**1. API í˜¸í™˜ì„±**:
```
âœ… OK: ìƒˆ í•„ë“œ ì¶”ê°€ (optional)
{
  "userId": 123,
  "name": "John",
  "email": "john@example.com"  // v2.0ì—ì„œ ì¶”ê°€
}

âŒ NOT OK: í•„ìˆ˜ í•„ë“œ ì œê±°
{
  "userId": 123
  // "name" ì œê±° â†’ v1.0ì´ ì²˜ë¦¬ ëª»í•¨!
}

âœ… OK: ê¸°ì¡´ í•„ë“œ ìœ ì§€ + ìƒˆ í•„ë“œ ì¶”ê°€
{
  "userId": 123,
  "name": "John",          // v1.0 í˜¸í™˜
  "email": "john@com"  // v2.0 ì‹ ê·œ
}
```

**2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**:
```sql
-- âœ… OK: ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ (NULL í—ˆìš©)
ALTER TABLE users
ADD COLUMN email VARCHAR(255) NULL;

-- âŒ NOT OK: ê¸°ì¡´ ì»¬ëŸ¼ ì œê±°
ALTER TABLE users
DROP COLUMN name;  -- v1.0ì´ ì‚¬ìš© ì¤‘!

-- âœ… OK: ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½ (3ë‹¨ê³„)
-- 1ë‹¨ê³„: new_column ì¶”ê°€
-- 2ë‹¨ê³„: v2.0 ë°°í¬ (ë‘˜ ë‹¤ ì§€ì›)
-- 3ë‹¨ê³„: old_column ì œê±°
```

**3. ë©”ì‹œì§€ í/ì´ë²¤íŠ¸**:
```kotlin
// âœ… OK: í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
data class UserCreatedEvent(
    val userId: Long,
    val name: String,
    val email: String? = null  // v2.0ì—ì„œ ì¶”ê°€ (optional)
) {
    // v1.0ë„ ì²˜ë¦¬ ê°€ëŠ¥ (email ë¬´ì‹œ)
    // v2.0ì€ email ì‚¬ìš©
}

// âŒ NOT OK: í•„ìˆ˜ í•„ë“œ ì¶”ê°€
data class UserCreatedEvent(
    val userId: Long,
    val name: String,
    val email: String  // í•„ìˆ˜! v1.0 ì²˜ë¦¬ ëª»í•¨
)
```

**4. ìºì‹œ í‚¤ í˜¸í™˜ì„±**:
```kotlin
// âœ… OK: ìºì‹œ í‚¤ì— ë²„ì „ í¬í•¨
val cacheKey = "user:${userId}:v2"

// âŒ NOT OK: ê°™ì€ í‚¤, ë‹¤ë¥¸ êµ¬ì¡°
// v1.0: "user:123" â†’ "John"
// v2.0: "user:123" â†’ {"name":"John","email":"john@com"}
// â†’ v1.0ì´ v2.0 ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨!
```

**ë²„ì „ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸**:
```bash
#!/bin/bash
# scripts/compatibility-test.sh

# 1. v1.0 ì»¨í…Œì´ë„ˆ ì‹œìž‘
docker run -d --name v1 user-service:1.0

# 2. v2.0 ì»¨í…Œì´ë„ˆ ì‹œìž‘
docker run -d --name v2 user-service:2.0

# 3. v1 â†’ v2 API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
curl v1/api/users/123 | jq > user_v1.json
curl v2/api/users/123 | jq > user_v2.json

# 4. v2 ì‘ë‹µì„ v1ì´ ì²˜ë¦¬ ê°€ëŠ¥í•œì§€ í™•ì¸
docker exec v1 curl -X POST \
    -H "Content-Type: application/json" \
    -d @user_v2.json \
    http://localhost:8080/api/users

# 5. ì„±ê³µí•˜ë©´ í˜¸í™˜ì„± OK
```

**Best Practice**:
- API: ìƒˆ í•„ë“œëŠ” optionalë¡œ ì¶”ê°€
- DB: 3ë‹¨ê³„ ë§ˆì´ê·¸ë ˆì´ì…˜
- ì´ë²¤íŠ¸: í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
- í…ŒìŠ¤íŠ¸: ë²„ì „ ê°„ í˜¸í™˜ì„± ìžë™ í…ŒìŠ¤íŠ¸

</details>

---

## ðŸ“ ë©´ì ‘ ì§ˆë¬¸

### ì£¼ë‹ˆì–´ ë ˆë²¨

**Q1: Rolling Updateì™€ Blue-Green ë°°í¬ì˜ ì°¨ì´ì ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

**A**: **Rolling UpdateëŠ” ì ì§„ì  êµì²´, Blue-Greenì€ ì¦‰ì‹œ ì „í™˜**ìž…ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

**Rolling Update**:
```
ë™ìž‘ ë°©ì‹:
1. ê¸°ì¡´ ì»¨í…Œì´ë„ˆë¥¼ í•˜ë‚˜ì”© ìƒˆ ë²„ì „ìœ¼ë¡œ êµì²´
2. ê° ì»¨í…Œì´ë„ˆ ì—…ë°ì´íŠ¸ ì‚¬ì´ì— ëŒ€ê¸° ì‹œê°„
3. ëª¨ë“  ì»¨í…Œì´ë„ˆê°€ ì—…ë°ì´íŠ¸ë  ë•Œê¹Œì§€ ë°˜ë³µ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1 v1 v1 v1  (ì´ˆê¸° ìƒíƒœ)        â”‚
â”‚  â†“                                â”‚
â”‚ v2 v1 v1 v1  (1ê°œ ì—…ë°ì´íŠ¸)      â”‚
â”‚  â†“                                â”‚
â”‚ v2 v2 v1 v1  (2ê°œ ì—…ë°ì´íŠ¸)      â”‚
â”‚  â†“                                â”‚
â”‚ v2 v2 v2 v1  (3ê°œ ì—…ë°ì´íŠ¸)      â”‚
â”‚  â†“                                â”‚
â”‚ v2 v2 v2 v2  (ì™„ë£Œ)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìž¥ì :
âœ… ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì  (ì¶”ê°€ ì„œë²„ ë¶ˆí•„ìš”)
âœ… ë¬´ì¤‘ë‹¨ ë°°í¬
âœ… ì ì§„ì  ìœ„í—˜ ë¶„ì‚°

ë‹¨ì :
âŒ ë°°í¬ ì‹œê°„ ê¹€ (5-10ë¶„)
âŒ ë¡¤ë°± ëŠë¦¼ (ë‹¤ì‹œ rolling)
âŒ v1ê³¼ v2 ë™ì‹œ ì‹¤í–‰ (í˜¸í™˜ì„± í•„ìš”)
```

**Blue-Green**:
```
ë™ìž‘ ë°©ì‹:
1. Blue(ê¸°ì¡´) í™˜ê²½ ìš´ì˜ ì¤‘
2. Green(ìƒˆ) í™˜ê²½ì„ ë˜‘ê°™ì´ êµ¬ì¶•
3. Green í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„
4. ë¡œë“œ ë°¸ëŸ°ì„œë§Œ Blue â†’ Green ì „í™˜ (1-2ì´ˆ)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Blue (v1)     Green (v2)            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚ v1 v1 v1 v1   v2 v2 v2 v2           â”‚
â”‚     â†‘             â†‘                  â”‚
â”‚ [íŠ¸ëž˜í”½]    [ëŒ€ê¸° ì¤‘]                â”‚
â”‚                                      â”‚
â”‚         íŠ¸ëž˜í”½ ì „í™˜ (1ì´ˆ)            â”‚
â”‚                                      â”‚
â”‚ v1 v1 v1 v1   v2 v2 v2 v2           â”‚
â”‚               â†‘                      â”‚
â”‚             [íŠ¸ëž˜í”½]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìž¥ì :
âœ… ì¦‰ì‹œ ì „í™˜ (1-2ì´ˆ)
âœ… ì¦‰ì‹œ ë¡¤ë°± (1-2ì´ˆ)
âœ… í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ì „ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
âœ… v1ê³¼ v2 ê²©ë¦¬

ë‹¨ì :
âŒ ë¦¬ì†ŒìŠ¤ 2ë°° í•„ìš”
âŒ ì¸í”„ë¼ ë¹„ìš© ì¦ê°€
âŒ DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë³µìž¡
```

**ì„ íƒ ê¸°ì¤€**:
```
Rolling Update ì¶”ì²œ:
- ì¼ë°˜ì ì¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
- ë¦¬ì†ŒìŠ¤ ì œì•½ì´ ìžˆëŠ” í™˜ê²½
- ìžì£¼ ë°°í¬í•˜ëŠ” ì„œë¹„ìŠ¤

Blue-Green ì¶”ì²œ:
- ê¸ˆìœµ/ê²°ì œ ì„œë¹„ìŠ¤
- ì¦‰ì‹œ ë¡¤ë°±ì´ ì¤‘ìš”í•œ ì„œë¹„ìŠ¤
- ëŒ€ê·œëª¨ ë³€ê²½ ì‚¬í•­
```

---

**Q2: Canary ë°°í¬ëŠ” ë¬´ì—‡ì´ê³  ì–¸ì œ ì‚¬ìš©í•˜ë‚˜ìš”?**

**A**: **ì†Œìˆ˜ ì‚¬ìš©ìžì—ê²Œ ë¨¼ì € ë°°í¬í•˜ì—¬ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ëŠ” ì „ëžµ**ìž…ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

**Canary ë°°í¬ ê°œë…**:
```
"íƒ„ê´‘ì˜ ì¹´ë‚˜ë¦¬ì•„"ì—ì„œ ìœ ëž˜
- ì˜›ë‚  ê´‘ë¶€ë“¤ì´ ìœ ë… ê°€ìŠ¤ ê°ì§€ë¥¼ ìœ„í•´ ì¹´ë‚˜ë¦¬ì•„ë¥¼ ë°ë ¤ê°
- ì¹´ë‚˜ë¦¬ì•„ê°€ ì£½ìœ¼ë©´ ê´‘ë¶€ë“¤ì´ ì¦‰ì‹œ ëŒ€í”¼

Docker Canary:
- ì†Œìˆ˜ ì‚¬ìš©ìž = ì¹´ë‚˜ë¦¬ì•„
- ë¬¸ì œ ë°œê²¬ ì‹œ ì „ì²´ ì‚¬ìš©ìž ì˜í–¥ ì „ì— ì¤‘ë‹¨
```

**ë™ìž‘ ë°©ì‹**:
```
1ë‹¨ê³„: 5% íŠ¸ëž˜í”½ì„ ìƒˆ ë²„ì „ìœ¼ë¡œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 95% â†’ v1 (Stable)           â”‚
â”‚  5% â†’ v2 (Canary) â† ëª¨ë‹ˆí„°ë§â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
15-30ë¶„ ëª¨ë‹ˆí„°ë§
  âœ… OK â†’ ë‹¤ìŒ ë‹¨ê³„
  âŒ ë¬¸ì œ â†’ ì¦‰ì‹œ ì¤‘ë‹¨

2ë‹¨ê³„: 25% íŠ¸ëž˜í”½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 75% â†’ v1                     â”‚
â”‚ 25% â†’ v2 â† ëª¨ë‹ˆí„°ë§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
15-30ë¶„ ëª¨ë‹ˆí„°ë§

3ë‹¨ê³„: 50% íŠ¸ëž˜í”½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 50% â†’ v1                     â”‚
â”‚ 50% â†’ v2 â† ëª¨ë‹ˆí„°ë§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4ë‹¨ê³„: 100% ì „í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 100% â†’ v2 (ì„±ê³µ!)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
```
âœ… Canary ë°°í¬ í•„ìˆ˜ ìƒí™©:
1. ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§
   ì˜ˆ: í•µì‹¬ API ë¡œì§ ì „ë©´ ë³€ê²½

2. ìƒˆë¡œìš´ ì•Œê³ ë¦¬ì¦˜ ë„ìž…
   ì˜ˆ: ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ML ëª¨ë¸ ë³€ê²½

3. ì™¸ë¶€ ì˜ì¡´ì„± ë³€ê²½
   ì˜ˆ: ê²°ì œ PGì‚¬ ë³€ê²½

4. ì„±ëŠ¥ ìµœì í™”
   ì˜ˆ: DB ì¿¼ë¦¬ ìµœì í™” (ì„±ëŠ¥ íšŒê·€ ê²€ì¦)

5. ì‹ ê·œ ê¸°ëŠ¥ ì¶œì‹œ
   ì˜ˆ: ìƒˆë¡œìš´ ê±°ëž˜ ë°©ì‹ ì¶”ê°€

âŒ Canary ë¶ˆí•„ìš” ìƒí™©:
- ì˜¤íƒ€ ìˆ˜ì •
- ë¡œê·¸ ë©”ì‹œì§€ ë³€ê²½
- UI í…ìŠ¤íŠ¸ ìˆ˜ì •
- ë¬¸ì„œ ì—…ë°ì´íŠ¸
```

**êµ¬í˜„ ì˜ˆì‹œ**:
```yaml
# Traefikë¡œ Canary êµ¬í˜„
services:
  stable:
    image: user-service:1.0
    deploy:
      labels:
        - "traefik.http.services.stable.loadbalancer.weight=95"

  canary:
    image: user-service:2.0
    deploy:
      labels:
        - "traefik.http.services.canary.loadbalancer.weight=5"
```

**í•µì‹¬**:
- 5% â†’ 25% â†’ 50% â†’ 100% ì ì§„ì  ì¦ê°€
- ê° ë‹¨ê³„ì—ì„œ ì¶©ë¶„í•œ ëª¨ë‹ˆí„°ë§
- ì—ëŸ¬ìœ¨, ì‘ë‹µì‹œê°„, ë¦¬ì†ŒìŠ¤ í™•ì¸
- ë¬¸ì œ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨

---

### ì¤‘ê¸‰ ë ˆë²¨

**Q3: Blue-Green ë°°í¬ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í•˜ë‚˜ìš”?**

**A**: **3ë‹¨ê³„ ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ ì§€**í•©ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

(ì´ ë¶€ë¶„ì€ FAQ Q3ì™€ ë™ì¼í•˜ë¯€ë¡œ ìƒëžµí•˜ê³  ì¶”ê°€ ë©´ì ‘ íŒ ì œê³µ)

**ë©´ì ‘ì—ì„œ ì¶”ê°€ë¡œ ë‹µë³€í•˜ë©´ ì¢‹ì€ ë‚´ìš©**:
```
1. ì‹¤ë¬´ ê²½í—˜ ê°•ì¡°:
"ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ users í…Œì´ë¸”ì˜ name ì»¬ëŸ¼ì„
 first_name, last_nameìœ¼ë¡œ ë¶„ë¦¬í•  ë•Œ ì´ ë°©ì‹ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
 1ì£¼ì¼ê°„ ë‘ ë°©ì‹ì„ ëª¨ë‘ ì§€ì›í•œ í›„ ê¸°ì¡´ ì»¬ëŸ¼ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤."

2. íŠ¸ë ˆì´ë“œì˜¤í”„ ì„¤ëª…:
"3ë‹¨ê³„ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì‹œê°„ì´ ë” ê±¸ë¦¬ì§€ë§Œ,
 ë¡¤ë°±ì´ ì‰½ê³  ì•ˆì „í•©ë‹ˆë‹¤. ê¸´ê¸‰í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´
 ì´ ë°©ì‹ì„ ì¶”ì²œí•©ë‹ˆë‹¤."

3. ëŒ€ì•ˆ ì œì‹œ:
"ë°ì´í„°ë² ì´ìŠ¤ ë·°(View)ë¥¼ ì‚¬ìš©í•˜ë©´
 ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³€ê²½ ì—†ì´ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."
```

---

**Q4: ë°°í¬ ì¤‘ ë¡¤ë°±ì„ í•´ì•¼ í•˜ëŠ” ìƒí™©ê³¼ íŒë‹¨ ê¸°ì¤€ì€ ë¬´ì—‡ì¸ê°€ìš”?**

**A**: **ìžë™ ë¡¤ë°± ê¸°ì¤€ê³¼ ìˆ˜ë™ íŒë‹¨ ê¸°ì¤€ì„ ì¡°í•©**í•©ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

**ìžë™ ë¡¤ë°± ê¸°ì¤€ (ë©”íŠ¸ë¦­ ê¸°ë°˜)**:
```
1. ì—ëŸ¬ìœ¨ ê¸‰ì¦
   í‰ì†Œ: 0.1%
   í˜„ìž¬: 5%
   â†’ 50ë°° ì¦ê°€ â†’ ì¦‰ì‹œ ë¡¤ë°±

2. ì‘ë‹µ ì‹œê°„ ì¦ê°€
   í‰ì†Œ P95: 200ms
   í˜„ìž¬ P95: 2000ms
   â†’ 10ë°° ì¦ê°€ â†’ ì¦‰ì‹œ ë¡¤ë°±

3. í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
   ì—°ì† 3íšŒ ì‹¤íŒ¨ â†’ ì¦‰ì‹œ ë¡¤ë°±

4. ë¦¬ì†ŒìŠ¤ ì´ˆê³¼
   CPU/ë©”ëª¨ë¦¬ 90% ì´ˆê³¼ â†’ ë¡¤ë°±
```

**ìˆ˜ë™ ë¡¤ë°± íŒë‹¨ (ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ì¤€)**:
```
1. ê²°ì œ/ê±°ëž˜ ì‹¤íŒ¨ ì¦ê°€
   "ê²°ì œê°€ ì•ˆë¼ìš”" ë¬¸ì˜ ê¸‰ì¦
   â†’ ì¦‰ì‹œ ì¡°ì‚¬ í›„ ë¡¤ë°± ê²°ì •

2. ë°ì´í„° ì •í•©ì„± ë¬¸ì œ
   "ìž”ê³ ê°€ ì´ìƒí•´ìš”"
   â†’ ì¦‰ì‹œ ë¡¤ë°± + ë°ì´í„° ë³µêµ¬

3. ì•Œ ìˆ˜ ì—†ëŠ” ë™ìž‘
   ë¡œê·¸ì— ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬
   â†’ ì›ì¸ íŒŒì•… ì–´ë ¤ìš°ë©´ ë¡¤ë°±

4. ê³ ê° ë¶ˆë§Œ ê¸‰ì¦
   ìŠ¬ëž™/CS ì±„ë„ì— ë¬¸ì˜ í­ì£¼
   â†’ ì¦‰ì‹œ ìƒí™© íŒŒì•… í›„ íŒë‹¨
```

**ë¡¤ë°± ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤**:
```python
def should_rollback(metrics, business_metrics):
    # ìžë™ ë¡¤ë°± ê¸°ì¤€ (ëª…í™•í•œ ìž„ê³„ê°’)
    if metrics.error_rate > 0.01:  # 1% ì´ˆê³¼
        return True, "Error rate exceeded"

    if metrics.p95_response_time > 2000:  # 2ì´ˆ ì´ˆê³¼
        return True, "Response time too high"

    if metrics.consecutive_health_check_failures >= 3:
        return True, "Health check failed"

    # ìˆ˜ë™ íŒë‹¨ ê¸°ì¤€ (íŒ€ í•©ì˜)
    if business_metrics.payment_failure_rate > baseline * 2:
        return True, "Payment failures increased"

    if business_metrics.customer_complaints > threshold:
        return True, "Too many customer complaints"

    # ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ê²½ìš°ë„ ë¡¤ë°±
    if metrics.looks_suspicious():
        return True, "Suspicious behavior detected"

    return False, "All OK"

# ì›ì¹™: "ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ë¡¤ë°±í•˜ë¼"
# ìž¬ë°°í¬ëŠ” ì‰½ì§€ë§Œ, ê³ ê° ì‹ ë¢° íšŒë³µì€ ì–´ë µë‹¤
```

**ì‹¤ì „ ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤**:
```
Case 1: ëª…í™•í•œ ì—ëŸ¬ â†’ ì¦‰ì‹œ ë¡¤ë°±
15:05 - ë°°í¬ ì™„ë£Œ
15:10 - ì—ëŸ¬ìœ¨ 0.1% â†’ 3% (30ë°°)
15:11 - ìžë™ ë¡¤ë°± ì‹¤í–‰
15:12 - ì—ëŸ¬ìœ¨ ì •ìƒí™”
15:13 - ìŠ¬ëž™ ì•Œë¦¼: "Automatic rollback completed"

Case 2: ì• ë§¤í•œ ìƒí™© â†’ íŒ€ ë…¼ì˜
15:05 - ë°°í¬ ì™„ë£Œ
15:20 - ì—ëŸ¬ìœ¨ ì •ìƒ, ì‘ë‹µì‹œê°„ ì •ìƒ
15:25 - ê³ ê° ë¬¸ì˜ 3ê±´: "í™”ë©´ì´ ì´ìƒí•´ìš”"
15:30 - íŒ€ ë…¼ì˜: "ë¡¤ë°±í• ê¹Œìš”?"
15:35 - ê²°ì •: ë¡¤ë°± (ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ë¡¤ë°±)
15:40 - ì›ì¸ íŒŒì•… í›„ ìž¬ë°°í¬ ì¤€ë¹„
```

**í•µì‹¬**:
- ìžë™: ëª…í™•í•œ ë©”íŠ¸ë¦­ ìž„ê³„ê°’
- ìˆ˜ë™: ë¹„ì¦ˆë‹ˆìŠ¤ íŒë‹¨ + ì§ê°
- ì›ì¹™: "ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ë¡¤ë°±"

---

**Q5: ëŒ€ê·œëª¨ íŠ¸ëž˜í”½ ì„œë¹„ìŠ¤ì—ì„œ ì•ˆì „í•˜ê²Œ ë°°í¬í•˜ë ¤ë©´ ì–´ë–¤ ì „ëžµì„ ì¡°í•©í•´ì•¼ í•˜ë‚˜ìš”?**

**A**: **Canary + Blue-Green + Feature Flagë¥¼ ì¡°í•©**í•©ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

**ë‹¨ê³„ë³„ ì•ˆì „ ë°°í¬ ì „ëžµ**:

```
1ë‹¨ê³„: Feature Flag (ê¸°ëŠ¥ í† ê¸€)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì½”ë“œëŠ” ë°°í¬í•˜ë˜, ê¸°ëŠ¥ì€ ë¹„í™œì„±í™”     â”‚
â”‚                                     â”‚
â”‚ if (featureFlag.isEnabled("new_ui")) {â”‚
â”‚     renderNewUI()                   â”‚
â”‚ } else {                            â”‚
â”‚     renderOldUI()  // ê¸°ë³¸ê°’        â”‚
â”‚ }                                    â”‚
â”‚                                     â”‚
â”‚ ìž¥ì : ë°°í¬ì™€ ì¶œì‹œ ë¶„ë¦¬               â”‚
â”‚       ë¡¤ë°± ë¶ˆí•„ìš” (í† ê¸€ë§Œ OFF)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ë‹¨ê³„: Canary ë°°í¬ (ì†Œìˆ˜ ê²€ì¦)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5% ì‚¬ìš©ìžì—ê²Œ Feature Flag ON       â”‚
â”‚                                     â”‚
â”‚ featureFlag.setPercentage(          â”‚
â”‚     "new_ui",                       â”‚
â”‚     percentage=5,                   â”‚
â”‚     userGroup="internal"  // ì§ì›ë§Œ â”‚
â”‚ )                                    â”‚
â”‚                                     â”‚
â”‚ 1ì¼ ëª¨ë‹ˆí„°ë§ â†’ ë¬¸ì œ ì—†ìœ¼ë©´ í™•ëŒ€     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3ë‹¨ê³„: Blue-Green ë°°í¬ (ì „í™˜ ì¤€ë¹„)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Green í™˜ê²½ì— ìƒˆ ë²„ì „ ì™„ì „ ë°°í¬       â”‚
â”‚                                     â”‚
â”‚ Blue (v1.0) - 100% íŠ¸ëž˜í”½           â”‚
â”‚ Green (v2.0) - Feature Flag 25% ON â”‚
â”‚                                     â”‚
â”‚ 3ì¼ ëª¨ë‹ˆí„°ë§ â†’ ë¬¸ì œ ì—†ìœ¼ë©´ ì „í™˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4ë‹¨ê³„: ì „ì²´ ì „í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Blue â†’ Green íŠ¸ëž˜í”½ ì „í™˜ (1-2ì´ˆ)    â”‚
â”‚ Feature Flag 100% ON                â”‚
â”‚                                     â”‚
â”‚ 1ì£¼ì¼ ëª¨ë‹ˆí„°ë§ â†’ ì•ˆì •í™” í™•ì¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5ë‹¨ê³„: ì •ë¦¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Blue í™˜ê²½ ì œê±°                       â”‚
â”‚ Feature Flag ì½”ë“œ ì •ë¦¬               â”‚
â”‚ Old UI ì½”ë“œ ì œê±°                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ì˜ˆì‹œ**:

**Feature Flag ì‹œìŠ¤í…œ**:
```kotlin
// FeatureFlagService.kt
interface FeatureFlagService {
    fun isEnabled(
        flagName: String,
        userId: Long
    ): Boolean
}

class LaunchDarklyFeatureFlagService : FeatureFlagService {
    override fun isEnabled(
        flagName: String,
        userId: Long
    ): Boolean {
        val user = LDUser.Builder(userId.toString()).build()
        return ldClient.boolVariation(flagName, user, false)
    }
}

// Controller.kt
@GetMapping("/dashboard")
fun getDashboard(@AuthUser user: User): String {
    return if (featureFlagService.isEnabled("new_dashboard", user.id)) {
        renderNewDashboard()
    } else {
        renderOldDashboard()
    }
}
```

**Canary + Feature Flag ì¡°í•©**:
```python
# ë°°í¬ ìžë™í™” ìŠ¤í¬ë¦½íŠ¸
def safe_deployment(version):
    # 1. Green í™˜ê²½ì— ë°°í¬
    deploy_to_green(version)

    # 2. Feature Flag: 5% ì§ì›ë§Œ
    feature_flag.set(
        "new_feature",
        percentage=5,
        whitelist=["employee_group"]
    )
    sleep(hours=24)  # 1ì¼ ëª¨ë‹ˆí„°ë§

    # 3. Feature Flag: 25% ì¼ë°˜ ì‚¬ìš©ìž
    if metrics_ok():
        feature_flag.set(
            "new_feature",
            percentage=25,
            whitelist=None
        )
        sleep(hours=72)  # 3ì¼ ëª¨ë‹ˆí„°ë§
    else:
        rollback_feature_flag()
        return False

    # 4. Blue â†’ Green ì „í™˜
    if metrics_ok():
        switch_traffic_to_green()
        feature_flag.set("new_feature", percentage=100)
    else:
        switch_traffic_to_blue()
        return False

    # 5. 1ì£¼ì¼ í›„ ì •ë¦¬
    sleep(days=7)
    if metrics_ok():
        cleanup_blue()
        remove_feature_flag_code()

    return True
```

**ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature Flag: new_checkout                      â”‚
â”‚                                                 â”‚
â”‚ Enabled: 25%                                    â”‚
â”‚ Rollout: Canary (5% â†’ 25% â†’ 50% â†’ 100%)       â”‚
â”‚                                                 â”‚
â”‚ Metrics:                                        â”‚
â”‚ â”œâ”€ Error Rate:     0.08% (âœ… OK)               â”‚
â”‚ â”œâ”€ P95 Response:   180ms (âœ… OK)               â”‚
â”‚ â”œâ”€ Conversion:     4.2% (âœ… +0.3% vs old)      â”‚
â”‚ â””â”€ Revenue/User:   $42 (âœ… +$2 vs old)         â”‚
â”‚                                                 â”‚
â”‚ User Feedback:                                  â”‚
â”‚ â”œâ”€ Positive: 127 (85%)                         â”‚
â”‚ â”œâ”€ Negative: 23 (15%)                          â”‚
â”‚ â””â”€ "Faster checkout!" â­â­â­â­â­              â”‚
â”‚                                                 â”‚
â”‚ [ðŸ”´ Emergency Rollback]  [ðŸŸ¢ Increase to 50%] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬**:
- Feature Flag: ë°°í¬ì™€ ì¶œì‹œ ë¶„ë¦¬
- Canary: ì ì§„ì  ìœ„í—˜ ë¶„ì‚°
- Blue-Green: ë¹ ë¥¸ ì „í™˜/ë¡¤ë°±
- 3ê°€ì§€ ì¡°í•© = ìµœê³  ì•ˆì „ì„±

---

## ë‹¤ìŒ ë‹¨ê³„

ì¶•í•˜í•©ë‹ˆë‹¤! í”„ë¡œë•ì…˜ ë°°í¬ ì „ëžµì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤.

### ì´ë²ˆ ì„¹ì…˜ì—ì„œ ë°°ìš´ ê²ƒ

âœ… ë°°í¬ ì „ëžµì˜ ì¤‘ìš”ì„±
âœ… Recreate ë°°í¬
âœ… Rolling Update (ìˆœì°¨ ë°°í¬)
âœ… Blue-Green ë°°í¬
âœ… Canary ë°°í¬
âœ… A/B Testing
âœ… ì„œë¹„ìŠ¤ë³„ ë°°í¬ ì „ëžµ ì„ íƒ

### ë‹¤ìŒì— ë°°ìš¸ ê²ƒ

**ì„¹ì…˜ 30: CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**ì—ì„œëŠ”:
- GitHub Actionsë¥¼ ì´ìš©í•œ CI/CD
- Jenkinsë¥¼ ì´ìš©í•œ CI/CD
- GitLab CI/CD
- ìžë™í™”ëœ í…ŒìŠ¤íŠ¸ ë° ë°°í¬

### ì¶”ê°€ í•™ìŠµ ìžë£Œ

**ê³µì‹ ë¬¸ì„œ:**
- [Docker Swarm Deploy](https://docs.docker.com/engine/swarm/stack-deploy/)
- [Rolling Updates](https://docs.docker.com/engine/swarm/swarm-tutorial/rolling-update/)

**ë„êµ¬:**
- [Traefik](https://traefik.io/) - í˜„ëŒ€ì ì¸ ë¡œë“œ ë°¸ëŸ°ì„œ
- [Flagger](https://flagger.app/) - Canary ë°°í¬ ìžë™í™”

---

**ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ë§Œë‚˜ìš”!** ðŸš€