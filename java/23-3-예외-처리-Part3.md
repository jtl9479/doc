# 23-3. ì˜ˆì™¸ ì²˜ë¦¬ Part 3 ğŸ›¡ï¸

## ğŸ“‹ ëª©ì°¨
1. [ì‹¤ì „ í”„ë¡œì íŠ¸: ë³µì›ë ¥ ìˆëŠ” ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ](#ì‹¤ì „-í”„ë¡œì íŠ¸)
2. [FAQ 7ì„ ](#faq)
3. [ë©´ì ‘ ì§ˆë¬¸ 12ì„ ](#ë©´ì ‘-ì§ˆë¬¸)

---

## ğŸš€ ì‹¤ì „ í”„ë¡œì íŠ¸: ë³µì›ë ¥ ìˆëŠ” ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ

### í”„ë¡œì íŠ¸ ê°œìš”
ì´ì»¤ë¨¸ìŠ¤ í”Œë«í¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” **ì¥ì• ì— ê°•í•œ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ**ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

**í•µì‹¬ ê¸°ëŠ¥:**
- âœ… ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°
- âœ… íŠ¸ëœì­ì…˜ ë¡¤ë°± ë° ë³´ìƒ ì²˜ë¦¬
- âœ… ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ (Exponential Backoff)
- âœ… Circuit Breaker íŒ¨í„´
- âœ… ì˜ˆì™¸ ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
- âœ… ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜ (Graceful Degradation)

---

### 1ï¸âƒ£ ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°

```java
// ğŸ“ exceptions/OrderException.java
/**
 * ì£¼ë¬¸ ì²˜ë¦¬ ê´€ë ¨ ìµœìƒìœ„ ì˜ˆì™¸
 */
public abstract class OrderException extends RuntimeException {
    private final String errorCode;
    private final long timestamp;

    public OrderException(String errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
        this.timestamp = System.currentTimeMillis();
    }

    public OrderException(String errorCode, String message, Throwable cause) {
        super(message, cause);
        this.errorCode = errorCode;
        this.timestamp = System.currentTimeMillis();
    }

    public String getErrorCode() {
        return errorCode;
    }

    public long getTimestamp() {
        return timestamp;
    }

    /**
     * ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨
     */
    public abstract boolean isRetryable();

    /**
     * ì‹¬ê°ë„ ìˆ˜ì¤€
     */
    public abstract SeverityLevel getSeverity();
}

enum SeverityLevel {
    LOW,      // ë¡œê·¸ë§Œ ë‚¨ê¹€
    MEDIUM,   // ì•Œë¦¼ ë°œì†¡
    HIGH,     // ì¦‰ì‹œ ëŒ€ì‘ í•„ìš”
    CRITICAL  // ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ê°€ëŠ¥ì„±
}
```

```java
// ğŸ“ exceptions/PaymentException.java
/**
 * ê²°ì œ ê´€ë ¨ ì˜ˆì™¸
 */
public class PaymentException extends OrderException {
    private final String paymentId;

    public PaymentException(String paymentId, String message) {
        super("PAYMENT_ERROR", message);
        this.paymentId = paymentId;
    }

    public PaymentException(String paymentId, String message, Throwable cause) {
        super("PAYMENT_ERROR", message, cause);
        this.paymentId = paymentId;
    }

    public String getPaymentId() {
        return paymentId;
    }

    @Override
    public boolean isRetryable() {
        return true; // ê²°ì œëŠ” ì¬ì‹œë„ ê°€ëŠ¥
    }

    @Override
    public SeverityLevel getSeverity() {
        return SeverityLevel.HIGH; // ê²°ì œ ì‹¤íŒ¨ëŠ” ë†’ì€ ìš°ì„ ìˆœìœ„
    }
}

/**
 * ì¹´ë“œ í•œë„ ì´ˆê³¼ ì˜ˆì™¸
 */
public class CardLimitExceededException extends PaymentException {
    private final int currentLimit;
    private final int requestedAmount;

    public CardLimitExceededException(String paymentId, int currentLimit, int requestedAmount) {
        super(paymentId, String.format(
            "ì¹´ë“œ í•œë„ ì´ˆê³¼: í˜„ì¬ í•œë„ %,dì›, ìš”ì²­ ê¸ˆì•¡ %,dì›",
            currentLimit, requestedAmount
        ));
        this.currentLimit = currentLimit;
        this.requestedAmount = requestedAmount;
    }

    @Override
    public boolean isRetryable() {
        return false; // í•œë„ ì´ˆê³¼ëŠ” ì¬ì‹œë„ ë¶ˆê°€
    }
}
```

```java
// ğŸ“ exceptions/InventoryException.java
/**
 * ì¬ê³  ê´€ë ¨ ì˜ˆì™¸
 */
public class InventoryException extends OrderException {
    private final String productId;

    public InventoryException(String productId, String message) {
        super("INVENTORY_ERROR", message);
        this.productId = productId;
    }

    public String getProductId() {
        return productId;
    }

    @Override
    public boolean isRetryable() {
        return true; // ì¬ê³ ëŠ” ë³€ë™ ê°€ëŠ¥í•˜ë¯€ë¡œ ì¬ì‹œë„ ê°€ëŠ¥
    }

    @Override
    public SeverityLevel getSeverity() {
        return SeverityLevel.MEDIUM;
    }
}

/**
 * ì¬ê³  ë¶€ì¡± ì˜ˆì™¸
 */
public class OutOfStockException extends InventoryException {
    private final int availableStock;
    private final int requestedQuantity;

    public OutOfStockException(String productId, int availableStock, int requestedQuantity) {
        super(productId, String.format(
            "ì¬ê³  ë¶€ì¡±: ìƒí’ˆID %s, í˜„ì¬ ì¬ê³  %dê°œ, ìš”ì²­ ìˆ˜ëŸ‰ %dê°œ",
            productId, availableStock, requestedQuantity
        ));
        this.availableStock = availableStock;
        this.requestedQuantity = requestedQuantity;
    }

    public int getAvailableStock() {
        return availableStock;
    }

    public int getRequestedQuantity() {
        return requestedQuantity;
    }
}
```

```java
// ğŸ“ exceptions/NetworkException.java
/**
 * ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì˜ˆì™¸ (ì™¸ë¶€ API í˜¸ì¶œ ì‹¤íŒ¨ ë“±)
 */
public class NetworkException extends OrderException {
    private final String endpoint;

    public NetworkException(String endpoint, String message, Throwable cause) {
        super("NETWORK_ERROR", message, cause);
        this.endpoint = endpoint;
    }

    public String getEndpoint() {
        return endpoint;
    }

    @Override
    public boolean isRetryable() {
        return true; // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ëŠ” ì¼ì‹œì ì¼ ìˆ˜ ìˆìŒ
    }

    @Override
    public SeverityLevel getSeverity() {
        return SeverityLevel.MEDIUM;
    }
}
```

---

### 2ï¸âƒ£ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ (Retry with Exponential Backoff)

```java
// ğŸ“ retry/RetryPolicy.java
/**
 * ì¬ì‹œë„ ì •ì±… ì„¤ì •
 */
public class RetryPolicy {
    private final int maxAttempts;
    private final long initialDelayMs;
    private final double backoffMultiplier;
    private final long maxDelayMs;

    public RetryPolicy(int maxAttempts, long initialDelayMs,
                       double backoffMultiplier, long maxDelayMs) {
        this.maxAttempts = maxAttempts;
        this.initialDelayMs = initialDelayMs;
        this.backoffMultiplier = backoffMultiplier;
        this.maxDelayMs = maxDelayMs;
    }

    /**
     * ê¸°ë³¸ ì •ì±…: ìµœëŒ€ 3íšŒ, ì´ˆê¸° ì§€ì—° 100ms, 2ë°°ì”© ì¦ê°€
     */
    public static RetryPolicy defaultPolicy() {
        return new RetryPolicy(3, 100, 2.0, 5000);
    }

    /**
     * ê³µê²©ì ì¸ ì¬ì‹œë„: ìµœëŒ€ 5íšŒ, ë¹ ë¥¸ ì¬ì‹œë„
     */
    public static RetryPolicy aggressive() {
        return new RetryPolicy(5, 50, 1.5, 2000);
    }

    /**
     * në²ˆì§¸ ì¬ì‹œë„ì˜ ëŒ€ê¸° ì‹œê°„ ê³„ì‚°
     */
    public long getDelayMs(int attemptNumber) {
        long delay = (long) (initialDelayMs * Math.pow(backoffMultiplier, attemptNumber - 1));
        return Math.min(delay, maxDelayMs);
    }

    public int getMaxAttempts() {
        return maxAttempts;
    }
}
```

```java
// ğŸ“ retry/RetryExecutor.java
/**
 * ì¬ì‹œë„ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ìœ í‹¸ë¦¬í‹°
 */
public class RetryExecutor {

    @FunctionalInterface
    public interface RetryableTask<T> {
        T execute() throws Exception;
    }

    /**
     * ì¬ì‹œë„ ê°€ëŠ¥í•œ ì‘ì—… ì‹¤í–‰
     */
    public static <T> T executeWithRetry(
        RetryableTask<T> task,
        RetryPolicy policy,
        String operationName
    ) throws Exception {

        Exception lastException = null;

        for (int attempt = 1; attempt <= policy.getMaxAttempts(); attempt++) {
            try {
                System.out.printf("[ì¬ì‹œë„ %d/%d] %s ì‹¤í–‰ ì¤‘...%n",
                    attempt, policy.getMaxAttempts(), operationName);

                T result = task.execute();

                if (attempt > 1) {
                    System.out.printf("âœ… %s ì„±ê³µ (ì‹œë„ íšŸìˆ˜: %d)%n",
                        operationName, attempt);
                }

                return result;

            } catch (Exception e) {
                lastException = e;

                // OrderExceptionì´ê³  ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ì¦‰ì‹œ ì˜ˆì™¸ ë°œìƒ
                if (e instanceof OrderException) {
                    OrderException orderEx = (OrderException) e;
                    if (!orderEx.isRetryable()) {
                        System.out.printf("âŒ %s: ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ - %s%n",
                            operationName, e.getMessage());
                        throw e;
                    }
                }

                // ë§ˆì§€ë§‰ ì‹œë„ì˜€ë‹¤ë©´ ì˜ˆì™¸ ë°œìƒ
                if (attempt == policy.getMaxAttempts()) {
                    System.out.printf("âŒ %s: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼%n", operationName);
                    throw e;
                }

                // ëŒ€ê¸° ì‹œê°„ ê³„ì‚° ë° ëŒ€ê¸°
                long delayMs = policy.getDelayMs(attempt);
                System.out.printf("â³ %dms í›„ ì¬ì‹œë„... (ì—ëŸ¬: %s)%n",
                    delayMs, e.getMessage());

                try {
                    Thread.sleep(delayMs);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("ì¬ì‹œë„ ì¤‘ ì¸í„°ëŸ½íŠ¸ ë°œìƒ", ie);
                }
            }
        }

        throw lastException; // ì´ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ ì»´íŒŒì¼ëŸ¬ë¥¼ ìœ„í•´ í•„ìš”
    }
}
```

---

### 3ï¸âƒ£ Circuit Breaker íŒ¨í„´

```java
// ğŸ“ circuitbreaker/CircuitBreakerState.java
/**
 * Circuit Breakerì˜ ìƒíƒœ
 */
enum CircuitBreakerState {
    CLOSED,      // ì •ìƒ ì‘ë™ (ìš”ì²­ í—ˆìš©)
    OPEN,        // ì°¨ë‹¨ ìƒíƒœ (ìš”ì²­ ê±°ë¶€)
    HALF_OPEN    // ë°˜ì¯¤ ì—´ë¦¼ (í…ŒìŠ¤íŠ¸ ìš”ì²­ í—ˆìš©)
}
```

```java
// ğŸ“ circuitbreaker/CircuitBreaker.java
/**
 * Circuit Breaker êµ¬í˜„
 *
 * ë™ì‘ ì›ë¦¬:
 * 1. CLOSED: ì •ìƒ ë™ì‘, ì‹¤íŒ¨ ì¹´ìš´íŠ¸
 * 2. OPEN: ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ì°¨ë‹¨, ëª¨ë“  ìš”ì²­ ì¦‰ì‹œ ê±°ë¶€
 * 3. HALF_OPEN: ì¼ì • ì‹œê°„ í›„ í…ŒìŠ¤íŠ¸ ìš”ì²­ í—ˆìš©
 * 4. ì„±ê³µ ì‹œ CLOSEDë¡œ ë³µê·€, ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ OPEN
 */
public class CircuitBreaker {
    private final String name;
    private final int failureThreshold;      // ì‹¤íŒ¨ ì„ê³„ê°’
    private final long openDurationMs;       // OPEN ìƒíƒœ ìœ ì§€ ì‹œê°„
    private final int halfOpenMaxAttempts;   // HALF_OPENì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œë„ íšŸìˆ˜

    private CircuitBreakerState state;
    private int failureCount;
    private int successCount;
    private long lastFailureTime;

    public CircuitBreaker(String name, int failureThreshold,
                          long openDurationMs, int halfOpenMaxAttempts) {
        this.name = name;
        this.failureThreshold = failureThreshold;
        this.openDurationMs = openDurationMs;
        this.halfOpenMaxAttempts = halfOpenMaxAttempts;
        this.state = CircuitBreakerState.CLOSED;
        this.failureCount = 0;
        this.successCount = 0;
    }

    /**
     * Circuit Breakerë¥¼ í†µí•´ ì‘ì—… ì‹¤í–‰
     */
    public <T> T execute(RetryExecutor.RetryableTask<T> task, String operationName)
        throws Exception {

        // OPEN ìƒíƒœ í™•ì¸
        if (state == CircuitBreakerState.OPEN) {
            // OPEN ì§€ì† ì‹œê°„ì´ ì§€ë‚¬ëŠ”ì§€ í™•ì¸
            if (System.currentTimeMillis() - lastFailureTime >= openDurationMs) {
                System.out.printf("ğŸ”„ [%s] OPEN â†’ HALF_OPEN (í…ŒìŠ¤íŠ¸ ì‹œì‘)%n", name);
                state = CircuitBreakerState.HALF_OPEN;
                successCount = 0;
            } else {
                throw new CircuitBreakerOpenException(name,
                    "Circuit Breakerê°€ OPEN ìƒíƒœì…ë‹ˆë‹¤: " + operationName);
            }
        }

        try {
            T result = task.execute();
            onSuccess();
            return result;

        } catch (Exception e) {
            onFailure();
            throw e;
        }
    }

    /**
     * ì„±ê³µ ì²˜ë¦¬
     */
    private void onSuccess() {
        failureCount = 0;

        if (state == CircuitBreakerState.HALF_OPEN) {
            successCount++;
            if (successCount >= halfOpenMaxAttempts) {
                System.out.printf("âœ… [%s] HALF_OPEN â†’ CLOSED (ë³µêµ¬ ì™„ë£Œ)%n", name);
                state = CircuitBreakerState.CLOSED;
                successCount = 0;
            }
        }
    }

    /**
     * ì‹¤íŒ¨ ì²˜ë¦¬
     */
    private void onFailure() {
        lastFailureTime = System.currentTimeMillis();
        failureCount++;

        if (state == CircuitBreakerState.HALF_OPEN) {
            System.out.printf("âŒ [%s] HALF_OPEN â†’ OPEN (í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨)%n", name);
            state = CircuitBreakerState.OPEN;
            failureCount = 0;
            successCount = 0;

        } else if (state == CircuitBreakerState.CLOSED
                   && failureCount >= failureThreshold) {
            System.out.printf("âš ï¸ [%s] CLOSED â†’ OPEN (ì‹¤íŒ¨ %díšŒ ì´ˆê³¼)%n",
                name, failureThreshold);
            state = CircuitBreakerState.OPEN;
        }
    }

    public CircuitBreakerState getState() {
        return state;
    }

    public int getFailureCount() {
        return failureCount;
    }
}

/**
 * Circuit Breakerê°€ OPEN ìƒíƒœì¼ ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸
 */
class CircuitBreakerOpenException extends OrderException {
    public CircuitBreakerOpenException(String circuitBreakerName, String message) {
        super("CIRCUIT_BREAKER_OPEN", message);
    }

    @Override
    public boolean isRetryable() {
        return false; // Circuit Breaker OPEN ìƒíƒœì—ì„œëŠ” ì¬ì‹œë„ ë¶ˆê°€
    }

    @Override
    public SeverityLevel getSeverity() {
        return SeverityLevel.HIGH;
    }
}
```

---

### 4ï¸âƒ£ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ë° ë³´ìƒ ì²˜ë¦¬

```java
// ğŸ“ transaction/TransactionManager.java
/**
 * íŠ¸ëœì­ì…˜ ê´€ë¦¬ì
 *
 * ì£¼ë¬¸ ì²˜ë¦¬ëŠ” ì—¬ëŸ¬ ë‹¨ê³„ë¡œ êµ¬ì„±:
 * 1. ì¬ê³  ì°¨ê°
 * 2. ê²°ì œ ì²˜ë¦¬
 * 3. ë°°ì†¡ ì •ë³´ ìƒì„±
 *
 * ì¤‘ê°„ì— ì‹¤íŒ¨ ì‹œ ì´ì „ ë‹¨ê³„ë¥¼ ë¡¤ë°±í•´ì•¼ í•¨ (ë³´ìƒ íŠ¸ëœì­ì…˜)
 */
public class TransactionManager {

    /**
     * ë³´ìƒ ê°€ëŠ¥í•œ ì‘ì—…
     */
    public interface CompensatableAction {
        void execute() throws Exception;
        void compensate() throws Exception; // ë¡¤ë°± ë¡œì§
        String getName();
    }

    /**
     * íŠ¸ëœì­ì…˜ ì‹¤í–‰
     */
    public static void executeTransaction(List<CompensatableAction> actions)
        throws Exception {

        List<CompensatableAction> executedActions = new ArrayList<>();

        try {
            // ìˆœì°¨ì ìœ¼ë¡œ ëª¨ë“  ì•¡ì…˜ ì‹¤í–‰
            for (CompensatableAction action : actions) {
                System.out.printf("ğŸ”¹ [íŠ¸ëœì­ì…˜] %s ì‹¤í–‰...%n", action.getName());
                action.execute();
                executedActions.add(action);
                System.out.printf("âœ… [íŠ¸ëœì­ì…˜] %s ì™„ë£Œ%n", action.getName());
            }

            System.out.println("âœ… [íŠ¸ëœì­ì…˜] ì „ì²´ íŠ¸ëœì­ì…˜ ì„±ê³µ!");

        } catch (Exception e) {
            System.err.printf("âŒ [íŠ¸ëœì­ì…˜] ì‹¤íŒ¨: %s%n", e.getMessage());
            System.err.println("ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì‹œì‘...");

            // ì—­ìˆœìœ¼ë¡œ ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰
            Collections.reverse(executedActions);

            for (CompensatableAction action : executedActions) {
                try {
                    System.out.printf("â†©ï¸  [ë¡¤ë°±] %s ë¡¤ë°± ì¤‘...%n", action.getName());
                    action.compensate();
                    System.out.printf("âœ… [ë¡¤ë°±] %s ë¡¤ë°± ì™„ë£Œ%n", action.getName());

                } catch (Exception compensationEx) {
                    // ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ ì‹¬ê°í•œ ë¬¸ì œ - ë¡œê·¸ ë‚¨ê¸°ê³  ê³„ì† ì§„í–‰
                    System.err.printf("âš ï¸ [ë¡¤ë°± ì‹¤íŒ¨] %s: %s%n",
                        action.getName(), compensationEx.getMessage());
                }
            }

            System.err.println("ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì™„ë£Œ");
            throw e; // ì›ë˜ ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ë˜ì§
        }
    }
}
```

---

### 5ï¸âƒ£ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ í†µí•©

```java
// ğŸ“ model/Order.java
/**
 * ì£¼ë¬¸ ì •ë³´
 */
public class Order {
    private final String orderId;
    private final String userId;
    private final String productId;
    private final int quantity;
    private final int totalAmount;
    private OrderStatus status;

    public Order(String orderId, String userId, String productId,
                 int quantity, int totalAmount) {
        this.orderId = orderId;
        this.userId = userId;
        this.productId = productId;
        this.quantity = quantity;
        this.totalAmount = totalAmount;
        this.status = OrderStatus.PENDING;
    }

    // Getters and setters
    public String getOrderId() { return orderId; }
    public String getUserId() { return userId; }
    public String getProductId() { return productId; }
    public int getQuantity() { return quantity; }
    public int getTotalAmount() { return totalAmount; }
    public OrderStatus getStatus() { return status; }
    public void setStatus(OrderStatus status) { this.status = status; }
}

enum OrderStatus {
    PENDING,          // ëŒ€ê¸° ì¤‘
    PROCESSING,       // ì²˜ë¦¬ ì¤‘
    PAYMENT_FAILED,   // ê²°ì œ ì‹¤íŒ¨
    INVENTORY_FAILED, // ì¬ê³  ë¶€ì¡±
    COMPLETED,        // ì™„ë£Œ
    CANCELLED         // ì·¨ì†Œë¨
}
```

```java
// ğŸ“ service/InventoryService.java
/**
 * ì¬ê³  ê´€ë¦¬ ì„œë¹„ìŠ¤
 */
public class InventoryService {
    private final Map<String, Integer> inventory = new HashMap<>();

    public InventoryService() {
        // ì´ˆê¸° ì¬ê³  ì„¤ì •
        inventory.put("PROD-001", 10);
        inventory.put("PROD-002", 5);
        inventory.put("PROD-003", 0); // í’ˆì ˆ
    }

    /**
     * ì¬ê³  ì°¨ê°
     */
    public void decreaseStock(String productId, int quantity)
        throws OutOfStockException {

        int currentStock = inventory.getOrDefault(productId, 0);

        if (currentStock < quantity) {
            throw new OutOfStockException(productId, currentStock, quantity);
        }

        inventory.put(productId, currentStock - quantity);
        System.out.printf("ğŸ“¦ ì¬ê³  ì°¨ê°: %s (%d â†’ %d)%n",
            productId, currentStock, currentStock - quantity);
    }

    /**
     * ì¬ê³  ë³µêµ¬ (ë³´ìƒ íŠ¸ëœì­ì…˜)
     */
    public void increaseStock(String productId, int quantity) {
        int currentStock = inventory.getOrDefault(productId, 0);
        inventory.put(productId, currentStock + quantity);
        System.out.printf("â†©ï¸  ì¬ê³  ë³µêµ¬: %s (%d â†’ %d)%n",
            productId, currentStock, currentStock + quantity);
    }

    public int getStock(String productId) {
        return inventory.getOrDefault(productId, 0);
    }
}
```

```java
// ğŸ“ service/PaymentService.java
/**
 * ê²°ì œ ì„œë¹„ìŠ¤ (ì™¸ë¶€ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜)
 */
public class PaymentService {
    private final Map<String, Integer> userBalances = new HashMap<>();
    private final Map<String, String> processedPayments = new HashMap<>();
    private final CircuitBreaker circuitBreaker;
    private int callCount = 0; // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜ìš©

    public PaymentService(CircuitBreaker circuitBreaker) {
        this.circuitBreaker = circuitBreaker;
        // ì´ˆê¸° ì”ì•¡ ì„¤ì •
        userBalances.put("USER-001", 100000);
        userBalances.put("USER-002", 50000);
        userBalances.put("USER-003", 10000);
    }

    /**
     * ê²°ì œ ì²˜ë¦¬
     */
    public String processPayment(String userId, int amount, String orderId)
        throws Exception {

        return circuitBreaker.execute(() -> {
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜ (ì²˜ìŒ 2ë²ˆ ì‹¤íŒ¨)
            callCount++;
            if (callCount <= 2) {
                throw new NetworkException(
                    "https://payment-gateway.example.com/charge",
                    "ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ì‹¤íŒ¨",
                    new IOException("Connection timeout")
                );
            }

            int balance = userBalances.getOrDefault(userId, 0);

            if (balance < amount) {
                throw new CardLimitExceededException(
                    "PAY-" + orderId, balance, amount
                );
            }

            userBalances.put(userId, balance - amount);
            String paymentId = "PAY-" + System.currentTimeMillis();
            processedPayments.put(paymentId, orderId);

            System.out.printf("ğŸ’³ ê²°ì œ ì™„ë£Œ: %s (ì”ì•¡ %,d â†’ %,d)%n",
                paymentId, balance, balance - amount);

            return paymentId;

        }, "ê²°ì œ ì²˜ë¦¬");
    }

    /**
     * ê²°ì œ ì·¨ì†Œ (ë³´ìƒ íŠ¸ëœì­ì…˜)
     */
    public void refundPayment(String paymentId, String userId, int amount) {
        int balance = userBalances.getOrDefault(userId, 0);
        userBalances.put(userId, balance + amount);
        processedPayments.remove(paymentId);

        System.out.printf("â†©ï¸  ê²°ì œ í™˜ë¶ˆ: %s (ì”ì•¡ %,d â†’ %,d)%n",
            paymentId, balance, balance + amount);
    }
}
```

```java
// ğŸ“ service/OrderService.java
/**
 * ì£¼ë¬¸ ì²˜ë¦¬ ì„œë¹„ìŠ¤ (í†µí•©)
 */
public class OrderService {
    private final InventoryService inventoryService;
    private final PaymentService paymentService;
    private final RetryPolicy retryPolicy;

    public OrderService(InventoryService inventoryService,
                        PaymentService paymentService,
                        RetryPolicy retryPolicy) {
        this.inventoryService = inventoryService;
        this.paymentService = paymentService;
        this.retryPolicy = retryPolicy;
    }

    /**
     * ì£¼ë¬¸ ì²˜ë¦¬ (íŠ¸ëœì­ì…˜)
     */
    public void processOrder(Order order) throws Exception {
        System.out.printf("%n========== ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: %s ==========%n",
            order.getOrderId());

        order.setStatus(OrderStatus.PROCESSING);

        // ë³´ìƒ íŠ¸ëœì­ì…˜ì„ ìœ„í•œ ë³€ìˆ˜
        final String[] paymentId = {null};

        List<TransactionManager.CompensatableAction> actions = List.of(
            // ì•¡ì…˜ 1: ì¬ê³  ì°¨ê°
            new TransactionManager.CompensatableAction() {
                @Override
                public void execute() throws Exception {
                    RetryExecutor.executeWithRetry(
                        () -> {
                            inventoryService.decreaseStock(
                                order.getProductId(),
                                order.getQuantity()
                            );
                            return null;
                        },
                        retryPolicy,
                        "ì¬ê³  ì°¨ê°"
                    );
                }

                @Override
                public void compensate() {
                    inventoryService.increaseStock(
                        order.getProductId(),
                        order.getQuantity()
                    );
                }

                @Override
                public String getName() {
                    return "ì¬ê³  ì°¨ê°";
                }
            },

            // ì•¡ì…˜ 2: ê²°ì œ ì²˜ë¦¬
            new TransactionManager.CompensatableAction() {
                @Override
                public void execute() throws Exception {
                    paymentId[0] = RetryExecutor.executeWithRetry(
                        () -> paymentService.processPayment(
                            order.getUserId(),
                            order.getTotalAmount(),
                            order.getOrderId()
                        ),
                        retryPolicy,
                        "ê²°ì œ ì²˜ë¦¬"
                    );
                }

                @Override
                public void compensate() {
                    if (paymentId[0] != null) {
                        paymentService.refundPayment(
                            paymentId[0],
                            order.getUserId(),
                            order.getTotalAmount()
                        );
                    }
                }

                @Override
                public String getName() {
                    return "ê²°ì œ ì²˜ë¦¬";
                }
            },

            // ì•¡ì…˜ 3: ë°°ì†¡ ì •ë³´ ìƒì„±
            new TransactionManager.CompensatableAction() {
                @Override
                public void execute() {
                    System.out.printf("ğŸšš ë°°ì†¡ ì •ë³´ ìƒì„±: %s%n", order.getOrderId());
                }

                @Override
                public void compensate() {
                    System.out.printf("â†©ï¸  ë°°ì†¡ ì •ë³´ ì·¨ì†Œ: %s%n", order.getOrderId());
                }

                @Override
                public String getName() {
                    return "ë°°ì†¡ ì •ë³´ ìƒì„±";
                }
            }
        );

        try {
            TransactionManager.executeTransaction(actions);
            order.setStatus(OrderStatus.COMPLETED);
            System.out.printf("========== ì£¼ë¬¸ ì™„ë£Œ: %s ==========%n%n",
                order.getOrderId());

        } catch (Exception e) {
            // ì˜ˆì™¸ íƒ€ì…ì— ë”°ë¼ ìƒíƒœ ì„¤ì •
            if (e instanceof PaymentException) {
                order.setStatus(OrderStatus.PAYMENT_FAILED);
            } else if (e instanceof InventoryException) {
                order.setStatus(OrderStatus.INVENTORY_FAILED);
            } else {
                order.setStatus(OrderStatus.CANCELLED);
            }

            System.err.printf("========== ì£¼ë¬¸ ì‹¤íŒ¨: %s (ìƒíƒœ: %s) ==========%n%n",
                order.getOrderId(), order.getStatus());
            throw e;
        }
    }
}
```

---

### 6ï¸âƒ£ ë©”ì¸ ì‹¤í–‰ ì½”ë“œ

```java
// ğŸ“ Main.java
public class ResilientOrderSystemDemo {
    public static void main(String[] args) {
        // Circuit Breaker ì„¤ì •
        CircuitBreaker paymentCircuitBreaker = new CircuitBreaker(
            "ê²°ì œ ì„œë¹„ìŠ¤",
            3,      // 3íšŒ ì‹¤íŒ¨ ì‹œ OPEN
            10000,  // OPEN ìƒíƒœ 10ì´ˆ ìœ ì§€
            2       // HALF_OPENì—ì„œ 2íšŒ ì„±ê³µ ì‹œ CLOSED
        );

        // ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
        InventoryService inventoryService = new InventoryService();
        PaymentService paymentService = new PaymentService(paymentCircuitBreaker);
        OrderService orderService = new OrderService(
            inventoryService,
            paymentService,
            RetryPolicy.defaultPolicy()
        );

        // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
        System.out.println("ğŸ’¡ ì´ˆê¸° ì¬ê³  ìƒíƒœ:");
        System.out.println("  PROD-001: " + inventoryService.getStock("PROD-001") + "ê°œ");
        System.out.println("  PROD-002: " + inventoryService.getStock("PROD-002") + "ê°œ");
        System.out.println("  PROD-003: " + inventoryService.getStock("PROD-003") + "ê°œ");
        System.out.println();

        // ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì£¼ë¬¸ (ì¬ì‹œë„ í›„ ì„±ê³µ)
        testScenario1(orderService);

        // ì‹œë‚˜ë¦¬ì˜¤ 2: ì¬ê³  ë¶€ì¡±
        testScenario2(orderService);

        // ì‹œë‚˜ë¦¬ì˜¤ 3: ê²°ì œ í•œë„ ì´ˆê³¼
        testScenario3(orderService);

        // ì‹œë‚˜ë¦¬ì˜¤ 4: Circuit Breaker ë™ì‘ í™•ì¸
        testScenario4(orderService, paymentCircuitBreaker);
    }

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì£¼ë¬¸ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í›„ ì¬ì‹œë„ë¡œ ì„±ê³µ)
     */
    private static void testScenario1(OrderService orderService) {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì£¼ë¬¸ (ì¬ì‹œë„ í›„ ì„±ê³µ)");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        Order order = new Order(
            "ORD-001",
            "USER-001",
            "PROD-001",
            2,
            50000
        );

        try {
            orderService.processOrder(order);
            System.out.printf("âœ… ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: %s%n%n", order.getStatus());

        } catch (Exception e) {
            System.err.printf("âŒ ì£¼ë¬¸ ì‹¤íŒ¨: %s%n%n", e.getMessage());
        }
    }

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ 2: ì¬ê³  ë¶€ì¡± (ë³´ìƒ íŠ¸ëœì­ì…˜ ë™ì‘ ì•ˆ í•¨ - ì¬ê³  ì°¨ê° ìì²´ê°€ ì‹¤íŒ¨)
     */
    private static void testScenario2(OrderService orderService) {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 2: ì¬ê³  ë¶€ì¡±");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        Order order = new Order(
            "ORD-002",
            "USER-001",
            "PROD-003",  // í’ˆì ˆ ìƒí’ˆ
            1,
            30000
        );

        try {
            orderService.processOrder(order);

        } catch (OutOfStockException e) {
            System.err.printf("âŒ ì˜ˆì™¸ ì²˜ë¦¬: %s%n", e.getMessage());
            System.err.printf("   ì¬ì‹œë„ ê°€ëŠ¥: %s%n", e.isRetryable());
            System.err.printf("   ì‹¬ê°ë„: %s%n", e.getSeverity());
            System.err.printf("âŒ ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: %s%n%n", order.getStatus());

        } catch (Exception e) {
            System.err.printf("âŒ ì£¼ë¬¸ ì‹¤íŒ¨: %s%n%n", e.getMessage());
        }
    }

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ 3: ê²°ì œ í•œë„ ì´ˆê³¼ (ì¬ê³  ì°¨ê° â†’ ê²°ì œ ì‹¤íŒ¨ â†’ ì¬ê³  ë³µêµ¬)
     */
    private static void testScenario3(OrderService orderService) {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 3: ê²°ì œ í•œë„ ì´ˆê³¼ (ë³´ìƒ íŠ¸ëœì­ì…˜)");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        Order order = new Order(
            "ORD-003",
            "USER-003",  // ì”ì•¡ 10,000ì›
            "PROD-002",
            1,
            50000        // ê²°ì œ ê¸ˆì•¡ 50,000ì› (í•œë„ ì´ˆê³¼)
        );

        try {
            orderService.processOrder(order);

        } catch (CardLimitExceededException e) {
            System.err.printf("âŒ ì˜ˆì™¸ ì²˜ë¦¬: %s%n", e.getMessage());
            System.err.printf("   ì¬ì‹œë„ ê°€ëŠ¥: %s%n", e.isRetryable());
            System.err.printf("   ì‹¬ê°ë„: %s%n", e.getSeverity());
            System.err.printf("âŒ ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: %s%n%n", order.getStatus());

        } catch (Exception e) {
            System.err.printf("âŒ ì£¼ë¬¸ ì‹¤íŒ¨: %s%n%n", e.getMessage());
        }
    }

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ 4: Circuit Breaker ë™ì‘
     */
    private static void testScenario4(OrderService orderService,
                                       CircuitBreaker circuitBreaker) {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 4: Circuit Breaker í…ŒìŠ¤íŠ¸");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        System.out.printf("í˜„ì¬ Circuit Breaker ìƒíƒœ: %s%n",
            circuitBreaker.getState());
        System.out.println();
    }
}
```

---

### 7ï¸âƒ£ ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

```
ğŸ’¡ ì´ˆê¸° ì¬ê³  ìƒíƒœ:
  PROD-001: 10ê°œ
  PROD-002: 5ê°œ
  PROD-003: 0ê°œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì£¼ë¬¸ (ì¬ì‹œë„ í›„ ì„±ê³µ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

========== ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORD-001 ==========
ğŸ”¹ [íŠ¸ëœì­ì…˜] ì¬ê³  ì°¨ê° ì‹¤í–‰...
[ì¬ì‹œë„ 1/3] ì¬ê³  ì°¨ê° ì‹¤í–‰ ì¤‘...
ğŸ“¦ ì¬ê³  ì°¨ê°: PROD-001 (10 â†’ 8)
âœ… [íŠ¸ëœì­ì…˜] ì¬ê³  ì°¨ê° ì™„ë£Œ
ğŸ”¹ [íŠ¸ëœì­ì…˜] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰...
[ì¬ì‹œë„ 1/3] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰ ì¤‘...
â³ 100ms í›„ ì¬ì‹œë„... (ì—ëŸ¬: ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ì‹¤íŒ¨)
[ì¬ì‹œë„ 2/3] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰ ì¤‘...
â³ 200ms í›„ ì¬ì‹œë„... (ì—ëŸ¬: ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ì‹¤íŒ¨)
[ì¬ì‹œë„ 3/3] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰ ì¤‘...
ğŸ’³ ê²°ì œ ì™„ë£Œ: PAY-1710123456789 (ì”ì•¡ 100,000 â†’ 50,000)
âœ… ê²°ì œ ì²˜ë¦¬ ì„±ê³µ (ì‹œë„ íšŸìˆ˜: 3)
âœ… [íŠ¸ëœì­ì…˜] ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ
ğŸ”¹ [íŠ¸ëœì­ì…˜] ë°°ì†¡ ì •ë³´ ìƒì„± ì‹¤í–‰...
ğŸšš ë°°ì†¡ ì •ë³´ ìƒì„±: ORD-001
âœ… [íŠ¸ëœì­ì…˜] ë°°ì†¡ ì •ë³´ ìƒì„± ì™„ë£Œ
âœ… [íŠ¸ëœì­ì…˜] ì „ì²´ íŠ¸ëœì­ì…˜ ì„±ê³µ!
========== ì£¼ë¬¸ ì™„ë£Œ: ORD-001 ==========

âœ… ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: COMPLETED

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 2: ì¬ê³  ë¶€ì¡±
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

========== ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORD-002 ==========
ğŸ”¹ [íŠ¸ëœì­ì…˜] ì¬ê³  ì°¨ê° ì‹¤í–‰...
[ì¬ì‹œë„ 1/3] ì¬ê³  ì°¨ê° ì‹¤í–‰ ì¤‘...
âŒ ì¬ê³  ì°¨ê°: ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ - ì¬ê³  ë¶€ì¡±: ìƒí’ˆID PROD-003, í˜„ì¬ ì¬ê³  0ê°œ, ìš”ì²­ ìˆ˜ëŸ‰ 1ê°œ
âŒ [íŠ¸ëœì­ì…˜] ì‹¤íŒ¨: ì¬ê³  ë¶€ì¡±: ìƒí’ˆID PROD-003, í˜„ì¬ ì¬ê³  0ê°œ, ìš”ì²­ ìˆ˜ëŸ‰ 1ê°œ
ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì‹œì‘...
ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì™„ë£Œ
========== ì£¼ë¬¸ ì‹¤íŒ¨: ORD-002 (ìƒíƒœ: INVENTORY_FAILED) ==========

âŒ ì˜ˆì™¸ ì²˜ë¦¬: ì¬ê³  ë¶€ì¡±: ìƒí’ˆID PROD-003, í˜„ì¬ ì¬ê³  0ê°œ, ìš”ì²­ ìˆ˜ëŸ‰ 1ê°œ
   ì¬ì‹œë„ ê°€ëŠ¥: true
   ì‹¬ê°ë„: MEDIUM
âŒ ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: INVENTORY_FAILED

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 3: ê²°ì œ í•œë„ ì´ˆê³¼ (ë³´ìƒ íŠ¸ëœì­ì…˜)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

========== ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORD-003 ==========
ğŸ”¹ [íŠ¸ëœì­ì…˜] ì¬ê³  ì°¨ê° ì‹¤í–‰...
[ì¬ì‹œë„ 1/3] ì¬ê³  ì°¨ê° ì‹¤í–‰ ì¤‘...
ğŸ“¦ ì¬ê³  ì°¨ê°: PROD-002 (5 â†’ 4)
âœ… [íŠ¸ëœì­ì…˜] ì¬ê³  ì°¨ê° ì™„ë£Œ
ğŸ”¹ [íŠ¸ëœì­ì…˜] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰...
[ì¬ì‹œë„ 1/3] ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰ ì¤‘...
âŒ ê²°ì œ ì²˜ë¦¬: ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ - ì¹´ë“œ í•œë„ ì´ˆê³¼: í˜„ì¬ í•œë„ 10,000ì›, ìš”ì²­ ê¸ˆì•¡ 50,000ì›
âŒ [íŠ¸ëœì­ì…˜] ì‹¤íŒ¨: ì¹´ë“œ í•œë„ ì´ˆê³¼: í˜„ì¬ í•œë„ 10,000ì›, ìš”ì²­ ê¸ˆì•¡ 50,000ì›
ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì‹œì‘...
â†©ï¸  [ë¡¤ë°±] ì¬ê³  ì°¨ê° ë¡¤ë°± ì¤‘...
â†©ï¸  ì¬ê³  ë³µêµ¬: PROD-002 (4 â†’ 5)
âœ… [ë¡¤ë°±] ì¬ê³  ì°¨ê° ë¡¤ë°± ì™„ë£Œ
ğŸ”™ [íŠ¸ëœì­ì…˜] ë¡¤ë°± ì™„ë£Œ
========== ì£¼ë¬¸ ì‹¤íŒ¨: ORD-003 (ìƒíƒœ: PAYMENT_FAILED) ==========

âŒ ì˜ˆì™¸ ì²˜ë¦¬: ì¹´ë“œ í•œë„ ì´ˆê³¼: í˜„ì¬ í•œë„ 10,000ì›, ìš”ì²­ ê¸ˆì•¡ 50,000ì›
   ì¬ì‹œë„ ê°€ëŠ¥: false
   ì‹¬ê°ë„: HIGH
âŒ ìµœì¢… ì£¼ë¬¸ ìƒíƒœ: PAYMENT_FAILED

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 4: Circuit Breaker í…ŒìŠ¤íŠ¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
í˜„ì¬ Circuit Breaker ìƒíƒœ: CLOSED
```

---

### ğŸ“Š í”„ë¡œì íŠ¸ í•µì‹¬ í¬ì¸íŠ¸

| ê¸°ëŠ¥ | ì„¤ëª… | êµ¬í˜„ í´ë˜ìŠ¤ |
|------|------|-------------|
| **ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê³„ì¸µ** | ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ë¥¼ ê³„ì¸µí™”í•˜ì—¬ ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€, ì‹¬ê°ë„ ê´€ë¦¬ | `OrderException`, `PaymentException`, `InventoryException` |
| **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜** | Exponential Backoff ì „ëµìœ¼ë¡œ ì¼ì‹œì  ì˜¤ë¥˜ ê·¹ë³µ | `RetryExecutor`, `RetryPolicy` |
| **Circuit Breaker** | ì—°ì† ì‹¤íŒ¨ ì‹œ ìë™ ì°¨ë‹¨, ì¼ì • ì‹œê°„ í›„ ë³µêµ¬ ì‹œë„ | `CircuitBreaker` |
| **íŠ¸ëœì­ì…˜ ë¡¤ë°±** | ë³´ìƒ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì´ì „ ë‹¨ê³„ ë³µêµ¬ (Saga Pattern) | `TransactionManager` |
| **ì˜ˆì™¸ ë¶„ë¥˜** | ì¬ì‹œë„ ê°€ëŠ¥/ë¶ˆê°€ëŠ¥, ì‹¬ê°ë„ ìˆ˜ì¤€ìœ¼ë¡œ ì˜ˆì™¸ ë¶„ë¥˜ | `isRetryable()`, `getSeverity()` |

---

## â“ FAQ 7ì„ 

### Q1. Checked Exceptionê³¼ Unchecked Exception, ì‹¤ë¬´ì—ì„œëŠ” ì–´ë–¤ ê±¸ ì¨ì•¼ í•˜ë‚˜ìš”?

**A1.**
- **Checked Exception**: í˜¸ì¶œìê°€ ë³µêµ¬ ê°€ëŠ¥í•œ ìƒí™© (íŒŒì¼ ì—†ìŒ, ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“±)
  ```java
  public void readConfig(String path) throws IOException {
      // í˜¸ì¶œìê°€ íŒŒì¼ ì—†ìŒ ìƒí™©ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
  }
  ```

- **Unchecked Exception (RuntimeException)**: í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜ ë˜ëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥
  ```java
  public void divide(int a, int b) {
      if (b == 0) {
          throw new IllegalArgumentException("0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
      }
  }
  ```

**ì‹¤ë¬´ íŠ¸ë Œë“œ**:
- Spring Framework ë“± í˜„ëŒ€ì ì¸ í”„ë ˆì„ì›Œí¬ëŠ” **Unchecked Exception ì„ í˜¸**
- ì´ìœ : Checked Exceptionì€ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ë³µì¡í•˜ê²Œ ë§Œë“¤ê³ , í˜¸ì¶œ ì²´ì¸ì„ ì˜¤ì—¼ì‹œí‚´

---

### Q2. ì˜ˆì™¸ë¥¼ catchí•˜ê³  ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ë©´ (ë¹ˆ catch ë¸”ë¡) ì™œ ì•ˆ ë ê¹Œìš”?

**A2.**
```java
// âŒ ë‚˜ìœ ì˜ˆ: ì˜ˆì™¸ ë¬´ì‹œ
try {
    processPayment();
} catch (Exception e) {
    // ì•„ë¬´ê²ƒë„ ì•ˆ í•¨ - ì˜ˆì™¸ê°€ ì‚¬ë¼ì§!
}
```

**ë¬¸ì œì **:
1. **ë””ë²„ê¹… ë¶ˆê°€ëŠ¥**: ì–´ë””ì„œ ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ
2. **ì¡°ìš©í•œ ì‹¤íŒ¨**: ì‚¬ìš©ìëŠ” ì„±ê³µí–ˆë‹¤ê³  ìƒê°í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì‹¤íŒ¨
3. **ë°ì´í„° ë¶ˆì¼ì¹˜**: íŠ¸ëœì­ì…˜ ì¤‘ê°„ì— ì‹¤íŒ¨í–ˆëŠ”ë° ì´ì „ ë‹¨ê³„ëŠ” ì»¤ë°‹ë¨

**ì˜¬ë°”ë¥¸ ì²˜ë¦¬**:
```java
// âœ… ì¢‹ì€ ì˜ˆ: ë¡œê·¸ ë‚¨ê¸°ê¸°
try {
    processPayment();
} catch (Exception e) {
    logger.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨: orderId={}", orderId, e);
    throw new PaymentException("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
}
```

---

### Q3. finally ë¸”ë¡ì€ í•­ìƒ ì‹¤í–‰ëœë‹¤ê³  í•˜ëŠ”ë°, ì˜ˆì™¸ê°€ ìˆë‚˜ìš”?

**A3.**
ê±°ì˜ í•­ìƒ ì‹¤í–‰ë˜ì§€ë§Œ, **ë‹¤ìŒ ê²½ìš°ì—ëŠ” ì‹¤í–‰ ì•ˆ ë¨**:

1. **JVM ìì²´ê°€ ì¢…ë£Œë˜ëŠ” ê²½ìš°**:
   ```java
   try {
       System.exit(0); // JVM ì¢…ë£Œ
   } finally {
       System.out.println("ì‹¤í–‰ ì•ˆ ë¨!");
   }
   ```

2. **ë°ëª¬ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë˜ëŠ” ê²½ìš°**
3. **ë¬´í•œ ë£¨í”„ì— ê°‡íŒ ê²½ìš°**
4. **ì¹˜ëª…ì ì¸ JVM ì˜¤ë¥˜** (OutOfMemoryError ë“±)

**ì‹¤ë¬´ íŒ**: try-with-resourcesë¥¼ ì‚¬ìš©í•˜ë©´ ë” ì•ˆì „
```java
// try-with-resources (Java 7+)
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // fisëŠ” ìë™ìœ¼ë¡œ ë‹«í˜
} catch (IOException e) {
    // ì˜ˆì™¸ ì²˜ë¦¬
}
```

---

### Q4. ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ë•Œ `throw`ì™€ `throws`ì˜ ì°¨ì´ê°€ ë­”ê°€ìš”?

**A4.**

| í‚¤ì›Œë“œ | ìœ„ì¹˜ | ì—­í•  | ì˜ˆì‹œ |
|--------|------|------|------|
| `throw` | ë©”ì„œë“œ **ë‚´ë¶€** | ì˜ˆì™¸ë¥¼ **ì‹¤ì œë¡œ ë°œìƒ**ì‹œí‚´ | `throw new IllegalArgumentException();` |
| `throws` | ë©”ì„œë“œ **ì‹œê·¸ë‹ˆì²˜** | ì´ ë©”ì„œë“œê°€ ì–´ë–¤ ì˜ˆì™¸ë¥¼ **ë˜ì§ˆ ìˆ˜ ìˆëŠ”ì§€ ì„ ì–¸** | `public void read() throws IOException` |

```java
// throws: ì´ ë©”ì„œë“œëŠ” IOExceptionì„ ë˜ì§ˆ ìˆ˜ ìˆë‹¤ê³  ì„ ì–¸
public void readFile(String path) throws IOException {
    if (!fileExists(path)) {
        // throw: ì‹¤ì œë¡œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚´
        throw new FileNotFoundException("íŒŒì¼ ì—†ìŒ: " + path);
    }
}
```

---

### Q5. Custom Exceptionì„ ë§Œë“¤ ë•Œ ì£¼ì˜í•  ì ì€?

**A5.**
**Best Practices**:

1. **ì˜ë¯¸ ìˆëŠ” ì´ë¦„**: `Exception1`, `MyException`ì€ ì•ˆ ë¨
   ```java
   // âŒ ë‚˜ìœ ì˜ˆ
   class Exception1 extends Exception { }

   // âœ… ì¢‹ì€ ì˜ˆ
   class OrderNotFoundException extends RuntimeException { }
   ```

2. **ì ì ˆí•œ ë¶€ëª¨ í´ë˜ìŠ¤ ì„ íƒ**:
   - ë³µêµ¬ ê°€ëŠ¥: `Exception` ìƒì† (Checked)
   - í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜: `RuntimeException` ìƒì† (Unchecked)

3. **ìƒì„±ì ì²´ì¸ ì œê³µ**:
   ```java
   public class PaymentException extends RuntimeException {
       public PaymentException(String message) {
           super(message);
       }

       public PaymentException(String message, Throwable cause) {
           super(message, cause); // ì›ì¸ ì˜ˆì™¸ ë³´ì¡´
       }
   }
   ```

4. **ì¶”ê°€ ì •ë³´ ì œê³µ**:
   ```java
   public class OutOfStockException extends RuntimeException {
       private final String productId;
       private final int availableStock;

       // Getter ì œê³µ
   }
   ```

---

### Q6. ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ë˜ì§ˆ ë•Œ (rethrow) ì£¼ì˜í•  ì ì€?

**A6.**
```java
// âŒ ë‚˜ìœ ì˜ˆ: ì›ì¸ ì˜ˆì™¸ ì†ì‹¤
try {
    callExternalAPI();
} catch (IOException e) {
    throw new RuntimeException("API í˜¸ì¶œ ì‹¤íŒ¨"); // ì›ì¸ ì†ì‹¤!
}

// âœ… ì¢‹ì€ ì˜ˆ: ì›ì¸ ì˜ˆì™¸ ë³´ì¡´
try {
    callExternalAPI();
} catch (IOException e) {
    throw new RuntimeException("API í˜¸ì¶œ ì‹¤íŒ¨", e); // ì›ì¸ ë³´ì¡´
}
```

**ì›ì¸ ì˜ˆì™¸ë¥¼ ë³´ì¡´í•˜ëŠ” ì´ìœ **:
- ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ë”°ë¼ê°€ë©° ë””ë²„ê¹… ê°€ëŠ¥
- ë£¨íŠ¸ ì›ì¸(Root Cause) íŒŒì•… ê°€ëŠ¥

---

### Q7. try-catchë¥¼ ë‚¨ë°œí•˜ë©´ ì„±ëŠ¥ì— ì˜í–¥ì´ ìˆë‚˜ìš”?

**A7.**
**ê²°ë¡ **: **ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ì„±ëŠ¥ ì˜í–¥ ê±°ì˜ ì—†ìŒ**

```java
// try-catch ìì²´ëŠ” ì„±ëŠ¥ ì˜í–¥ ë¯¸ë¯¸
for (int i = 0; i < 1000000; i++) {
    try {
        normalOperation(); // ì˜ˆì™¸ ì•ˆ ë°œìƒ ì‹œ ê±°ì˜ ë™ì¼
    } catch (Exception e) {
        // ...
    }
}
```

**BUT**, **ì˜ˆì™¸ê°€ ì‹¤ì œë¡œ ë°œìƒí•˜ë©´ ë¹„ìš©ì´ í¼**:
- ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ìƒì„± ë¹„ìš©
- ì˜ˆì™¸ ê°ì²´ ìƒì„± ë¹„ìš©

**ì‹¤ë¬´ ê°€ì´ë“œ**:
1. **ì •ìƒ íë¦„ ì œì–´ìš©ìœ¼ë¡œ ì˜ˆì™¸ ì‚¬ìš© ê¸ˆì§€**:
   ```java
   // âŒ ë‚˜ìœ ì˜ˆ
   try {
       int value = map.get(key);
   } catch (NullPointerException e) {
       value = defaultValue;
   }

   // âœ… ì¢‹ì€ ì˜ˆ
   int value = map.getOrDefault(key, defaultValue);
   ```

2. **ì˜ˆì™¸ëŠ” ì§„ì§œ ì˜ˆì™¸ì ì¸ ìƒí™©ì—ë§Œ ì‚¬ìš©**

---

## ğŸ¤ ë©´ì ‘ ì§ˆë¬¸ 12ì„ 

### ì£¼ë‹ˆì–´ ë ˆë²¨ (7ë¬¸ì œ)

#### Q1. Checked Exceptionê³¼ Unchecked Exceptionì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•˜ì„¸ìš”.

**ëª¨ë²” ë‹µë³€**:
- **Checked Exception**: ì»´íŒŒì¼ ì‹œì ì— í™•ì¸ë˜ë©°, ë°˜ë“œì‹œ ì²˜ë¦¬(try-catch) ë˜ëŠ” ì„ ì–¸(throws)í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆ: `IOException`, `SQLException`
- **Unchecked Exception**: `RuntimeException`ì„ ìƒì†í•˜ë©°, ì»´íŒŒì¼ëŸ¬ê°€ ê°•ì œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆ: `NullPointerException`, `IllegalArgumentException`

```java
// Checked Exception
public void readFile() throws IOException { // ì„ ì–¸ í•„ìˆ˜
    FileReader fr = new FileReader("file.txt");
}

// Unchecked Exception
public void divide(int a, int b) { // ì„ ì–¸ ì•ˆ í•´ë„ ë¨
    if (b == 0) {
        throw new IllegalArgumentException();
    }
}
```

**ì¶”ê°€ ì„¤ëª…**:
- Checked Exceptionì€ ë³µêµ¬ ê°€ëŠ¥í•œ ìƒí™©, UncheckedëŠ” í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜ì— ì‚¬ìš©

---

#### Q2. try-catch-finallyì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì„¤ëª…í•˜ì„¸ìš”.

**ëª¨ë²” ë‹µë³€**:
1. **try ë¸”ë¡** ì‹¤í–‰
2. ì˜ˆì™¸ ë°œìƒ ì‹œ **catch ë¸”ë¡** ì‹¤í–‰
3. **finally ë¸”ë¡**ì€ í•­ìƒ ì‹¤í–‰ (return ì „ì—ë„ ì‹¤í–‰)

```java
public int test() {
    try {
        System.out.println("1. try");
        return 10;
    } catch (Exception e) {
        System.out.println("2. catch");
        return 20;
    } finally {
        System.out.println("3. finally"); // return ì „ì— ì‹¤í–‰!
    }
}

// ì¶œë ¥:
// 1. try
// 3. finally
// ë°˜í™˜ê°’: 10
```

**ì£¼ì˜ì **: finallyì—ì„œ returní•˜ë©´ try/catchì˜ returnì„ ë®ì–´ì”€ (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)

---

#### Q3. throwì™€ throwsì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?

**ëª¨ë²” ë‹µë³€**:
- **throw**: ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ì˜ˆì™¸ë¥¼ ì‹¤ì œë¡œ ë°œìƒì‹œí‚¬ ë•Œ ì‚¬ìš©
- **throws**: ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ì—ì„œ ì´ ë©”ì„œë“œê°€ ë˜ì§ˆ ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ì„ ì–¸

```java
public void validateAge(int age) throws InvalidAgeException {
    if (age < 0) {
        throw new InvalidAgeException("ë‚˜ì´ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤");
    }
}
```

---

#### Q4. ì˜ˆì™¸ë¥¼ catchí•  ë•Œ ì—¬ëŸ¬ ê°œë¥¼ í•œ ë²ˆì— ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì€?

**ëª¨ë²” ë‹µë³€**:
**Java 7 ì´ì „**:
```java
try {
    // ...
} catch (IOException e) {
    logger.error("IO ì˜¤ë¥˜", e);
} catch (SQLException e) {
    logger.error("DB ì˜¤ë¥˜", e);
}
```

**Java 7 ì´í›„ (Multi-catch)**:
```java
try {
    // ...
} catch (IOException | SQLException e) {
    logger.error("ì˜¤ë¥˜ ë°œìƒ", e);
}
```

**ì£¼ì˜**: Multi-catchì—ì„œ `e`ëŠ” `final`ë¡œ ê°„ì£¼ë¨

---

#### Q5. try-with-resourcesëŠ” ë¬´ì—‡ì´ê³  ì™œ ì‚¬ìš©í•˜ë‚˜ìš”?

**ëª¨ë²” ë‹µë³€**:
**Java 7ë¶€í„° ë„ì…**ëœ ìë™ ìì› ê´€ë¦¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

**ê¸°ì¡´ ë°©ì‹ (finally ì‚¬ìš©)**:
```java
FileInputStream fis = null;
try {
    fis = new FileInputStream("file.txt");
    // ...
} catch (IOException e) {
    // ...
} finally {
    if (fis != null) {
        try {
            fis.close(); // ìˆ˜ë™ìœ¼ë¡œ ë‹«ê¸°
        } catch (IOException e) {
            // ...
        }
    }
}
```

**try-with-resources**:
```java
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // ...
} catch (IOException e) {
    // ...
}
// fisëŠ” ìë™ìœ¼ë¡œ ë‹«í˜!
```

**ì¥ì **:
- ì½”ë“œ ê°„ê²°
- ìì› ëˆ„ìˆ˜ ë°©ì§€
- `AutoCloseable` ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ê°ì²´ì— ì‚¬ìš© ê°€ëŠ¥

---

#### Q6. NullPointerExceptionì„ í”¼í•˜ëŠ” ë°©ë²•ì€?

**ëª¨ë²” ë‹µë³€**:
1. **null ì²´í¬**:
   ```java
   if (user != null) {
       user.getName();
   }
   ```

2. **Optional ì‚¬ìš©** (Java 8+):
   ```java
   Optional<User> optUser = findUser(id);
   String name = optUser.map(User::getName).orElse("Unknown");
   ```

3. **ê¸°ë³¸ê°’ ì œê³µ ë©”ì„œë“œ ì‚¬ìš©**:
   ```java
   String value = map.getOrDefault(key, "default");
   ```

4. **Null Object Pattern**:
   ```java
   public static final User EMPTY_USER = new User("", 0);
   ```

5. **ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©**:
   ```java
   public void process(@NonNull User user) { }
   ```

---

#### Q7. ì˜ˆì™¸ ì²˜ë¦¬ì˜ Best Practice 3ê°€ì§€ë¥¼ ë§í•˜ì„¸ìš”.

**ëª¨ë²” ë‹µë³€**:
1. **êµ¬ì²´ì ì¸ ì˜ˆì™¸ ì¡ê¸°**:
   ```java
   // âŒ ë‚˜ìœ ì˜ˆ
   catch (Exception e) { }

   // âœ… ì¢‹ì€ ì˜ˆ
   catch (FileNotFoundException e) { }
   ```

2. **ì›ì¸ ì˜ˆì™¸ ë³´ì¡´**:
   ```java
   catch (IOException e) {
       throw new BusinessException("íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨", e);
   }
   ```

3. **ë¹ˆ catch ë¸”ë¡ ê¸ˆì§€**:
   ```java
   catch (Exception e) {
       logger.error("ì˜¤ë¥˜ ë°œìƒ", e);
       throw new RuntimeException(e);
   }
   ```

---

### ì¤‘ê¸‰ ë ˆë²¨ (5ë¬¸ì œ)

#### Q8. ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ Transaction Rollbackì€ ì–´ë–»ê²Œ êµ¬í˜„í•˜ë‚˜ìš”?

**ëª¨ë²” ë‹µë³€**:
**Saga Patternì˜ ë³´ìƒ íŠ¸ëœì­ì…˜**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
List<CompensatableAction> executedActions = new ArrayList<>();

try {
    for (Action action : actions) {
        action.execute();
        executedActions.add(action);
    }
} catch (Exception e) {
    // ì—­ìˆœìœ¼ë¡œ ë¡¤ë°±
    Collections.reverse(executedActions);
    for (Action action : executedActions) {
        action.compensate(); // ì´ì „ ìƒíƒœë¡œ ë³µêµ¬
    }
    throw e;
}
```

**ì‹¤ë¬´ ì˜ˆì‹œ**:
- ì£¼ë¬¸ ì²˜ë¦¬: ì¬ê³  ì°¨ê° â†’ ê²°ì œ â†’ ë°°ì†¡ ì •ë³´ ìƒì„±
- ê²°ì œ ì‹¤íŒ¨ ì‹œ ì¬ê³ ë¥¼ ë‹¤ì‹œ ì¦ê°€ì‹œí‚´ (ë³´ìƒ)

---

#### Q9. Circuit Breaker íŒ¨í„´ì´ ë¬´ì—‡ì´ê³  ì™œ í•„ìš”í•œê°€ìš”?

**ëª¨ë²” ë‹µë³€**:
**ì—°ì†ëœ ì‹¤íŒ¨ë¥¼ ê°ì§€í•˜ì—¬ ì¼ì • ì‹œê°„ ë™ì•ˆ ìš”ì²­ì„ ì°¨ë‹¨**í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

**ë™ì‘ ì›ë¦¬**:
1. **CLOSED** (ì •ìƒ): ëª¨ë“  ìš”ì²­ í—ˆìš©, ì‹¤íŒ¨ ì¹´ìš´íŠ¸
2. **OPEN** (ì°¨ë‹¨): ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ëª¨ë“  ìš”ì²­ ì¦‰ì‹œ ê±°ë¶€
3. **HALF_OPEN** (í…ŒìŠ¤íŠ¸): ì¼ì • ì‹œê°„ í›„ ì¼ë¶€ ìš”ì²­ í—ˆìš©
4. ì„±ê³µ ì‹œ CLOSEDë¡œ ë³µê·€, ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ OPEN

**í•„ìš”í•œ ì´ìœ **:
- **Cascading Failure ë°©ì§€**: ì¥ì• ê°€ ì „íŒŒë˜ëŠ” ê²ƒì„ ë§‰ìŒ
- **ë¹ ë¥¸ ì‹¤íŒ¨ (Fail Fast)**: ì‘ë‹µ ì—†ëŠ” ì„œë¹„ìŠ¤ë¥¼ ê³„ì† í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
- **ë³µêµ¬ ì‹œê°„ í™•ë³´**: ì¥ì•  ì„œë¹„ìŠ¤ê°€ ë³µêµ¬ë  ì‹œê°„ì„ ì œê³µ

**ì‹¤ë¬´ ì˜ˆì‹œ**:
```java
// Netflix Hystrix, Resilience4j ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
@HystrixCommand(fallbackMethod = "defaultUser")
public User getUser(String userId) {
    return externalAPI.getUser(userId);
}

public User defaultUser(String userId) {
    return new User("Guest", "guest@example.com");
}
```

---

#### Q10. ì¬ì‹œë„ ë¡œì§ì„ êµ¬í˜„í•  ë•Œ ê³ ë ¤í•´ì•¼ í•  ì ì€?

**ëª¨ë²” ë‹µë³€**:
1. **ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨**:
   - ì¼ì‹œì  ì˜¤ë¥˜ (ë„¤íŠ¸ì›Œí¬): ì¬ì‹œë„ O
   - ì˜êµ¬ì  ì˜¤ë¥˜ (ì˜ëª»ëœ íŒŒë¼ë¯¸í„°): ì¬ì‹œë„ X

2. **ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì œí•œ**:
   ```java
   int maxAttempts = 3;
   ```

3. **Backoff ì „ëµ**:
   - **Fixed Delay**: ê³ ì • ê°„ê²© (100ms, 100ms, 100ms)
   - **Exponential Backoff**: ì§€ìˆ˜ ì¦ê°€ (100ms, 200ms, 400ms)
   - **Jitter**: ëœë¤ ìš”ì†Œ ì¶”ê°€ (ë™ì‹œ ì¬ì‹œë„ ë°©ì§€)

4. **ë©±ë“±ì„± (Idempotency) ë³´ì¥**:
   - ê°™ì€ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ í•´ë„ ê²°ê³¼ê°€ ë™ì¼í•´ì•¼ í•¨
   ```java
   // âœ… ë©±ë“±: PUT (ì—…ë°ì´íŠ¸)
   updateUser(userId, newData);

   // âŒ ë¹„ë©±ë“±: POST (ìƒì„±)
   createUser(userData); // ì¬ì‹œë„ ì‹œ ì¤‘ë³µ ìƒì„±!
   ```

5. **íƒ€ì„ì•„ì›ƒ ì„¤ì •**:
   ```java
   try {
       Future<Result> future = executor.submit(task);
       return future.get(5, TimeUnit.SECONDS);
   } catch (TimeoutException e) {
       // ì¬ì‹œë„
   }
   ```

---

#### Q11. Custom Exception ê³„ì¸µ êµ¬ì¡°ë¥¼ ì–´ë–»ê²Œ ì„¤ê³„í•˜ë‚˜ìš”?

**ëª¨ë²” ë‹µë³€**:
**ë„ë©”ì¸ë³„ë¡œ ìµœìƒìœ„ ì˜ˆì™¸ë¥¼ ë§Œë“¤ê³ , êµ¬ì²´ì ì¸ ì˜ˆì™¸ë¥¼ ìƒì†**ì‹œí‚µë‹ˆë‹¤.

```java
// ìµœìƒìœ„ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
public abstract class BusinessException extends RuntimeException {
    private final String errorCode;

    public abstract boolean isRetryable();
    public abstract SeverityLevel getSeverity();
}

// ë„ë©”ì¸ë³„ ì˜ˆì™¸
public class OrderException extends BusinessException { }
public class PaymentException extends BusinessException { }

// êµ¬ì²´ì ì¸ ì˜ˆì™¸
public class OrderNotFoundException extends OrderException { }
public class OutOfStockException extends OrderException { }
public class CardLimitExceededException extends PaymentException { }
```

**ì„¤ê³„ ì›ì¹™**:
1. **ì˜ë¯¸ ìˆëŠ” ê³„ì¸µ êµ¬ì¡°**: ì˜ˆì™¸ë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ì²˜ë¦¬ ê°€ëŠ¥
2. **ì¶”ê°€ ì •ë³´ ì œê³µ**: errorCode, íƒ€ì„ìŠ¤íƒ¬í”„, ê´€ë ¨ ë°ì´í„°
3. **ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€**: `isRetryable()` ë©”ì„œë“œë¡œ íŒë‹¨
4. **ì‹¬ê°ë„ ìˆ˜ì¤€**: ë¡œê¹… ë° ì•Œë¦¼ ì •ì±… ê²°ì •

---

#### Q12. ì˜ˆì™¸ ì²˜ë¦¬ì™€ ë¡œê¹…ì„ ì–´ë–»ê²Œ ì—°ê³„í•˜ë‚˜ìš”?

**ëª¨ë²” ë‹µë³€**:
**ê³„ì¸µë³„ë¡œ ì—­í• ì„ ë¶„ë¦¬**í•©ë‹ˆë‹¤.

```java
// âŒ ë‚˜ìœ ì˜ˆ: ëª¨ë“  ê³„ì¸µì—ì„œ ë¡œê¹…
public void serviceMethod() {
    try {
        repositoryMethod();
    } catch (Exception e) {
        logger.error("Service ì˜¤ë¥˜", e); // ì¤‘ë³µ ë¡œê·¸!
        throw e;
    }
}

public void repositoryMethod() {
    try {
        // DB ì‘ì—…
    } catch (SQLException e) {
        logger.error("Repository ì˜¤ë¥˜", e); // ì¤‘ë³µ ë¡œê·¸!
        throw new DataAccessException(e);
    }
}
```

**âœ… ì¢‹ì€ ì˜ˆ: ìµœìƒìœ„ì—ì„œë§Œ ë¡œê¹…**:
```java
@ControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<?> handleBusinessException(BusinessException e) {
        // ì—¬ê¸°ì„œë§Œ ë¡œê¹…
        if (e.getSeverity() == SeverityLevel.HIGH) {
            logger.error("ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ", e);
            alertService.sendAlert(e);
        } else {
            logger.warn("ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸", e);
        }

        return ResponseEntity
            .status(HttpStatus.BAD_REQUEST)
            .body(new ErrorResponse(e.getErrorCode(), e.getMessage()));
    }
}
```

**ë¡œê¹… ì „ëµ**:
| ì‹¬ê°ë„ | ë¡œê·¸ ë ˆë²¨ | ì¶”ê°€ ì¡°ì¹˜ |
|--------|-----------|-----------|
| LOW | INFO | ì—†ìŒ |
| MEDIUM | WARN | ì—†ìŒ |
| HIGH | ERROR | ì´ë©”ì¼ ì•Œë¦¼ |
| CRITICAL | ERROR | ì¦‰ì‹œ SMS/ì „í™” |

**MDC (Mapped Diagnostic Context) í™œìš©**:
```java
MDC.put("userId", userId);
MDC.put("orderId", orderId);
logger.error("ì£¼ë¬¸ ì²˜ë¦¬ ì‹¤íŒ¨", e);
// ë¡œê·¸: [userId=123] [orderId=ORD-001] ì£¼ë¬¸ ì²˜ë¦¬ ì‹¤íŒ¨
MDC.clear();
```

---

## ğŸ¯ ë§ˆë¬´ë¦¬

ì´ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë‹¤ìŒì„ ë°°ì› ìŠµë‹ˆë‹¤:

âœ… **ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°** - ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬
âœ… **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜** - Exponential Backoffë¡œ ì¼ì‹œì  ì˜¤ë¥˜ ê·¹ë³µ
âœ… **Circuit Breaker íŒ¨í„´** - ì¥ì•  ì „íŒŒ ë°©ì§€ ë° ë¹ ë¥¸ ì‹¤íŒ¨
âœ… **íŠ¸ëœì­ì…˜ ë¡¤ë°±** - ë³´ìƒ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
âœ… **ì˜ˆì™¸ ì²˜ë¦¬ Best Practices** - ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì „ëµë“¤

**ë‹¤ìŒ í•™ìŠµ ì¶”ì²œ**:
1. Springì˜ `@Transactional` ì–´ë…¸í…Œì´ì…˜ í•™ìŠµ
2. Resilience4j ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ Circuit Breaker ì‹¤ìŠµ
3. ë¶„ì‚° íŠ¸ëœì­ì…˜ (Saga Pattern) ì‹¬í™” í•™ìŠµ

---

**ğŸ“š ì°¸ê³  ìë£Œ**:
- Effective Java 3íŒ - Item 69~77 (ì˜ˆì™¸ ì²˜ë¦¬)
- Spring Framework ê³µì‹ ë¬¸ì„œ - Exception Handling
- Resilience4j ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¸ì„œ
- Martin Fowler - Circuit Breaker Pattern

**ğŸ”— ê´€ë ¨ ì±•í„°**:
- [23-1. ì˜ˆì™¸ ì²˜ë¦¬ Part 1 - ì‹¤ìƒí™œ ë¹„ìœ ](23-1-ì˜ˆì™¸-ì²˜ë¦¬-Part1.md)
- [23-2. ì˜ˆì™¸ ì²˜ë¦¬ Part 2 - ê¸°ì—… ì‚¬ë¡€](23-2-ì˜ˆì™¸-ì²˜ë¦¬-Part2.md)

---

í–‰ìš´ì„ ë¹•ë‹ˆë‹¤! ğŸ€
