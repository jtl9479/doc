# Redis 13장: 프로그래밍 언어 연동 완전 가이드

> **학습 목표**: Python, Java, Node.js에서 Redis를 연동하고 실무에서 바로 사용할 수 있는 코드 작성 능력 습득

**⏱️ 예상 학습 시간**: 6-8시간
**난이도**: ⭐⭐⭐⭐☆ (4개/5개)

---

## 📚 목차
- [왜 이 기술이 필요한가](#왜-이-기술이-필요한가)
- [실생활 비유로 이해하기](#실생활-비유로-이해하기)
- [Python Redis 연동 (redis-py)](#1-python-redis-연동-redis-py)
- [Java Redis 연동 (Jedis, Lettuce)](#2-java-redis-연동-jedis-lettuce)
- [Node.js Redis 연동 (ioredis)](#3-nodejs-redis-연동-ioredis)
- [Spring Boot Redis 통합](#4-spring-boot-redis-통합)
- [프로그래밍 언어별 Best Practices](#5-프로그래밍-언어별-best-practices)
- [주니어 시나리오](#주니어-시나리오)
- [FAQ](#faq)
- [면접 질문 리스트](#면접-질문-리스트)
- [핵심 정리](#핵심-정리)

---

## 🤔 왜 이 기술이 필요한가?

### 실무 배경
**지금까지 Redis CLI로만 학습했지만, 실무에서는 Python, Java, Node.js 코드로 Redis를 사용합니다**

#### ❌ 프로그래밍 언어 연동을 모르면 발생하는 문제
```
문제 1: CLI 지식만으로는 실무 적용 불가
- 증상: Redis 명령어는 알지만 실제 코드 작성 못함
- 영향: 면접에서 코드 작성 요구 시 당황
- 비용: 입사 후 추가 학습 시간 2-3주 소요

문제 2: 연결 관리 실수로 장애 발생
- 증상: 매 요청마다 새로운 연결 생성 → 연결 수 폭증
- 영향: Redis 최대 연결 수 초과, 서비스 중단
- 비용: 3시간 다운타임, 매출 손실 $30,000

문제 3: 비효율적인 코드로 성능 저하
- 증상: 파이프라인 미사용, 불필요한 직렬화
- 영향: 응답 시간 10배 증가
- 비용: 서버 증설 월 $2,000 추가
```

#### ✅ 프로그래밍 언어 연동을 마스터하면
```
해결책 1: 실무에서 바로 사용 가능한 코드 작성
- 방법: redis-py, Jedis, ioredis 라이브러리 활용
- 효과: 입사 첫날부터 Redis 코드 작성 가능
- 절감: 학습 시간 70% 단축

해결책 2: 연결 풀로 안정적인 운영
- 방법: Connection Pool 사용
- 효과: 연결 재사용으로 성능 향상, 안정성 확보
- 절감: 장애 발생률 95% 감소

해결책 3: 최적화된 코드로 성능 극대화
- 방법: 파이프라인, 비동기 처리, 캐시 추상화
- 효과: 응답 시간 80% 단축, 처리량 5배 증가
- 절감: 서버 비용 60% 절감
```

### 📊 수치로 보는 효과

| 지표 | Before (미숙한 코드) | After (최적화 코드) | 개선율 |
|------|---------------------|---------------------|--------|
| 평균 응답 시간 | 50ms | 5ms | **90%↓** |
| 연결 수 | 1,000개 (매번 생성) | 50개 (풀 재사용) | **95%↓** |
| 처리량 (req/sec) | 1,000 | 10,000 | **900%↑** |
| 서버 비용 | $1,500/월 | $600/월 | **60%↓** |
| 장애 발생률 | 월 3회 | 월 0회 | **100%↓** |

---

## 🌟 실생활 비유로 이해하기

### 비유 1: 도서관 사서와 대화하기 📚
```
Redis CLI = 사서에게 직접 말로 요청
- "책 제목이 'Redis 가이드'인 책 주세요"
- "반납합니다"

프로그래밍 언어 = 도서관 앱으로 요청
- 앱에서 검색 버튼 클릭
- 앱이 자동으로 사서에게 전달
- 앱이 결과를 받아서 화면에 표시

┌─────────────────────────────────────┐
│         도서관 앱 (Python)          │
│   [검색] [대출] [반납]              │
│         ↓                           │
│   redis.get("book:1")               │
│         ↓                           │
│   도서관 시스템 (Redis Server)      │
│         ↓                           │
│   결과를 앱으로 반환                │
└─────────────────────────────────────┘

실무에서는 CLI로 직접 입력하지 않고,
프로그래밍 언어로 자동화된 요청을 보냅니다.
```

### 비유 2: 전화 통화 vs 자동 응답 시스템 📞
```
Redis CLI = 매번 전화 걸어서 사람과 통화
- 번호 누르기
- 연결 대기
- 통화
- 끊기
- 다시 걸기 (비효율적)

연결 풀 = 자동 응답 시스템 (항상 연결 유지)
- 한 번 연결하면 계속 유지
- 필요할 때마다 즉시 통화
- 끊고 다시 거는 시간 절약

┌─────────────────────────────────────┐
│    연결 풀 (Connection Pool)        │
│  [연결1] [연결2] [연결3] ... [연결10]│
│    ↑      ↑      ↑            ↑    │
│  사용중  대기중  사용중       대기중  │
│                                     │
│  → 연결 재사용으로 성능 10배 향상   │
└─────────────────────────────────────┘
```

### 비유 3: 택배 배송 시스템 📦
```
파이프라인 = 택배 상자에 물건 모아서 한 번에 보내기

일반적인 방법:
- 물건 1개 → 택배 보내기 → 왕복
- 물건 1개 → 택배 보내기 → 왕복
- 10개 물건 = 10번 왕복 (비효율)

파이프라인:
- 물건 10개를 상자에 담기
- 한 번에 보내기 → 1번 왕복
- 시간과 비용 절약!

Python 예제:
pipe = redis.pipeline()
pipe.set("key1", "value1")
pipe.set("key2", "value2")
pipe.set("key3", "value3")
pipe.execute()  # 한 번에 전송!
```

---

## 1. Python Redis 연동 (redis-py)

### 1.1 설치 및 기본 연결

#### 설치
```bash
# redis-py 설치
pip install redis

# 비동기 지원 (선택)
pip install redis[hiredis]
```

#### 기본 연결
```python
import redis

# 방법 1: 기본 연결
r = redis.Redis(host='localhost', port=6379, db=0)

# 방법 2: URL 연결
r = redis.from_url('redis://localhost:6379/0')

# 방법 3: 비밀번호 포함
r = redis.Redis(
    host='localhost',
    port=6379,
    password='your_password',
    db=0
)

# 연결 테스트
print(r.ping())  # True
```

### 1.2 기본 연산

```python
import redis

r = redis.Redis(host='localhost', port=6379, decode_responses=True)

# String 타입
r.set('user:1001:name', '김철수')
name = r.get('user:1001:name')
print(name)  # 김철수

# TTL 설정
r.setex('session:abc123', 3600, 'user_data')  # 1시간 후 만료

# 숫자 증가
r.set('views', 0)
r.incr('views')  # 1
r.incrby('views', 10)  # 11

# Hash 타입
r.hset('user:1001', 'name', '김철수')
r.hset('user:1001', 'age', 30)
r.hset('user:1001', 'email', 'kim@example.com')

# 또는 한 번에
r.hset('user:1001', mapping={
    'name': '김철수',
    'age': 30,
    'email': 'kim@example.com'
})

user = r.hgetall('user:1001')
print(user)  # {'name': '김철수', 'age': '30', 'email': 'kim@example.com'}

# List 타입
r.lpush('queue:emails', 'email1@example.com')
r.lpush('queue:emails', 'email2@example.com')
email = r.rpop('queue:emails')  # email1@example.com

# Set 타입
r.sadd('tags:python', 'programming', 'backend', 'scripting')
tags = r.smembers('tags:python')
print(tags)  # {'programming', 'backend', 'scripting'}

# Sorted Set 타입
r.zadd('leaderboard', {'player1': 100, 'player2': 200, 'player3': 150})
top3 = r.zrevrange('leaderboard', 0, 2, withscores=True)
print(top3)  # [('player2', 200.0), ('player3', 150.0), ('player1', 100.0)]
```

### 1.3 연결 풀 사용 (중요!)

```python
import redis

# ❌ 나쁜 예: 매번 새로운 연결 생성
def bad_example():
    r = redis.Redis(host='localhost', port=6379)
    return r.get('key')  # 함수 종료 후 연결 닫힘

# ✅ 좋은 예: 연결 풀 재사용
pool = redis.ConnectionPool(
    host='localhost',
    port=6379,
    max_connections=50,  # 최대 연결 수
    decode_responses=True
)

r = redis.Redis(connection_pool=pool)

def good_example():
    return r.get('key')  # 연결 풀에서 연결 재사용
```

### 1.4 파이프라인으로 성능 최적화

```python
import redis
import time

r = redis.Redis(host='localhost', port=6379, decode_responses=True)

# ❌ 나쁜 예: 개별 명령 (느림)
start = time.time()
for i in range(1000):
    r.set(f'key:{i}', f'value{i}')
print(f"개별 명령: {time.time() - start:.2f}초")  # ~5초

# ✅ 좋은 예: 파이프라인 (빠름)
start = time.time()
pipe = r.pipeline()
for i in range(1000):
    pipe.set(f'key:{i}', f'value{i}')
pipe.execute()
print(f"파이프라인: {time.time() - start:.2f}초")  # ~0.1초

# 50배 빠름!
```

### 1.5 실전 예제: 세션 관리

```python
import redis
import json
from datetime import timedelta

class SessionManager:
    def __init__(self):
        self.redis = redis.Redis(
            host='localhost',
            port=6379,
            decode_responses=True
        )
        self.session_ttl = 3600  # 1시간

    def create_session(self, session_id, user_data):
        """세션 생성"""
        key = f'session:{session_id}'
        self.redis.setex(
            key,
            self.session_ttl,
            json.dumps(user_data)
        )

    def get_session(self, session_id):
        """세션 조회"""
        key = f'session:{session_id}'
        data = self.redis.get(key)
        if data:
            return json.loads(data)
        return None

    def update_session(self, session_id, user_data):
        """세션 업데이트 및 TTL 갱신"""
        key = f'session:{session_id}'
        self.redis.setex(
            key,
            self.session_ttl,
            json.dumps(user_data)
        )

    def delete_session(self, session_id):
        """세션 삭제 (로그아웃)"""
        key = f'session:{session_id}'
        self.redis.delete(key)

# 사용 예시
session_mgr = SessionManager()

# 세션 생성
session_mgr.create_session('abc123', {
    'user_id': 1001,
    'username': 'kimcs',
    'email': 'kim@example.com'
})

# 세션 조회
session = session_mgr.get_session('abc123')
print(session)  # {'user_id': 1001, 'username': 'kimcs', ...}

# 세션 삭제
session_mgr.delete_session('abc123')
```

### 1.6 실전 예제: 캐싱 데코레이터

```python
import redis
import json
import functools
import time

r = redis.Redis(host='localhost', port=6379, decode_responses=True)

def cache(ttl=300):
    """캐싱 데코레이터"""
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            # 캐시 키 생성
            cache_key = f"cache:{func.__name__}:{args}:{kwargs}"

            # 캐시 확인
            cached = r.get(cache_key)
            if cached:
                print(f"캐시 히트: {cache_key}")
                return json.loads(cached)

            # 캐시 미스: 함수 실행
            print(f"캐시 미스: {cache_key}")
            result = func(*args, **kwargs)

            # 캐시 저장
            r.setex(cache_key, ttl, json.dumps(result))
            return result

        return wrapper
    return decorator

# 사용 예시
@cache(ttl=60)  # 60초 캐싱
def get_user_info(user_id):
    """DB에서 사용자 정보 조회 (느림)"""
    print(f"DB 쿼리 실행: user_id={user_id}")
    time.sleep(2)  # DB 쿼리 시뮬레이션
    return {
        'user_id': user_id,
        'name': '김철수',
        'email': 'kim@example.com'
    }

# 첫 번째 호출: DB 쿼리 (2초)
user = get_user_info(1001)  # "캐시 미스", "DB 쿼리 실행"

# 두 번째 호출: 캐시에서 조회 (즉시)
user = get_user_info(1001)  # "캐시 히트"
```

### 1.7 Django/Flask 통합

#### Flask 예제
```python
from flask import Flask, session
from flask_session import Session
import redis

app = Flask(__name__)

# Redis를 세션 스토어로 사용
app.config['SESSION_TYPE'] = 'redis'
app.config['SESSION_REDIS'] = redis.Redis(
    host='localhost',
    port=6379
)
Session(app)

@app.route('/login')
def login():
    session['user_id'] = 1001
    session['username'] = 'kimcs'
    return 'Logged in'

@app.route('/profile')
def profile():
    user_id = session.get('user_id')
    if user_id:
        return f'User ID: {user_id}'
    return 'Not logged in'
```

---

## 2. Java Redis 연동 (Jedis, Lettuce)

### 2.1 Jedis vs Lettuce 비교

| 특징 | Jedis | Lettuce |
|------|-------|---------|
| 성능 | 빠름 | 더 빠름 |
| 비동기 지원 | ❌ 없음 | ✅ 있음 |
| 스레드 안전성 | ❌ 불안전 | ✅ 안전 |
| 연결 풀 | 직접 구현 필요 | 내장 |
| Spring Boot 기본 | ❌ | ✅ |
| 사용 난이도 | 쉬움 | 중간 |

**추천**: **Lettuce** (Spring Boot 기본, 성능 우수)

### 2.2 Jedis 사용법

#### Maven 의존성
```xml
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>5.0.0</version>
</dependency>
```

#### 기본 연결
```java
import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPool;
import redis.clients.jedis.JedisPoolConfig;

public class RedisExample {
    public static void main(String[] args) {
        // ❌ 나쁜 예: 매번 새로운 연결
        Jedis jedis = new Jedis("localhost", 6379);
        jedis.set("key", "value");
        jedis.close();

        // ✅ 좋은 예: 연결 풀 사용
        JedisPoolConfig config = new JedisPoolConfig();
        config.setMaxTotal(50);  // 최대 연결 수
        config.setMaxIdle(10);   // 최대 유휴 연결

        JedisPool pool = new JedisPool(config, "localhost", 6379);

        // try-with-resources로 자동 반환
        try (Jedis jedis = pool.getResource()) {
            jedis.set("user:1001:name", "김철수");
            String name = jedis.get("user:1001:name");
            System.out.println(name);  // 김철수
        }

        pool.close();
    }
}
```

#### 기본 연산
```java
import redis.clients.jedis.Jedis;
import java.util.*;

public class JedisOperations {
    public static void main(String[] args) {
        try (Jedis jedis = new Jedis("localhost", 6379)) {

            // String 타입
            jedis.set("user:1001:name", "김철수");
            jedis.setex("session:abc", 3600, "user_data");  // TTL
            jedis.incr("views");  // 증가

            // Hash 타입
            Map<String, String> user = new HashMap<>();
            user.put("name", "김철수");
            user.put("age", "30");
            user.put("email", "kim@example.com");
            jedis.hset("user:1001", user);

            Map<String, String> userData = jedis.hgetAll("user:1001");
            System.out.println(userData);

            // List 타입
            jedis.lpush("queue:emails", "email1@example.com");
            jedis.lpush("queue:emails", "email2@example.com");
            String email = jedis.rpop("queue:emails");

            // Set 타입
            jedis.sadd("tags:java", "programming", "backend", "oop");
            Set<String> tags = jedis.smembers("tags:java");

            // Sorted Set 타입
            Map<String, Double> scores = new HashMap<>();
            scores.put("player1", 100.0);
            scores.put("player2", 200.0);
            scores.put("player3", 150.0);
            jedis.zadd("leaderboard", scores);

            List<String> top3 = jedis.zrevrange("leaderboard", 0, 2);
            System.out.println(top3);  // [player2, player3, player1]
        }
    }
}
```

#### 파이프라인
```java
import redis.clients.jedis.Jedis;
import redis.clients.jedis.Pipeline;

public class JedisPipeline {
    public static void main(String[] args) {
        try (Jedis jedis = new Jedis("localhost", 6379)) {

            // ❌ 나쁜 예: 개별 명령 (느림)
            long start = System.currentTimeMillis();
            for (int i = 0; i < 1000; i++) {
                jedis.set("key:" + i, "value" + i);
            }
            System.out.println("개별 명령: " + (System.currentTimeMillis() - start) + "ms");

            // ✅ 좋은 예: 파이프라인 (빠름)
            start = System.currentTimeMillis();
            Pipeline pipe = jedis.pipelined();
            for (int i = 0; i < 1000; i++) {
                pipe.set("key:" + i, "value" + i);
            }
            pipe.sync();  // 실행
            System.out.println("파이프라인: " + (System.currentTimeMillis() - start) + "ms");
        }
    }
}
```

### 2.3 실전 예제: 세션 관리 (Java)

```java
import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPool;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.util.Map;

public class SessionManager {
    private final JedisPool pool;
    private final ObjectMapper mapper;
    private final int sessionTTL = 3600;  // 1시간

    public SessionManager(JedisPool pool) {
        this.pool = pool;
        this.mapper = new ObjectMapper();
    }

    // 세션 생성
    public void createSession(String sessionId, Map<String, Object> userData) {
        try (Jedis jedis = pool.getResource()) {
            String key = "session:" + sessionId;
            String json = mapper.writeValueAsString(userData);
            jedis.setex(key, sessionTTL, json);
        } catch (Exception e) {
            throw new RuntimeException("세션 생성 실패", e);
        }
    }

    // 세션 조회
    public Map<String, Object> getSession(String sessionId) {
        try (Jedis jedis = pool.getResource()) {
            String key = "session:" + sessionId;
            String json = jedis.get(key);

            if (json != null) {
                return mapper.readValue(json, Map.class);
            }
            return null;
        } catch (Exception e) {
            throw new RuntimeException("세션 조회 실패", e);
        }
    }

    // 세션 삭제
    public void deleteSession(String sessionId) {
        try (Jedis jedis = pool.getResource()) {
            String key = "session:" + sessionId;
            jedis.del(key);
        }
    }

    public static void main(String[] args) {
        JedisPool pool = new JedisPool("localhost", 6379);
        SessionManager mgr = new SessionManager(pool);

        // 세션 생성
        Map<String, Object> userData = Map.of(
            "userId", 1001,
            "username", "kimcs",
            "email", "kim@example.com"
        );
        mgr.createSession("abc123", userData);

        // 세션 조회
        Map<String, Object> session = mgr.getSession("abc123");
        System.out.println(session);

        pool.close();
    }
}
```

---

## 3. Node.js Redis 연동 (ioredis)

### 3.1 설치 및 기본 연결

#### 설치
```bash
npm install ioredis
```

#### 기본 연결
```javascript
const Redis = require('ioredis');

// 방법 1: 기본 연결
const redis = new Redis({
  host: 'localhost',
  port: 6379,
  db: 0
});

// 방법 2: URL 연결
const redis = new Redis('redis://localhost:6379/0');

// 방법 3: 비밀번호 포함
const redis = new Redis({
  host: 'localhost',
  port: 6379,
  password: 'your_password',
  db: 0,
  retryStrategy: (times) => {
    const delay = Math.min(times * 50, 2000);
    return delay;  // 재연결 전략
  }
});

// 연결 테스트
redis.ping().then(result => {
  console.log(result);  // PONG
});
```

### 3.2 기본 연산

```javascript
const Redis = require('ioredis');
const redis = new Redis();

async function basicOperations() {
  // String 타입
  await redis.set('user:1001:name', '김철수');
  const name = await redis.get('user:1001:name');
  console.log(name);  // 김철수

  // TTL 설정
  await redis.setex('session:abc123', 3600, 'user_data');

  // 숫자 증가
  await redis.set('views', 0);
  await redis.incr('views');  // 1
  await redis.incrby('views', 10);  // 11

  // Hash 타입
  await redis.hset('user:1001', 'name', '김철수');
  await redis.hset('user:1001', 'age', 30);
  await redis.hset('user:1001', 'email', 'kim@example.com');

  // 또는 한 번에
  await redis.hmset('user:1001', {
    name: '김철수',
    age: 30,
    email: 'kim@example.com'
  });

  const user = await redis.hgetall('user:1001');
  console.log(user);  // { name: '김철수', age: '30', email: 'kim@example.com' }

  // List 타입
  await redis.lpush('queue:emails', 'email1@example.com');
  await redis.lpush('queue:emails', 'email2@example.com');
  const email = await redis.rpop('queue:emails');

  // Set 타입
  await redis.sadd('tags:nodejs', 'programming', 'backend', 'javascript');
  const tags = await redis.smembers('tags:nodejs');
  console.log(tags);

  // Sorted Set 타입
  await redis.zadd('leaderboard', 100, 'player1', 200, 'player2', 150, 'player3');
  const top3 = await redis.zrevrange('leaderboard', 0, 2, 'WITHSCORES');
  console.log(top3);  // ['player2', '200', 'player3', '150', 'player1', '100']
}

basicOperations();
```

### 3.3 파이프라인

```javascript
const Redis = require('ioredis');
const redis = new Redis();

async function pipelineExample() {
  // ❌ 나쁜 예: 개별 명령 (느림)
  console.time('개별 명령');
  for (let i = 0; i < 1000; i++) {
    await redis.set(`key:${i}`, `value${i}`);
  }
  console.timeEnd('개별 명령');  // ~5000ms

  // ✅ 좋은 예: 파이프라인 (빠름)
  console.time('파이프라인');
  const pipeline = redis.pipeline();
  for (let i = 0; i < 1000; i++) {
    pipeline.set(`key:${i}`, `value${i}`);
  }
  await pipeline.exec();
  console.timeEnd('파이프라인');  // ~100ms

  // 50배 빠름!
}

pipelineExample();
```

### 3.4 실전 예제: Express.js 세션 관리

```javascript
const express = require('express');
const session = require('express-session');
const RedisStore = require('connect-redis').default;
const Redis = require('ioredis');

const app = express();
const redis = new Redis();

// Redis를 세션 스토어로 사용
app.use(session({
  store: new RedisStore({ client: redis }),
  secret: 'your-secret-key',
  resave: false,
  saveUninitialized: false,
  cookie: {
    maxAge: 3600000  // 1시간
  }
}));

app.get('/login', (req, res) => {
  req.session.userId = 1001;
  req.session.username = 'kimcs';
  res.send('Logged in');
});

app.get('/profile', (req, res) => {
  if (req.session.userId) {
    res.send(`User ID: ${req.session.userId}`);
  } else {
    res.send('Not logged in');
  }
});

app.get('/logout', (req, res) => {
  req.session.destroy((err) => {
    res.send('Logged out');
  });
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});
```

### 3.5 실전 예제: 캐싱 미들웨어

```javascript
const Redis = require('ioredis');
const redis = new Redis();

// 캐싱 미들웨어
function cacheMiddleware(ttl = 60) {
  return async (req, res, next) => {
    const cacheKey = `cache:${req.originalUrl}`;

    // 캐시 확인
    const cached = await redis.get(cacheKey);
    if (cached) {
      console.log(`캐시 히트: ${cacheKey}`);
      return res.json(JSON.parse(cached));
    }

    console.log(`캐시 미스: ${cacheKey}`);

    // 원본 res.json 백업
    const originalJson = res.json.bind(res);

    // res.json 오버라이드
    res.json = (body) => {
      // 캐시 저장
      redis.setex(cacheKey, ttl, JSON.stringify(body));
      return originalJson(body);
    };

    next();
  };
}

// 사용 예시
const express = require('express');
const app = express();

app.get('/api/users/:id', cacheMiddleware(60), async (req, res) => {
  // DB 쿼리 시뮬레이션
  console.log('DB 쿼리 실행');
  await new Promise(resolve => setTimeout(resolve, 2000));

  res.json({
    userId: req.params.id,
    name: '김철수',
    email: 'kim@example.com'
  });
});

// 첫 번째 요청: DB 쿼리 (2초)
// 두 번째 요청: 캐시에서 조회 (즉시)
```

---

## 4. Spring Boot Redis 통합

### 4.1 의존성 추가

```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>

<!-- Lettuce는 기본 포함 -->
```

### 4.2 설정

```yaml
# application.yml
spring:
  redis:
    host: localhost
    port: 6379
    password: your_password  # 선택
    lettuce:
      pool:
        max-active: 50
        max-idle: 10
        min-idle: 5
```

### 4.3 RedisTemplate 사용

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.ValueOperations;
import org.springframework.stereotype.Service;
import java.util.concurrent.TimeUnit;

@Service
public class RedisService {

    @Autowired
    private RedisTemplate<String, Object> redisTemplate;

    // String 타입 저장
    public void setValue(String key, String value) {
        ValueOperations<String, Object> ops = redisTemplate.opsForValue();
        ops.set(key, value);
    }

    // TTL과 함께 저장
    public void setValueWithTTL(String key, String value, long timeout) {
        ValueOperations<String, Object> ops = redisTemplate.opsForValue();
        ops.set(key, value, timeout, TimeUnit.SECONDS);
    }

    // 값 조회
    public String getValue(String key) {
        ValueOperations<String, Object> ops = redisTemplate.opsForValue();
        return (String) ops.get(key);
    }

    // Hash 저장
    public void setHash(String key, String field, String value) {
        redisTemplate.opsForHash().put(key, field, value);
    }

    // Hash 조회
    public Object getHash(String key, String field) {
        return redisTemplate.opsForHash().get(key, field);
    }

    // List 추가
    public void pushToList(String key, String value) {
        redisTemplate.opsForList().leftPush(key, value);
    }

    // Set 추가
    public void addToSet(String key, String... values) {
        redisTemplate.opsForSet().add(key, (Object[]) values);
    }

    // Sorted Set 추가
    public void addToSortedSet(String key, String value, double score) {
        redisTemplate.opsForZSet().add(key, value, score);
    }
}
```

### 4.4 @Cacheable 어노테이션 사용

```java
import org.springframework.cache.annotation.Cacheable;
import org.springframework.cache.annotation.CacheEvict;
import org.springframework.stereotype.Service;

@Service
public class UserService {

    // 캐시 저장 (자동)
    @Cacheable(value = "users", key = "#userId")
    public User getUserById(Long userId) {
        System.out.println("DB 쿼리 실행: " + userId);
        // DB에서 사용자 조회 (느림)
        return userRepository.findById(userId).orElse(null);
    }

    // 캐시 무효화
    @CacheEvict(value = "users", key = "#userId")
    public void updateUser(Long userId, User user) {
        userRepository.save(user);
    }

    // 모든 캐시 무효화
    @CacheEvict(value = "users", allEntries = true)
    public void clearAllCache() {
        // 모든 users 캐시 삭제
    }
}
```

### 4.5 Redis Cache Configuration

```java
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.RedisSerializationContext;
import org.springframework.data.redis.serializer.StringRedisSerializer;
import java.time.Duration;

@Configuration
@EnableCaching
public class RedisCacheConfig {

    @Bean
    public RedisCacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .serializeKeysWith(
                RedisSerializationContext.SerializationPair.fromSerializer(
                    new StringRedisSerializer()
                )
            )
            .serializeValuesWith(
                RedisSerializationContext.SerializationPair.fromSerializer(
                    new GenericJackson2JsonRedisSerializer()
                )
            )
            .entryTtl(Duration.ofMinutes(60));  // 기본 TTL 60분

        return RedisCacheManager.builder(factory)
            .cacheDefaults(config)
            .build();
    }
}
```

---

## 5. 프로그래밍 언어별 Best Practices

### 5.1 연결 관리

#### ✅ 모범 사례
```python
# Python
pool = redis.ConnectionPool(host='localhost', max_connections=50)
r = redis.Redis(connection_pool=pool)
```

```java
// Java
JedisPool pool = new JedisPool(config, "localhost", 6379);
try (Jedis jedis = pool.getResource()) {
    // 사용 후 자동 반환
}
```

```javascript
// Node.js
const redis = new Redis({
  host: 'localhost',
  retryStrategy: (times) => Math.min(times * 50, 2000)
});
```

#### ❌ 안티 패턴
```python
# 매번 새로운 연결 생성 (느림, 자원 낭비)
r = redis.Redis()
r.get('key')
```

### 5.2 에러 핸들링

```python
# Python
import redis

try:
    r = redis.Redis(host='localhost', socket_connect_timeout=5)
    r.ping()
except redis.ConnectionError as e:
    print(f"Redis 연결 실패: {e}")
except redis.TimeoutError as e:
    print(f"Redis 타임아웃: {e}")
```

```java
// Java
try (Jedis jedis = pool.getResource()) {
    String value = jedis.get("key");
} catch (JedisConnectionException e) {
    logger.error("Redis 연결 실패", e);
} catch (JedisDataException e) {
    logger.error("Redis 데이터 오류", e);
}
```

```javascript
// Node.js
redis.on('error', (err) => {
  console.error('Redis 오류:', err);
});

redis.on('connect', () => {
  console.log('Redis 연결 성공');
});

redis.on('reconnecting', () => {
  console.log('Redis 재연결 중...');
});
```

### 5.3 직렬화 전략

```python
# Python - JSON 직렬화
import json

data = {'name': '김철수', 'age': 30}
r.set('user:1001', json.dumps(data))
user = json.loads(r.get('user:1001'))
```

```java
// Java - Jackson
ObjectMapper mapper = new ObjectMapper();
User user = new User("김철수", 30);
String json = mapper.writeValueAsString(user);
jedis.set("user:1001", json);
```

```javascript
// Node.js - 자동 JSON 직렬화
const data = { name: '김철수', age: 30 };
await redis.set('user:1001', JSON.stringify(data));
const user = JSON.parse(await redis.get('user:1001'));
```

---

## 주니어 시나리오

### 시나리오 1: "첫 출근, Redis 코드 작성 요청"
```
상황: 입사 첫 주, 팀장님이 세션 관리 코드 작성 요청

팀장: "Redis로 사용자 세션 저장하는 코드 작성해줘.
      1시간 후 만료되게 하고."

당신: (당황) "CLI만 배웠는데..."

해결:
1. 13장 Python 예제 참고
2. SessionManager 클래스 복사
3. TTL 3600초로 설정
4. 테스트 후 제출

결과: ✅ 코드 리뷰 통과, 팀장님 칭찬
```

### 시나리오 2: "연결 수 폭증으로 서비스 장애"
```
상황: 배포 후 30분, Redis 연결 수 초과로 서비스 중단

모니터링: "Redis connections: 10,000/10,000"

코드 확인:
def get_data():
    r = redis.Redis()  # ❌ 매번 새 연결
    return r.get('key')

해결:
1. 연결 풀 생성 (전역 변수)
2. 연결 재사용
3. 재배포

결과: ✅ 연결 수 50개로 감소, 서비스 정상화
```

### 시나리오 3: "응답 속도 너무 느림"
```
상황: API 응답 시간 5초 (목표 0.5초)

코드:
for i in range(1000):
    r.set(f'key:{i}', f'value{i}')  # ❌ 개별 명령

해결:
1. 파이프라인 사용
2. 1000개 명령을 한 번에 전송

결과: ✅ 5초 → 0.1초 (50배 개선)
```

---

## FAQ

**Q1: redis-py, Jedis, ioredis 중 어떤 걸 선택해야 하나요?**
```
A: 사용하는 프로그래밍 언어에 따라 선택
- Python → redis-py
- Java → Lettuce (Spring Boot), Jedis (일반)
- Node.js → ioredis

모두 기능은 거의 동일합니다.
```

**Q2: 연결 풀 크기는 어떻게 설정하나요?**
```
A: 동시 요청 수 기준
- 소규모: max_connections=10-20
- 중규모: max_connections=50-100
- 대규모: max_connections=200-500

모니터링하면서 조정하세요.
```

**Q3: decode_responses=True는 언제 사용하나요?**
```
A: 문자열 데이터를 다룰 때

# decode_responses=False (기본)
value = r.get('key')  # b'value' (bytes)

# decode_responses=True
value = r.get('key')  # 'value' (str)

편의성을 위해 대부분 True 권장
```

**Q4: 파이프라인과 트랜잭션의 차이는?**
```
A:
- 파이프라인: 여러 명령을 한 번에 전송 (성능 향상)
- 트랜잭션: MULTI/EXEC로 원자성 보장

파이프라인 안에서 트랜잭션 사용 가능
```

**Q5: async/await를 사용해야 하나요?**
```
A: 언어별 상황에 따라
- Python: asyncio + aioredis (비동기 필요 시)
- Java: Lettuce (비동기 기본 지원)
- Node.js: ioredis (Promise 기본 지원)

일반적으로 동기 방식도 충분히 빠름
```

---

## 면접 질문 리스트

### 초급
1. Redis 클라이언트 라이브러리 이름을 언어별로 말하세요
2. 연결 풀을 사용하는 이유는?
3. redis-py에서 decode_responses의 역할은?

### 중급
4. 파이프라인의 동작 원리를 설명하세요
5. Jedis와 Lettuce의 차이점은?
6. Spring Boot에서 @Cacheable 어노테이션의 동작 원리는?

### 고급
7. 연결 풀 크기를 결정하는 기준은?
8. Redis 클라이언트의 재연결 전략을 설계하세요
9. 대용량 데이터 저장 시 직렬화 방식 선택 기준은?

---

## 핵심 정리

### 언어별 클라이언트
```
Python: redis-py
Java: Jedis, Lettuce
Node.js: ioredis
```

### 핵심 원칙
```
1. ✅ 연결 풀 사용 (매번 새 연결 ❌)
2. ✅ 파이프라인으로 성능 향상
3. ✅ try-with-resources로 자원 관리
4. ✅ 에러 핸들링 필수
5. ✅ TTL 설정으로 메모리 관리
```

### 성능 최적화
```
1. 연결 풀 재사용
2. 파이프라인 사용
3. 적절한 직렬화 (JSON, MessagePack)
4. 비동기 처리 (필요 시)
```

---

## 다음 단계

- **14장**: Redis 보안 완전 가이드
- **16장**: Redis 캐싱 전략 완전 가이드

---

## 축하합니다! 🎉

**이제 여러분은 Python, Java, Node.js에서 Redis를 실무 수준으로 사용할 수 있습니다!**

**다음 장에서 보안 설정을 배워봅시다!** 🚀