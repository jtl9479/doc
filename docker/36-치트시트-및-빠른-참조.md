# ì„¹ì…˜ 36: ì¹˜íŠ¸ì‹œíŠ¸ ë° ë¹ ë¥¸ ì°¸ì¡°

## Docker ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

### ê¸°ë³¸ ëª…ë ¹ì–´

```bash
# Docker ë²„ì „ í™•ì¸
docker --version
docker version
docker info

# ë„ì›€ë§
docker --help
docker <command> --help
```

### ì´ë¯¸ì§€ ê´€ë¦¬

```bash
# ì´ë¯¸ì§€ ê²€ìƒ‰
docker search nginx

# ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
docker pull nginx:alpine
docker pull nginx:1.21

# ì´ë¯¸ì§€ ëª©ë¡
docker images
docker image ls

# ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´
docker inspect nginx:alpine
docker history nginx:alpine

# ì´ë¯¸ì§€ ì‚­ì œ
docker rmi nginx:alpine
docker image rm nginx:alpine

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì‚­ì œ
docker image prune
docker image prune -a

# ì´ë¯¸ì§€ íƒœê·¸
docker tag nginx:alpine myregistry.com/nginx:v1

# ì´ë¯¸ì§€ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
docker save nginx:alpine -o nginx.tar
docker load -i nginx.tar
```

### ì»¨í…Œì´ë„ˆ ê´€ë¦¬

```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run nginx
docker run -d nginx                    # ë°±ê·¸ë¼ìš´ë“œ
docker run -d --name web nginx         # ì´ë¦„ ì§€ì •
docker run -d -p 8080:80 nginx        # í¬íŠ¸ ë§¤í•‘
docker run -d -v $(pwd):/app nginx    # ë³¼ë¥¨ ë§ˆìš´íŠ¸
docker run -d -e KEY=VALUE nginx      # í™˜ê²½ ë³€ìˆ˜

# ì»¨í…Œì´ë„ˆ ëª©ë¡
docker ps                 # ì‹¤í–‰ ì¤‘
docker ps -a              # ëª¨ë“  ì»¨í…Œì´ë„ˆ
docker ps -q              # IDë§Œ ì¶œë ¥

# ì»¨í…Œì´ë„ˆ ì‹œì‘/ì¤‘ì§€/ì¬ì‹œì‘
docker start <container>
docker stop <container>
docker restart <container>
docker pause <container>
docker unpause <container>

# ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker rm <container>
docker rm -f <container>     # ê°•ì œ ì‚­ì œ

# ëª¨ë“  ì¤‘ì§€ëœ ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker container prune

# ì»¨í…Œì´ë„ˆ ë¡œê·¸
docker logs <container>
docker logs -f <container>           # ì‹¤ì‹œê°„
docker logs --tail 100 <container>   # ë§ˆì§€ë§‰ 100ì¤„
docker logs --since 10m <container>  # ìµœê·¼ 10ë¶„

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì†
docker exec -it <container> /bin/bash
docker exec -it <container> sh

# ì»¨í…Œì´ë„ˆ â†’ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ë³µì‚¬
docker cp <container>:/path/to/file ./local

# í˜¸ìŠ¤íŠ¸ â†’ ì»¨í…Œì´ë„ˆ íŒŒì¼ ë³µì‚¬
docker cp ./local <container>:/path/to/file

# ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
docker stats
docker stats <container>

# ì»¨í…Œì´ë„ˆ ìƒì„¸ ì •ë³´
docker inspect <container>
docker top <container>
```

### ë¹Œë“œ ê´€ë¦¬

```bash
# ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t myapp:v1 .
docker build -f Dockerfile.prod -t myapp:v1 .
docker build --no-cache -t myapp:v1 .

# ë¹Œë“œ ì¸ì
docker build --build-arg VERSION=1.0 -t myapp:v1 .

# BuildKit ì‚¬ìš©
DOCKER_BUILDKIT=1 docker build -t myapp:v1 .
```

### ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬

```bash
# ë„¤íŠ¸ì›Œí¬ ëª©ë¡
docker network ls

# ë„¤íŠ¸ì›Œí¬ ìƒì„±
docker network create mynetwork
docker network create --driver bridge mynetwork

# ë„¤íŠ¸ì›Œí¬ ìƒì„¸ ì •ë³´
docker network inspect mynetwork

# ì»¨í…Œì´ë„ˆë¥¼ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°
docker network connect mynetwork <container>
docker network disconnect mynetwork <container>

# ë„¤íŠ¸ì›Œí¬ ì‚­ì œ
docker network rm mynetwork
docker network prune
```

### ë³¼ë¥¨ ê´€ë¦¬

```bash
# ë³¼ë¥¨ ëª©ë¡
docker volume ls

# ë³¼ë¥¨ ìƒì„±
docker volume create myvolume

# ë³¼ë¥¨ ìƒì„¸ ì •ë³´
docker volume inspect myvolume

# ë³¼ë¥¨ ì‚­ì œ
docker volume rm myvolume
docker volume prune

# ë³¼ë¥¨ ì‚¬ìš©
docker run -v myvolume:/data nginx
```

### Docker Compose

```bash
# ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up
docker-compose up -d              # ë°±ê·¸ë¼ìš´ë“œ
docker-compose up --build         # ì´ë¯¸ì§€ ì¬ë¹Œë“œ

# ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose stop
docker-compose down               # ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker-compose down -v            # ë³¼ë¥¨ë„ ì‚­ì œ

# ì„œë¹„ìŠ¤ ëª©ë¡
docker-compose ps

# ë¡œê·¸
docker-compose logs
docker-compose logs -f
docker-compose logs <service>

# íŠ¹ì • ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart <service>

# ìŠ¤ì¼€ì¼ë§
docker-compose up -d --scale web=3

# ì„¤ì • í™•ì¸
docker-compose config
```

### Docker Swarm

```bash
# Swarm ì´ˆê¸°í™”
docker swarm init
docker swarm init --advertise-addr <ip>

# ë…¸ë“œ ì¶”ê°€
docker swarm join --token <token> <ip>:2377

# ë…¸ë“œ ëª©ë¡
docker node ls

# ì„œë¹„ìŠ¤ ìƒì„±
docker service create --name web --replicas 3 -p 80:80 nginx

# ì„œë¹„ìŠ¤ ëª©ë¡
docker service ls

# ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´
docker service ps web
docker service inspect web

# ì„œë¹„ìŠ¤ ìŠ¤ì¼€ì¼
docker service scale web=5

# ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸
docker service update --image nginx:1.21 web

# ì„œë¹„ìŠ¤ ì‚­ì œ
docker service rm web

# Stack ë°°í¬
docker stack deploy -c docker-compose.yml mystack

# Stack ëª©ë¡
docker stack ls
docker stack services mystack
docker stack ps mystack

# Stack ì‚­ì œ
docker stack rm mystack
```

### Kubernetes (kubectl)

```bash
# í´ëŸ¬ìŠ¤í„° ì •ë³´
kubectl cluster-info
kubectl get nodes

# Pod ê´€ë¦¬
kubectl get pods
kubectl get pods -o wide
kubectl describe pod <pod>
kubectl logs <pod>
kubectl logs -f <pod>
kubectl exec -it <pod> -- /bin/bash

# Deployment ê´€ë¦¬
kubectl create deployment nginx --image=nginx
kubectl get deployments
kubectl scale deployment nginx --replicas=3
kubectl delete deployment nginx

# Service ê´€ë¦¬
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl get services
kubectl delete service nginx

# YAML ì ìš©
kubectl apply -f deployment.yaml
kubectl delete -f deployment.yaml

# ë¦¬ì†ŒìŠ¤ ì¡°íšŒ
kubectl get all
kubectl get all -n <namespace>

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤
kubectl get namespaces
kubectl create namespace <name>
kubectl config set-context --current --namespace=<name>

# ConfigMap & Secret
kubectl create configmap <name> --from-literal=key=value
kubectl create secret generic <name> --from-literal=password=secret
kubectl get configmaps
kubectl get secrets

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top nodes
kubectl top pods
```

---

## Dockerfile ì¹˜íŠ¸ì‹œíŠ¸

### ê¸°ë³¸ ëª…ë ¹ì–´

```dockerfile
# ë² ì´ìŠ¤ ì´ë¯¸ì§€
FROM ubuntu:22.04
FROM node:18-alpine AS builder

# ì‘ì—… ë””ë ‰í† ë¦¬
WORKDIR /app

# íŒŒì¼ ë³µì‚¬
COPY package.json .
COPY . .
COPY --from=builder /app/dist ./dist

# ëª…ë ¹ ì‹¤í–‰
RUN apt-get update && apt-get install -y curl
RUN npm install

# í™˜ê²½ ë³€ìˆ˜
ENV NODE_ENV=production
ENV PATH="/app/bin:${PATH}"

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# ë³¼ë¥¨
VOLUME /data

# ì‚¬ìš©ì
USER appuser

# í—¬ìŠ¤ì²´í¬
HEALTHCHECK --interval=30s --timeout=3s \
  CMD curl -f http://localhost:8080/health || exit 1

# ì‹¤í–‰ ëª…ë ¹ (í•˜ë‚˜ë§Œ)
CMD ["node", "server.js"]
ENTRYPOINT ["docker-entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]

# ë ˆì´ë¸”
LABEL version="1.0"
LABEL description="My Application"

# ë¹Œë“œ ì¸ì
ARG VERSION=latest
ARG BUILD_DATE
```

### ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ

```dockerfile
# Stage 1: Build
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Stage 2: Production
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
CMD ["node", "dist/main.js"]
```

---

## docker-compose.yml ì¹˜íŠ¸ì‹œíŠ¸

```yaml
version: '3.8'

services:
  # ì›¹ ì„œë¹„ìŠ¤
  web:
    image: nginx:alpine
    # ë˜ëŠ” ë¹Œë“œ
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: 1.0
    container_name: my-web
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
      - web-data:/var/log/nginx
    environment:
      - NODE_ENV=production
      - DEBUG=false
    env_file:
      - .env
    networks:
      - frontend
    depends_on:
      - db
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 3s
      retries: 3
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

  # ë°ì´í„°ë² ì´ìŠ¤
  db:
    image: postgres:16
    volumes:
      - db-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    networks:
      - backend

volumes:
  web-data:
  db-data:

networks:
  frontend:
  backend:
```

---

## ìì£¼ ì“°ëŠ” íŒ¨í„´

### 1. ê°œë°œ í™˜ê²½ ì„¤ì •

```yaml
version: '3.8'

services:
  app:
    build:
      context: .
      target: development
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
    command: npm run dev
```

### 2. í…ŒìŠ¤íŠ¸ í™˜ê²½

```yaml
version: '3.8'

services:
  test:
    build: .
    volumes:
      - .:/app
    command: npm test
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: test_db
```

### 3. í”„ë¡œë•ì…˜ í™˜ê²½

```yaml
version: '3.8'

services:
  app:
    image: myregistry.com/myapp:${VERSION}
    restart: always
    environment:
      - NODE_ENV=production
    deploy:
      replicas: 3
      update_config:
        parallelism: 1
        delay: 10s
```

---

## í™˜ê²½ ë³€ìˆ˜

```bash
# .env íŒŒì¼
VERSION=1.0.0
REGISTRY=myregistry.com
DB_PASSWORD=secret

# docker-compose.ymlì—ì„œ ì‚¬ìš©
services:
  app:
    image: ${REGISTRY}/myapp:${VERSION}
    environment:
      - DB_PASSWORD=${DB_PASSWORD}
```

---

## ë¦¬ì†ŒìŠ¤ ì •ë¦¬

```bash
# ëª¨ë‘ ì¤‘ì§€ ë° ì‚­ì œ
docker-compose down

# ì»¨í…Œì´ë„ˆ, ë„¤íŠ¸ì›Œí¬, ì´ë¯¸ì§€, ë³¼ë¥¨ ëª¨ë‘ ì‚­ì œ
docker system prune -a --volumes

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒë§Œ ì‚­ì œ
docker container prune
docker image prune
docker volume prune
docker network prune

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸
docker system df
```

---

## ë””ë²„ê¹…

```bash
# ì»¨í…Œì´ë„ˆ ë¡œê·¸
docker logs -f <container>

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì†
docker exec -it <container> sh

# ì»¨í…Œì´ë„ˆ ìƒì„¸ ì •ë³´
docker inspect <container>

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸
docker run --rm -it nicolaka/netshoot
# ë‚´ë¶€ì—ì„œ: nslookup, ping, curl ë“± ì‚¬ìš©

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
docker top <container>

# íŒŒì¼ ì‹œìŠ¤í…œ ë³€ê²½ í™•ì¸
docker diff <container>
```

---

## ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
docker stats

# íŠ¹ì • ì»¨í…Œì´ë„ˆ
docker stats <container>

# JSON í˜•ì‹
docker stats --format "{{json .}}"

# í•œ ë²ˆë§Œ ì¶œë ¥
docker stats --no-stream
```

---

## ë³´ì•ˆ

```bash
# ì´ë¯¸ì§€ ìŠ¤ìº”
trivy image myapp:latest
docker scan myapp:latest

# ì»¨í…Œì´ë„ˆ ë³´ì•ˆ ì„¤ì •
docker run --read-only \
  --security-opt=no-new-privileges \
  --cap-drop=ALL \
  myapp

# Secret ì‚¬ìš©
echo "password" | docker secret create db_password -
docker service create --secret db_password myapp
```

---

## ìœ ìš©í•œ í”Œë˜ê·¸

```bash
# ìì£¼ ì“°ëŠ” í”Œë˜ê·¸
-d, --detach              # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
-i, --interactive         # í‘œì¤€ ì…ë ¥ ìœ ì§€
-t, --tty                 # ê°€ìƒ í„°ë¯¸ë„ í• ë‹¹
-p, --publish             # í¬íŠ¸ ë§¤í•‘
-v, --volume              # ë³¼ë¥¨ ë§ˆìš´íŠ¸
-e, --env                 # í™˜ê²½ ë³€ìˆ˜
--name                    # ì´ë¦„ ì§€ì •
--rm                      # ì¢…ë£Œ ì‹œ ìë™ ì‚­ì œ
-f, --force               # ê°•ì œ ì‹¤í–‰
--no-cache                # ìºì‹œ ì‚¬ìš© ì•ˆ í•¨
-q, --quiet               # ìµœì†Œ ì¶œë ¥
```

---

ì´ ì¹˜íŠ¸ì‹œíŠ¸ë¥¼ ì¸ì‡„í•˜ê±°ë‚˜ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í•˜ì—¬ ì–¸ì œë“ ì§€ ì°¸ì¡°í•˜ì„¸ìš”! ğŸ“‹