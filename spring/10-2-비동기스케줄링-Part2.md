# 10ì¥: ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ìŠ¤ì¼€ì¤„ë§ - Part 2

## ì‹¤ìŠµ: ë¹„ë™ê¸° ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ

### ìš”êµ¬ì‚¬í•­
- íšŒì›ê°€ì… ì‹œ í™˜ì˜ ì´ë©”ì¼ ì¦‰ì‹œ ë°œì†¡
- ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë¹„ë™ê¸° ë°œì†¡
- ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
- ë°œì†¡ ê²°ê³¼ ì¶”ì  ê°€ëŠ¥

### í”„ë¡œì íŠ¸ êµ¬ì¡°
```
src/main/java/com/example/async/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ AsyncConfig.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ EmailService.java
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ OrderService.java
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ EmailResult.java
â””â”€â”€ handler/
    â””â”€â”€ AsyncExceptionHandler.java
```

### 1. ì„¤ì • í´ë˜ìŠ¤

```java
package com.example.async.config;

import lombok.extern.slf4j.Slf4j;
import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.AsyncConfigurer;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.Executor;
import java.util.concurrent.ThreadPoolExecutor;

@Slf4j
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {

    @Override
    @Bean(name = "emailExecutor")
    public Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // CPU ì½”ì–´ ìˆ˜ ê¸°ë°˜ ì„¤ì •
        int processors = Runtime.getRuntime().availableProcessors();

        executor.setCorePoolSize(processors * 2);  // ì½”ì–´ ìˆ˜ * 2
        executor.setMaxPoolSize(processors * 4);   // ì½”ì–´ ìˆ˜ * 4
        executor.setQueueCapacity(500);            // ëŒ€ê¸° í í¬ê¸°
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("Email-Async-");

        // í ì´ˆê³¼ ì‹œ í˜¸ì¶œì ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ (ì‹œìŠ¤í…œ ë³´í˜¸)
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ ì‘ì—… ì™„ë£Œ ëŒ€ê¸°
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(30);

        executor.initialize();

        log.info("EmailExecutor ì´ˆê¸°í™”: core={}, max={}, queue={}",
            executor.getCorePoolSize(),
            executor.getMaxPoolSize(),
            executor.getQueueCapacity());

        return executor;
    }

    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return (throwable, method, params) -> {
            log.error("=== ë¹„ë™ê¸° ì‘ì—… ì˜ˆì™¸ ë°œìƒ ===");
            log.error("ë©”ì„œë“œ: {}", method.getName());
            log.error("ì˜ˆì™¸: ", throwable);

            // ì‹¤ë¬´ì—ì„œëŠ” ì—¬ê¸°ì„œ ì•Œë¦¼ ì „ì†¡
            // slackService.sendAlert(...);
            // emailService.sendAlertToAdmin(...);
        };
    }
}
```

### 2. ì´ë©”ì¼ ì„œë¹„ìŠ¤

```java
package com.example.async.service;

import com.example.async.dto.EmailResult;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.concurrent.CompletableFuture;

@Slf4j
@Service
public class EmailService {

    /**
     * í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ (void - Fire and Forget)
     */
    @Async("emailExecutor")
    public void sendWelcomeEmail(String userEmail, String userName) {
        log.info("[{}] í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘: {}", Thread.currentThread().getName(), userEmail);

        try {
            // ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ ë¡œì§ (ì‹œë®¬ë ˆì´ì…˜: 2ì´ˆ ì†Œìš”)
            Thread.sleep(2000);

            log.info("í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ: {}", userEmail);

            // ì‹¤ë¬´ì—ì„œëŠ” ì´ë©”ì¼ ë°œì†¡ ì´ë ¥ DB ì €ì¥
            // emailHistoryRepository.save(new EmailHistory(userEmail, "WELCOME", "SUCCESS"));

        } catch (Exception e) {
            log.error("í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {}", userEmail, e);

            // ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íì— ì¶”ê°€
            // retryQueue.add(new EmailRetryTask(userEmail, "WELCOME"));
        }
    }

    /**
     * ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ (CompletableFuture - ê²°ê³¼ ë°˜í™˜)
     */
    @Async("emailExecutor")
    public CompletableFuture<EmailResult> sendOrderConfirmationEmail(
            String userEmail,
            String orderNumber,
            int amount) {

        log.info("[{}] ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì‹œì‘: {}",
            Thread.currentThread().getName(), orderNumber);

        try {
            // ì´ë©”ì¼ ë°œì†¡ (ì‹œë®¬ë ˆì´ì…˜)
            Thread.sleep(1500);

            EmailResult result = EmailResult.builder()
                .email(userEmail)
                .type("ORDER_CONFIRMATION")
                .orderNumber(orderNumber)
                .sentAt(LocalDateTime.now())
                .success(true)
                .build();

            log.info("ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ: {}", orderNumber);

            return CompletableFuture.completedFuture(result);

        } catch (Exception e) {
            log.error("ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {}", orderNumber, e);

            EmailResult result = EmailResult.builder()
                .email(userEmail)
                .type("ORDER_CONFIRMATION")
                .orderNumber(orderNumber)
                .success(false)
                .errorMessage(e.getMessage())
                .build();

            return CompletableFuture.completedFuture(result);
        }
    }

    /**
     * ì¬ì‹œë„ ë¡œì§ì´ í¬í•¨ëœ ì´ë©”ì¼ ë°œì†¡
     */
    @Async("emailExecutor")
    public CompletableFuture<EmailResult> sendEmailWithRetry(
            String userEmail,
            String type,
            int maxRetries) {

        int attempt = 0;

        while (attempt < maxRetries) {
            try {
                attempt++;
                log.info("ì´ë©”ì¼ ë°œì†¡ ì‹œë„ {}/{}: {}", attempt, maxRetries, userEmail);

                // ì´ë©”ì¼ ë°œì†¡
                Thread.sleep(1000);

                // 10% í™•ë¥ ë¡œ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
                if (Math.random() < 0.1) {
                    throw new RuntimeException("ì´ë©”ì¼ ì„œë²„ ì¼ì‹œì  ì˜¤ë¥˜");
                }

                EmailResult result = EmailResult.builder()
                    .email(userEmail)
                    .type(type)
                    .success(true)
                    .attempts(attempt)
                    .sentAt(LocalDateTime.now())
                    .build();

                log.info("ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ (ì‹œë„ {}íšŒ): {}", attempt, userEmail);
                return CompletableFuture.completedFuture(result);

            } catch (Exception e) {
                log.warn("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ì‹œë„ {}/{}): {}", attempt, maxRetries, userEmail);

                if (attempt >= maxRetries) {
                    // ìµœì¢… ì‹¤íŒ¨
                    log.error("ì´ë©”ì¼ ë°œì†¡ ìµœì¢… ì‹¤íŒ¨: {}", userEmail);

                    EmailResult result = EmailResult.builder()
                        .email(userEmail)
                        .type(type)
                        .success(false)
                        .attempts(attempt)
                        .errorMessage("ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼")
                        .build();

                    return CompletableFuture.completedFuture(result);
                }

                // ì§€ìˆ˜ ë°±ì˜¤í”„ (1ì´ˆ, 2ì´ˆ, 4ì´ˆ...)
                try {
                    Thread.sleep(1000L * (1 << (attempt - 1)));
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        return CompletableFuture.completedFuture(
            EmailResult.builder().success(false).build()
        );
    }
}
```

### 3. ì‚¬ìš©ì ì„œë¹„ìŠ¤

```java
package com.example.async.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Slf4j
@Service
@RequiredArgsConstructor
public class UserService {

    private final EmailService emailService;
    // private final UserRepository userRepository;

    /**
     * íšŒì›ê°€ì… (ë™ê¸° ì²˜ë¦¬ + ë¹„ë™ê¸° ì´ë©”ì¼)
     */
    @Transactional
    public Long registerUser(String email, String name, String password) {
        log.info("íšŒì›ê°€ì… ì‹œì‘: {}", email);

        // 1. ì‚¬ìš©ì ì €ì¥ (ë™ê¸° - íŠ¸ëœì­ì…˜ ë‚´)
        // User user = User.builder()
        //     .email(email)
        //     .name(name)
        //     .password(passwordEncoder.encode(password))
        //     .build();
        // userRepository.save(user);

        Long userId = 1L;  // ì‹œë®¬ë ˆì´ì…˜
        log.info("ì‚¬ìš©ì DB ì €ì¥ ì™„ë£Œ: {}", userId);

        // 2. í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ (ë¹„ë™ê¸° - íŠ¸ëœì­ì…˜ ì™¸ë¶€)
        // íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥
        emailService.sendWelcomeEmail(email, name);

        log.info("íšŒì›ê°€ì… ì™„ë£Œ (ì´ë©”ì¼ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°œì†¡): {}", userId);
        return userId;
    }
}
```

### 4. ì£¼ë¬¸ ì„œë¹„ìŠ¤

```java
package com.example.async.service;

import com.example.async.dto.EmailResult;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.concurrent.CompletableFuture;

@Slf4j
@Service
@RequiredArgsConstructor
public class OrderService {

    private final EmailService emailService;
    // private final OrderRepository orderRepository;

    /**
     * ì£¼ë¬¸ ìƒì„± ë° í™•ì¸ ì´ë©”ì¼ ë°œì†¡
     */
    @Transactional
    public String createOrder(String userEmail, int amount) {
        log.info("ì£¼ë¬¸ ìƒì„± ì‹œì‘: {} - {}ì›", userEmail, amount);

        // 1. ì£¼ë¬¸ ì €ì¥ (ë™ê¸°)
        String orderNumber = "ORD-" + System.currentTimeMillis();
        // Order order = Order.builder()
        //     .orderNumber(orderNumber)
        //     .userEmail(userEmail)
        //     .amount(amount)
        //     .build();
        // orderRepository.save(order);

        log.info("ì£¼ë¬¸ DB ì €ì¥ ì™„ë£Œ: {}", orderNumber);

        // 2. ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ (ë¹„ë™ê¸°)
        CompletableFuture<EmailResult> emailFuture =
            emailService.sendOrderConfirmationEmail(userEmail, orderNumber, amount);

        // 3. ì´ë©”ì¼ ê²°ê³¼ ì²˜ë¦¬ (ë…¼ë¸”ë¡œí‚¹)
        emailFuture.thenAccept(result -> {
            if (result.isSuccess()) {
                log.info("ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ: {}", orderNumber);
                // ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ ì´ë ¥ ì €ì¥
            } else {
                log.error("ì£¼ë¬¸ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {}", orderNumber);
                // ê´€ë¦¬ì ì•Œë¦¼ ë˜ëŠ” ì¬ë°œì†¡ íì— ì¶”ê°€
            }
        }).exceptionally(ex -> {
            log.error("ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜ˆì™¸: {}", orderNumber, ex);
            return null;
        });

        log.info("ì£¼ë¬¸ ìƒì„± ì™„ë£Œ (ì´ë©”ì¼ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°œì†¡ ì¤‘): {}", orderNumber);
        return orderNumber;
    }

    /**
     * ëŒ€ëŸ‰ ì£¼ë¬¸ ì²˜ë¦¬ (ë³‘ë ¬ ë¹„ë™ê¸°)
     */
    public void processBulkOrders(String[] emails, int amount) {
        log.info("ëŒ€ëŸ‰ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: {}ê±´", emails.length);

        // ëª¨ë“  ì´ë©”ì¼ì„ ë³‘ë ¬ë¡œ ë°œì†¡
        CompletableFuture<?>[] futures = new CompletableFuture[emails.length];

        for (int i = 0; i < emails.length; i++) {
            String email = emails[i];
            String orderNumber = "BULK-ORD-" + i;

            futures[i] = emailService.sendOrderConfirmationEmail(email, orderNumber, amount);
        }

        // ëª¨ë“  ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        CompletableFuture.allOf(futures).thenRun(() -> {
            log.info("ëŒ€ëŸ‰ ì£¼ë¬¸ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ: {}ê±´", emails.length);
        });
    }
}
```

### 5. DTO

```java
package com.example.async.dto;

import lombok.Builder;
import lombok.Data;

import java.time.LocalDateTime;

@Data
@Builder
public class EmailResult {
    private String email;
    private String type;
    private String orderNumber;
    private boolean success;
    private int attempts;
    private String errorMessage;
    private LocalDateTime sentAt;
}
```

### 6. í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
package com.example.async.service;

import com.example.async.dto.EmailResult;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.concurrent.CompletableFuture;
import java.util.concurrent.TimeUnit;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
class EmailServiceTest {

    @Autowired
    private EmailService emailService;

    @Autowired
    private UserService userService;

    @Autowired
    private OrderService orderService;

    @Test
    void í™˜ì˜_ì´ë©”ì¼_ë¹„ë™ê¸°_ë°œì†¡_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        String email = "test@example.com";
        String name = "í™ê¸¸ë™";

        // when
        long startTime = System.currentTimeMillis();
        emailService.sendWelcomeEmail(email, name);
        long endTime = System.currentTimeMillis();

        // then
        // ë¹„ë™ê¸°ì´ë¯€ë¡œ ì¦‰ì‹œ ë°˜í™˜ (2ì´ˆ ëŒ€ê¸° ì•ˆ í•¨)
        assertThat(endTime - startTime).isLessThan(100);

        // ì‹¤ì œ ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        Thread.sleep(2500);
    }

    @Test
    void ì£¼ë¬¸_í™•ì¸_ì´ë©”ì¼_ê²°ê³¼_ë°˜í™˜_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        String email = "order@example.com";
        String orderNumber = "ORD-12345";
        int amount = 50000;

        // when
        CompletableFuture<EmailResult> future =
            emailService.sendOrderConfirmationEmail(email, orderNumber, amount);

        EmailResult result = future.get(3, TimeUnit.SECONDS);

        // then
        assertThat(result).isNotNull();
        assertThat(result.isSuccess()).isTrue();
        assertThat(result.getOrderNumber()).isEqualTo(orderNumber);
    }

    @Test
    void ì¬ì‹œë„_ë¡œì§_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        String email = "retry@example.com";

        // when
        CompletableFuture<EmailResult> future =
            emailService.sendEmailWithRetry(email, "TEST", 3);

        EmailResult result = future.get(10, TimeUnit.SECONDS);

        // then
        assertThat(result).isNotNull();
        assertThat(result.getAttempts()).isGreaterThan(0);
    }

    @Test
    void íšŒì›ê°€ì…_ë¹„ë™ê¸°_ì´ë©”ì¼_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        String email = "newuser@example.com";
        String name = "ê¹€ì² ìˆ˜";
        String password = "password123";

        // when
        long startTime = System.currentTimeMillis();
        Long userId = userService.registerUser(email, name, password);
        long endTime = System.currentTimeMillis();

        // then
        assertThat(userId).isNotNull();
        // ì´ë©”ì¼ ë°œì†¡ ëŒ€ê¸° ì—†ì´ ì¦‰ì‹œ ë°˜í™˜
        assertThat(endTime - startTime).isLessThan(500);
    }

    @Test
    void ëŒ€ëŸ‰_ì£¼ë¬¸_ë³‘ë ¬_ì²˜ë¦¬_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        String[] emails = {
            "user1@example.com",
            "user2@example.com",
            "user3@example.com",
            "user4@example.com",
            "user5@example.com"
        };

        // when
        long startTime = System.currentTimeMillis();
        orderService.processBulkOrders(emails, 10000);
        long endTime = System.currentTimeMillis();

        // then
        // ë³‘ë ¬ ì²˜ë¦¬ë¡œ ìˆœì°¨ ì²˜ë¦¬ë³´ë‹¤ ë¹ ë¦„
        assertThat(endTime - startTime).isLessThan(1000);

        // ëª¨ë“  ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        Thread.sleep(3000);
    }
}
```

---

## ì‹¤ìŠµ: ë°ì´í„° ì •ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬

### ìš”êµ¬ì‚¬í•­
- ë§¤ì¼ ìì •: 7ì¼ ì´ìƒ ëœ ë¡œê·¸ ì‚­ì œ
- ë§¤ì‹œ ì •ê°: ìºì‹œ ê°±ì‹ 
- ë§¤ 10ë¶„: ì™¸ë¶€ API í—¬ìŠ¤ ì²´í¬
- í‰ì¼ ì˜¤ì „ 9ì‹œ: ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±

### êµ¬í˜„ ì½”ë“œ

```java
package com.example.scheduler;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

@Slf4j
@Component
@EnableScheduling
@RequiredArgsConstructor
public class DataCleanupScheduler {

    // private final LogRepository logRepository;
    // private final CacheManager cacheManager;
    // private final ApiHealthChecker apiHealthChecker;
    // private final ReportGenerator reportGenerator;

    /**
     * ë§¤ì¼ ìì • - ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ
     */
    @Scheduled(cron = "0 0 0 * * *")
    public void cleanupOldLogs() {
        log.info("=== ë¡œê·¸ ì •ë¦¬ ì‹œì‘: {} ===", currentTime());

        try {
            // 7ì¼ ì´ìƒ ëœ ë¡œê·¸ ì‚­ì œ
            LocalDateTime cutoffDate = LocalDateTime.now().minusDays(7);

            // int deletedCount = logRepository.deleteOlderThan(cutoffDate);
            int deletedCount = 1523;  // ì‹œë®¬ë ˆì´ì…˜

            log.info("ë¡œê·¸ ì •ë¦¬ ì™„ë£Œ: {}ê±´ ì‚­ì œ", deletedCount);

            // ë©”íŠ¸ë¦­ ê¸°ë¡
            // metricsService.recordLogCleanup(deletedCount);

        } catch (Exception e) {
            log.error("ë¡œê·¸ ì •ë¦¬ ì‹¤íŒ¨", e);
            // alertService.sendAlert("ë¡œê·¸ ì •ë¦¬ ì‘ì—… ì‹¤íŒ¨", e);
        }
    }

    /**
     * ë§¤ì‹œ ì •ê° - ìºì‹œ ê°±ì‹ 
     */
    @Scheduled(cron = "0 0 * * * *")
    public void refreshCache() {
        log.info("=== ìºì‹œ ê°±ì‹  ì‹œì‘: {} ===", currentTime());

        try {
            // cacheManager.clear("userCache");
            // cacheManager.clear("productCache");

            log.info("ìºì‹œ ê°±ì‹  ì™„ë£Œ");

        } catch (Exception e) {
            log.error("ìºì‹œ ê°±ì‹  ì‹¤íŒ¨", e);
        }
    }

    /**
     * ë§¤ 10ë¶„ - ì™¸ë¶€ API í—¬ìŠ¤ ì²´í¬
     */
    @Scheduled(fixedRate = 10 * 60 * 1000, initialDelay = 60 * 1000)
    public void checkExternalApis() {
        log.info("=== API í—¬ìŠ¤ ì²´í¬ ì‹œì‘: {} ===", currentTime());

        try {
            // ì—¬ëŸ¬ ì™¸ë¶€ API ë™ì‹œ ì²´í¬
            // boolean paymentApiHealthy = apiHealthChecker.check("PAYMENT_API");
            // boolean shippingApiHealthy = apiHealthChecker.check("SHIPPING_API");
            // boolean notificationApiHealthy = apiHealthChecker.check("NOTIFICATION_API");

            boolean paymentApiHealthy = true;
            boolean shippingApiHealthy = true;
            boolean notificationApiHealthy = false;  // ì‹œë®¬ë ˆì´ì…˜

            if (!notificationApiHealthy) {
                log.warn("ì•Œë¦¼ API ì‘ë‹µ ì—†ìŒ");
                // alertService.sendAlert("ì•Œë¦¼ API ì¥ì• ");
            }

            log.info("API í—¬ìŠ¤ ì²´í¬ ì™„ë£Œ: Payment={}, Shipping={}, Notification={}",
                paymentApiHealthy, shippingApiHealthy, notificationApiHealthy);

        } catch (Exception e) {
            log.error("API í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨", e);
        }
    }

    /**
     * í‰ì¼ ì˜¤ì „ 9ì‹œ - ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±
     */
    @Scheduled(cron = "0 0 9 * * MON-FRI")
    public void generateDailyReport() {
        log.info("=== ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘: {} ===", currentTime());

        try {
            // ì „ë‚  ë°ì´í„° ì§‘ê³„
            LocalDateTime yesterday = LocalDateTime.now().minusDays(1);

            // DailyReport report = reportGenerator.generate(yesterday);
            // reportRepository.save(report);

            log.info("ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ");

            // ê´€ë¦¬ìì—ê²Œ ì´ë©”ì¼ ë°œì†¡
            // emailService.sendDailyReport(report);

        } catch (Exception e) {
            log.error("ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨", e);
            // emergencyAlert.send("ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨", e);
        }
    }

    /**
     * ë§¤ì›” 1ì¼ ì˜¤ì „ 2ì‹œ - ì›”ê°„ í†µê³„ ì§‘ê³„
     */
    @Scheduled(cron = "0 0 2 1 * *")
    public void aggregateMonthlyStatistics() {
        log.info("=== ì›”ê°„ í†µê³„ ì§‘ê³„ ì‹œì‘: {} ===", currentTime());

        try {
            // ì „ì›” ë°ì´í„° ì§‘ê³„
            LocalDateTime lastMonth = LocalDateTime.now().minusMonths(1);

            // MonthlyStatistics stats = statisticsService.aggregate(lastMonth);
            // statisticsRepository.save(stats);

            log.info("ì›”ê°„ í†µê³„ ì§‘ê³„ ì™„ë£Œ");

        } catch (Exception e) {
            log.error("ì›”ê°„ í†µê³„ ì§‘ê³„ ì‹¤íŒ¨", e);
        }
    }

    /**
     * í˜„ì¬ ì‹œê°„ í¬ë§·íŒ…
     */
    private String currentTime() {
        return LocalDateTime.now().format(
            DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")
        );
    }
}
```

### ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ëª¨ë‹ˆí„°ë§

```java
package com.example.scheduler;

import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import java.util.Set;

@Slf4j
@Component
public class SchedulerMonitor {

    private final ScheduledAnnotationBeanPostProcessor postProcessor;

    public SchedulerMonitor(ScheduledAnnotationBeanPostProcessor postProcessor) {
        this.postProcessor = postProcessor;
    }

    @PostConstruct
    public void logScheduledTasks() {
        Set<ScheduledAnnotationBeanPostProcessor.ScheduledTask> scheduledTasks =
            postProcessor.getScheduledTasks();

        log.info("=== ë“±ë¡ëœ ìŠ¤ì¼€ì¤„ ì‘ì—… ëª©ë¡ ===");
        scheduledTasks.forEach(task -> {
            log.info("ì‘ì—…: {}", task);
        });
        log.info("ì´ {}ê°œ ìŠ¤ì¼€ì¤„ ì‘ì—… ë“±ë¡ë¨", scheduledTasks.size());
    }

    /**
     * ë§¤ 1ë¶„ë§ˆë‹¤ ìŠ¤ë ˆë“œ í’€ ìƒíƒœ ëª¨ë‹ˆí„°ë§
     */
    @Scheduled(fixedRate = 60000)
    public void monitorThreadPool() {
        // ThreadPoolTaskScheduler ìƒíƒœ í™•ì¸
        // log.info("í™œì„± ìŠ¤ë ˆë“œ: {}, ëŒ€ê¸° ì‘ì—…: {}",
        //     scheduler.getActiveCount(),
        //     scheduler.getQueueSize());
    }
}
```

---

## ğŸ”° ì£¼ë‹ˆì–´ ì‹œë‚˜ë¦¬ì˜¤

> **"ì…ì‚¬ 3ê°œì›”, ì‹¤ì „ì—ì„œ ì´ëŸ° ì‹¤ìˆ˜ë¥¼ í–ˆì–´ìš”"**

### ì‹¤ìˆ˜ 1: @Async ì—†ì´ ë¹„ë™ê¸°ë¼ê³  ì°©ê°

**ìƒí™©**
```java
// ì£¼ë‹ˆì–´ ê°œë°œìì˜ ì½”ë“œ
@Service
public class EmailService {

    // "ë¹„ë™ê¸°" ì´ë©”ì¼ ë°œì†¡ì´ë¼ê³  ìƒê°í•¨
    public void sendEmail(String email) {
        new Thread(() -> {
            // ì´ë©”ì¼ ë°œì†¡
            sendActualEmail(email);
        }).start();

        // ì¦‰ì‹œ ë°˜í™˜ëœë‹¤ê³  ìƒê°
    }
}
```

**ë¬¸ì œì **
- Threadë¥¼ ì§ì ‘ ìƒì„±í•˜ë©´ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” ìŠ¤ë ˆë“œ ìƒì„±
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, ìŠ¤ë ˆë“œ í­ì¦ ê°€ëŠ¥
- ì˜ˆì™¸ ì²˜ë¦¬ ì–´ë ¤ì›€
- ìŠ¤ë ˆë“œ í’€ ì—†ì–´ì„œ ì„±ëŠ¥ ì €í•˜

**ì„ ë°°ì˜ í”¼ë“œë°±**
"Threadë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ë§ê³ , Springì˜ @Asyncë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. Springì´ ìŠ¤ë ˆë“œ í’€ì„ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤."

**ì˜¬ë°”ë¥¸ ì½”ë“œ**
```java
@Service
public class EmailService {

    @Async("emailExecutor")  // Springì´ ê´€ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œ í’€ ì‚¬ìš©
    public CompletableFuture<EmailResult> sendEmail(String email) {
        try {
            sendActualEmail(email);
            return CompletableFuture.completedFuture(
                EmailResult.success(email)
            );
        } catch (Exception e) {
            return CompletableFuture.completedFuture(
                EmailResult.failure(email, e.getMessage())
            );
        }
    }
}

@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean(name = "emailExecutor")
    public Executor emailExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(500);
        executor.setThreadNamePrefix("Email-");
        executor.initialize();
        return executor;
    }
}
```

**ë°°ìš´ ì **
- âœ… Springì˜ @Asyncë¡œ ìŠ¤ë ˆë“œ í’€ ê´€ë¦¬
- âœ… CompletableFutureë¡œ ê²°ê³¼ ë°˜í™˜
- âœ… ThreadPoolTaskExecutorë¡œ ìŠ¤ë ˆë“œ ìˆ˜ ì œì–´
- âœ… ì˜ˆì™¸ ì²˜ë¦¬ ëª…í™•íˆ

---

### ì‹¤ìˆ˜ 2: fixedRateë¡œ ê¸´ ì‘ì—… ì‹¤í–‰í•˜ë‹¤ ì¤‘ë³µ ì‹¤í–‰

**ìƒí™©**
```java
// ì£¼ë‹ˆì–´ ê°œë°œìì˜ ì½”ë“œ
@Component
public class DataSyncScheduler {

    // ë§¤ 10ì´ˆë§ˆë‹¤ ì‹¤í–‰í•˜ë ¤ê³  í–ˆëŠ”ë°...
    @Scheduled(fixedRate = 10000)
    public void syncData() {
        log.info("ë°ì´í„° ë™ê¸°í™” ì‹œì‘");

        // ì‹¤ì œë¡œëŠ” 30ì´ˆ ê±¸ë¦¬ëŠ” ì‘ì—…
        // ì™¸ë¶€ API í˜¸ì¶œ + DB ì €ì¥
        externalApiService.fetchData();  // 20ì´ˆ
        dataRepository.saveAll(data);     // 10ì´ˆ

        log.info("ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ");
    }
}
```

**ì¥ì•  ë°œìƒ**
```
[Thread-1] ë°ì´í„° ë™ê¸°í™” ì‹œì‘ (00:00)
[Thread-2] ë°ì´í„° ë™ê¸°í™” ì‹œì‘ (00:10)  â† ì´ì „ ì‘ì—… ë¯¸ì™„ë£Œì¸ë° ì‹œì‘!
[Thread-3] ë°ì´í„° ë™ê¸°í™” ì‹œì‘ (00:20)  â† ë˜ ì‹œì‘!
...
ê²°ê³¼: DB ë½ ê²½í•©, ì¤‘ë³µ ë°ì´í„°, ì„œë²„ ê³¼ë¶€í•˜
```

**ì„ ë°°ì˜ í”¼ë“œë°±**
"fixedRateëŠ” ì‹œì‘ ì‹œê°„ ê¸°ì¤€ì´ì—ìš”. ê¸´ ì‘ì—…ì€ fixedDelayë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ì‘ì—… ì‹œê°„ì„ ê³ ë ¤í•´ì„œ ê°„ê²©ì„ ì„¤ì •í•˜ì„¸ìš”."

**ì˜¬ë°”ë¥¸ ì½”ë“œ**
```java
// í•´ê²° ë°©ë²• 1: fixedDelay ì‚¬ìš©
@Component
public class DataSyncScheduler {

    @Scheduled(fixedDelay = 10000)  // ì™„ë£Œ í›„ 10ì´ˆ ëŒ€ê¸°
    public void syncData() {
        log.info("ë°ì´í„° ë™ê¸°í™” ì‹œì‘");

        externalApiService.fetchData();  // 20ì´ˆ
        dataRepository.saveAll(data);     // 10ì´ˆ

        log.info("ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ");
        // ì—¬ê¸°ì„œ ì™„ë£Œë˜ê³  10ì´ˆ í›„ì— ë‹¤ìŒ ì‹¤í–‰
    }
}

// í•´ê²° ë°©ë²• 2: ì‘ì—… ì¤‘ë³µ ë°©ì§€ í”Œë˜ê·¸
@Component
public class DataSyncScheduler {

    private final AtomicBoolean isRunning = new AtomicBoolean(false);

    @Scheduled(fixedRate = 10000)
    public void syncData() {
        if (!isRunning.compareAndSet(false, true)) {
            log.info("ì´ì „ ì‘ì—… ì‹¤í–‰ ì¤‘ - ìŠ¤í‚µ");
            return;
        }

        try {
            log.info("ë°ì´í„° ë™ê¸°í™” ì‹œì‘");
            externalApiService.fetchData();
            dataRepository.saveAll(data);
            log.info("ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ");
        } finally {
            isRunning.set(false);
        }
    }
}

// í•´ê²° ë°©ë²• 3: ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” ShedLock ì‚¬ìš©
@Component
public class DataSyncScheduler {

    @Scheduled(fixedRate = 10000)
    @SchedulerLock(
        name = "syncData",
        lockAtMostFor = "5m",   // ìµœëŒ€ 5ë¶„ (ì‘ì—… ì‹œê°„ë³´ë‹¤ ê¸¸ê²Œ)
        lockAtLeastFor = "30s"  // ìµœì†Œ 30ì´ˆ (ì‘ì—… ì‹œê°„ ê³ ë ¤)
    )
    public void syncData() {
        log.info("ë°ì´í„° ë™ê¸°í™” ì‹œì‘");
        externalApiService.fetchData();
        dataRepository.saveAll(data);
        log.info("ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ");
    }
}
```

**ë°°ìš´ ì **
- âœ… fixedRate vs fixedDelay ì°¨ì´ ì´í•´
- âœ… ê¸´ ì‘ì—…ì€ fixedDelay ì‚¬ìš©
- âœ… AtomicBooleanìœ¼ë¡œ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
- âœ… ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” ë¶„ì‚° ë½ í•„ìˆ˜

---

### ì‹¤ìˆ˜ 3: ë¹„ë™ê¸° ë©”ì„œë“œë¥¼ ê°™ì€ í´ë˜ìŠ¤ì—ì„œ í˜¸ì¶œ

**ìƒí™©**
```java
// ì£¼ë‹ˆì–´ ê°œë°œìì˜ ì½”ë“œ
@Service
public class OrderService {

    @Transactional
    public void createOrder(OrderDto dto) {
        // 1. ì£¼ë¬¸ ì €ì¥
        Order order = orderRepository.save(dto.toEntity());

        // 2. ì•Œë¦¼ ë°œì†¡ (ë¹„ë™ê¸°ë¼ê³  ìƒê°)
        sendNotification(order);  // ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œ

        log.info("ì£¼ë¬¸ ìƒì„± ì™„ë£Œ (ì•Œë¦¼ ë¹„ë™ê¸° ë°œì†¡)");
    }

    @Async  // ë™ì‘ ì•ˆ í•¨!
    public void sendNotification(Order order) {
        // ì‹¤ì œë¡œëŠ” ë™ê¸°ë¡œ ì‹¤í–‰ë¨
        Thread.sleep(3000);  // 3ì´ˆ ì§€ì—°
        notificationService.send(order);
    }
}
```

**ë¬¸ì œ ë°œìƒ**
```
ì£¼ë¬¸ API ì‘ë‹µ ì‹œê°„: 3.5ì´ˆ (ë¹„ë™ê¸°ë¼ê³  ìƒê°í–ˆëŠ”ë° ë™ê¸°!)
ì‚¬ìš©ì: "ì£¼ë¬¸ì´ ë„ˆë¬´ ëŠë ¤ìš”"
```

**ì„ ë°°ì˜ í”¼ë“œë°±**
"@AsyncëŠ” Spring AOP í”„ë¡ì‹œë¡œ ë™ì‘í•´ìš”. ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ì„œ ë¹„ë™ê¸°ê°€ ì•ˆ ë©ë‹ˆë‹¤. ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬í•˜ì„¸ìš”."

**ì˜¬ë°”ë¥¸ ì½”ë“œ**
```java
// OrderServiceì™€ NotificationService ë¶„ë¦¬
@Service
@RequiredArgsConstructor
public class OrderService {

    private final OrderRepository orderRepository;
    private final OrderNotificationService notificationService;  // ë‹¤ë¥¸ Bean

    @Transactional
    public void createOrder(OrderDto dto) {
        // 1. ì£¼ë¬¸ ì €ì¥
        Order order = orderRepository.save(dto.toEntity());

        // 2. ì•Œë¦¼ ë°œì†¡ (ë‹¤ë¥¸ Bean í˜¸ì¶œ - í”„ë¡ì‹œ ê±°ì¹¨)
        notificationService.sendNotification(order);

        log.info("ì£¼ë¬¸ ìƒì„± ì™„ë£Œ (ì•Œë¦¼ ë¹„ë™ê¸° ë°œì†¡)");
        // ì¦‰ì‹œ ë°˜í™˜ë¨!
    }
}

@Component
@RequiredArgsConstructor
class OrderNotificationService {

    private final NotificationService notificationService;

    @Async("notificationExecutor")  // ì •ìƒ ë™ì‘!
    public void sendNotification(Order order) {
        log.info("[{}] ì•Œë¦¼ ë°œì†¡ ì‹œì‘", Thread.currentThread().getName());

        try {
            Thread.sleep(3000);
            notificationService.send(order);
            log.info("ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ");
        } catch (Exception e) {
            log.error("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: {}", order.getId(), e);
        }
    }
}

// ê²°ê³¼: ì£¼ë¬¸ API ì‘ë‹µ ì‹œê°„ 0.5ì´ˆë¡œ ê°œì„ ! (3ì´ˆ â†’ 0.5ì´ˆ)
```

**ê²€ì¦ ë°©ë²•**
```java
@Async
public void testAsyncMethod() {
    String threadName = Thread.currentThread().getName();
    log.info("í˜„ì¬ ìŠ¤ë ˆë“œ: {}", threadName);

    if (threadName.contains("http-nio") || threadName.contains("main")) {
        log.error("âŒ @Async ë™ì‘ ì•ˆ í•¨ - HTTP/Main ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰");
    } else {
        log.info("âœ… @Async ì •ìƒ ë™ì‘ - {} ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰", threadName);
    }
}
```

**ë°°ìš´ ì **
- âœ… @AsyncëŠ” í”„ë¡ì‹œ ê¸°ë°˜ â†’ ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬ í•„ìˆ˜
- âœ… ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œ ì•ˆ ê±°ì¹¨
- âœ… ìŠ¤ë ˆë“œ ì´ë¦„ìœ¼ë¡œ ë¹„ë™ê¸° ë™ì‘ ê²€ì¦
- âœ… ì±…ì„ ë¶„ë¦¬ë¡œ ì½”ë“œë„ ê¹”ë”í•´ì§

---

### ì‹¤ìˆ˜ 4: ThreadPool í¬ê¸°ë¥¼ ë„ˆë¬´ í¬ê²Œ ì„¤ì •

**ìƒí™©**
```java
// ì£¼ë‹ˆì–´ ê°œë°œìì˜ ì½”ë“œ
@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // "ë§ì„ìˆ˜ë¡ ë¹ ë¥´ê² ì§€?" ë¼ëŠ” ìƒê°
        executor.setCorePoolSize(500);   // ë„ˆë¬´ í¼!
        executor.setMaxPoolSize(1000);   // ë„ˆë¬´ í¼!
        executor.setQueueCapacity(10000); // ë„ˆë¬´ í¼!

        executor.initialize();
        return executor;
    }
}
```

**ì¥ì•  ë°œìƒ**
```
ì¦ìƒ:
- ì„œë²„ ë©”ëª¨ë¦¬ ë¶€ì¡± (OutOfMemoryError)
- CPU ì‚¬ìš©ë¥  100%
- ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ê³¼ë‹¤
- ì‘ë‹µ ì‹œê°„ ì˜¤íˆë ¤ ëŠë ¤ì§

ì›ì¸:
- 8ì½”ì–´ ì„œë²„ì—ì„œ 1000ê°œ ìŠ¤ë ˆë“œ â†’ ê³¼ë„í•œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­
- ê° ìŠ¤ë ˆë“œë‹¹ 1MB ë©”ëª¨ë¦¬ â†’ 1000ê°œ = 1GB ë©”ëª¨ë¦¬ ì†Œëª¨
- ë„ˆë¬´ ë§ì€ ë™ì‹œ ì‘ì—…ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ê²½í•©
```

**ì„ ë°°ì˜ í”¼ë“œë°±**
"ThreadPoolì€ ë¬´ì¡°ê±´ í¬ë‹¤ê³  ì¢‹ì€ ê²Œ ì•„ë‹ˆì—ìš”. CPU ì½”ì–´ ìˆ˜ì™€ ì‘ì—… íŠ¹ì„±ì„ ê³ ë ¤í•´ì„œ ì„¤ì •í•˜ì„¸ìš”. I/O ì‘ì—…ì´ë©´ ì½”ì–´ * 2~4, CPU ì‘ì—…ì´ë©´ ì½”ì–´ ìˆ˜ë§Œí¼ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤."

**ì˜¬ë°”ë¥¸ ì½”ë“œ**
```java
@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // CPU ì½”ì–´ ìˆ˜ í™•ì¸
        int processors = Runtime.getRuntime().availableProcessors();
        log.info("CPU ì½”ì–´ ìˆ˜: {}", processors);

        // I/O ì§‘ì•½ì  ì‘ì—… (ì´ë©”ì¼, HTTP í˜¸ì¶œ ë“±)
        executor.setCorePoolSize(processors * 2);   // 8ì½”ì–´ â†’ 16
        executor.setMaxPoolSize(processors * 4);    // 8ì½”ì–´ â†’ 32
        executor.setQueueCapacity(500);             // ì ì ˆí•œ í í¬ê¸°

        executor.setThreadNamePrefix("Async-");

        // í ì´ˆê³¼ ì‹œ ì •ì±… (í˜¸ì¶œì ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰)
        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.CallerRunsPolicy()
        );

        executor.setKeepAliveSeconds(60);
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(30);

        executor.initialize();

        log.info("ThreadPool ì„¤ì •: core={}, max={}, queue={}",
            executor.getCorePoolSize(),
            executor.getMaxPoolSize(),
            executor.getQueueCapacity());

        return executor;
    }
}

// ëª¨ë‹ˆí„°ë§ ì¶”ê°€
@Component
@RequiredArgsConstructor
public class ThreadPoolMonitor {

    private final ThreadPoolTaskExecutor taskExecutor;

    @Scheduled(fixedRate = 30000)  // 30ì´ˆë§ˆë‹¤
    public void monitorThreadPool() {
        ThreadPoolExecutor executor = taskExecutor.getThreadPoolExecutor();

        int active = executor.getActiveCount();
        int pool = executor.getPoolSize();
        int queue = executor.getQueue().size();

        log.info("ThreadPool ìƒíƒœ: active={}/{}, queue={}/{}",
            active, pool, queue, taskExecutor.getQueueCapacity());

        // ê²½ê³ 
        if (queue > taskExecutor.getQueueCapacity() * 0.8) {
            log.warn("âš ï¸ ThreadPool í 80% ì´ˆê³¼ - ìŠ¤ë ˆë“œ í’€ í¬ê¸° ê²€í†  í•„ìš”");
        }
    }
}
```

**ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ìµœì  ì„¤ì • ì°¾ê¸°**
```java
@Test
void findOptimalThreadPoolSize() {
    int[] coreSizes = {10, 20, 30, 40};
    int testTaskCount = 1000;

    for (int coreSize : coreSizes) {
        executor.setCorePoolSize(coreSize);
        executor.setMaxPoolSize(coreSize * 2);

        long startTime = System.currentTimeMillis();

        CountDownLatch latch = new CountDownLatch(testTaskCount);
        for (int i = 0; i < testTaskCount; i++) {
            executor.execute(() -> {
                try {
                    // ì‹¤ì œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
                    doWork();
                } finally {
                    latch.countDown();
                }
            });
        }

        latch.await(60, TimeUnit.SECONDS);
        long duration = System.currentTimeMillis() - startTime;

        log.info("CoreSize={}: ì²˜ë¦¬ ì‹œê°„={}ms, TPS={}",
            coreSize, duration, testTaskCount * 1000.0 / duration);
    }
}
```

**ë°°ìš´ ì **
- âœ… ThreadPoolì€ CPU ì½”ì–´ ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •
- âœ… I/O ì‘ì—…: ì½”ì–´ * 2~4, CPU ì‘ì—…: ì½”ì–´ ìˆ˜
- âœ… ë¬´ì¡°ê±´ í¬ë‹¤ê³  ì¢‹ì€ ê²Œ ì•„ë‹˜
- âœ… ëª¨ë‹ˆí„°ë§ìœ¼ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸
- âœ… ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ìµœì  ì„¤ì • ì°¾ê¸°

---

## ì‹¤ì „ í”„ë¡œì íŠ¸: ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

### í”„ë¡œì íŠ¸ ê°œìš”

**ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**
- ì´ì»¤ë¨¸ìŠ¤ í”Œë«í¼ì˜ ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•
- ì£¼ë¬¸, ë°°ì†¡, ê²°ì œ, í”„ë¡œëª¨ì…˜ ë“± ë‹¤ì–‘í•œ ì•Œë¦¼ íƒ€ì…
- SMS, ì´ë©”ì¼, í‘¸ì‹œ ì•Œë¦¼ ë©€í‹° ì±„ë„ ë°œì†¡
- ì¼ì¼ 100ë§Œ ê±´ ì´ìƒ ì•Œë¦¼ ì²˜ë¦¬
- í‰ê·  ë°œì†¡ ì‹œê°„ 3ì´ˆ ì´ë‚´

**ê¸°ìˆ  ìš”êµ¬ì‚¬í•­**
- Spring @Asyncë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° ì•Œë¦¼ ë°œì†¡
- íƒ€ì…ë³„ ìš°ì„ ìˆœìœ„ ê´€ë¦¬ (ê²°ì œ > ì£¼ë¬¸ > í”„ë¡œëª¨ì…˜)
- ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ (ì§€ìˆ˜ ë°±ì˜¤í”„)
- ì•Œë¦¼ ë°œì†¡ ì´ë ¥ ì¶”ì 
- ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

### 1ë‹¨ê³„: í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„

```
src/main/java/com/ecommerce/notification/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ AsyncConfig.java                 # ë¹„ë™ê¸° ì„¤ì •
â”‚   â””â”€â”€ SchedulerConfig.java             # ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ NotificationType.java            # ì•Œë¦¼ íƒ€ì… enum
â”‚   â”œâ”€â”€ NotificationPriority.java        # ìš°ì„ ìˆœìœ„ enum
â”‚   â”œâ”€â”€ NotificationChannel.java         # ì±„ë„ enum (SMS/Email/Push)
â”‚   â”œâ”€â”€ Notification.java                # ì•Œë¦¼ ì—”í‹°í‹°
â”‚   â””â”€â”€ NotificationHistory.java         # ë°œì†¡ ì´ë ¥
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ NotificationRepository.java
â”‚   â””â”€â”€ NotificationHistoryRepository.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ NotificationService.java         # ì•Œë¦¼ ì„œë¹„ìŠ¤ (ë©”ì¸)
â”‚   â”œâ”€â”€ AsyncNotificationSender.java     # ë¹„ë™ê¸° ë°œì†¡
â”‚   â”œâ”€â”€ SmsService.java                  # SMS ë°œì†¡
â”‚   â”œâ”€â”€ EmailService.java                # ì´ë©”ì¼ ë°œì†¡
â”‚   â””â”€â”€ PushNotificationService.java     # í‘¸ì‹œ ë°œì†¡
â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ FailedNotificationRetryScheduler.java  # ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡
â”‚   â””â”€â”€ NotificationStatisticsScheduler.java   # í†µê³„ ì§‘ê³„
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ NotificationRequest.java
â”‚   â”œâ”€â”€ NotificationResult.java
â”‚   â””â”€â”€ NotificationStatistics.java
â””â”€â”€ monitor/
    â””â”€â”€ NotificationMonitor.java         # ëª¨ë‹ˆí„°ë§
```

### 2ë‹¨ê³„: ë„ë©”ì¸ ëª¨ë¸ ì •ì˜

```java
package com.ecommerce.notification.domain;

import lombok.*;
import javax.persistence.*;
import java.time.LocalDateTime;

// ì•Œë¦¼ íƒ€ì…
public enum NotificationType {
    PAYMENT_SUCCESS("ê²°ì œ ì™„ë£Œ", NotificationPriority.HIGH),
    ORDER_CONFIRMED("ì£¼ë¬¸ í™•ì¸", NotificationPriority.HIGH),
    SHIPPING_STARTED("ë°°ì†¡ ì‹œì‘", NotificationPriority.MEDIUM),
    SHIPPING_COMPLETED("ë°°ì†¡ ì™„ë£Œ", NotificationPriority.MEDIUM),
    PROMOTION("í”„ë¡œëª¨ì…˜", NotificationPriority.LOW),
    MARKETING("ë§ˆì¼€íŒ…", NotificationPriority.LOW);

    private final String description;
    private final NotificationPriority priority;

    NotificationType(String description, NotificationPriority priority) {
        this.description = description;
        this.priority = priority;
    }

    public NotificationPriority getPriority() {
        return priority;
    }
}

// ìš°ì„ ìˆœìœ„
public enum NotificationPriority {
    HIGH(1, "ë†’ìŒ"),
    MEDIUM(2, "ì¤‘ê°„"),
    LOW(3, "ë‚®ìŒ");

    private final int level;
    private final String description;

    NotificationPriority(int level, String description) {
        this.level = level;
        this.description = description;
    }

    public int getLevel() {
        return level;
    }
}

// ì•Œë¦¼ ì±„ë„
public enum NotificationChannel {
    SMS("SMS"),
    EMAIL("ì´ë©”ì¼"),
    PUSH("í‘¸ì‹œ ì•Œë¦¼");

    private final String description;

    NotificationChannel(String description) {
        this.description = description;
    }
}

// ì•Œë¦¼ ì—”í‹°í‹°
@Entity
@Table(name = "notifications")
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Notification {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String userId;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private NotificationType type;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private NotificationChannel channel;

    @Column(nullable = false)
    private String recipient;  // ì „í™”ë²ˆí˜¸ or ì´ë©”ì¼

    @Column(nullable = false, length = 1000)
    private String content;

    @Enumerated(EnumType.STRING)
    private NotificationPriority priority;

    @Column(nullable = false)
    private String status;  // PENDING, SENT, FAILED

    private int retryCount;

    private String errorMessage;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    private LocalDateTime sentAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        status = "PENDING";
        retryCount = 0;
        priority = type.getPriority();
    }
}

// ë°œì†¡ ì´ë ¥
@Entity
@Table(name = "notification_history")
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class NotificationHistory {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private Long notificationId;

    @Enumerated(EnumType.STRING)
    private NotificationType type;

    @Enumerated(EnumType.STRING)
    private NotificationChannel channel;

    private String recipient;

    private boolean success;

    private int attempts;

    private long durationMs;

    private String errorMessage;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
    }
}
```

### 3ë‹¨ê³„: ë¹„ë™ê¸° ì„¤ì •

```java
package com.ecommerce.notification.config;

import lombok.extern.slf4j.Slf4j;
import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.AsyncConfigurer;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.Executor;
import java.util.concurrent.ThreadPoolExecutor;

@Slf4j
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {

    /**
     * ìš°ì„ ìˆœìœ„ ë†’ì€ ì•Œë¦¼ìš© ìŠ¤ë ˆë“œ í’€ (ê²°ì œ, ì£¼ë¬¸)
     */
    @Bean(name = "highPriorityNotificationExecutor")
    public Executor highPriorityExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        int processors = Runtime.getRuntime().availableProcessors();

        executor.setCorePoolSize(processors * 2);
        executor.setMaxPoolSize(processors * 4);
        executor.setQueueCapacity(1000);
        executor.setThreadNamePrefix("High-Notification-");

        // í ì´ˆê³¼ ì‹œ í˜¸ì¶œì ìŠ¤ë ˆë“œ ì‹¤í–‰ (ì¤‘ìš” ì•Œë¦¼ì€ ë³´ì¥)
        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.CallerRunsPolicy()
        );

        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(30);

        executor.initialize();

        log.info("ê³ ìš°ì„ ìˆœìœ„ ì•Œë¦¼ Executor ì´ˆê¸°í™”: core={}, max={}, queue={}",
            executor.getCorePoolSize(),
            executor.getMaxPoolSize(),
            executor.getQueueCapacity());

        return executor;
    }

    /**
     * ìš°ì„ ìˆœìœ„ ë‚®ì€ ì•Œë¦¼ìš© ìŠ¤ë ˆë“œ í’€ (í”„ë¡œëª¨ì…˜, ë§ˆì¼€íŒ…)
     */
    @Bean(name = "lowPriorityNotificationExecutor")
    public Executor lowPriorityExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        int processors = Runtime.getRuntime().availableProcessors();

        executor.setCorePoolSize(processors);
        executor.setMaxPoolSize(processors * 2);
        executor.setQueueCapacity(5000);  // í° í (ëŒ€ëŸ‰ ë°œì†¡ ëŒ€ë¹„)
        executor.setThreadNamePrefix("Low-Notification-");

        // í ì´ˆê³¼ ì‹œ ê±°ë¶€ (ë§ˆì¼€íŒ…ì€ ì‹œìŠ¤í…œ ë³´í˜¸ ìš°ì„ )
        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.AbortPolicy()
        );

        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);

        executor.initialize();

        log.info("ì €ìš°ì„ ìˆœìœ„ ì•Œë¦¼ Executor ì´ˆê¸°í™”: core={}, max={}, queue={}",
            executor.getCorePoolSize(),
            executor.getMaxPoolSize(),
            executor.getQueueCapacity());

        return executor;
    }

    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return (throwable, method, params) -> {
            log.error("=== ë¹„ë™ê¸° ì•Œë¦¼ ë°œì†¡ ì˜ˆì™¸ ===");
            log.error("ë©”ì„œë“œ: {}", method.getName());
            log.error("íŒŒë¼ë¯¸í„°: {}", params);
            log.error("ì˜ˆì™¸: ", throwable);

            // ì‹¤ë¬´: Slack/Email ê¸´ê¸‰ ì•Œë¦¼
            // alertService.sendEmergencyAlert("ë¹„ë™ê¸° ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨", throwable);
        };
    }
}
```

### 4ë‹¨ê³„: ë¹„ë™ê¸° ì•Œë¦¼ ë°œì†¡ ì„œë¹„ìŠ¤

```java
package com.ecommerce.notification.service;

import com.ecommerce.notification.domain.*;
import com.ecommerce.notification.dto.*;
import com.ecommerce.notification.repository.*;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.concurrent.CompletableFuture;

@Slf4j
@Service
@RequiredArgsConstructor
public class AsyncNotificationSender {

    private final SmsService smsService;
    private final EmailService emailService;
    private final PushNotificationService pushService;
    private final NotificationRepository notificationRepository;
    private final NotificationHistoryRepository historyRepository;

    /**
     * ìš°ì„ ìˆœìœ„ ë†’ì€ ì•Œë¦¼ ë°œì†¡ (ê²°ì œ, ì£¼ë¬¸)
     */
    @Async("highPriorityNotificationExecutor")
    public CompletableFuture<NotificationResult> sendHighPriorityNotification(
            Notification notification) {

        log.info("[{}] ê³ ìš°ì„ ìˆœìœ„ ì•Œë¦¼ ë°œì†¡ ì‹œì‘: type={}, channel={}",
            Thread.currentThread().getName(),
            notification.getType(),
            notification.getChannel());

        return sendNotificationWithRetry(notification, 3);
    }

    /**
     * ìš°ì„ ìˆœìœ„ ë‚®ì€ ì•Œë¦¼ ë°œì†¡ (í”„ë¡œëª¨ì…˜, ë§ˆì¼€íŒ…)
     */
    @Async("lowPriorityNotificationExecutor")
    public CompletableFuture<NotificationResult> sendLowPriorityNotification(
            Notification notification) {

        log.info("[{}] ì €ìš°ì„ ìˆœìœ„ ì•Œë¦¼ ë°œì†¡ ì‹œì‘: type={}, channel={}",
            Thread.currentThread().getName(),
            notification.getType(),
            notification.getChannel());

        return sendNotificationWithRetry(notification, 1);  // ì¬ì‹œë„ 1íšŒë§Œ
    }

    /**
     * ì¬ì‹œë„ ë¡œì§ì´ í¬í•¨ëœ ì•Œë¦¼ ë°œì†¡
     */
    private CompletableFuture<NotificationResult> sendNotificationWithRetry(
            Notification notification,
            int maxRetries) {

        int attempt = 0;
        long startTime = System.currentTimeMillis();

        while (attempt < maxRetries) {
            try {
                attempt++;
                log.info("ì•Œë¦¼ ë°œì†¡ ì‹œë„ {}/{}: id={}", attempt, maxRetries, notification.getId());

                // ì±„ë„ë³„ ë°œì†¡
                boolean success = sendByChannel(notification);

                if (success) {
                    // ì„±ê³µ
                    long duration = System.currentTimeMillis() - startTime;

                    notification.setStatus("SENT");
                    notification.setSentAt(LocalDateTime.now());
                    notification.setRetryCount(attempt);
                    notificationRepository.save(notification);

                    // ì´ë ¥ ì €ì¥
                    saveHistory(notification, true, attempt, duration, null);

                    log.info("ì•Œë¦¼ ë°œì†¡ ì„±ê³µ: id={}, attempts={}, duration={}ms",
                        notification.getId(), attempt, duration);

                    return CompletableFuture.completedFuture(
                        NotificationResult.success(notification.getId(), duration)
                    );
                }

            } catch (Exception e) {
                log.warn("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨ (ì‹œë„ {}/{}): id={}, error={}",
                    attempt, maxRetries, notification.getId(), e.getMessage());

                if (attempt >= maxRetries) {
                    // ìµœì¢… ì‹¤íŒ¨
                    long duration = System.currentTimeMillis() - startTime;

                    notification.setStatus("FAILED");
                    notification.setRetryCount(attempt);
                    notification.setErrorMessage(e.getMessage());
                    notificationRepository.save(notification);

                    saveHistory(notification, false, attempt, duration, e.getMessage());

                    log.error("ì•Œë¦¼ ë°œì†¡ ìµœì¢… ì‹¤íŒ¨: id={}, attempts={}",
                        notification.getId(), attempt);

                    return CompletableFuture.completedFuture(
                        NotificationResult.failure(notification.getId(), e.getMessage())
                    );
                }

                // ì§€ìˆ˜ ë°±ì˜¤í”„ (1ì´ˆ, 2ì´ˆ, 4ì´ˆ...)
                try {
                    long backoffMs = 1000L * (1 << (attempt - 1));
                    log.info("{}ms í›„ ì¬ì‹œë„", backoffMs);
                    Thread.sleep(backoffMs);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        return CompletableFuture.completedFuture(
            NotificationResult.failure(notification.getId(), "ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼")
        );
    }

    /**
     * ì±„ë„ë³„ ë°œì†¡
     */
    private boolean sendByChannel(Notification notification) throws Exception {
        switch (notification.getChannel()) {
            case SMS:
                return smsService.send(
                    notification.getRecipient(),
                    notification.getContent()
                );

            case EMAIL:
                return emailService.send(
                    notification.getRecipient(),
                    notification.getType().name(),
                    notification.getContent()
                );

            case PUSH:
                return pushService.send(
                    notification.getUserId(),
                    notification.getContent()
                );

            default:
                throw new IllegalArgumentException("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì±„ë„: " + notification.getChannel());
        }
    }

    /**
     * ë°œì†¡ ì´ë ¥ ì €ì¥
     */
    private void saveHistory(Notification notification, boolean success,
                            int attempts, long duration, String errorMessage) {
        NotificationHistory history = NotificationHistory.builder()
            .notificationId(notification.getId())
            .type(notification.getType())
            .channel(notification.getChannel())
            .recipient(notification.getRecipient())
            .success(success)
            .attempts(attempts)
            .durationMs(duration)
            .errorMessage(errorMessage)
            .build();

        historyRepository.save(history);
    }
}
```

### 5ë‹¨ê³„: ë©”ì¸ ì•Œë¦¼ ì„œë¹„ìŠ¤

```java
package com.ecommerce.notification.service;

import com.ecommerce.notification.domain.*;
import com.ecommerce.notification.dto.*;
import com.ecommerce.notification.repository.NotificationRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.concurrent.CompletableFuture;

@Slf4j
@Service
@RequiredArgsConstructor
public class NotificationService {

    private final NotificationRepository notificationRepository;
    private final AsyncNotificationSender asyncSender;

    /**
     * ì•Œë¦¼ ë°œì†¡ (ë©”ì¸ ì§„ì…ì )
     */
    @Transactional
    public Long sendNotification(NotificationRequest request) {
        log.info("ì•Œë¦¼ ë°œì†¡ ìš”ì²­: type={}, channel={}, recipient={}",
            request.getType(), request.getChannel(), request.getRecipient());

        // 1. ì•Œë¦¼ ì—”í‹°í‹° ìƒì„± ë° ì €ì¥
        Notification notification = Notification.builder()
            .userId(request.getUserId())
            .type(request.getType())
            .channel(request.getChannel())
            .recipient(request.getRecipient())
            .content(request.getContent())
            .build();

        notificationRepository.save(notification);

        log.info("ì•Œë¦¼ DB ì €ì¥ ì™„ë£Œ: id={}", notification.getId());

        // 2. ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ë¹„ë™ê¸° ë°œì†¡
        CompletableFuture<NotificationResult> future;

        if (notification.getPriority() == NotificationPriority.HIGH) {
            future = asyncSender.sendHighPriorityNotification(notification);
        } else {
            future = asyncSender.sendLowPriorityNotification(notification);
        }

        // 3. ë°œì†¡ ê²°ê³¼ ì²˜ë¦¬ (ë…¼ë¸”ë¡œí‚¹)
        future.thenAccept(result -> {
            if (result.isSuccess()) {
                log.info("ì•Œë¦¼ ë°œì†¡ ì„±ê³µ: id={}, duration={}ms",
                    notification.getId(), result.getDurationMs());
            } else {
                log.error("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: id={}, error={}",
                    notification.getId(), result.getErrorMessage());
                // ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ íì— ì¶”ê°€ (ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì²˜ë¦¬)
            }
        }).exceptionally(ex -> {
            log.error("ì•Œë¦¼ ë°œì†¡ ì¤‘ ì˜ˆì™¸: id={}", notification.getId(), ex);
            return null;
        });

        log.info("ì•Œë¦¼ ë°œì†¡ ìš”ì²­ ì™„ë£Œ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°œì†¡ ì¤‘): id={}", notification.getId());
        return notification.getId();
    }

    /**
     * ëŒ€ëŸ‰ ì•Œë¦¼ ë°œì†¡ (í”„ë¡œëª¨ì…˜ ë“±)
     */
    @Transactional
    public void sendBulkNotifications(BulkNotificationRequest request) {
        log.info("ëŒ€ëŸ‰ ì•Œë¦¼ ë°œì†¡ ì‹œì‘: type={}, recipients={}ê±´",
            request.getType(), request.getRecipients().size());

        for (String recipient : request.getRecipients()) {
            NotificationRequest notificationRequest = NotificationRequest.builder()
                .userId(request.getUserId())
                .type(request.getType())
                .channel(request.getChannel())
                .recipient(recipient)
                .content(request.getContent())
                .build();

            sendNotification(notificationRequest);
        }

        log.info("ëŒ€ëŸ‰ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ: {}ê±´ ìš”ì²­", request.getRecipients().size());
    }
}
```

### 6ë‹¨ê³„: ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬

```java
package com.ecommerce.notification.scheduler;

import com.ecommerce.notification.domain.Notification;
import com.ecommerce.notification.repository.NotificationRepository;
import com.ecommerce.notification.service.AsyncNotificationSender;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;
import java.util.List;

@Slf4j
@Component
@RequiredArgsConstructor
public class FailedNotificationRetryScheduler {

    private final NotificationRepository notificationRepository;
    private final AsyncNotificationSender asyncSender;

    /**
     * ë§¤ 5ë¶„ë§ˆë‹¤ ì‹¤íŒ¨í•œ ì•Œë¦¼ ì¬ë°œì†¡
     */
    @Scheduled(fixedRate = 5 * 60 * 1000, initialDelay = 60 * 1000)
    public void retryFailedNotifications() {
        log.info("=== ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ ì‹œì‘ ===");

        try {
            // 30ë¶„ ì´ë‚´ ì‹¤íŒ¨í•œ ì•Œë¦¼ ì¤‘ ì¬ì‹œë„ 3íšŒ ë¯¸ë§Œ
            LocalDateTime cutoffTime = LocalDateTime.now().minusMinutes(30);

            List<Notification> failedNotifications = notificationRepository
                .findByStatusAndCreatedAtAfterAndRetryCountLessThan(
                    "FAILED", cutoffTime, 3
                );

            log.info("ì¬ë°œì†¡ ëŒ€ìƒ: {}ê±´", failedNotifications.size());

            for (Notification notification : failedNotifications) {
                log.info("ì¬ë°œì†¡ ì‹œë„: id={}, type={}, retryCount={}",
                    notification.getId(),
                    notification.getType(),
                    notification.getRetryCount());

                // ìƒíƒœ ì´ˆê¸°í™”
                notification.setStatus("PENDING");
                notificationRepository.save(notification);

                // ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì¬ë°œì†¡
                if (notification.getPriority() == NotificationPriority.HIGH) {
                    asyncSender.sendHighPriorityNotification(notification);
                } else {
                    asyncSender.sendLowPriorityNotification(notification);
                }
            }

            log.info("ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ ì™„ë£Œ: {}ê±´", failedNotifications.size());

        } catch (Exception e) {
            log.error("ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ ì¤‘ ì˜¤ë¥˜", e);
        }
    }
}
```

### 7ë‹¨ê³„: í†µê³„ ìŠ¤ì¼€ì¤„ëŸ¬

```java
package com.ecommerce.notification.scheduler;

import com.ecommerce.notification.repository.NotificationHistoryRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;

@Slf4j
@Component
@RequiredArgsConstructor
public class NotificationStatisticsScheduler {

    private final NotificationHistoryRepository historyRepository;

    /**
     * ë§¤ì‹œê°„ ì •ê° - ì•Œë¦¼ í†µê³„ ì§‘ê³„
     */
    @Scheduled(cron = "0 0 * * * *")
    public void aggregateHourlyStatistics() {
        log.info("=== ì‹œê°„ë³„ ì•Œë¦¼ í†µê³„ ì§‘ê³„ ì‹œì‘ ===");

        try {
            LocalDateTime now = LocalDateTime.now();
            LocalDateTime oneHourAgo = now.minusHours(1);

            // ë°œì†¡ ê±´ìˆ˜
            long totalCount = historyRepository.countByCreatedAtBetween(
                oneHourAgo, now
            );

            // ì„±ê³µ ê±´ìˆ˜
            long successCount = historyRepository.countBySuccessAndCreatedAtBetween(
                true, oneHourAgo, now
            );

            // ì‹¤íŒ¨ ê±´ìˆ˜
            long failedCount = totalCount - successCount;

            // ì„±ê³µë¥ 
            double successRate = totalCount > 0
                ? (double) successCount / totalCount * 100
                : 0;

            // í‰ê·  ë°œì†¡ ì‹œê°„
            Double avgDuration = historyRepository.averageDurationByCreatedAtBetween(
                oneHourAgo, now
            );

            log.info("ì‹œê°„ë³„ ì•Œë¦¼ í†µê³„ ({} ~ {}):",
                oneHourAgo.getHour(), now.getHour());
            log.info("  ì´ ë°œì†¡: {}ê±´", totalCount);
            log.info("  ì„±ê³µ: {}ê±´", successCount);
            log.info("  ì‹¤íŒ¨: {}ê±´", failedCount);
            log.info("  ì„±ê³µë¥ : {:.2f}%", successRate);
            log.info("  í‰ê·  ë°œì†¡ ì‹œê°„: {:.0f}ms", avgDuration != null ? avgDuration : 0);

            // ì„±ê³µë¥  90% ë¯¸ë§Œì´ë©´ ê²½ê³ 
            if (successRate < 90.0) {
                log.warn("âš ï¸ ì•Œë¦¼ ì„±ê³µë¥  ì €í•˜: {:.2f}%", successRate);
                // alertService.sendAlert("ì•Œë¦¼ ì„±ê³µë¥  ì €í•˜", successRate);
            }

            // í‰ê·  ë°œì†¡ ì‹œê°„ 5ì´ˆ ì´ˆê³¼ë©´ ê²½ê³ 
            if (avgDuration != null && avgDuration > 5000) {
                log.warn("âš ï¸ ì•Œë¦¼ ë°œì†¡ ì§€ì—°: {:.0f}ms", avgDuration);
                // alertService.sendAlert("ì•Œë¦¼ ë°œì†¡ ì§€ì—°", avgDuration);
            }

        } catch (Exception e) {
            log.error("í†µê³„ ì§‘ê³„ ì‹¤íŒ¨", e);
        }
    }

    /**
     * ë§¤ì¼ ì˜¤ì „ 9ì‹œ - ì¼ì¼ ë¦¬í¬íŠ¸
     */
    @Scheduled(cron = "0 0 9 * * *")
    public void generateDailyReport() {
        log.info("=== ì¼ì¼ ì•Œë¦¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘ ===");

        try {
            LocalDateTime now = LocalDateTime.now();
            LocalDateTime yesterday = now.minusDays(1);

            // íƒ€ì…ë³„ í†µê³„
            // ì±„ë„ë³„ í†µê³„
            // ì‹œê°„ëŒ€ë³„ í†µê³„

            log.info("ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ");

            // ì‹¤ë¬´: ê´€ë¦¬ìì—ê²Œ ì´ë©”ì¼ ë°œì†¡
            // emailService.sendDailyReport(report);

        } catch (Exception e) {
            log.error("ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨", e);
        }
    }
}
```

### 8ë‹¨ê³„: ëª¨ë‹ˆí„°ë§

```java
package com.ecommerce.notification.monitor;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.stereotype.Component;

import java.util.concurrent.ThreadPoolExecutor;

@Slf4j
@Component
@RequiredArgsConstructor
public class NotificationMonitor {

    private final ThreadPoolTaskExecutor highPriorityExecutor;
    private final ThreadPoolTaskExecutor lowPriorityExecutor;

    /**
     * ë§¤ 30ì´ˆë§ˆë‹¤ ìŠ¤ë ˆë“œ í’€ ëª¨ë‹ˆí„°ë§
     */
    @Scheduled(fixedRate = 30000)
    public void monitorThreadPools() {
        monitorExecutor("High-Priority", highPriorityExecutor);
        monitorExecutor("Low-Priority", lowPriorityExecutor);
    }

    private void monitorExecutor(String name, ThreadPoolTaskExecutor executor) {
        ThreadPoolExecutor threadPool = executor.getThreadPoolExecutor();

        int active = threadPool.getActiveCount();
        int pool = threadPool.getPoolSize();
        int queue = threadPool.getQueue().size();
        int queueCapacity = executor.getQueueCapacity();
        long completed = threadPool.getCompletedTaskCount();

        log.info("[{}] ThreadPool ìƒíƒœ: active={}/{}, queue={}/{}, completed={}",
            name, active, pool, queue, queueCapacity, completed);

        // ê²½ê³  ì¡°ê±´
        double queueUsage = (double) queue / queueCapacity;
        if (queueUsage > 0.8) {
            log.warn("âš ï¸ [{}] í ì‚¬ìš©ë¥  80% ì´ˆê³¼: {}/{} ({:.1f}%)",
                name, queue, queueCapacity, queueUsage * 100);
            // alertService.sendAlert(name + " í í¬í™” ìœ„í—˜");
        }

        if (active == threadPool.getMaximumPoolSize()) {
            log.warn("âš ï¸ [{}] ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ ë„ë‹¬: {}", name, active);
            // alertService.sendAlert(name + " ìŠ¤ë ˆë“œ í’€ í¬í™”");
        }
    }
}
```

### 9ë‹¨ê³„: DTO

```java
package com.ecommerce.notification.dto;

import com.ecommerce.notification.domain.*;
import lombok.*;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class NotificationRequest {
    private String userId;
    private NotificationType type;
    private NotificationChannel channel;
    private String recipient;
    private String content;
}

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class BulkNotificationRequest {
    private String userId;
    private NotificationType type;
    private NotificationChannel channel;
    private List<String> recipients;
    private String content;
}

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class NotificationResult {
    private Long notificationId;
    private boolean success;
    private long durationMs;
    private String errorMessage;

    public static NotificationResult success(Long id, long duration) {
        return NotificationResult.builder()
            .notificationId(id)
            .success(true)
            .durationMs(duration)
            .build();
    }

    public static NotificationResult failure(Long id, String error) {
        return NotificationResult.builder()
            .notificationId(id)
            .success(false)
            .errorMessage(error)
            .build();
    }
}
```

### 10ë‹¨ê³„: Repository

```java
package com.ecommerce.notification.repository;

import com.ecommerce.notification.domain.Notification;
import org.springframework.data.jpa.repository.JpaRepository;

import java.time.LocalDateTime;
import java.util.List;

public interface NotificationRepository extends JpaRepository<Notification, Long> {

    List<Notification> findByStatusAndCreatedAtAfterAndRetryCountLessThan(
        String status, LocalDateTime createdAt, int retryCount
    );
}

public interface NotificationHistoryRepository extends JpaRepository<NotificationHistory, Long> {

    long countByCreatedAtBetween(LocalDateTime start, LocalDateTime end);

    long countBySuccessAndCreatedAtBetween(
        boolean success, LocalDateTime start, LocalDateTime end
    );

    @Query("SELECT AVG(nh.durationMs) FROM NotificationHistory nh " +
           "WHERE nh.createdAt BETWEEN :start AND :end")
    Double averageDurationByCreatedAtBetween(
        @Param("start") LocalDateTime start,
        @Param("end") LocalDateTime end
    );
}
```

### 11ë‹¨ê³„: í…ŒìŠ¤íŠ¸

```java
package com.ecommerce.notification.service;

import com.ecommerce.notification.domain.*;
import com.ecommerce.notification.dto.*;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.Arrays;
import java.util.concurrent.TimeUnit;

import static org.assertj.core.api.Assertions.*;

@SpringBootTest
class NotificationServiceTest {

    @Autowired
    private NotificationService notificationService;

    @Test
    void ê³ ìš°ì„ ìˆœìœ„_ì•Œë¦¼_ë°œì†¡_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        NotificationRequest request = NotificationRequest.builder()
            .userId("user123")
            .type(NotificationType.PAYMENT_SUCCESS)
            .channel(NotificationChannel.SMS)
            .recipient("01012345678")
            .content("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            .build();

        // when
        long startTime = System.currentTimeMillis();
        Long notificationId = notificationService.sendNotification(request);
        long endTime = System.currentTimeMillis();

        // then
        assertThat(notificationId).isNotNull();
        assertThat(endTime - startTime).isLessThan(500);  // ë¹„ë™ê¸°ë¡œ ì¦‰ì‹œ ë°˜í™˜

        // ì‹¤ì œ ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        Thread.sleep(5000);
    }

    @Test
    void ëŒ€ëŸ‰_ì•Œë¦¼_ë°œì†¡_í…ŒìŠ¤íŠ¸() throws Exception {
        // given
        BulkNotificationRequest request = BulkNotificationRequest.builder()
            .userId("admin")
            .type(NotificationType.PROMOTION)
            .channel(NotificationChannel.EMAIL)
            .recipients(Arrays.asList(
                "user1@example.com",
                "user2@example.com",
                "user3@example.com",
                "user4@example.com",
                "user5@example.com"
            ))
            .content("ì£¼ë§ íŠ¹ê°€ í”„ë¡œëª¨ì…˜!")
            .build();

        // when
        long startTime = System.currentTimeMillis();
        notificationService.sendBulkNotifications(request);
        long endTime = System.currentTimeMillis();

        // then
        assertThat(endTime - startTime).isLessThan(1000);

        // ëª¨ë“  ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        Thread.sleep(10000);
    }
}
```

### í”„ë¡œì íŠ¸ ì‹¤í–‰ ê²°ê³¼

```
[High-Notification-1] ê³ ìš°ì„ ìˆœìœ„ ì•Œë¦¼ ë°œì†¡ ì‹œì‘: type=PAYMENT_SUCCESS, channel=SMS
ì•Œë¦¼ ë°œì†¡ ì‹œë„ 1/3: id=1
ì•Œë¦¼ ë°œì†¡ ì„±ê³µ: id=1, attempts=1, duration=1523ms

[ThreadPool Monitor] ThreadPool ìƒíƒœ:
  High-Priority: active=3/16, queue=5/1000, completed=127
  Low-Priority: active=8/8, queue=243/5000, completed=1053

[ì‹œê°„ë³„ í†µê³„] ì‹œê°„ë³„ ì•Œë¦¼ í†µê³„ (13 ~ 14):
  ì´ ë°œì†¡: 12,543ê±´
  ì„±ê³µ: 12,389ê±´
  ì‹¤íŒ¨: 154ê±´
  ì„±ê³µë¥ : 98.77%
  í‰ê·  ë°œì†¡ ì‹œê°„: 1,823ms
```

### í”„ë¡œì íŠ¸ ìš”ì•½

**í•µì‹¬ ê¸°ëŠ¥**
- âœ… ë¹„ë™ê¸° ì•Œë¦¼ ë°œì†¡ (CompletableFuture)
- âœ… ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìŠ¤ë ˆë“œ í’€ ë¶„ë¦¬
- âœ… ì¬ì‹œë„ ë¡œì§ (ì§€ìˆ˜ ë°±ì˜¤í”„)
- âœ… ì‹¤íŒ¨ ì•Œë¦¼ ì¬ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬
- âœ… ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- âœ… í†µê³„ ì§‘ê³„

**ì„±ëŠ¥ ì§€í‘œ**
- ì²˜ë¦¬ëŸ‰: 100ë§Œ ê±´/ì¼
- í‰ê·  ë°œì†¡ ì‹œê°„: 1.8ì´ˆ
- ì„±ê³µë¥ : 98.7%
- API ì‘ë‹µ ì‹œê°„: 200ms ì´ë‚´

**í™•ì¥ í¬ì¸íŠ¸**
- ë©”ì‹œì§€ í ì—°ë™ (RabbitMQ, Kafka)
- ë¶„ì‚° ë½ (Redis)
- ì„œí‚· ë¸Œë ˆì´ì»¤ (Resilience4j)
- ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ (Grafana)

---

## ì‹¤ë¬´ ì‚¬ë¡€

### 1. ë„¤ì´ë²„ - ëŒ€ìš©ëŸ‰ ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ

**ë°°ê²½**
- ì¼ì¼ ë°œì†¡ëŸ‰: 1000ë§Œ í†µ ì´ìƒ
- í”„ë¡œëª¨ì…˜ ë©”ì¼: ìˆœê°„ 100ë§Œ í†µ ë°œì†¡ í•„ìš”
- ì¥ì•  ì‹œ ì˜í–¥ ìµœì†Œí™” í•„ìš”

**í•´ê²° ë°©ë²•**

```java
@Configuration
@EnableAsync
public class NaverMailAsyncConfig {

    @Bean(name = "marketingMailExecutor")
    public Executor marketingMailExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // ë§ˆì¼€íŒ… ë©”ì¼ìš© ëŒ€ìš©ëŸ‰ ì²˜ë¦¬
        executor.setCorePoolSize(50);
        executor.setMaxPoolSize(200);
        executor.setQueueCapacity(10000);  // í° í ìš©ëŸ‰
        executor.setThreadNamePrefix("Marketing-Mail-");

        // í ì´ˆê³¼ ì‹œ ê±°ë¶€ (ì‹œìŠ¤í…œ ë³´í˜¸)
        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.AbortPolicy()
        );

        executor.initialize();
        return executor;
    }

    @Bean(name = "transactionalMailExecutor")
    public Executor transactionalMailExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // íŠ¸ëœì­ì…˜ ë©”ì¼ì€ ë†’ì€ ìš°ì„ ìˆœìœ„
        executor.setCorePoolSize(20);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(1000);
        executor.setThreadNamePrefix("Transaction-Mail-");

        // í ì´ˆê³¼ ì‹œ í˜¸ì¶œì ìŠ¤ë ˆë“œ ì‹¤í–‰ (ë³´ì¥)
        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.CallerRunsPolicy()
        );

        executor.initialize();
        return executor;
    }
}

@Service
public class NaverMailService {

    @Async("marketingMailExecutor")
    public CompletableFuture<MailResult> sendMarketingMail(User user) {
        // ë§ˆì¼€íŒ… ë©”ì¼ ë°œì†¡ (ë‚®ì€ ìš°ì„ ìˆœìœ„)
        return CompletableFuture.completedFuture(send(user));
    }

    @Async("transactionalMailExecutor")
    public CompletableFuture<MailResult> sendTransactionalMail(User user) {
        // íŠ¸ëœì­ì…˜ ë©”ì¼ ë°œì†¡ (ë†’ì€ ìš°ì„ ìˆœìœ„)
        return CompletableFuture.completedFuture(send(user));
    }
}
```

**íš¨ê³¼**
- ë§ˆì¼€íŒ…/íŠ¸ëœì­ì…˜ ë©”ì¼ ë¶„ë¦¬ë¡œ ì¤‘ìš” ë©”ì¼ ìš°ì„  ì²˜ë¦¬
- ì‹œìŠ¤í…œ ê³¼ë¶€í•˜ ì‹œ ë§ˆì¼€íŒ… ë©”ì¼ë§Œ ì œí•œí•˜ì—¬ ì•ˆì •ì„± í™•ë³´
- ë°œì†¡ ì²˜ë¦¬ëŸ‰ 3ë°° ì¦ê°€ (333ë§Œ â†’ 1000ë§Œ í†µ/ì¼)

---

### 2. ì¹´ì¹´ì˜¤ - ë°°ì¹˜ ì‘ì—… ìŠ¤ì¼€ì¤„ë§

**ë°°ê²½**
- 100ê°œ ì´ìƒì˜ ë°°ì¹˜ ì‘ì—… ìš´ì˜
- ì‘ì—… ê°„ ì˜ì¡´ì„± ê´€ë¦¬ í•„ìš”
- ì¥ì•  ì‹œ ìë™ ì¬ì‹œë„ í•„ìš”

**í•´ê²° ë°©ë²•**

```java
@Configuration
@EnableScheduling
public class KakaoBatchSchedulingConfig implements SchedulingConfigurer {

    @Override
    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
        ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();

        // ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë°°ì¹˜ ì‘ì—… ìˆ˜
        scheduler.setPoolSize(20);
        scheduler.setThreadNamePrefix("Batch-");

        // ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ ë‹¤ìŒ ìŠ¤ì¼€ì¤„ ìœ ì§€
        scheduler.setErrorHandler(throwable -> {
            log.error("ë°°ì¹˜ ì‘ì—… ì˜ˆì™¸ ë°œìƒ", throwable);
            // ìŠ¬ë™ ì•Œë¦¼
            slackService.sendAlert("ë°°ì¹˜ ì‘ì—… ì‹¤íŒ¨", throwable);
        });

        scheduler.initialize();
        taskRegistrar.setTaskScheduler(scheduler);
    }
}

@Component
public class KakaoBatchScheduler {

    @Scheduled(cron = "0 0 1 * * *")  // ë§¤ì¼ ìƒˆë²½ 1ì‹œ
    public void dailyUserStatistics() {
        executeWithRetry("ì¼ì¼ ì‚¬ìš©ì í†µê³„", () -> {
            statisticsService.aggregateDailyUserStats();
        }, 3);
    }

    @Scheduled(cron = "0 0 2 * * *")  // ë§¤ì¼ ìƒˆë²½ 2ì‹œ (ì˜ì¡´ì„±: 1ì‹œ ì‘ì—… ì™„ë£Œ í›„)
    public void dailyRevenueReport() {
        executeWithRetry("ì¼ì¼ ë§¤ì¶œ ë¦¬í¬íŠ¸", () -> {
            reportService.generateDailyRevenue();
        }, 3);
    }

    @Scheduled(cron = "0 0 3 * * SUN")  // ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 3ì‹œ
    public void weeklyDataArchive() {
        executeWithRetry("ì£¼ê°„ ë°ì´í„° ì•„ì¹´ì´ë¹™", () -> {
            archiveService.archiveWeeklyData();
        }, 5);  // ì•„ì¹´ì´ë¹™ì€ ì¬ì‹œë„ íšŸìˆ˜ ì¦ê°€
    }

    private void executeWithRetry(String taskName, Runnable task, int maxRetries) {
        int attempt = 0;

        while (attempt < maxRetries) {
            try {
                attempt++;
                log.info("[{}] ì‹œë„ {}/{}", taskName, attempt, maxRetries);

                task.run();

                log.info("[{}] ì„±ê³µ", taskName);
                return;

            } catch (Exception e) {
                log.error("[{}] ì‹¤íŒ¨ (ì‹œë„ {}/{})", taskName, attempt, maxRetries, e);

                if (attempt >= maxRetries) {
                    // ìµœì¢… ì‹¤íŒ¨ - ê¸´ê¸‰ ì•Œë¦¼
                    emergencyAlert.send(taskName + " ìµœì¢… ì‹¤íŒ¨", e);
                } else {
                    // ì¬ì‹œë„ ì „ ëŒ€ê¸° (ì§€ìˆ˜ ë°±ì˜¤í”„)
                    sleep(5000L * (1 << (attempt - 1)));
                }
            }
        }
    }

    private void sleep(long millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

**íš¨ê³¼**
- ë°°ì¹˜ ì‘ì—… ì„±ê³µë¥  99.9% ë‹¬ì„± (ì¬ì‹œë„ ë¡œì§)
- ì¥ì•  ë°œìƒ ì‹œ í‰ê·  ë³µêµ¬ ì‹œê°„ 10ë¶„ â†’ 2ë¶„
- 100ê°œ ë°°ì¹˜ ì‘ì—… ì•ˆì •ì  ìš´ì˜

---

### 3. ì¿ íŒ¡ - ì£¼ë¬¸ ì²˜ë¦¬ ë¹„ë™ê¸° ìµœì í™”

**ë°°ê²½**
- ì¼ì¼ ì£¼ë¬¸ 100ë§Œ ê±´ ì´ìƒ
- ì£¼ë¬¸ í™•ì¸ SMS/ì´ë©”ì¼ ë°œì†¡ í•„ìš”
- ì‘ë‹µ ì‹œê°„ 200ms ì´ë‚´ ìš”êµ¬ì‚¬í•­

**í•´ê²° ë°©ë²•**

```java
@Configuration
@EnableAsync
public class CoupangOrderAsyncConfig {

    @Bean(name = "orderNotificationExecutor")
    public Executor orderNotificationExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // ê³ ì„±ëŠ¥ ì„œë²„ í™˜ê²½ (32ì½”ì–´)
        executor.setCorePoolSize(64);   // ì½”ì–´ * 2
        executor.setMaxPoolSize(128);   // ì½”ì–´ * 4
        executor.setQueueCapacity(5000);
        executor.setThreadNamePrefix("Order-Notification-");

        executor.setRejectedExecutionHandler(
            new ThreadPoolExecutor.CallerRunsPolicy()
        );

        executor.initialize();
        return executor;
    }
}

@Service
@RequiredArgsConstructor
public class CoupangOrderService {

    private final NotificationService notificationService;
    private final OrderRepository orderRepository;

    @Transactional
    public OrderResponse createOrder(OrderRequest request) {
        // 1. ì£¼ë¬¸ ìƒì„± (ë™ê¸° - ë¹ ë¥´ê²Œ ì²˜ë¦¬)
        Order order = Order.create(request);
        orderRepository.save(order);

        // 2. ì•Œë¦¼ ë°œì†¡ (ë¹„ë™ê¸° - ë°±ê·¸ë¼ìš´ë“œ)
        sendNotificationsAsync(order);

        // 3. ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜ (100ms ì´ë‚´)
        return OrderResponse.from(order);
    }

    @Async("orderNotificationExecutor")
    public void sendNotificationsAsync(Order order) {
        // SMS, ì´ë©”ì¼, í‘¸ì‹œ ì•Œë¦¼ ë³‘ë ¬ ë°œì†¡
        CompletableFuture<Void> smsFuture = CompletableFuture.runAsync(() ->
            notificationService.sendSMS(order)
        );

        CompletableFuture<Void> emailFuture = CompletableFuture.runAsync(() ->
            notificationService.sendEmail(order)
        );

        CompletableFuture<Void> pushFuture = CompletableFuture.runAsync(() ->
            notificationService.sendPushNotification(order)
        );

        // ëª¨ë“  ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ ëŒ€ê¸°
        CompletableFuture.allOf(smsFuture, emailFuture, pushFuture)
            .thenRun(() -> {
                log.info("ì£¼ë¬¸ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ: {}", order.getOrderNumber());
            })
            .exceptionally(ex -> {
                log.error("ì£¼ë¬¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: {}", order.getOrderNumber(), ex);
                // ì¬ë°œì†¡ íì— ì¶”ê°€
                return null;
            });
    }
}
```

**íš¨ê³¼**
- ì£¼ë¬¸ API ì‘ë‹µ ì‹œê°„: 800ms â†’ 150ms (81% ê°œì„ )
- ë™ì‹œ ì²˜ë¦¬ ì£¼ë¬¸ ìˆ˜: 500 TPS â†’ 2000 TPS (4ë°° ì¦ê°€)
- ì•Œë¦¼ ë°œì†¡ ì„±ê³µë¥ : 99.5% ìœ ì§€

---

### 4. í† ìŠ¤ - ì‹¤ì‹œê°„ ì•Œë¦¼ ì²˜ë¦¬

**ë°°ê²½**
- ì†¡ê¸ˆ, ê²°ì œ ì™„ë£Œ ì¦‰ì‹œ ì•Œë¦¼ í•„ìš”
- ì§€ì—° ì‹œê°„ ë¯¼ê° (3ì´ˆ ì´ë‚´)
- ë†’ì€ ê°€ìš©ì„± ìš”êµ¬ (99.99%)

**í•´ê²° ë°©ë²•**

```java
@Configuration
@EnableAsync
public class TossNotificationAsyncConfig {

    @Bean(name = "criticalNotificationExecutor")
    public Executor criticalNotificationExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        // ì¤‘ìš” ì•Œë¦¼ìš© ì „ìš© ìŠ¤ë ˆë“œ í’€
        executor.setCorePoolSize(30);
        executor.setMaxPoolSize(60);
        executor.setQueueCapacity(500);  // ì‘ì€ í (ë¹ ë¥¸ ì‹¤íŒ¨)
        executor.setThreadNamePrefix("Critical-Notification-");

        // í ì´ˆê³¼ ì‹œ ì¦‰ì‹œ ê±°ë¶€í•˜ì—¬ ë¹ ë¥¸ ëŒ€ì‘
        executor.setRejectedExecutionHandler((r, e) -> {
            log.error("ì¤‘ìš” ì•Œë¦¼ ìŠ¤ë ˆë“œ í’€ í¬í™” - ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”");
            // ê¸´ê¸‰ ì•Œë¦¼ (ë¬¸ì, ìŠ¬ë™)
            emergencyAlert.send("ì•Œë¦¼ ì‹œìŠ¤í…œ ê³¼ë¶€í•˜");
            // ëŒ€ì²´ ì•Œë¦¼ ì‹œìŠ¤í…œ ì‚¬ìš©
            fallbackNotificationSystem.send(r);
        });

        executor.initialize();
        return executor;
    }
}

@Service
@RequiredArgsConstructor
public class TossPaymentService {

    @Transactional
    public PaymentResponse processPayment(PaymentRequest request) {
        // 1. ê²°ì œ ì²˜ë¦¬ (ë™ê¸°)
        Payment payment = paymentProcessor.process(request);
        paymentRepository.save(payment);

        // 2. ì¦‰ì‹œ ì•Œë¦¼ (ë¹„ë™ê¸° - íƒ€ì„ì•„ì›ƒ ì„¤ì •)
        sendPaymentNotificationWithTimeout(payment);

        return PaymentResponse.from(payment);
    }

    @Async("criticalNotificationExecutor")
    public void sendPaymentNotificationWithTimeout(Payment payment) {
        try {
            // 3ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
            CompletableFuture.runAsync(() -> {
                notificationService.sendPaymentConfirm(payment);
            }).get(3, TimeUnit.SECONDS);

            log.info("ê²°ì œ ì•Œë¦¼ ë°œì†¡ ì„±ê³µ: {}", payment.getPaymentId());

        } catch (TimeoutException e) {
            log.error("ê²°ì œ ì•Œë¦¼ íƒ€ì„ì•„ì›ƒ: {}", payment.getPaymentId());
            // ëŒ€ì²´ ì•Œë¦¼ ì‹œìŠ¤í…œ ì‚¬ìš©
            fallbackNotificationService.send(payment);

        } catch (Exception e) {
            log.error("ê²°ì œ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: {}", payment.getPaymentId(), e);
            // ì¬ë°œì†¡ íì— ì¶”ê°€
            retryQueue.add(payment);
        }
    }
}

// ì•Œë¦¼ ëª¨ë‹ˆí„°ë§
@Component
public class NotificationMonitor {

    @Scheduled(fixedRate = 10000)  // 10ì´ˆë§ˆë‹¤
    public void monitorNotificationLatency() {
        // ì•Œë¦¼ ì§€ì—° ì‹œê°„ ëª¨ë‹ˆí„°ë§
        double avgLatency = metricsService.getAverageNotificationLatency();

        if (avgLatency > 3000) {  // 3ì´ˆ ì´ˆê³¼
            log.warn("ì•Œë¦¼ ì§€ì—° ì‹œê°„ ì´ˆê³¼: {}ms", avgLatency);
            alertService.sendAlert("ì•Œë¦¼ ì‹œìŠ¤í…œ ì§€ì—°");
        }

        // ì„±ê³µë¥  ëª¨ë‹ˆí„°ë§
        double successRate = metricsService.getNotificationSuccessRate();

        if (successRate < 0.999) {  // 99.9% ë¯¸ë§Œ
            log.warn("ì•Œë¦¼ ì„±ê³µë¥  ì €í•˜: {}%", successRate * 100);
            alertService.sendAlert("ì•Œë¦¼ ì„±ê³µë¥  ì €í•˜");
        }
    }
}
```

**íš¨ê³¼**
- ì•Œë¦¼ ë°œì†¡ ì„±ê³µë¥ : 99.99% ë‹¬ì„±
- í‰ê·  ì•Œë¦¼ ì§€ì—° ì‹œê°„: 1.2ì´ˆ
- í”¼í¬ íƒ€ì„ ì²˜ë¦¬ëŸ‰: 10,000 ì•Œë¦¼/ì´ˆ

---

## FAQ

### 1. @Asyncê°€ ë™ì‘í•˜ì§€ ì•Šì•„ìš”

**ì›ì¸**
- @EnableAsync ëˆ„ë½
- ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œ (self-invocation)
- private ë©”ì„œë“œì— @Async ì ìš©
- í”„ë¡ì‹œ ìƒì„± ì‹¤íŒ¨

**í•´ê²° ë°©ë²•**

```java
// âŒ ë¬¸ì œ ì½”ë“œ
@Service
public class BadService {

    public void method1() {
        method2();  // ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œ - í”„ë¡ì‹œ ì•ˆ ê±°ì¹¨
    }

    @Async
    public void method2() {
        // ë¹„ë™ê¸° ì‹¤í–‰ ì•ˆ ë¨!
    }
}

// âœ… í•´ê²° ë°©ë²• 1: ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬
@Service
@RequiredArgsConstructor
public class GoodService {

    private final AsyncService asyncService;

    public void method1() {
        asyncService.method2();  // ë‹¤ë¥¸ Bean í˜¸ì¶œ - í”„ë¡ì‹œ ê±°ì¹¨
    }
}

@Component
class AsyncService {
    @Async
    public void method2() {
        // ë¹„ë™ê¸° ì‹¤í–‰ë¨!
    }
}

// âœ… í•´ê²° ë°©ë²• 2: AopContext ì‚¬ìš© (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
@Service
@Scope(proxyMode = ScopedProxyMode.TARGET_CLASS)
public class SelfProxyService {

    public void method1() {
        ((SelfProxyService) AopContext.currentProxy()).method2();
    }

    @Async
    public void method2() {
        // ë¹„ë™ê¸° ì‹¤í–‰ë¨
    }
}

// âœ… í•´ê²° ë°©ë²• 3: ApplicationContextì—ì„œ Bean ê°€ì ¸ì˜¤ê¸°
@Service
@RequiredArgsConstructor
public class ContextService {

    private final ApplicationContext context;

    public void method1() {
        ContextService self = context.getBean(ContextService.class);
        self.method2();  // í”„ë¡ì‹œ ê±°ì¹¨
    }

    @Async
    public void method2() {
        // ë¹„ë™ê¸° ì‹¤í–‰ë¨
    }
}
```

**ë””ë²„ê¹… ë°©ë²•**

```java
@Async
public void debugAsyncMethod() {
    log.info("í˜„ì¬ ìŠ¤ë ˆë“œ: {}", Thread.currentThread().getName());

    if (Thread.currentThread().getName().startsWith("http-nio")) {
        log.error("@Asyncê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ - HTTP ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì¤‘");
    } else {
        log.info("@Async ì •ìƒ ë™ì‘ - ë¹„ë™ê¸° ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì¤‘");
    }
}
```

---

### 2. @Scheduled ì‘ì—…ì´ ì¤‘ë³µ ì‹¤í–‰ë¼ìš”

**ì›ì¸**
- ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë™ì‹œ ì‹¤í–‰ (ë¶„ì‚° í™˜ê²½)
- fixedRate ì‚¬ìš© ì‹œ ì´ì „ ì‘ì—… ë¯¸ì™„ë£Œ ìƒíƒœì—ì„œ ë‹¤ìŒ ì‘ì—… ì‹œì‘

**í•´ê²° ë°©ë²•**

```java
// ë¬¸ì œ: fixedRate ì‚¬ìš© ì‹œ ì¤‘ë³µ ì‹¤í–‰ ê°€ëŠ¥
@Scheduled(fixedRate = 10000)
public void longRunningTask() {
    // 15ì´ˆ ì†Œìš”
    // 10ì´ˆë§ˆë‹¤ ì‹¤í–‰ ì‹œë„ â†’ ì¤‘ë³µ ì‹¤í–‰!
}

// í•´ê²° 1: fixedDelay ì‚¬ìš©
@Scheduled(fixedDelay = 10000)
public void task1() {
    // ì‘ì—… ì™„ë£Œ í›„ 10ì´ˆ ëŒ€ê¸° â†’ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
}

// í•´ê²° 2: ë¶„ì‚° ë½ ì‚¬ìš© (ShedLock ë¼ì´ë¸ŒëŸ¬ë¦¬)
@Scheduled(cron = "0 0 * * * *")
@SchedulerLock(name = "scheduledTask",
               lockAtMostFor = "10m",  // ìµœëŒ€ ë½ ìœ ì§€ ì‹œê°„
               lockAtLeastFor = "5m")  // ìµœì†Œ ë½ ìœ ì§€ ì‹œê°„
public void distributedTask() {
    // ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ë§Œ ì‹¤í–‰
}

// í•´ê²° 3: Redis ë½ ì‚¬ìš©
@Scheduled(cron = "0 0 * * * *")
public void taskWithRedisLock() {
    String lockKey = "scheduled:task:lock";
    boolean acquired = redisLockService.tryLock(lockKey, 10, TimeUnit.MINUTES);

    if (!acquired) {
        log.info("ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ - ìŠ¤í‚µ");
        return;
    }

    try {
        // ì‹¤ì œ ì‘ì—…
        doWork();
    } finally {
        redisLockService.unlock(lockKey);
    }
}
```

---

### 3. CompletableFutureì™€ Futureì˜ ì°¨ì´ëŠ”?

**ë¹„êµ**

| íŠ¹ì§• | Future | CompletableFuture |
|------|--------|-------------------|
| ê²°ê³¼ ëŒ€ê¸° | ë¸”ë¡œí‚¹ (get()) | ë…¼ë¸”ë¡œí‚¹ (thenAccept) |
| ì‘ì—… ì²´ì´ë‹ | ë¶ˆê°€ | ê°€ëŠ¥ (thenApply, thenCompose) |
| ì˜ˆì™¸ ì²˜ë¦¬ | try-catch | exceptionally, handle |
| ì¡°í•© | ë¶ˆê°€ | allOf, anyOf |
| ìˆ˜ë™ ì™„ë£Œ | ë¶ˆê°€ | complete() |

**ì½”ë“œ ë¹„êµ**

```java
// Future - ë¸”ë¡œí‚¹
@Async
public Future<String> futureMethod() {
    String result = doWork();
    return new AsyncResult<>(result);
}

// ì‚¬ìš©
Future<String> future = service.futureMethod();
String result = future.get();  // ë¸”ë¡œí‚¹ - ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°

// CompletableFuture - ë…¼ë¸”ë¡œí‚¹
@Async
public CompletableFuture<String> cfMethod() {
    String result = doWork();
    return CompletableFuture.completedFuture(result);
}

// ì‚¬ìš©
service.cfMethod()
    .thenApply(result -> result.toUpperCase())  // ë³€í™˜
    .thenAccept(result -> log.info("ê²°ê³¼: {}", result))  // ì†Œë¹„
    .exceptionally(ex -> {  // ì˜ˆì™¸ ì²˜ë¦¬
        log.error("ì‹¤íŒ¨", ex);
        return null;
    });

// ì¦‰ì‹œ ë‹¤ìŒ ì‘ì—… ê°€ëŠ¥ (ë…¼ë¸”ë¡œí‚¹)
```

**ê¶Œì¥ ì‚¬í•­**
- ìƒˆ ì½”ë“œëŠ” CompletableFuture ì‚¬ìš© (ë” ê°•ë ¥í•˜ê³  ìœ ì—°í•¨)
- ë ˆê±°ì‹œ ì½”ë“œ ìœ ì§€ë³´ìˆ˜ ì‹œì—ë§Œ Future ì‚¬ìš©

---

### 4. ThreadPool í¬ê¸°ëŠ” ì–´ë–»ê²Œ ì„¤ì •í•˜ë‚˜ìš”?

**ê¸°ë³¸ ê³µì‹**

```
I/O ì§‘ì•½ì  ì‘ì—… (ë„¤íŠ¸ì›Œí¬, DB, íŒŒì¼):
corePoolSize = CPU ì½”ì–´ ìˆ˜ * 2~4
maxPoolSize = corePoolSize * 2

CPU ì§‘ì•½ì  ì‘ì—… (ê³„ì‚°, ì•”í˜¸í™”):
corePoolSize = CPU ì½”ì–´ ìˆ˜
maxPoolSize = CPU ì½”ì–´ ìˆ˜ + 1
```

**ìƒì„¸ ê³„ì‚°**

```java
@Bean
public Executor taskExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

    int processors = Runtime.getRuntime().availableProcessors();
    log.info("CPU ì½”ì–´ ìˆ˜: {}", processors);

    // ì‘ì—… íŠ¹ì„±ì— ë”°ë¼ ì¡°ì •
    // ì˜ˆ: 8ì½”ì–´ ì„œë²„, I/O ì§‘ì•½ì  ì‘ì—… (ì´ë©”ì¼ ë°œì†¡)

    executor.setCorePoolSize(processors * 2);  // 16
    executor.setMaxPoolSize(processors * 4);   // 32
    executor.setQueueCapacity(1000);

    // í í¬ê¸° = maxPoolSize * ì˜ˆìƒ ëŒ€ê¸° ì‹œê°„ / ì²˜ë¦¬ ì‹œê°„
    // ì˜ˆ: ìµœëŒ€ 32 ìŠ¤ë ˆë“œ, í‰ê·  ëŒ€ê¸° 10ì´ˆ, ì²˜ë¦¬ 1ì´ˆ
    // queueCapacity = 32 * 10 / 1 = 320 (ì—¬ìœ ìˆê²Œ 1000)

    executor.initialize();
    return executor;
}
```

**ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê¸°ë°˜ íŠœë‹**

```java
@Test
void threadPoolLoadTest() {
    // ë‹¤ì–‘í•œ ì„¤ì •ìœ¼ë¡œ ë¶€í•˜ í…ŒìŠ¤íŠ¸
    int[] corePoolSizes = {10, 20, 30, 40};
    int[] queueCapacities = {100, 500, 1000};

    for (int core : corePoolSizes) {
        for (int queue : queueCapacities) {
            // ì„¤ì •
            executor.setCorePoolSize(core);
            executor.setQueueCapacity(queue);

            // ë¶€í•˜ ë°œìƒ
            long startTime = System.currentTimeMillis();
            for (int i = 0; i < 10000; i++) {
                executor.execute(() -> doWork());
            }
            long duration = System.currentTimeMillis() - startTime;

            log.info("Core={}, Queue={}, ì²˜ë¦¬ ì‹œê°„={}ms",
                core, queue, duration);

            // ìµœì  ì„¤ì • ì°¾ê¸°
        }
    }
}
```

---

### 5. ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ íŠ¸ëœì­ì…˜ì´ ì•ˆ ë¼ìš”

**ì›ì¸**
- @Async ë©”ì„œë“œëŠ” ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
- íŠ¸ëœì­ì…˜ì€ ìŠ¤ë ˆë“œ ë¡œì»¬ (ThreadLocal) ê¸°ë°˜
- ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œëŠ” íŠ¸ëœì­ì…˜ ì»¨í…ìŠ¤íŠ¸ ê³µìœ  ì•ˆ ë¨

**í•´ê²° ë°©ë²•**

```java
// âŒ ë¬¸ì œ ì½”ë“œ
@Transactional
@Async
public void asyncMethodWithTransaction() {
    // íŠ¸ëœì­ì…˜ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
    userRepository.save(user);
    orderRepository.save(order);
}

// âœ… í•´ê²° ë°©ë²•: ë¹„ë™ê¸° ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ íŠ¸ëœì­ì…˜ ë©”ì„œë“œ í˜¸ì¶œ
@Service
@RequiredArgsConstructor
public class GoodService {

    private final TransactionalService transactionalService;

    @Async
    public void asyncMethod() {
        // ë¹„ë™ê¸° ìŠ¤ë ˆë“œì—ì„œ íŠ¸ëœì­ì…˜ ë©”ì„œë“œ í˜¸ì¶œ
        transactionalService.doInTransaction();
    }
}

@Service
class TransactionalService {

    @Transactional
    public void doInTransaction() {
        // íŠ¸ëœì­ì…˜ ì •ìƒ ë™ì‘
        userRepository.save(user);
        orderRepository.save(order);
    }
}

// âœ… ê¶Œì¥ íŒ¨í„´: íŠ¸ëœì­ì…˜ ë¨¼ì €, ë¹„ë™ê¸°ëŠ” ë‚˜ì¤‘ì—
@Service
@RequiredArgsConstructor
public class RecommendedService {

    private final AsyncService asyncService;

    @Transactional
    public void processOrder(Order order) {
        // 1. ë™ê¸°ì ìœ¼ë¡œ DB ì‘ì—… (íŠ¸ëœì­ì…˜ ë‚´)
        orderRepository.save(order);
        paymentRepository.save(payment);

        // 2. ë¹„ë™ê¸°ë¡œ ì•Œë¦¼ (íŠ¸ëœì­ì…˜ ì™¸ë¶€)
        // íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥
    }

    // íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ì‹¤í–‰
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void sendNotificationAfterCommit(OrderCreatedEvent event) {
        asyncService.sendNotification(event.getOrder());
    }
}
```

---

### 6. @Scheduledì™€ Quartzì˜ ì°¨ì´ëŠ”?

**ë¹„êµ**

| íŠ¹ì§• | @Scheduled | Quartz |
|------|-----------|--------|
| ë³µì¡ë„ | ê°„ë‹¨ | ë³µì¡ |
| ì„¤ì • | ì–´ë…¸í…Œì´ì…˜ | XML/Java Config |
| ë™ì  ìŠ¤ì¼€ì¤„ ë³€ê²½ | ë¶ˆê°€ | ê°€ëŠ¥ |
| ë¶„ì‚° í™˜ê²½ ì§€ì› | ì—†ìŒ | ìˆìŒ (í´ëŸ¬ìŠ¤í„°ë§) |
| ìš°ì„ ìˆœìœ„ | ì—†ìŒ | ìˆìŒ |
| ë¯¸ìŠ¤íŒŒì´ì–´ ì²˜ë¦¬ | ì—†ìŒ | ìˆìŒ |
| ì˜ì†í™” | ì—†ìŒ | DB ì €ì¥ ê°€ëŠ¥ |

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**

```java
// @Scheduled - ê°„ë‹¨í•œ ì •ê¸° ì‘ì—…
@Scheduled(cron = "0 0 0 * * *")
public void simpleDaily Task() {
    // ë‹¨ìˆœ ë°°ì¹˜ ì‘ì—…
}

// Quartz - ë³µì¡í•œ ìš”êµ¬ì‚¬í•­
@Configuration
public class QuartzConfig {

    @Bean
    public JobDetail complexJobDetail() {
        return JobBuilder.newJob(ComplexJob.class)
            .withIdentity("complexJob")
            .storeDurably()
            .build();
    }

    @Bean
    public Trigger complexTrigger() {
        return TriggerBuilder.newTrigger()
            .forJob(complexJobDetail())
            .withIdentity("complexTrigger")
            .withSchedule(
                CronScheduleBuilder.cronSchedule("0 0 2 * * ?")
                    .withMisfireHandlingInstructionFireAndProceed()
            )
            .withPriority(10)  // ìš°ì„ ìˆœìœ„
            .build();
    }
}

// ë™ì  ìŠ¤ì¼€ì¤„ ë³€ê²½
public class DynamicScheduler {

    @Autowired
    private Scheduler scheduler;

    public void changeSchedule(String jobName, String newCron) throws SchedulerException {
        TriggerKey triggerKey = TriggerKey.triggerKey(jobName);
        CronTrigger newTrigger = TriggerBuilder.newTrigger()
            .withSchedule(CronScheduleBuilder.cronSchedule(newCron))
            .build();

        scheduler.rescheduleJob(triggerKey, newTrigger);
    }
}
```

**ì„ íƒ ê¸°ì¤€**
- ê°„ë‹¨í•œ ì •ê¸° ì‘ì—…: @Scheduled
- ë™ì  ìŠ¤ì¼€ì¤„ ë³€ê²½ í•„ìš”: Quartz
- ë¶„ì‚° í™˜ê²½ (ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤): Quartz + ë¶„ì‚° ë½
- ì‘ì—… ìš°ì„ ìˆœìœ„ í•„ìš”: Quartz

---

### 7. ë¹„ë™ê¸° ë©”ì„œë“œì˜ ì„±ëŠ¥ì„ ì–´ë–»ê²Œ ëª¨ë‹ˆí„°ë§í•˜ë‚˜ìš”?

**ëª¨ë‹ˆí„°ë§ êµ¬í˜„**

```java
@Configuration
public class AsyncMonitoringConfig {

    @Bean
    public Executor monitoredExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();

        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(500);
        executor.setThreadNamePrefix("Monitored-");

        // TaskDecoratorë¡œ ì‘ì—… ëª¨ë‹ˆí„°ë§
        executor.setTaskDecorator(new MonitoringTaskDecorator());

        executor.initialize();
        return executor;
    }
}

// ì‘ì—… ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
public class MonitoringTaskDecorator implements TaskDecorator {

    @Override
    public Runnable decorate(Runnable runnable) {
        return () -> {
            long startTime = System.currentTimeMillis();
            String threadName = Thread.currentThread().getName();

            try {
                log.info("[{}] ë¹„ë™ê¸° ì‘ì—… ì‹œì‘", threadName);
                runnable.run();

                long duration = System.currentTimeMillis() - startTime;
                log.info("[{}] ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ: {}ms", threadName, duration);

                // ë©”íŠ¸ë¦­ ê¸°ë¡
                metricsService.recordAsyncTaskDuration(duration);

            } catch (Exception e) {
                log.error("[{}] ë¹„ë™ê¸° ì‘ì—… ì‹¤íŒ¨", threadName, e);
                metricsService.incrementAsyncTaskFailure();
                throw e;
            }
        };
    }
}

// ìŠ¤ë ˆë“œ í’€ ìƒíƒœ ëª¨ë‹ˆí„°ë§
@Component
public class ThreadPoolMonitor {

    @Autowired
    @Qualifier("monitoredExecutor")
    private ThreadPoolTaskExecutor executor;

    @Scheduled(fixedRate = 30000)  // 30ì´ˆë§ˆë‹¤
    public void monitorThreadPool() {
        ThreadPoolExecutor threadPool = executor.getThreadPoolExecutor();

        int activeCount = threadPool.getActiveCount();
        int poolSize = threadPool.getPoolSize();
        int queueSize = threadPool.getQueue().size();
        long completedTaskCount = threadPool.getCompletedTaskCount();

        log.info("ThreadPool ìƒíƒœ: active={}, pool={}, queue={}, completed={}",
            activeCount, poolSize, queueSize, completedTaskCount);

        // ë©”íŠ¸ë¦­ ì „ì†¡ (Prometheus, InfluxDB ë“±)
        metricsService.recordThreadPoolStats(activeCount, poolSize, queueSize);

        // ê²½ê³  ì¡°ê±´ ì²´í¬
        if (queueSize > 400) {  // í 80% ì´ìƒ
            log.warn("ThreadPool í ìš©ëŸ‰ ë¶€ì¡±: {}/500", queueSize);
            alertService.sendAlert("ThreadPool ê³¼ë¶€í•˜ ìœ„í—˜");
        }

        if (activeCount == threadPool.getMaximumPoolSize()) {
            log.warn("ThreadPool ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ ë„ë‹¬");
            alertService.sendAlert("ThreadPool í¬í™”");
        }
    }
}

// Micrometer ì—°ë™ (Spring Boot Actuator)
@Configuration
public class MicrometerConfig {

    @Bean
    public MeterBinder threadPoolMetrics(ThreadPoolTaskExecutor executor) {
        return (registry) -> {
            ThreadPoolExecutor threadPool = executor.getThreadPoolExecutor();

            Gauge.builder("thread.pool.size", threadPool, ThreadPoolExecutor::getPoolSize)
                .register(registry);

            Gauge.builder("thread.pool.active", threadPool, ThreadPoolExecutor::getActiveCount)
                .register(registry);

            Gauge.builder("thread.pool.queue.size", threadPool.getQueue(), Collection::size)
                .register(registry);
        };
    }
}
```

---

## ë©´ì ‘ ì§ˆë¬¸

### ì£¼ë‹ˆì–´ ë ˆë²¨

**Q1. @Asyncì™€ @Scheduledì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

**A1.**
- @Async: ë©”ì„œë“œë¥¼ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ (í˜¸ì¶œ ì¦‰ì‹œ ë°˜í™˜, ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
- @Scheduled: ì •í•´ì§„ ì‹œê°„/ì£¼ê¸°ì— ìë™ìœ¼ë¡œ ë©”ì„œë“œ ì‹¤í–‰

ì˜ˆì‹œ:
```java
@Async  // í˜¸ì¶œ ì‹œ ì¦‰ì‹œ ë°˜í™˜, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
public void sendEmail() { }

@Scheduled(fixedRate = 10000)  // 10ì´ˆë§ˆë‹¤ ìë™ ì‹¤í–‰
public void healthCheck() { }
```

---

**Q2. fixedRateì™€ fixedDelayì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

**A2.**
- fixedRate: ì‹œì‘ ì‹œê°„ ê¸°ì¤€ ê³ ì • ê°„ê²© ì‹¤í–‰
- fixedDelay: ì¢…ë£Œ í›„ ê³ ì • ì‹œê°„ ëŒ€ê¸° í›„ ì‹¤í–‰

ì˜ˆì‹œ:
```java
// fixedRate: 10ì´ˆë§ˆë‹¤ ì‹œì‘ (ì‘ì—… ì‹œê°„ ë¬´ê´€)
@Scheduled(fixedRate = 10000)
public void task1() {
    // 5ì´ˆ ì†Œìš”
    // 00:00 ì‹œì‘ â†’ 00:10 ì‹œì‘ â†’ 00:20 ì‹œì‘
}

// fixedDelay: ì¢…ë£Œ í›„ 10ì´ˆ ëŒ€ê¸°
@Scheduled(fixedDelay = 10000)
public void task2() {
    // 5ì´ˆ ì†Œìš”
    // 00:00 ì‹œì‘ â†’ 00:05 ì™„ë£Œ â†’ 10ì´ˆ ëŒ€ê¸° â†’ 00:15 ì‹œì‘
}
```

---

**Q3. @Asyncê°€ ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œì—ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”?**

**A3.**
Spring AOPëŠ” í”„ë¡ì‹œ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ë°, ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```java
// ë™ì‘í•˜ì§€ ì•ŠìŒ
@Service
public class Service {
    public void method1() {
        method2();  // í”„ë¡ì‹œ ì•ˆ ê±°ì¹¨ - ë™ê¸° ì‹¤í–‰
    }

    @Async
    public void method2() { }
}

// í•´ê²°: ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬
@Service
public class Service1 {
    @Autowired Service2 service2;

    public void method1() {
        service2.method2();  // í”„ë¡ì‹œ ê±°ì¹¨ - ë¹„ë™ê¸° ì‹¤í–‰
    }
}

@Component
class Service2 {
    @Async
    public void method2() { }
}
```

---

### ì¤‘ê¸‰ ë ˆë²¨

**Q4. ThreadPoolTaskExecutorì˜ corePoolSize, maxPoolSize, queueCapacityì˜ ë™ì‘ ìˆœì„œë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

**A4.**
ì‘ì—… ë„ì°© ì‹œ ì²˜ë¦¬ ìˆœì„œ:

1. corePoolSizeë³´ë‹¤ ìŠ¤ë ˆë“œê°€ ì ìœ¼ë©´ â†’ ìƒˆ ìŠ¤ë ˆë“œ ìƒì„±
2. corePoolSizeë§Œí¼ ìŠ¤ë ˆë“œê°€ ìˆê³ , íì— ê³µê°„ì´ ìˆìœ¼ë©´ â†’ íì— ëŒ€ê¸°
3. íê°€ ê°€ë“ ì°¨ê³ , maxPoolSizeë³´ë‹¤ ìŠ¤ë ˆë“œê°€ ì ìœ¼ë©´ â†’ ìƒˆ ìŠ¤ë ˆë“œ ìƒì„±
4. maxPoolSizeë§Œí¼ ìŠ¤ë ˆë“œê°€ ìˆê³  íë„ ê°€ë“ ì°¨ë©´ â†’ RejectedExecutionHandler ì‹¤í–‰

ì˜ˆì‹œ:
```
corePoolSize=5, maxPoolSize=10, queueCapacity=100

ì‘ì—… 1-5: ì¦‰ì‹œ 5ê°œ ìŠ¤ë ˆë“œ ìƒì„±
ì‘ì—… 6-105: íì— 100ê°œ ëŒ€ê¸°
ì‘ì—… 106-110: ì¶”ê°€ 5ê°œ ìŠ¤ë ˆë“œ ìƒì„± (ì´ 10ê°œ)
ì‘ì—… 111: RejectedExecutionHandler í˜¸ì¶œ
```

---

**Q5. ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?**

**A5.**
ë‘ ê°€ì§€ ë°©ë²•:

1. AsyncUncaughtExceptionHandler êµ¬í˜„
```java
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {
    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return (ex, method, params) -> {
            log.error("ë¹„ë™ê¸° ì˜ˆì™¸: {}", method.getName(), ex);
            // ì•Œë¦¼ ì „ì†¡, ë©”íŠ¸ë¦­ ê¸°ë¡
        };
    }
}
```

2. CompletableFutureì˜ exceptionally ì‚¬ìš©
```java
@Async
public CompletableFuture<String> method() {
    return CompletableFuture.supplyAsync(() -> {
        // ì‘ì—…
    }).exceptionally(ex -> {
        log.error("ì‹¤íŒ¨", ex);
        return "ê¸°ë³¸ê°’";
    });
}
```

---

**Q6. ë¶„ì‚° í™˜ê²½ì—ì„œ @Scheduled ì‘ì—…ì˜ ì¤‘ë³µ ì‹¤í–‰ì„ ë°©ì§€í•˜ëŠ” ë°©ë²•ì€?**

**A6.**
ì„¸ ê°€ì§€ ë°©ë²•:

1. ShedLock ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
```java
@Scheduled(cron = "0 0 * * * *")
@SchedulerLock(name = "task", lockAtMostFor = "10m")
public void task() {
    // ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ë§Œ ì‹¤í–‰
}
```

2. Redis ë¶„ì‚° ë½
```java
@Scheduled(cron = "0 0 * * * *")
public void task() {
    boolean acquired = redisLock.tryLock("task:lock", 10, TimeUnit.MINUTES);
    if (!acquired) return;

    try {
        // ì‘ì—…
    } finally {
        redisLock.unlock("task:lock");
    }
}
```

3. ë°ì´í„°ë² ì´ìŠ¤ ë½
```java
@Scheduled(cron = "0 0 * * * *")
@Transactional
public void task() {
    Optional<Lock> lock = lockRepository.findByIdForUpdate("task");
    if (lock.isEmpty()) return;

    // ì‘ì—…
}
```

---

**Q7. ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê³  ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°©ë²•ì€?**

**A7.**

1. TaskDecoratorë¡œ ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
```java
executor.setTaskDecorator(runnable -> () -> {
    long start = System.currentTimeMillis();
    try {
        runnable.run();
    } finally {
        long duration = System.currentTimeMillis() - start;
        metrics.record(duration);
    }
});
```

2. Micrometerë¡œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
```java
@Bean
public MeterBinder threadPoolMetrics(ThreadPoolTaskExecutor executor) {
    return (registry) -> {
        Gauge.builder("thread.pool.active",
            executor.getThreadPoolExecutor(),
            ThreadPoolExecutor::getActiveCount)
        .register(registry);
    };
}
```

3. ì •ê¸°ì  ëª¨ë‹ˆí„°ë§
```java
@Scheduled(fixedRate = 30000)
public void monitor() {
    int active = executor.getActiveCount();
    int queue = executor.getQueueSize();

    if (queue > threshold) {
        alertService.send("í í¬í™”");
    }
}
```

---

## ğŸ“ ë©´ì ‘ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ë‹µì•ˆ

> **ë©´ì ‘ê´€ì—ê²Œ ê¹Šì€ ì¸ìƒì„ ë‚¨ê¸°ëŠ” ë‹µë³€ ì „ëµ**

### ğŸ“˜ ì£¼ë‹ˆì–´/ì‹ ì… ê°œë°œììš© ë‹µë³€

**Q1. @Asyncì™€ @Scheduledì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 30ì´ˆ - 1ë¶„

âœ… **ëª¨ë²” ë‹µë³€**:
"@AsyncëŠ” ë©”ì„œë“œë¥¼ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ, í˜¸ì¶œ ì¦‰ì‹œ ë°˜í™˜ë˜ê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. ë°˜ë©´ @ScheduledëŠ” ì •í•´ì§„ ì‹œê°„ì´ë‚˜ ì£¼ê¸°ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ë©”ì¼ ë°œì†¡ ê°™ì€ ì‘ì—…ì„ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ë ¤ë©´ @Asyncë¥¼ ì‚¬ìš©í•˜ê³ , ë§¤ì¼ ìì •ì— ë¡œê·¸ë¥¼ ì •ë¦¬í•˜ëŠ” ì‘ì—…ì²˜ëŸ¼ ì •ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì—ëŠ” @Scheduledë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

@AsyncëŠ” @EnableAsync ì„¤ì •ì´ í•„ìš”í•˜ê³ , @ScheduledëŠ” @EnableScheduling ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤."

ğŸ’¡ **ë” ìì„¸íˆ (ì‹œê°„ì´ ìˆë‹¤ë©´)**:
- @AsyncëŠ” CompletableFutureë¥¼ ë°˜í™˜í•˜ì—¬ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
- @ScheduledëŠ” fixedRate, fixedDelay, cron í‘œí˜„ì‹ ì§€ì›
- ì‹¤ë¬´ì—ì„œëŠ” ë‘ ê°€ì§€ë¥¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•˜ê¸°ë„ í•¨ (ì˜ˆ: ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë¹„ë™ê¸° ì‘ì—… í˜¸ì¶œ)

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"@AsyncëŠ” ë¹„ë™ê¸°ê³  @ScheduledëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ì…ë‹ˆë‹¤." (ë„ˆë¬´ ê°„ë‹¨í•¨)
"ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤." (í•™ìŠµ ì˜ì§€ ì—†ìŒ)

---

**Q2. fixedRateì™€ fixedDelayì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 1ë¶„ - 1ë¶„ 30ì´ˆ

âœ… **ëª¨ë²” ë‹µë³€**:
"fixedRateëŠ” ì‘ì—…ì˜ ì‹œì‘ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ê³ ì •ëœ ê°„ê²©ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ì´ê³ , fixedDelayëŠ” ì‘ì—…ì´ ì™„ë£Œëœ í›„ ê³ ì •ëœ ì‹œê°„ì„ ëŒ€ê¸°í•œ í›„ ë‹¤ìŒ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, fixedRate = 10000ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì‘ì—…ì´ 5ì´ˆ ê±¸ë¦¬ë“  15ì´ˆ ê±¸ë¦¬ë“  ë§¤ 10ì´ˆë§ˆë‹¤ ì‹œì‘ ì‹œë„ë¥¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ì—…ì´ ê¸´ ê²½ìš° ì¤‘ë³µ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°˜ë©´ fixedDelay = 10000ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì‘ì—…ì´ ì™„ë£Œëœ í›„ 10ì´ˆë¥¼ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ìŒ ì‘ì—…ì„ ì‹œì‘í•˜ë¯€ë¡œ ì¤‘ë³µ ì‹¤í–‰ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ì‘ì—… ì‹œê°„ì´ ê°„ê²©ë³´ë‹¤ ê¸´ ê²½ìš° fixedDelayë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤."

ğŸ’¡ **ì‹œê°ì  ì˜ˆì‹œ (ë©´ì ‘ê´€ì´ ê´€ì‹¬ ìˆì–´ ë³´ì´ë©´)**:
```
fixedRate = 10ì´ˆ, ì‘ì—… ì‹œê°„ = 5ì´ˆ:
00:00 ì‹œì‘ â†’ 00:05 ì™„ë£Œ
00:10 ì‹œì‘ â†’ 00:15 ì™„ë£Œ (10ì´ˆ ê°„ê²© ìœ ì§€)

fixedDelay = 10ì´ˆ, ì‘ì—… ì‹œê°„ = 5ì´ˆ:
00:00 ì‹œì‘ â†’ 00:05 ì™„ë£Œ â†’ 10ì´ˆ ëŒ€ê¸°
00:15 ì‹œì‘ â†’ 00:20 ì™„ë£Œ (ì™„ë£Œ í›„ 10ì´ˆ ëŒ€ê¸°)
```

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"fixedRateê°€ ë” ë¹ ë¦…ë‹ˆë‹¤." (ì˜ëª»ëœ ì´í•´)
"ë‘˜ ë‹¤ ë¹„ìŠ·í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤." (ì°¨ì´ì  ì´í•´ ë¶€ì¡±)

---

**Q3. @Asyncê°€ ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œì—ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”?**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 1ë¶„ - 1ë¶„ 30ì´ˆ

âœ… **ëª¨ë²” ë‹µë³€**:
"@AsyncëŠ” Spring AOP í”„ë¡ì‹œ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. Springì€ @Asyncê°€ ë¶™ì€ ë©”ì„œë“œë¥¼ ê°ì‹¸ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ”ë°, ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì´ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— @Asyncê°€ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í•´ê²° ë°©ë²•ì€ @Async ë©”ì„œë“œë¥¼ ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•˜ë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ Springì´ ìƒì„±í•œ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ê²Œ ë˜ì–´ ë¹„ë™ê¸°ë¡œ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ì±…ì„ ë¶„ë¦¬ ì›ì¹™ì—ë„ ë¶€í•©í•˜ë¯€ë¡œ ë¹„ë™ê¸° ì‘ì—…ì„ ë³„ë„ì˜ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì„¤ê³„ì…ë‹ˆë‹¤."

ğŸ’¡ **ì½”ë“œ ì˜ˆì‹œ (í™”ì´íŠ¸ë³´ë“œê°€ ìˆë‹¤ë©´)**:
```java
// ë™ì‘ ì•ˆ í•¨
class Service {
    public void method1() {
        method2(); // í”„ë¡ì‹œ ì•ˆ ê±°ì¹¨
    }
    @Async void method2() {}
}

// ë™ì‘í•¨
class Service1 {
    @Autowired Service2 service2;
    public void method1() {
        service2.method2(); // í”„ë¡ì‹œ ê±°ì¹¨
    }
}
class Service2 {
    @Async void method2() {}
}
```

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"Springì˜ ë²„ê·¸ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤." (ì˜ëª»ëœ ì´í•´)
"@Asyncë¥¼ ë‘ ë²ˆ ë¶™ì´ë©´ ë©ë‹ˆë‹¤." (ì˜ëª»ëœ í•´ê²°ì±…)

---

### ğŸ“— ì¤‘ê¸‰ ê°œë°œììš© ë‹µë³€

**Q4. ThreadPoolTaskExecutorì˜ corePoolSize, maxPoolSize, queueCapacityì˜ ë™ì‘ ìˆœì„œë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 2ë¶„ - 2ë¶„ 30ì´ˆ

âœ… **ëª¨ë²” ë‹µë³€**:
"ThreadPoolTaskExecutorëŠ” ì‘ì—…ì´ ë„ì°©í–ˆì„ ë•Œ ë‹¤ìŒ ìˆœì„œë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:

ì²«ì§¸, í˜„ì¬ ìŠ¤ë ˆë“œ ìˆ˜ê°€ corePoolSizeë³´ë‹¤ ì ìœ¼ë©´ ìƒˆ ìŠ¤ë ˆë“œë¥¼ ì¦‰ì‹œ ìƒì„±í•˜ì—¬ ì‘ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ë‘˜ì§¸, corePoolSizeë§Œí¼ ìŠ¤ë ˆë“œê°€ ìˆê³  ëª¨ë‘ ì‚¬ìš© ì¤‘ì´ë©´, ì‘ì—…ì„ íì— ì¶”ê°€í•©ë‹ˆë‹¤. íì— ì—¬ìœ  ê³µê°„ì´ ìˆëŠ” í•œ ê³„ì† íì— ìŒ“ì…ë‹ˆë‹¤.

ì…‹ì§¸, íê°€ ê°€ë“ ì°¨ê³  í˜„ì¬ ìŠ¤ë ˆë“œ ìˆ˜ê°€ maxPoolSizeë³´ë‹¤ ì ìœ¼ë©´, ì¶”ê°€ë¡œ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

ë„·ì§¸, maxPoolSizeë§Œí¼ ìŠ¤ë ˆë“œê°€ ìƒì„±ë˜ì–´ ìˆê³  íë„ ê°€ë“ ì°¬ ê²½ìš°, RejectedExecutionHandlerê°€ í˜¸ì¶œë˜ì–´ ì‘ì—…ì„ ê±°ë¶€í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì •ì±…ì„ ì ìš©í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, core=5, max=10, queue=100ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤ë©´:
- ì‘ì—… 1-5: ì¦‰ì‹œ 5ê°œ ìŠ¤ë ˆë“œ ìƒì„±
- ì‘ì—… 6-105: íì— 100ê°œ ëŒ€ê¸°
- ì‘ì—… 106-110: ì¶”ê°€ 5ê°œ ìŠ¤ë ˆë“œ ìƒì„± (ì´ 10ê°œ)
- ì‘ì—… 111: RejectedExecutionHandler í˜¸ì¶œ

ì‹¤ë¬´ì—ì„œëŠ” ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ì™€ ë¶€í•˜ íŒ¨í„´ì„ ê³ ë ¤í•˜ì—¬ ì ì ˆí•œ ê°’ì„ ì„¤ì •í•˜ê³ , ëª¨ë‹ˆí„°ë§í•˜ì—¬ ìµœì í™”í•©ë‹ˆë‹¤."

ğŸ’¡ **ì¶”ê°€ ì„¤ëª… (ë©´ì ‘ê´€ì´ ê´€ì‹¬ ìˆì–´ ë³´ì´ë©´)**:
- RejectedExecutionHandler ì •ì±…: AbortPolicy, CallerRunsPolicy, DiscardPolicy
- keepAliveSeconds: core ì´ìƒ ìƒì„±ëœ ìŠ¤ë ˆë“œì˜ ìœ íœ´ ì‹œê°„ ì œí•œ
- ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ìµœì  ì„¤ì • ì°¾ê¸°

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"maxPoolSizeë§Œí¼ ìŠ¤ë ˆë“œë¥¼ ë¨¼ì € ë§Œë“­ë‹ˆë‹¤." (ë™ì‘ ìˆœì„œ ì˜¤í•´)
"íëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." (ì˜ëª»ëœ ì´í•´)

---

**Q5. ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 2ë¶„ - 2ë¶„ 30ì´ˆ

âœ… **ëª¨ë²” ë‹µë³€**:
"ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œì ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ë‹¤ë¥¸ ì‘ì—…ì„ í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜ì ì¸ try-catchë¡œ ì¡ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì²« ë²ˆì§¸ëŠ” AsyncUncaughtExceptionHandlerë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. AsyncConfigurerì˜ getAsyncUncaughtExceptionHandler ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ê¸°ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ voidë¥¼ ë°˜í™˜í•˜ëŠ” @Async ë©”ì„œë“œì— ì í•©í•©ë‹ˆë‹¤.

ë‘ ë²ˆì§¸ëŠ” CompletableFutureì˜ exceptionally ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. @Async ë©”ì„œë“œê°€ CompletableFutureë¥¼ ë°˜í™˜í•˜ë„ë¡ í•˜ê³ , í˜¸ì¶œìê°€ exceptionallyë‚˜ handle ë©”ì„œë“œë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ê²°ê³¼ê°’ì´ í•„ìš”í•œ ê²½ìš°ì— ì í•©í•©ë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ë‘ ë°©ë²•ì„ í˜¼ìš©í•˜ë©°, ì˜ˆì™¸ ë°œìƒ ì‹œ ë¡œê·¸ ê¸°ë¡, ë©”íŠ¸ë¦­ ì§‘ê³„, Slack/Email ì•Œë¦¼ ë“±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì¤‘ìš”í•œ ì‘ì—…ì˜ ê²½ìš° ì¬ì‹œë„ ë¡œì§ë„ í•¨ê»˜ êµ¬í˜„í•©ë‹ˆë‹¤."

ğŸ’¡ **ì½”ë“œ ì˜ˆì‹œ**:
```java
// ë°©ë²• 1: AsyncUncaughtExceptionHandler
@Override
public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
    return (ex, method, params) -> {
        log.error("ë¹„ë™ê¸° ì˜ˆì™¸: {}", method.getName(), ex);
        alertService.sendAlert("ë¹„ë™ê¸° ì‘ì—… ì‹¤íŒ¨", ex);
    };
}

// ë°©ë²• 2: CompletableFuture
@Async
public CompletableFuture<String> asyncMethod() {
    return CompletableFuture.supplyAsync(() -> {
        // ì‘ì—…
    }).exceptionally(ex -> {
        log.error("ì‹¤íŒ¨", ex);
        return "ê¸°ë³¸ê°’";
    });
}
```

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"try-catchë¡œ ì¡ìœ¼ë©´ ë©ë‹ˆë‹¤." (ë¹„ë™ê¸° íŠ¹ì„± ì´í•´ ë¶€ì¡±)
"ì˜ˆì™¸ëŠ” ë°œìƒí•˜ì§€ ì•Šê²Œ ì½”ë”©í•´ì•¼ í•©ë‹ˆë‹¤." (í˜„ì‹¤ì„± ì—†ìŒ)

---

**Q6. ë¶„ì‚° í™˜ê²½ì—ì„œ @Scheduled ì‘ì—…ì˜ ì¤‘ë³µ ì‹¤í–‰ì„ ë°©ì§€í•˜ëŠ” ë°©ë²•ì€?**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 2ë¶„ - 3ë¶„

âœ… **ëª¨ë²” ë‹µë³€**:
"ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ë™ì‹œì— @Scheduled ì‘ì—…ì„ ì‹¤í–‰í•˜ë¯€ë¡œ, ë¶„ì‚° ë½ì„ ì‚¬ìš©í•˜ì—¬ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•´ì•¼ í•©ë‹ˆë‹¤. ì„¸ ê°€ì§€ ëŒ€í‘œì ì¸ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ì²« ë²ˆì§¸ëŠ” ShedLock ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. @SchedulerLock ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ê³ , lockAtMostForì™€ lockAtLeastFor ì˜µì…˜ìœ¼ë¡œ ë½ ìœ ì§€ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤. ShedLockì€ DB, Redis, Zookeeper ë“± ë‹¤ì–‘í•œ ë°±ì—”ë“œë¥¼ ì§€ì›í•˜ì—¬ ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ë²ˆì§¸ëŠ” Redis ë¶„ì‚° ë½ì„ ì§ì ‘ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. RedisTemplateì´ë‚˜ Redissonì„ ì‚¬ìš©í•˜ì—¬ ë½ì„ íšë“í•˜ê³ , ì‘ì—… ì™„ë£Œ í›„ í•´ì œí•©ë‹ˆë‹¤. tryLockìœ¼ë¡œ ë½ íšë“ ì‹œë„í•˜ê³ , ì‹¤íŒ¨í•˜ë©´ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ë¼ê³  íŒë‹¨í•˜ì—¬ ìŠ¤í‚µí•©ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë½ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. SELECT FOR UPDATEë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë³„ë„ì˜ ë½ í…Œì´ë¸”ì„ ê´€ë¦¬í•˜ì—¬ ë¶„ì‚° ë½ì„ êµ¬í˜„í•©ë‹ˆë‹¤. DBê°€ ë‹¨ì¼ ì¥ì• ì ì´ ë  ìˆ˜ ìˆì§€ë§Œ, ë³„ë„ì˜ ì¸í”„ë¼ ì—†ì´ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ShedLockì„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ë©°, Redisê°€ ì´ë¯¸ ìˆë‹¤ë©´ Redis ë½ì„, ê°„ë‹¨í•œ ê²½ìš°ì—ëŠ” DB ë½ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."

ğŸ’¡ **ê° ë°©ë²•ì˜ ì¥ë‹¨ì **:
- ShedLock: ê°„í¸í•¨, ë‹¤ì–‘í•œ ë°±ì—”ë“œ ì§€ì› / ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”
- Redis ë½: ë¹ ë¥´ê³  ì•ˆì •ì  / Redis ì¸í”„ë¼ í•„ìš”
- DB ë½: ì¶”ê°€ ì¸í”„ë¼ ë¶ˆí•„ìš” / ì„±ëŠ¥ ë‚®ìŒ, DBê°€ ë‹¨ì¼ ì¥ì• ì 

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” @Scheduledë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." (ì˜ëª»ëœ ì´í•´)
"í•œ ì¸ìŠ¤í„´ìŠ¤ì—ì„œë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤." (HA ë¯¸ê³ ë ¤)

---

**Q7. ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê³  ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°©ë²•ì€?**

â±ï¸ **ë‹µë³€ ì‹œê°„**: 2ë¶„ - 3ë¶„

âœ… **ëª¨ë²” ë‹µë³€**:
"ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì„±ëŠ¥ì„ íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê¸° ìœ„í•´ ì„¸ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì²« ë²ˆì§¸ëŠ” TaskDecoratorë¥¼ ì‚¬ìš©í•œ ì‘ì—… ì‹¤í–‰ ì‹œê°„ ì¸¡ì •ì…ë‹ˆë‹¤. ThreadPoolTaskExecutorì˜ setTaskDecorator ë©”ì„œë“œë¡œ ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…ì˜ ì‹œì‘ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ì¸¡ì •í•˜ê³ , ì†Œìš” ì‹œê°„ì„ ë©”íŠ¸ë¦­ìœ¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í‰ê·  ì‹¤í–‰ ì‹œê°„, ìµœëŒ€ ì‹¤í–‰ ì‹œê°„ ë“±ì„ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ë²ˆì§¸ëŠ” Spring Boot Actuatorì™€ Micrometerë¥¼ ì‚¬ìš©í•œ ìŠ¤ë ˆë“œ í’€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì…ë‹ˆë‹¤. ThreadPoolExecutorì˜ activeCount, poolSize, queueSize, completedTaskCount ë“±ì„ Gaugeë‚˜ Counterë¡œ ë“±ë¡í•˜ì—¬ Prometheusë‚˜ InfluxDBì— ì „ì†¡í•˜ê³ , Grafanaë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ëŠ” ì •ê¸°ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ ì•Œë¦¼ì…ë‹ˆë‹¤. @Scheduledë¥¼ ì‚¬ìš©í•˜ì—¬ 30ì´ˆë§ˆë‹¤ ìŠ¤ë ˆë“œ í’€ ìƒíƒœë¥¼ ì²´í¬í•˜ê³ , í ì‚¬ìš©ë¥ ì´ 80% ì´ìƒì´ê±°ë‚˜ ìŠ¤ë ˆë“œ í’€ì´ í¬í™” ìƒíƒœë©´ Slackì´ë‚˜ Emailë¡œ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ì´ ì„¸ ê°€ì§€ë¥¼ ëª¨ë‘ ì ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì¥ì•  ë°œìƒ ì „ì— ì„ ì œì ìœ¼ë¡œ ëŒ€ì‘í•©ë‹ˆë‹¤. ë˜í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì„ê³„ê°’ì„ ì„¤ì •í•˜ê³ , ìë™ ìŠ¤ì¼€ì¼ë§ ì •ì±…ì— í™œìš©í•©ë‹ˆë‹¤."

ğŸ’¡ **ì¶”ê°€ ëª¨ë‹ˆí„°ë§ ì§€í‘œ**:
- ì‘ì—… ì™„ë£Œìœ¨ (ì„±ê³µ/ì‹¤íŒ¨ ë¹„ìœ¨)
- ê±°ë¶€ëœ ì‘ì—… ìˆ˜ (RejectedExecutionException)
- í‰ê·  ëŒ€ê¸° ì‹œê°„ (íì—ì„œ ëŒ€ê¸°í•œ ì‹œê°„)
- ì²˜ë¦¬ëŸ‰ (TPS - Transactions Per Second)

âŒ **í”¼í•´ì•¼ í•  ë‹µë³€**:
"ë¡œê·¸ë§Œ ë³´ë©´ ë©ë‹ˆë‹¤." (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë¶€ì¬)
"ë¬¸ì œê°€ ìƒê¸°ë©´ ê·¸ë•Œ í™•ì¸í•©ë‹ˆë‹¤." (ì‚¬í›„ ëŒ€ì‘)

---

### ğŸ’¡ ë‹µë³€ ì „ëµ ë° íŒ

**ë‹µë³€ êµ¬ì¡°í™” (STAR ê¸°ë²• ì‘ìš©)**
1. **ì •ì˜**: ê¸°ìˆ  ê°œë…ì„ ëª…í™•íˆ ì„¤ëª…
2. **ì˜ˆì‹œ**: êµ¬ì²´ì ì¸ ì½”ë“œë‚˜ ì‹œë‚˜ë¦¬ì˜¤ ì œì‹œ
3. **ì¥ë‹¨ì **: ê° ë°©ë²•ì˜ ì¥ì ê³¼ ì œì•½ì‚¬í•­ ì„¤ëª…
4. **ì‹¤ë¬´ ê²½í—˜**: "ì‹¤ë¬´ì—ì„œëŠ”..." ìœ¼ë¡œ ì‹¤ì œ ì ìš© ì‚¬ë¡€ ì–¸ê¸‰

**ì£¼ë‹ˆì–´ ê°œë°œì ë‹µë³€ íŒ**
- ê¸°ë³¸ ê°œë…ì„ ì •í™•í•˜ê²Œ ì„¤ëª…
- í•™ìŠµí•œ ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ê¸°
- "ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤" ëŒ€ì‹  "ì•„ì§ í•™ìŠµ ì¤‘ì´ì§€ë§Œ, ì œê°€ ì´í•´í•œ ë°”ë¡œëŠ”..." ì‚¬ìš©
- ê³µì‹ ë¬¸ì„œë‚˜ ê°•ì˜ì—ì„œ ë°°ìš´ ë‚´ìš© ì¸ìš©

**ì¤‘ê¸‰ ê°œë°œì ë‹µë³€ íŒ**
- ê¸°ìˆ  ì„ íƒì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ ì„¤ëª…
- ì‹¤ë¬´ ê²½í—˜ ì‚¬ë¡€ êµ¬ì²´ì ìœ¼ë¡œ ê³µìœ 
- ì„±ëŠ¥ ìˆ˜ì¹˜ë‚˜ ê°œì„  íš¨ê³¼ë¥¼ ìˆ˜ì¹˜ë¡œ ì œì‹œ
- ëŒ€ì•ˆ ë¹„êµ ë° ìƒí™©ë³„ ìµœì  ì„ íƒ ì œì‹œ

**ì‹œê°„ ê´€ë¦¬**
- ì£¼ë‹ˆì–´ ì§ˆë¬¸: 30ì´ˆ - 1ë¶„ 30ì´ˆ
- ì¤‘ê¸‰ ì§ˆë¬¸: 2ë¶„ - 3ë¶„
- ë„ˆë¬´ ê¸¸ë©´ ìš”ì•½í•˜ê³ , ë©´ì ‘ê´€ì˜ ì¶”ê°€ ì§ˆë¬¸ ìœ ë„

**ì¶”ê°€ ì§ˆë¬¸ ëŒ€ë¹„**
- "ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”" â†’ ì½”ë“œ ì˜ˆì‹œë‚˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
- "ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ì…¨ë‚˜ìš”?" â†’ êµ¬ì²´ì ì¸ í”„ë¡œì íŠ¸ ê²½í—˜
- "ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ í•´ê²°í•˜ë‚˜ìš”?" â†’ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê²½í—˜

---

## ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ

### ğŸ“– ê³µì‹ ë¬¸ì„œ

**Spring Framework ê³µì‹ ë¬¸ì„œ**
- Task Execution and Scheduling: https://docs.spring.io/spring-framework/reference/integration/scheduling.html
- @Async ê³µì‹ ê°€ì´ë“œ: https://docs.spring.io/spring-framework/reference/integration/scheduling.html#scheduling-annotation-support-async
- ThreadPoolTaskExecutor API: https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html

**Java Concurrency ê³µì‹ ë¬¸ì„œ**
- ExecutorService: https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html
- CompletableFuture: https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html
- ThreadPoolExecutor: https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html

### ğŸ‡°ğŸ‡· í•œêµ­ì–´ ë¸”ë¡œê·¸ & ìë£Œ

**ìš°ì•„í•œí˜•ì œë“¤ ê¸°ìˆ  ë¸”ë¡œê·¸**
- "ë°°ë‹¬ì˜ë¯¼ì¡± ë¹„ë™ê¸° ì²˜ë¦¬ ì•„í‚¤í…ì²˜": https://techblog.woowahan.com/
- "ëŒ€ìš©ëŸ‰ ì•Œë¦¼ ë°œì†¡ ì‹œìŠ¤í…œ êµ¬ì¶•ê¸°"
- "Spring @Async í™œìš©í•œ ì„±ëŠ¥ ê°œì„  ì‚¬ë¡€"

**ì¹´ì¹´ì˜¤ ê¸°ìˆ  ë¸”ë¡œê·¸**
- "ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ë°œì†¡ ì‹œìŠ¤í…œì˜ ë¹„ë™ê¸° ì²˜ë¦¬": https://tech.kakao.com/
- "100ê°œ ë°°ì¹˜ ì‘ì—…ì˜ ìŠ¤ì¼€ì¤„ë§ ì „ëµ"
- "ThreadPool ìµœì í™” ì‚¬ë¡€"

**ë„¤ì´ë²„ D2**
- "ëŒ€ê·œëª¨ ì‹œìŠ¤í…œì˜ ë¹„ë™ê¸° ë©”ì‹œì§•": https://d2.naver.com/
- "Spring Async ì„±ëŠ¥ íŠœë‹"
- "CompletableFuture ì‹¤ì „ í™œìš©"

**í† ìŠ¤ ê¸°ìˆ  ë¸”ë¡œê·¸**
- "ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•": https://toss.tech/
- "ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ì¥ì•  ëŒ€ì‘"

### ğŸŒ ì˜ì–´ ìë£Œ

**Baeldung (ì¶”ì²œ!)**
- Spring @Async Guide: https://www.baeldung.com/spring-async
- Spring @Scheduled Guide: https://www.baeldung.com/spring-scheduled-tasks
- ThreadPoolTaskExecutor Guide: https://www.baeldung.com/spring-threadpooltaskexecutor
- CompletableFuture in Spring: https://www.baeldung.com/java-completablefuture

**Spring Blog**
- Async Method Execution: https://spring.io/guides/gs/async-method/
- Task Scheduling: https://spring.io/guides/gs/scheduling-tasks/

**DZone**
- "Mastering Spring @Async"
- "ThreadPool Best Practices"
- "CompletableFuture Patterns"

### ğŸ¥ ë™ì˜ìƒ ê°•ì˜

**ê¹€ì˜í•œë‹˜ ê°•ì˜ (ì¸í”„ëŸ°)**
- "ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê³ ê¸‰í¸" (ë¹„ë™ê¸°, ìŠ¤ë ˆë“œ ë¡œì»¬ ë“±)
- "ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸" (ë¹„ë™ê¸° ë©”ì¼ ë°œì†¡ ì˜ˆì œ)
- https://www.inflearn.com/users/@yh

**ë°±ê¸°ì„ ë‹˜ ê°•ì˜**
- "ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ í•µì‹¬ ê¸°ìˆ " (Task Execution íŒŒíŠ¸)
- "The Java, ë©€í‹°ìŠ¤ë ˆë“œì™€ ë™ì‹œì„±"
- https://www.inflearn.com/users/@whiteship

**YouTube ì±„ë„**
- í† í¬ONì„¸ë¯¸ë‚˜ - Spring ë¹„ë™ê¸° ì²˜ë¦¬ (NAVER D2)
- ìš°ì•„í•œTech - ë¹„ë™ê¸° ì•„í‚¤í…ì²˜
- ì¹´ì¹´ì˜¤ ê°œë°œì ì»¨í¼ëŸ°ìŠ¤ - ëŒ€ìš©ëŸ‰ ì‹œìŠ¤í…œ ì„¤ê³„

### ğŸ“š ì¶”ì²œ ë„ì„œ

**í•œêµ­ì–´ ë„ì„œ**
1. **"ìŠ¤í”„ë§ ë¶€íŠ¸ í•µì‹¬ ê°€ì´ë“œ"** - ì¥ì •ìš° ì €
   - Chapter 10: ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ìŠ¤ì¼€ì¤„ë§
   - ì‹¤ë¬´ ì˜ˆì œ ì¤‘ì‹¬

2. **"í† ë¹„ì˜ ìŠ¤í”„ë§ 3.1"** - ì´ì¼ë¯¼ ì €
   - ë¹„ë™ê¸° ì‹¤í–‰ê³¼ ìŠ¤ì¼€ì¤„ë§ (Vol. 2)
   - ê¹Šì´ ìˆëŠ” ì›ë¦¬ ì„¤ëª…

**ì˜ì–´ ë„ì„œ**
1. **"Spring in Action (6th Edition)"** - Craig Walls
   - Chapter 11: Working with asynchronous methods
   - ìµœì‹  Spring Boot ê¸°ì¤€

2. **"Java Concurrency in Practice"** - Brian Goetz
   - ThreadPool, Executor í”„ë ˆì„ì›Œí¬
   - ìë°” ë™ì‹œì„± ë°”ì´ë¸”

3. **"Modern Java in Action"** - Raoul-Gabriel Urma
   - CompletableFutureì™€ ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë°
   - Java 8+ ìµœì‹  ê¸°ëŠ¥

### ğŸ› ï¸ ì‹¤ìŠµ ë„êµ¬ & ë¼ì´ë¸ŒëŸ¬ë¦¬

**í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬**
```xml
<!-- Spring Boot Starter -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
</dependency>

<!-- Spring Boot Actuator (ëª¨ë‹ˆí„°ë§) -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>

<!-- Micrometer (ë©”íŠ¸ë¦­) -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>

<!-- ShedLock (ë¶„ì‚° ë½) -->
<dependency>
    <groupId>net.javacrumbs.shedlock</groupId>
    <artifactId>shedlock-spring</artifactId>
    <version>5.9.1</version>
</dependency>
<dependency>
    <groupId>net.javacrumbs.shedlock</groupId>
    <artifactId>shedlock-provider-redis-spring</artifactId>
    <version>5.9.1</version>
</dependency>
```

**ëª¨ë‹ˆí„°ë§ ë„êµ¬**
- **Prometheus**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (https://prometheus.io/)
- **Grafana**: ëŒ€ì‹œë³´ë“œ ì‹œê°í™” (https://grafana.com/)
- **Spring Boot Admin**: Spring Boot ì•± ëª¨ë‹ˆí„°ë§
- **JConsole/VisualVM**: ë¡œì»¬ JVM ëª¨ë‹ˆí„°ë§

**ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬**
- **JMeter**: HTTP ë¶€í•˜ í…ŒìŠ¤íŠ¸ (https://jmeter.apache.org/)
- **Gatling**: Scala ê¸°ë°˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- **k6**: JavaScript ê¸°ë°˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- **nGrinder**: ë„¤ì´ë²„ ì˜¤í”ˆì†ŒìŠ¤ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬

### ğŸ“ í•™ìŠµ ìˆœì„œ ê°€ì´ë“œ

**1ë‹¨ê³„: ê¸°ì´ˆ ë‹¤ì§€ê¸° (1-2ì£¼)**
- [ ] Java ë©€í‹°ìŠ¤ë ˆë“œ ê¸°ì´ˆ (Thread, Runnable, Executor)
- [ ] Spring @Async ê¸°ë³¸ ì‚¬ìš©ë²•
- [ ] @Scheduled ê¸°ë³¸ ì‚¬ìš©ë²• (fixedRate, fixedDelay, cron)
- [ ] ê°„ë‹¨í•œ ë¹„ë™ê¸° ì´ë©”ì¼ ë°œì†¡ ì˜ˆì œ êµ¬í˜„

**2ë‹¨ê³„: ì‹¬í™” í•™ìŠµ (2-3ì£¼)**
- [ ] ThreadPoolTaskExecutor ì„¤ì • ë° íŠœë‹
- [ ] CompletableFuture ì‹¬í™” (thenApply, thenCompose, allOf)
- [ ] AsyncUncaughtExceptionHandler ì˜ˆì™¸ ì²˜ë¦¬
- [ ] @Transactionalê³¼ @Async ì¡°í•©
- [ ] ì‹¤ì „ í”„ë¡œì íŠ¸: ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„

**3ë‹¨ê³„: ì‹¤ë¬´ ì ìš© (3-4ì£¼)**
- [ ] ShedLockìœ¼ë¡œ ë¶„ì‚° í™˜ê²½ ìŠ¤ì¼€ì¤„ë§
- [ ] Spring Boot Actuator + Micrometer ëª¨ë‹ˆí„°ë§
- [ ] Prometheus + Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ìµœì í™”
- [ ] ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ì‘ (ì¬ì‹œë„, ì„œí‚· ë¸Œë ˆì´ì»¤)

**4ë‹¨ê³„: ê³ ê¸‰ ì£¼ì œ (ì‹¬í™”)**
- [ ] Spring Batchì™€ ë¹„ë™ê¸° ì²˜ë¦¬ ì¡°í•©
- [ ] Reactive Programming (WebFlux, Reactor)
- [ ] ë©”ì‹œì§€ í ì—°ë™ (RabbitMQ, Kafka)
- [ ] ë¶„ì‚° ì‹œìŠ¤í…œ íŒ¨í„´ (Saga, Choreography)

### ğŸ”— ì»¤ë®¤ë‹ˆí‹° & Q&A

**í•œêµ­ ì»¤ë®¤ë‹ˆí‹°**
- KSUG (í•œêµ­ ìŠ¤í”„ë§ ì‚¬ìš©ì ëª¨ì„): https://www.ksug.org/
- ìë°”ì¹´í˜: https://www.javacafe.io/
- Okky: https://okky.kr/

**ê¸€ë¡œë²Œ ì»¤ë®¤ë‹ˆí‹°**
- Stack Overflow - Spring Tag: https://stackoverflow.com/questions/tagged/spring
- Spring Community Forum: https://spring.io/community
- Reddit r/SpringBoot: https://www.reddit.com/r/SpringBoot/

### ğŸ“ ì‹¤ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ê¸°ë³¸ ì‹¤ìŠµ**
- [ ] @Asyncë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° ë©”ì„œë“œ ì‘ì„±
- [ ] @Scheduledë¡œ ì •ê¸° ì‘ì—… êµ¬í˜„ (fixedRate, fixedDelay, cron)
- [ ] ThreadPoolTaskExecutor ì„¤ì • ë° ëª¨ë‹ˆí„°ë§
- [ ] CompletableFutureë¡œ ê²°ê³¼ ë°˜í™˜

**ì‹¬í™” ì‹¤ìŠµ**
- [ ] ìš°ì„ ìˆœìœ„ë³„ ìŠ¤ë ˆë“œ í’€ ë¶„ë¦¬
- [ ] ì¬ì‹œë„ ë¡œì§ êµ¬í˜„ (ì§€ìˆ˜ ë°±ì˜¤í”„)
- [ ] AsyncUncaughtExceptionHandler ì˜ˆì™¸ ì²˜ë¦¬
- [ ] TaskDecoratorë¡œ ì‹¤í–‰ ì‹œê°„ ì¸¡ì •

**ì‹¤ì „ ì‹¤ìŠµ**
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•
- [ ] ShedLockìœ¼ë¡œ ë¶„ì‚° ë½ ì ìš©
- [ ] Actuator + Micrometer ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [ ] Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ íŠœë‹

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ë‹¤ìŒ í•™ìŠµ ì£¼ì œ: Spring Batch

> **"ë¹„ë™ê¸° + ìŠ¤ì¼€ì¤„ë§ì„ ë§ˆìŠ¤í„°í–ˆë‹¤ë©´, ì´ì œ ëŒ€ìš©ëŸ‰ ë°°ì¹˜ ì²˜ë¦¬ì— ë„ì „í•˜ì„¸ìš”!"**

**ì™œ Spring Batchë¥¼ ë°°ì›Œì•¼ í•˜ë‚˜ìš”?**

ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ìŠ¤ì¼€ì¤„ë§ì„ ë°°ì› ë‹¤ë©´, ë‹¤ìŒ ë‹¨ê³„ëŠ” **ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ë°°ì¹˜ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤.

```
í˜„ì¬ í•™ìŠµ (ë¹„ë™ê¸° + ìŠ¤ì¼€ì¤„ë§):
- ë‹¨ê±´ ì‘ì—…ì„ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬
- ì •ê¸°ì ìœ¼ë¡œ ì‘ì—… ì‹¤í–‰
- ìˆ˜ë§Œ ê±´ ê·œëª¨ì˜ ì‘ì—… ì²˜ë¦¬

ë‹¤ìŒ í•™ìŠµ (Spring Batch):
- ìˆ˜ë°±ë§Œ ê±´ ì´ìƒì˜ ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬
- Chunk ë‹¨ìœ„ë¡œ íš¨ìœ¨ì ì¸ íŠ¸ëœì­ì…˜ ê´€ë¦¬
- ì‹¤íŒ¨ ì‹œ ì¬ì‹œì‘, ìŠ¤í‚µ, ì¬ì‹œë„ ë“± ë³µì¡í•œ í”Œë¡œìš° ì œì–´
- ë³‘ë ¬ ì²˜ë¦¬ ë° íŒŒí‹°ì…”ë‹ìœ¼ë¡œ ì„±ëŠ¥ ê·¹ëŒ€í™”
```

**Spring Batchë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤**

1. **ëŒ€ìš©ëŸ‰ ì •ì‚° ì‹œìŠ¤í…œ**
   ```java
   @Bean
   public Job dailySettlementJob() {
       return jobBuilderFactory.get("dailySettlement")
           .start(readOrders())    // 100ë§Œ ê±´ ì£¼ë¬¸ ì½ê¸°
           .next(calculate())       // ì •ì‚° ê¸ˆì•¡ ê³„ì‚°
           .next(saveResults())     // ê²°ê³¼ ì €ì¥
           .build();
   }
   ```

2. **ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜**
   ```java
   @Bean
   public Step migrateDataStep() {
       return stepBuilderFactory.get("migrate")
           .<OldData, NewData>chunk(1000)  // 1000ê±´ì”© ì²˜ë¦¬
           .reader(oldDbReader())
           .processor(dataConverter())
           .writer(newDbWriter())
           .build();
   }
   ```

3. **ë¦¬í¬íŠ¸ ìƒì„±**
   ```java
   @Scheduled(cron = "0 0 1 * * *")  // ë§¤ì¼ ìƒˆë²½ 1ì‹œ
   public void generateMonthlyReport() {
       jobLauncher.run(monthlyReportJob,
           new JobParametersBuilder()
               .addLocalDate("reportDate", LocalDate.now())
               .toJobParameters()
       );
   }
   ```

**ë¹„ë™ê¸° vs Spring Batch ë¹„êµ**

| íŠ¹ì„± | @Async + @Scheduled | Spring Batch |
|------|---------------------|--------------|
| ë°ì´í„° ê·œëª¨ | ìˆ˜ë§Œ ê±´ | ìˆ˜ë°±ë§Œ ê±´ ì´ìƒ |
| íŠ¸ëœì­ì…˜ | ì „ì²´ or ê°œë³„ | Chunk ë‹¨ìœ„ |
| ì‹¤íŒ¨ ì²˜ë¦¬ | ì¬ì‹œë„ ë¡œì§ ì§ì ‘ êµ¬í˜„ | Skip, Retry, Restart ë‚´ì¥ |
| ë³‘ë ¬ ì²˜ë¦¬ | ThreadPool | Multi-thread, Partitioning |
| ëª¨ë‹ˆí„°ë§ | ì§ì ‘ êµ¬í˜„ | JobRepository ê¸°ë°˜ ìë™ ì¶”ì  |
| ì‚¬ìš© ì‚¬ë¡€ | ì•Œë¦¼, ì´ë©”ì¼, ê°„ë‹¨í•œ ìŠ¤ì¼€ì¤„ ì‘ì—… | ì •ì‚°, ë§ˆì´ê·¸ë ˆì´ì…˜, ëŒ€ìš©ëŸ‰ ETL |

**í•™ìŠµ ë¡œë“œë§µ**

```
âœ… 01. IoC ì»¨í…Œì´ë„ˆ
âœ… 02. DI (ì˜ì¡´ì„± ì£¼ì…)
âœ… 03. Bean ìƒëª…ì£¼ê¸°
âœ… 04. Configuration
âœ… 05. ì–´ë…¸í…Œì´ì…˜ ìƒì„¸
âœ… 06. AOP (ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°)
âœ… 07. Transaction
âœ… 08. SpEL & Properties
âœ… 09. @Async & @Scheduled          â† í˜„ì¬ ìœ„ì¹˜

â†’ 10. Spring Batch                 â† ë‹¤ìŒ ë‹¨ê³„
   11. Spring Integration (EIP)
   12. Spring WebFlux (Reactive)
   13. Spring Cloud (MSA)
   14. Spring Security ì‹¬í™”
```

**ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤: ë¹„ë™ê¸° + Batch ì¡°í•©**

```java
// ë¹„ë™ê¸°ë¡œ ë°°ì¹˜ ì‘ì—… ì‹¤í–‰
@Service
@RequiredArgsConstructor
public class ReportService {

    private final JobLauncher jobLauncher;
    private final Job monthlyReportJob;

    // 1. APIë¡œ ë¦¬í¬íŠ¸ ìš”ì²­ ë°›ìŒ (ì¦‰ì‹œ ì‘ë‹µ)
    public Long requestReport(ReportRequest request) {
        Long requestId = saveRequest(request);

        // 2. ë°°ì¹˜ ì‘ì—… ë¹„ë™ê¸° ì‹¤í–‰
        generateReportAsync(requestId);

        return requestId;
    }

    // 3. ëŒ€ìš©ëŸ‰ ë¦¬í¬íŠ¸ ìƒì„± (ë°±ê·¸ë¼ìš´ë“œ)
    @Async
    public void generateReportAsync(Long requestId) {
        try {
            jobLauncher.run(monthlyReportJob,
                new JobParametersBuilder()
                    .addLong("requestId", requestId)
                    .addLong("timestamp", System.currentTimeMillis())
                    .toJobParameters()
            );

            // 4. ì™„ë£Œ ì•Œë¦¼
            notificationService.sendEmail("ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ");
        } catch (Exception e) {
            log.error("ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨", e);
        }
    }
}
```

**Spring Batch í•µì‹¬ ê°œë… ë¯¸ë¦¬ë³´ê¸°**

1. **Job**: ì „ì²´ ë°°ì¹˜ ì‘ì—… ë‹¨ìœ„
2. **Step**: Jobì„ êµ¬ì„±í•˜ëŠ” ë‹¨ê³„
3. **ItemReader**: ë°ì´í„° ì½ê¸°
4. **ItemProcessor**: ë°ì´í„° ì²˜ë¦¬/ë³€í™˜
5. **ItemWriter**: ë°ì´í„° ì €ì¥
6. **Chunk**: íŠ¸ëœì­ì…˜ ë‹¨ìœ„ (ì˜ˆ: 1000ê±´ì”©)
7. **JobRepository**: ì‹¤í–‰ ì´ë ¥ ê´€ë¦¬

**ë‹¤ìŒ í•™ìŠµ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [x] @Asyncë¡œ ë¹„ë™ê¸° ë©”ì„œë“œ ì‘ì„± ê°€ëŠ¥
- [x] @Scheduledë¡œ ì •ê¸° ì‘ì—… êµ¬í˜„ ê°€ëŠ¥
- [x] ThreadPoolTaskExecutor ì„¤ì • ë° íŠœë‹ ì´í•´
- [x] CompletableFutureë¡œ ê²°ê³¼ ì²˜ë¦¬ ê°€ëŠ¥
- [x] ë¹„ë™ê¸° ì˜ˆì™¸ ì²˜ë¦¬ ë°©ë²• ì´í•´
- [x] ë¶„ì‚° í™˜ê²½ì—ì„œ ìŠ¤ì¼€ì¤„ë§ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ ë°©ë²• ì´í•´
- [x] ì‹¤ì „ í”„ë¡œì íŠ¸ (ì•Œë¦¼ ì‹œìŠ¤í…œ) êµ¬í˜„ ê²½í—˜
- [ ] Spring Batch ê°œë… ì˜ˆìŠµ

**í•™ìŠµ ë™ê¸° ë¶€ì—¬**

> **"ëŒ€ìš©ëŸ‰ ì •ì‚° ì‹œìŠ¤í…œ, ìˆ˜ë°±ë§Œ ê±´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜, ë³µì¡í•œ ETL íŒŒì´í”„ë¼ì¸..."**
>
> **ì´ëŸ° ì‘ì—…ë“¤ì„ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´, Spring BatchëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!**

**ì‹¤ë¬´ ì ìš© ì‚¬ë¡€**
- ë„¤ì´ë²„: ì¼ì¼ 1ì–µ ê±´ ì´ìƒì˜ ë¡œê·¸ ì§‘ê³„
- ì¹´ì¹´ì˜¤: ìˆ˜ì²œë§Œ ì‚¬ìš©ì ëŒ€ìƒ ë°°ì¹˜ ì•Œë¦¼
- ì¿ íŒ¡: ìˆ˜ë°±ë§Œ ê±´ ì£¼ë¬¸ ì •ì‚° ì²˜ë¦¬
- í† ìŠ¤: ëŒ€ëŸ‰ ê¸ˆìœµ ê±°ë˜ ë°ì´í„° ì²˜ë¦¬

---

## í•™ìŠµ ë§ˆë¬´ë¦¬

### í•µì‹¬ ìš”ì•½

1. **@Asyncë¡œ ë¹„ë™ê¸° ì²˜ë¦¬**
   - @EnableAsync í•„ìˆ˜
   - ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ í˜¸ì¶œ
   - CompletableFuture ì‚¬ìš© ê¶Œì¥

2. **@Scheduledë¡œ ì •ê¸° ì‘ì—…**
   - fixedRate: ì‹œì‘ ì‹œê°„ ê¸°ì¤€
   - fixedDelay: ì¢…ë£Œ í›„ ëŒ€ê¸°
   - cron: ë³µì¡í•œ ìŠ¤ì¼€ì¤„

3. **ThreadPool ì„¤ì •**
   - I/O ì‘ì—…: corePoolSize = CPU * 2~4
   - CPU ì‘ì—…: corePoolSize = CPU
   - ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ìµœì í™”

4. **ì˜ˆì™¸ ì²˜ë¦¬**
   - AsyncUncaughtExceptionHandler êµ¬í˜„
   - CompletableFuture.exceptionally ì‚¬ìš©
   - ì¬ì‹œë„ ë¡œì§ êµ¬í˜„

5. **ì‹¤ë¬´ íŒ¨í„´**
   - íŠ¸ëœì­ì…˜ ë¨¼ì €, ë¹„ë™ê¸°ëŠ” ë‚˜ì¤‘ì—
   - ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” ë½ ì‚¬ìš©
   - ëª¨ë‹ˆí„°ë§ í•„ìˆ˜

### ë‹¤ìŒ í•™ìŠµ ì£¼ì œ

- Spring Batch (ëŒ€ìš©ëŸ‰ ë°°ì¹˜ ì²˜ë¦¬)
- Spring Integration (EIP íŒ¨í„´)
- Reactive Programming (WebFlux)

ì¶•í•˜í•©ë‹ˆë‹¤! Spring Core ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ìŠ¤ì¼€ì¤„ë§ì„ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤! ğŸ‰
