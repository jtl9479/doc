# 36ì¥ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ (GC) - Part 3: ë©´ì ‘ ì§ˆë¬¸

## ğŸ¤ ë©´ì ‘ ì§ˆë¬¸ TOP 3

### Q1. Minor GCì™€ Major GCì˜ ì°¨ì´ëŠ”?

**ë‹µë³€**:
```
Minor GC (Young Generation):
- Eden + Survivor ì˜ì—­ ëŒ€ìƒ
- ìì£¼ ë°œìƒ (ìˆ˜ì´ˆë§ˆë‹¤)
- ë¹ ë¥¸ ì†ë„ (ìˆ˜ ms)
- Stop-The-World ì§§ìŒ
- ëŒ€ë¶€ë¶„ ê°ì²´ê°€ ì£½ìŒ (ë‹¨ëª… ê°ì²´)

Major GC (Old Generation):
- Old Generation ëŒ€ìƒ
- ê°€ë” ë°œìƒ
- ëŠë¦° ì†ë„ (ìˆ˜ë°± ms ~ ì´ˆ)
- Stop-The-World ê¹€
- Full GC í¬í•¨

ì˜ˆì‹œ:
[GC (Allocation Failure) [PSYoungGen: 2048K->256K(2560K)]
   â†’ Minor GC, Youngë§Œ ì •ë¦¬

[Full GC (Ergonomics) [PSYoungGen: 256K->0K]
[ParOldGen: 7000K->5000K(7168K)]
   â†’ Major GC, ì „ì²´ ì •ë¦¬
```

### Q2. G1 GCê°€ ë¬´ì—‡ì´ê³  ì™œ ê¸°ë³¸ GCê°€ ë˜ì—ˆë‚˜?

**ë‹µë³€**:
```
G1 GC (Garbage First):
- Java 9+ì˜ ê¸°ë³¸ GC
- Region ê¸°ë°˜ GC

íŠ¹ì§•:
1. Heapì„ ì‘ì€ Regionìœ¼ë¡œ ë¶„í• 
   - Young/Oldë¥¼ ê³ ì • ì˜ì—­ì´ ì•„ë‹Œ Regionìœ¼ë¡œ ê´€ë¦¬
   - 2048ê°œ Region (ë³´í†µ 1~32MB)

2. ì˜ˆì¸¡ ê°€ëŠ¥í•œ pause time
   - -XX:MaxGCPauseMillis=200 (ëª©í‘œ ì„¤ì •)
   - ëª©í‘œì— ë§ì¶° GC ìˆ˜í–‰

3. í° Heapì— ì í•©
   - 6GB ì´ìƒ ê¶Œì¥
   - ìˆ˜ì‹­ GBë„ íš¨ìœ¨ì  ì²˜ë¦¬

4. ì ì§„ì  ì •ë¦¬
   - ê°€ë¹„ì§€ ë§ì€ Region ìš°ì„  (Garbage First)
   - ì „ì²´ Heap ìŠ¤ìº” ë¶ˆí•„ìš”

ê¸°ì¡´ CMS ëŒ€ë¹„ ì¥ì :
- Compaction (ë©”ëª¨ë¦¬ ë‹¨í¸í™” í•´ê²°)
- ë” ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì„±ëŠ¥
```

### Q3. OutOfMemoryErrorê°€ ë°œìƒí•˜ëŠ” ì›ì¸ê³¼ í•´ê²° ë°©ë²•ì€?

**ë‹µë³€**:
```
ì›ì¸:
1. Heap ë¶€ì¡±
   - java.lang.OutOfMemoryError: Java heap space
   - ê°ì²´ê°€ ë„ˆë¬´ ë§ìŒ

2. Metaspace ë¶€ì¡±
   - java.lang.OutOfMemoryError: Metaspace
   - í´ë˜ìŠ¤ê°€ ë„ˆë¬´ ë§ìŒ

3. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
   - ì‚¬ìš© ì•ˆ í•˜ëŠ” ê°ì²´ê°€ ê³„ì† ì°¸ì¡°ë¨

í•´ê²° ë°©ë²•:

1. Heap í¬ê¸° ì¦ê°€
   -Xmx4g â†’ -Xmx8g

2. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì°¾ê¸°
   // Heap dump ìƒì„±
   -XX:+HeapDumpOnOutOfMemoryError
   -XX:HeapDumpPath=/logs/heapdump.hprof

   // MATë¡œ ë¶„ì„
   - Leak Suspects Report
   - Dominator Tree í™•ì¸

3. ì½”ë“œ ìµœì í™”
   âŒ ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„±
   List<Integer> list = new ArrayList<>();
   for (int i = 0; i < 1000000; i++) {
       list.add(i);  // 100ë§Œ ê°œ Integer ê°ì²´
   }

   âœ… primitive ë°°ì—´
   int[] array = new int[1000000];

4. ì»¬ë ‰ì…˜ ì •ë¦¬
   // WeakHashMap ì‚¬ìš©
   private Map<Key, Value> cache = new WeakHashMap<>();

   // ë˜ëŠ” ì£¼ê¸°ì  ì •ë¦¬
   if (cache.size() > MAX_SIZE) {
       cache.clear();
   }
```

---

## ğŸ“ GC íŠœë‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

```java
// âœ… 1. GC ë¡œê·¸ í™œì„±í™”
-Xlog:gc*:file=gc.log:time,uptime,level,tags

// âœ… 2. OOM ì‹œ Heap dump
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/logs/heapdump.hprof

// âœ… 3. ì ì ˆí•œ Heap í¬ê¸°
-Xms4g -Xmx4g  // ê°™ì€ ê°’ìœ¼ë¡œ

// âœ… 4. G1 GC ì„¤ì • (ê¸°ë³¸)
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200

// âœ… 5. GC ìŠ¤ë ˆë“œ ì¡°ì •
-XX:ConcGCThreads=4
-XX:ParallelGCThreads=8
```

---

## ğŸ’¡ GC ëª¨ë‹ˆí„°ë§ ë„êµ¬

### 1. jstat
```bash
# GC í†µê³„ (1ì´ˆë§ˆë‹¤)
jstat -gc <pid> 1000

# ê²°ê³¼:
S0C    S1C    EC       OU       YGC   YGCT    FGC    FGCT
2560   2560   20480    5000     100   0.500   5      1.000
```

### 2. jmap
```bash
# Heap ìš”ì•½
jmap -heap <pid>

# Heap dump
jmap -dump:format=b,file=heap.bin <pid>
```

### 3. jvisualvm
```
- GUI ë„êµ¬
- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- GC ì‹œê°í™”
- Heap dump ë¶„ì„
```

### 4. GC ë¡œê·¸ ë¶„ì„
```bash
# GCeasy (ì˜¨ë¼ì¸)
https://gceasy.io

# GCViewer (ë¡œì»¬)
java -jar gcviewer.jar gc.log
```

---

## ğŸ’¡ ì‹¤ì „ GC ìµœì í™” ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤: ì›¹ ì„œë²„ ì‘ë‹µ ì§€ì—°
```
ì¦ìƒ:
- ì£¼ê¸°ì ìœ¼ë¡œ 500ms ì´ìƒ ì§€ì—°
- GC ë¡œê·¸ì—ì„œ Full GC ë¹ˆë²ˆ

ì›ì¸ ë¶„ì„:
[Full GC 18.234s] â†’ Old Generation ê°€ë“ ì°¸

í•´ê²°:
1. Heap í¬ê¸° ì¦ê°€
   -Xms2g -Xmx2g â†’ -Xms4g -Xmx4g

2. G1 GCë¡œ ì „í™˜ + pause time ëª©í‘œ
   -XX:+UseG1GC -XX:MaxGCPauseMillis=100

3. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì œê±°
   - MATë¡œ Heap dump ë¶„ì„
   - ìºì‹œ í¬ê¸° ì œí•œ ì¶”ê°€

ê²°ê³¼:
- Full GC ê±°ì˜ ì—†ìŒ
- í‰ê·  ì‘ë‹µ ì‹œê°„ 50ms ì´í•˜
- 99 percentile 150ms ì´í•˜
```

---

## ğŸ¯ GC ì„ íƒ ê°€ì´ë“œ

```
ì‘ì€ Heap (<2GB):
â†’ Serial GC

ì¤‘ê°„ Heap (2~6GB):
â†’ Parallel GC (ì²˜ë¦¬ëŸ‰ ì¤‘ì‹œ)
â†’ G1 GC (ì§€ì—°ì‹œê°„ ì¤‘ì‹œ)

í° Heap (6GB+):
â†’ G1 GC (ê¸°ë³¸ ì„ íƒ)

ì´ˆì €ì§€ì—° ìš”êµ¬ (10ms ì´í•˜):
â†’ ZGC / Shenandoah (Java 11+)

ì»¨í…Œì´ë„ˆ í™˜ê²½:
â†’ G1 GC + ì ì ˆí•œ Heap í¬ê¸°
â†’ -XX:+UseContainerSupport
```

**ì‹œë¦¬ì¦ˆ ì™„ë£Œ**: 29-36ì¥ Java ê³ ê¸‰ ê°œë… ë§ˆìŠ¤í„°! ğŸŠğŸ‰
