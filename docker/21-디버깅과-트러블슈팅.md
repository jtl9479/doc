# 21. ë””ë²„ê¹… ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

## ëª©ì°¨
1. [Docker ë””ë²„ê¹… ê¸°ì´ˆ](#docker-ë””ë²„ê¹…-ê¸°ì´ˆ)
2. [ì»¨í…Œì´ë„ˆ ë¡œê·¸ ë¶„ì„](#ì»¨í…Œì´ë„ˆ-ë¡œê·¸-ë¶„ì„)
3. [ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²€ì‚¬](#ì»¨í…Œì´ë„ˆ-ë‚´ë¶€-ê²€ì‚¬)
4. [ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…](#ë„¤íŠ¸ì›Œí¬-ë””ë²„ê¹…)
5. [ì„±ëŠ¥ ë¬¸ì œ ì§„ë‹¨](#ì„±ëŠ¥-ë¬¸ì œ-ì§„ë‹¨)
6. [ì´ë¯¸ì§€ ë¬¸ì œ í•´ê²°](#ì´ë¯¸ì§€-ë¬¸ì œ-í•´ê²°)
7. [ë³¼ë¥¨ ë¬¸ì œ í•´ê²°](#ë³¼ë¥¨-ë¬¸ì œ-í•´ê²°)
8. [ì¼ë°˜ì ì¸ ì˜¤ë¥˜ íŒ¨í„´](#ì¼ë°˜ì ì¸-ì˜¤ë¥˜-íŒ¨í„´)
9. [ê³ ê¸‰ ë””ë²„ê¹… ê¸°ë²•](#ê³ ê¸‰-ë””ë²„ê¹…-ê¸°ë²•)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## Docker ë””ë²„ê¹… ê¸°ì´ˆ

### ë””ë²„ê¹… ë§ˆì¸ë“œì…‹

**ì‹¤ìƒí™œ ë¹„ìœ **: íƒì •ì˜ ì‚¬ê±´ ìˆ˜ì‚¬

```
ì¦ìƒ ë°œê²¬ â†’ ë‹¨ì„œ ìˆ˜ì§‘ â†’ ê°€ì„¤ ìˆ˜ë¦½ â†’ ê²€ì¦ â†’ í•´ê²°

Docker ë””ë²„ê¹…ë„ ë™ì¼:
1. ë¬´ì—‡ì´ ë¬¸ì œì¸ê°€? (ì¦ìƒ)
2. ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ê°€? (ìœ„ì¹˜)
3. ì–¸ì œ ë°œìƒí–ˆëŠ”ê°€? (ì‹œê°„)
4. ì™œ ë°œìƒí–ˆëŠ”ê°€? (ì›ì¸)
5. ì–´ë–»ê²Œ í•´ê²°í•˜ë‚˜? (í•´ê²°ì±…)
```

### ê¸°ë³¸ ë””ë²„ê¹… ëª…ë ¹ì–´

```bash
# 1. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps -a

# 2. ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
docker logs <container_id>

# 3. ì»¨í…Œì´ë„ˆ ìƒì„¸ ì •ë³´
docker inspect <container_id>

# 4. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì†
docker exec -it <container_id> sh

# 5. í”„ë¡œì„¸ìŠ¤ í™•ì¸
docker top <container_id>

# 6. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
docker stats <container_id>

# 7. íŒŒì¼ ì‹œìŠ¤í…œ ë³€ê²½ ì‚¬í•­
docker diff <container_id>

# 8. ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
docker events
```

### ë””ë²„ê¹… ì›Œí¬í”Œë¡œìš°

```
ë¬¸ì œ ë°œìƒ
    â†“
1. docker ps -a (ìƒíƒœ í™•ì¸)
    â†“
    ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì¸ê°€?
    â”œâ”€ Yes â†’ 2. docker logs (ë¡œê·¸ í™•ì¸)
    â”‚           â†“
    â”‚        ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
    â”‚           â†“
    â”‚        3. docker exec (ë‚´ë¶€ ì§„ì…)
    â”‚           â†“
    â”‚        í™˜ê²½ ë³€ìˆ˜, íŒŒì¼, ë„¤íŠ¸ì›Œí¬ í™•ì¸
    â”‚
    â””â”€ No â†’ Exit Code í™•ì¸
              â†“
           docker logs (ì¢…ë£Œ ì›ì¸)
              â†“
           Dockerfile/compose ê²€í† 
```

---

## ì»¨í…Œì´ë„ˆ ë¡œê·¸ ë¶„ì„

### ë¡œê·¸ í™•ì¸ ëª…ë ¹ì–´

```bash
# ê¸°ë³¸ ë¡œê·¸ í™•ì¸
docker logs <container_id>

# ì‹¤ì‹œê°„ ë¡œê·¸ (tail -f)
docker logs -f <container_id>

# ìµœê·¼ Nì¤„ë§Œ í™•ì¸
docker logs --tail 100 <container_id>

# íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨
docker logs -t <container_id>

# íŠ¹ì • ì‹œê°„ ì´í›„ ë¡œê·¸
docker logs --since 2024-01-01T10:00:00 <container_id>

# ìµœê·¼ 1ì‹œê°„ ë¡œê·¸
docker logs --since 1h <container_id>

# íŠ¹ì • ì‹œê°„ ì´ì „ ë¡œê·¸
docker logs --until 2024-01-01T12:00:00 <container_id>
```

### docker-compose ë¡œê·¸

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs user-service

# ì‹¤ì‹œê°„ ë¡œê·¸
docker-compose logs -f

# ìµœê·¼ 50ì¤„
docker-compose logs --tail 50

# ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ë™ì‹œì—
docker-compose logs user-service account-service
```

### ë¡œê·¸ í•„í„°ë§ ë° ë¶„ì„

```bash
# grepìœ¼ë¡œ ì—ëŸ¬ë§Œ í•„í„°ë§
docker logs container_id 2>&1 | grep -i error

# íŠ¹ì • íŒ¨í„´ ê²€ìƒ‰
docker logs container_id 2>&1 | grep "connection refused"

# ì—ëŸ¬ ì¹´ìš´íŠ¸
docker logs container_id 2>&1 | grep -c ERROR

# ì—¬ëŸ¬ íŒ¨í„´ ê²€ìƒ‰
docker logs container_id 2>&1 | grep -E "ERROR|FATAL|Exception"

# íƒ€ì„ë¼ì¸ ë¶„ì„ (ì‹œê°„ë³„ ì—ëŸ¬ ìˆ˜)
docker logs -t container_id 2>&1 | grep ERROR | awk '{print $1}' | uniq -c
```

### ë¡œê·¸ ë ˆë²¨ë³„ ë¶„ì„

```bash
#!/bin/bash
# scripts/analyze-logs.sh

CONTAINER_ID=$1

echo "ğŸ“Š ë¡œê·¸ ë¶„ì„: $CONTAINER_ID"
echo ""

# ì´ ë¡œê·¸ ë¼ì¸ ìˆ˜
TOTAL=$(docker logs $CONTAINER_ID 2>&1 | wc -l)
echo "ì´ ë¡œê·¸ ë¼ì¸: $TOTAL"

# ì—ëŸ¬ ë ˆë²¨ë³„ ì¹´ìš´íŠ¸
echo ""
echo "ì—ëŸ¬ ë ˆë²¨ë³„ í†µê³„:"
echo "  ERROR:   $(docker logs $CONTAINER_ID 2>&1 | grep -c ERROR)"
echo "  WARN:    $(docker logs $CONTAINER_ID 2>&1 | grep -c WARN)"
echo "  INFO:    $(docker logs $CONTAINER_ID 2>&1 | grep -c INFO)"
echo "  DEBUG:   $(docker logs $CONTAINER_ID 2>&1 | grep -c DEBUG)"

# ìµœê·¼ ì—ëŸ¬ ë©”ì‹œì§€ (ìµœê·¼ 5ê°œ)
echo ""
echo "ìµœê·¼ ì—ëŸ¬ ë©”ì‹œì§€ (ìµœê·¼ 5ê°œ):"
docker logs $CONTAINER_ID 2>&1 | grep ERROR | tail -5
```

### ë¡œê·¸ ë“œë¼ì´ë²„ ì„¤ì •

```yaml
# docker-compose.yml

services:
  user-service:
    image: user-service:latest
    logging:
      driver: json-file
      options:
        max-size: "10m"      # ìµœëŒ€ íŒŒì¼ í¬ê¸°
        max-file: "3"        # ìµœëŒ€ íŒŒì¼ ê°œìˆ˜
        labels: "service"
        env: "ENV,APP_VERSION"

  # syslogë¡œ ì „ì†¡
  account-service:
    image: account-service:latest
    logging:
      driver: syslog
      options:
        syslog-address: "tcp://192.168.1.100:514"
        tag: "account-service"

  # fluentdë¡œ ì „ì†¡
  trade-service:
    image: trade-service:latest
    logging:
      driver: fluentd
      options:
        fluentd-address: localhost:24224
        tag: trade-service
```

---

## ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²€ì‚¬

### ì»¨í…Œì´ë„ˆ ì ‘ì†

```bash
# sh/bash ì…¸ ì‹¤í–‰
docker exec -it <container_id> sh
docker exec -it <container_id> bash

# íŠ¹ì • ëª…ë ¹ì–´ ì‹¤í–‰
docker exec <container_id> ls -la /app
docker exec <container_id> cat /app/config.json
docker exec <container_id> ps aux

# ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
docker exec -u root -it <container_id> sh

# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
docker exec <container_id> env

# ì‘ì—… ë””ë ‰í† ë¦¬ ì§€ì •
docker exec -w /app <container_id> ls -la
```

### íŒŒì¼ ì‹œìŠ¤í…œ ê²€ì‚¬

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ
$ ls -la /app
$ cat /app/config/application.yml
$ find /app -name "*.jar"
$ df -h  # ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰

# íŒŒì¼ ì¡´ì¬ í™•ì¸
docker exec container_id test -f /app/app.jar && echo "exists" || echo "not found"

# ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
docker exec container_id tree /app

# íŒŒì¼ ê¶Œí•œ í™•ì¸
docker exec container_id ls -l /app/app.jar
```

### í”„ë¡œì„¸ìŠ¤ ê²€ì‚¬

```bash
# ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤
docker top <container_id>

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ìƒì„¸ í™•ì¸
docker exec <container_id> ps aux
docker exec <container_id> ps -ef

# íŠ¹ì • í”„ë¡œì„¸ìŠ¤ ê²€ìƒ‰
docker exec <container_id> ps aux | grep java

# í¬íŠ¸ ë¦¬ìŠ¤ë‹ í™•ì¸
docker exec <container_id> netstat -tuln

# ë˜ëŠ”
docker exec <container_id> ss -tuln
```

### í™˜ê²½ ë³€ìˆ˜ ê²€ì‚¬

```bash
# ëª¨ë“  í™˜ê²½ ë³€ìˆ˜
docker exec <container_id> env

# íŠ¹ì • í™˜ê²½ ë³€ìˆ˜
docker exec <container_id> printenv DATABASE_URL

# docker inspectë¡œ í™•ì¸
docker inspect <container_id> | jq '.[0].Config.Env'

# docker-compose í™˜ê²½ ë³€ìˆ˜
docker-compose config
```

### ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ê²€ì‚¬

```bash
# IP ì£¼ì†Œ í™•ì¸
docker exec <container_id> ip addr

# ë˜ëŠ”
docker exec <container_id> ifconfig

# ë¼ìš°íŒ… í…Œì´ë¸”
docker exec <container_id> ip route

# DNS í™•ì¸
docker exec <container_id> cat /etc/resolv.conf

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec <container_id> ping -c 3 google.com
docker exec <container_id> curl -I https://google.com
```

---

## ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…

### ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  í…ŒìŠ¤íŠ¸

```bash
# 1. ì»¨í…Œì´ë„ˆ IP í™•ì¸
docker inspect <container_id> | grep IPAddress

# 2. ping í…ŒìŠ¤íŠ¸
docker exec container_a ping -c 3 container_b

# 3. í¬íŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec container_a nc -zv container_b 8080

# ë˜ëŠ” telnet
docker exec container_a telnet container_b 8080

# 4. HTTP ìš”ì²­ í…ŒìŠ¤íŠ¸
docker exec container_a curl http://container_b:8080/health
```

### ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸

```bash
# Docker ë„¤íŠ¸ì›Œí¬ ëª©ë¡
docker network ls

# ë„¤íŠ¸ì›Œí¬ ìƒì„¸ ì •ë³´
docker network inspect bridge

# íŠ¹ì • ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ëœ ì»¨í…Œì´ë„ˆ
docker network inspect my-network | jq '.[0].Containers'

# ì»¨í…Œì´ë„ˆê°€ ì†í•œ ë„¤íŠ¸ì›Œí¬
docker inspect container_id | jq '.[0].NetworkSettings.Networks'
```

### DNS í•´ì„ ë¬¸ì œ

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ DNS í…ŒìŠ¤íŠ¸
docker exec container_id nslookup postgres
docker exec container_id dig postgres

# /etc/hosts í™•ì¸
docker exec container_id cat /etc/hosts

# DNS ì„œë²„ í™•ì¸
docker exec container_id cat /etc/resolv.conf

# ì»¤ìŠ¤í…€ DNS ì‚¬ìš©
docker run --dns 8.8.8.8 --dns 8.8.4.4 myapp:latest
```

### í¬íŠ¸ ë§¤í•‘ ë¬¸ì œ

```bash
# í¬íŠ¸ ë§¤í•‘ í™•ì¸
docker port <container_id>

# í˜¸ìŠ¤íŠ¸ì—ì„œ í¬íŠ¸ ì‚¬ìš© ì¤‘ í™•ì¸
netstat -tuln | grep 8080
# Windows
netstat -ano | findstr :8080

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í¬íŠ¸ ë¦¬ìŠ¤ë‹ í™•ì¸
docker exec <container_id> netstat -tuln | grep 8080

# ë°©í™”ë²½ í™•ì¸ (Linux)
sudo iptables -L -n | grep 8080

# í¬íŠ¸ í¬ì›Œë”© í…ŒìŠ¤íŠ¸
curl http://localhost:8080/health
```

### ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë¬¸ì œ

```yaml
# docker-compose.yml

services:
  frontend:
    networks:
      - frontend-net
      - backend-net  # ì–‘ìª½ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼

  backend:
    networks:
      - backend-net
      - database-net

  database:
    networks:
      - database-net  # ë°ì´í„°ë² ì´ìŠ¤ ë„¤íŠ¸ì›Œí¬ë§Œ

networks:
  frontend-net:
  backend-net:
  database-net:
```

**ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸**:

```bash
# frontendê°€ backendì— ì ‘ê·¼ ê°€ëŠ¥í•œê°€?
docker-compose exec frontend ping backend

# backendê°€ databaseì— ì ‘ê·¼ ê°€ëŠ¥í•œê°€?
docker-compose exec backend ping database

# frontendê°€ databaseì— ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€ëŠ¥ (ì˜ë„ëœ ë™ì‘)
docker-compose exec frontend ping database
# ping: bad address 'database'
```

### ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ë„êµ¬ ì„¤ì¹˜

```bash
# ì•ŒíŒŒì¸ ê¸°ë°˜ ì»¨í…Œì´ë„ˆì— ë„êµ¬ ì„¤ì¹˜
docker exec -u root container_id apk add --no-cache \
    curl \
    bind-tools \
    netcat-openbsd \
    tcpdump

# ë°ë¹„ì•ˆ/ìš°ë¶„íˆ¬ ê¸°ë°˜
docker exec -u root container_id apt-get update && \
    apt-get install -y curl dnsutils netcat tcpdump
```

### íŒ¨í‚· ìº¡ì²˜

```bash
# ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸
docker exec container_id ip link

# tcpdumpë¡œ íŒ¨í‚· ìº¡ì²˜
docker exec container_id tcpdump -i eth0 -w /tmp/capture.pcap

# íŠ¹ì • í¬íŠ¸ë§Œ ìº¡ì²˜
docker exec container_id tcpdump -i eth0 port 8080

# ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œ íŒŒì¼ ë³µì‚¬
docker cp container_id:/tmp/capture.pcap ./capture.pcap

# Wiresharkë¡œ ë¶„ì„
wireshark capture.pcap
```

---

## ì„±ëŠ¥ ë¬¸ì œ ì§„ë‹¨

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
docker stats

# íŠ¹ì • ì»¨í…Œì´ë„ˆë§Œ
docker stats user-service account-service

# í¬ë§· ì§€ì •
docker stats --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}"

# 1íšŒë§Œ ì¶œë ¥
docker stats --no-stream
```

### CPU ì‚¬ìš©ëŸ‰ ë¶„ì„

```bash
# CPU ì‚¬ìš©ë¥  ë†’ì€ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}" | sort -k2 -rn

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í”„ë¡œì„¸ìŠ¤ CPU ì‚¬ìš©ëŸ‰
docker exec container_id top -bn1 | head -20

# CPU ì œí•œ í™•ì¸
docker inspect container_id | jq '.[0].HostConfig.CpuQuota'
docker inspect container_id | jq '.[0].HostConfig.CpuPeriod'
```

**CPU í”„ë¡œíŒŒì¼ë§ (Java)**:

```bash
# JVM ìŠ¤ë ˆë“œ ë¤í”„
docker exec container_id jstack 1 > thread-dump.txt

# CPU ì‚¬ìš© ì¤‘ì¸ ìŠ¤ë ˆë“œ ì°¾ê¸°
docker exec container_id top -H -p 1
```

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„

```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
docker stats --no-stream --format "table {{.Name}}\t{{.MemUsage}}"

# ë©”ëª¨ë¦¬ ì œí•œ í™•ì¸
docker inspect container_id | jq '.[0].HostConfig.Memory'

# OOM Killer ë¡œê·¸ í™•ì¸ (Linux)
dmesg | grep -i "killed process"
docker inspect container_id | jq '.[0].State.OOMKilled'
```

**ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§ (Java)**:

```bash
# í™ ë¤í”„ ìƒì„±
docker exec container_id jmap -dump:format=b,file=/tmp/heap.hprof 1

# í™ ë¤í”„ ë³µì‚¬
docker cp container_id:/tmp/heap.hprof ./heap.hprof

# Eclipse MAT ë˜ëŠ” VisualVMìœ¼ë¡œ ë¶„ì„
```

**ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€**:

```bash
#!/bin/bash
# scripts/memory-leak-detector.sh

CONTAINER_ID=$1
INTERVAL=60  # 60ì´ˆë§ˆë‹¤ í™•ì¸

echo "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œì‘: $CONTAINER_ID"
echo "ì‹œê°„, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰" > memory-usage.csv

while true; do
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    MEM_USAGE=$(docker stats --no-stream --format "{{.MemUsage}}" $CONTAINER_ID)

    echo "$TIMESTAMP, $MEM_USAGE" >> memory-usage.csv
    echo "$TIMESTAMP - $MEM_USAGE"

    sleep $INTERVAL
done
```

### ë””ìŠ¤í¬ I/O ë¶„ì„

```bash
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
docker exec container_id df -h

# ëŒ€ìš©ëŸ‰ íŒŒì¼ ì°¾ê¸°
docker exec container_id du -sh /* | sort -hr | head -10

# I/O í†µê³„
docker stats --format "table {{.Name}}\t{{.BlockIO}}"

# ì»¨í…Œì´ë„ˆë³„ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
docker system df
docker system df -v
```

### ë„¤íŠ¸ì›Œí¬ I/O ë¶„ì„

```bash
# ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰
docker stats --format "table {{.Name}}\t{{.NetIO}}"

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§
docker exec container_id iftop -i eth0
docker exec container_id nethogs

# ì—°ê²° ìˆ˜ í™•ì¸
docker exec container_id netstat -an | wc -l
```

---

## ì´ë¯¸ì§€ ë¬¸ì œ í•´ê²°

### ì´ë¯¸ì§€ ë¹Œë“œ ì‹¤íŒ¨

```bash
# ë¹Œë“œ ë¡œê·¸ ìƒì„¸ ì¶œë ¥
docker build --no-cache --progress=plain -t myapp:latest .

# íŠ¹ì • ë‹¨ê³„ê¹Œì§€ë§Œ ë¹Œë“œ
docker build --target builder -t myapp:builder .

# ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ í¬ê¸° í™•ì¸
tar -czf - . | wc -c

# .dockerignore í™•ì¸
cat .dockerignore
```

**ì¼ë°˜ì ì¸ ë¹Œë“œ ì˜¤ë¥˜**:

```dockerfile
# âŒ ë¬¸ì œ: COPY ì‹¤íŒ¨
COPY app.jar /app/
# Error: no such file or directory

# âœ… í•´ê²°: ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
# app.jarê°€ Dockerfileê³¼ ê°™ì€ ë””ë ‰í† ë¦¬ì— ìˆëŠ”ì§€ í™•ì¸
ls -la app.jar

# âŒ ë¬¸ì œ: RUN ëª…ë ¹ì–´ ì‹¤íŒ¨
RUN apt-get install -y nodejs
# E: Unable to locate package nodejs

# âœ… í•´ê²°: íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
RUN apt-get update && apt-get install -y nodejs
```

### ì´ë¯¸ì§€ ë ˆì´ì–´ ë¶„ì„

```bash
# ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬
docker history myapp:latest

# ìƒì„¸ ë ˆì´ì–´ ì •ë³´
docker history --no-trunc myapp:latest

# ë ˆì´ì–´ í¬ê¸° ìˆœìœ¼ë¡œ ì •ë ¬
docker history --format "{{.Size}}\t{{.CreatedBy}}" myapp:latest | sort -hr

# dive ë„êµ¬ë¡œ ìƒì„¸ ë¶„ì„
dive myapp:latest
```

### ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”

```bash
# í˜„ì¬ ì´ë¯¸ì§€ í¬ê¸°
docker images myapp:latest

# ë¶ˆí•„ìš”í•œ ë ˆì´ì–´ ì œê±°
docker build --squash -t myapp:latest .

# ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ ì‚¬ìš©
# (Dockerfileì—ì„œ êµ¬í˜„)

# ì´ë¯¸ì§€ í¬ê¸° ë¹„êµ
docker images | grep myapp
```

---

## ë³¼ë¥¨ ë¬¸ì œ í•´ê²°

### ë³¼ë¥¨ ë§ˆìš´íŠ¸ ë¬¸ì œ

```bash
# ë³¼ë¥¨ ëª©ë¡
docker volume ls

# ë³¼ë¥¨ ìƒì„¸ ì •ë³´
docker volume inspect my-volume

# ì»¨í…Œì´ë„ˆì˜ ë§ˆìš´íŠ¸ ì •ë³´
docker inspect container_id | jq '.[0].Mounts'

# ë³¼ë¥¨ ë‚´ìš© í™•ì¸
docker run --rm -v my-volume:/data alpine ls -la /data
```

**ê¶Œí•œ ë¬¸ì œ**:

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê¶Œí•œ í™•ì¸
docker exec container_id ls -la /app/data

# ì†Œìœ ì ë³€ê²½
docker exec -u root container_id chown -R appuser:appuser /app/data

# Dockerfileì—ì„œ í•´ê²°
COPY --chown=appuser:appuser . /app
```

### ë³¼ë¥¨ ë°ì´í„° ì†ì‹¤

```bash
# ìµëª… ë³¼ë¥¨ ì°¾ê¸° (ëŒ•ê¸€ë§ ë³¼ë¥¨)
docker volume ls -qf dangling=true

# ë³¼ë¥¨ ë°±ì—…
docker run --rm -v my-volume:/source -v $(pwd):/backup \
    alpine tar czf /backup/backup.tar.gz -C /source .

# ë³¼ë¥¨ ë³µì›
docker run --rm -v my-volume:/target -v $(pwd):/backup \
    alpine tar xzf /backup/backup.tar.gz -C /target

# ë³¼ë¥¨ ë§ˆì´ê·¸ë ˆì´ì…˜
docker run --rm -v old-volume:/from -v new-volume:/to \
    alpine sh -c "cp -av /from/. /to/"
```

### ë³¼ë¥¨ ì„±ëŠ¥ ë¬¸ì œ

```bash
# Docker Desktop (Mac/Windows): cached, delegated ì˜µì…˜
volumes:
  - ./src:/app/src:cached  # ì½ê¸° ì„±ëŠ¥ í–¥ìƒ

# Linux: ê¸°ë³¸ ì„¤ì •ì´ ìµœì 

# ë³¼ë¥¨ I/O í…ŒìŠ¤íŠ¸
docker run --rm -v my-volume:/data alpine \
    dd if=/dev/zero of=/data/testfile bs=1M count=100
```

---

## ì¼ë°˜ì ì¸ ì˜¤ë¥˜ íŒ¨í„´

### 1. "Cannot connect to Docker daemon"

```bash
# ì¦ìƒ
Cannot connect to the Docker daemon at unix:///var/run/docker.sock

# ì›ì¸ ë° í•´ê²°
# 1. Dockerê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
sudo systemctl status docker

# 2. Docker ì‹œì‘
sudo systemctl start docker

# 3. ê¶Œí•œ í™•ì¸ (Linux)
sudo usermod -aG docker $USER
# ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸

# 4. Docker Desktop (Windows/Mac) í™•ì¸
# Docker Desktopì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
```

### 2. "Port is already allocated"

```bash
# ì¦ìƒ
Error: bind: address already in use

# ì›ì¸: í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘

# í•´ê²° 1: ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ ì°¾ê¸°
netstat -tuln | grep 8080
lsof -i :8080  # Mac/Linux

# Windows
netstat -ano | findstr :8080

# í•´ê²° 2: í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill <PID>

# í•´ê²° 3: ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
docker run -p 8081:8080 myapp:latest
```

### 3. "No space left on device"

```bash
# ì¦ìƒ
no space left on device

# ì›ì¸: ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±

# ì§„ë‹¨
docker system df
df -h

# í•´ê²° 1: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker system prune -a

# í•´ê²° 2: íŠ¹ì • ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker image prune    # ëŒ•ê¸€ë§ ì´ë¯¸ì§€
docker container prune  # ì¤‘ì§€ëœ ì»¨í…Œì´ë„ˆ
docker volume prune   # ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë³¼ë¥¨

# í•´ê²° 3: ë¡œê·¸ ì •ë¦¬
docker logs container_id --tail 0  # ë¡œê·¸ ì´ˆê¸°í™”
```

### 4. "Exec format error"

```bash
# ì¦ìƒ
exec format error

# ì›ì¸: ì•„í‚¤í…ì²˜ ë¶ˆì¼ì¹˜ (ARM vs AMD64)

# í™•ì¸
docker inspect myapp:latest | jq '.[0].Architecture'
uname -m  # í˜¸ìŠ¤íŠ¸ ì•„í‚¤í…ì²˜

# í•´ê²°: ë©€í‹° ì•„í‚¤í…ì²˜ ë¹Œë“œ
docker buildx build --platform linux/amd64,linux/arm64 -t myapp:latest .
```

### 5. "OCI runtime create failed"

```bash
# ì¦ìƒ
OCI runtime create failed: ...

# ì¼ë°˜ì ì¸ ì›ì¸ ë° í•´ê²°

# 1. ë§ˆìš´íŠ¸ ê²½ë¡œ ë¬¸ì œ
# âŒ
volumes:
  - /nonexistent:/app
# âœ…
volumes:
  - ./data:/app

# 2. ê¶Œí•œ ë¬¸ì œ
# âœ… ì»¨í…Œì´ë„ˆë¥¼ ë£¨íŠ¸ë¡œ ì‹¤í–‰
docker run --user root myapp:latest

# 3. ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë¶€ì¡±
# Docker Desktop: Settings > Resources > ë©”ëª¨ë¦¬/CPU ì¦ê°€
```

### 6. "Container unhealthy"

```bash
# ì¦ìƒ
Container is unhealthy

# ì›ì¸: í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨

# ì§„ë‹¨
docker inspect container_id | jq '.[0].State.Health'

# ë¡œê·¸ í™•ì¸
docker inspect container_id | jq '.[0].State.Health.Log'

# í—¬ìŠ¤ì²´í¬ ìˆ˜ë™ ì‹¤í–‰
docker exec container_id curl -f http://localhost:8080/health

# í•´ê²°: í—¬ìŠ¤ì²´í¬ ì¡°ì •
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
  interval: 30s        # ê°„ê²© ëŠ˜ë¦¬ê¸°
  timeout: 10s         # íƒ€ì„ì•„ì›ƒ ëŠ˜ë¦¬ê¸°
  retries: 5           # ì¬ì‹œë„ íšŸìˆ˜ ëŠ˜ë¦¬ê¸°
  start_period: 60s    # ì‹œì‘ ëŒ€ê¸° ì‹œê°„ ëŠ˜ë¦¬ê¸°
```

---

## ê³ ê¸‰ ë””ë²„ê¹… ê¸°ë²•

### straceë¡œ ì‹œìŠ¤í…œ ì½œ ì¶”ì 

```bash
# strace ì„¤ì¹˜
docker exec -u root container_id apt-get update && \
    apt-get install -y strace

# í”„ë¡œì„¸ìŠ¤ ì¶”ì 
docker exec container_id strace -p 1

# íŒŒì¼ I/O ì¶”ì 
docker exec container_id strace -e trace=open,close,read,write -p 1

# ë„¤íŠ¸ì›Œí¬ ì½œ ì¶”ì 
docker exec container_id strace -e trace=network -p 1
```

### ì»¨í…Œì´ë„ˆ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ì´ë²¤íŠ¸
docker events

# íŠ¹ì • ì»¨í…Œì´ë„ˆë§Œ
docker events --filter container=user-service

# íŠ¹ì • ì´ë²¤íŠ¸ë§Œ
docker events --filter event=start
docker events --filter event=die

# ì‹œê°„ ë²”ìœ„ ì§€ì •
docker events --since 2024-01-01T00:00:00 --until 2024-01-01T23:59:59
```

### ë””ë²„ê·¸ ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ë””ë²„ê·¸ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -it --rm \
    --network container:user-service \
    nicolaka/netshoot

# ë˜ëŠ” ê°™ì€ ë„¤íŠ¸ì›Œí¬ ê³µìœ 
docker run -it --rm \
    --network lk-trade_default \
    nicolaka/netshoot

# ë””ë²„ê·¸ ë„êµ¬ê°€ í¬í•¨ëœ ì´ë¯¸ì§€
# - nicolaka/netshoot: ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…
# - busybox: ê¸°ë³¸ ìœ ë‹‰ìŠ¤ ë„êµ¬
# - alpine: ê°€ë²¼ìš´ ë¦¬ëˆ…ìŠ¤
```

### ì»¨í…Œì´ë„ˆ ì²´í¬í¬ì¸íŠ¸ ë° ë³µì›

```bash
# ì‹¤í—˜ì  ê¸°ëŠ¥ í™œì„±í™” í•„ìš”

# ì»¨í…Œì´ë„ˆ ì²´í¬í¬ì¸íŠ¸ ìƒì„±
docker checkpoint create container_id checkpoint1

# ì²´í¬í¬ì¸íŠ¸ ëª©ë¡
docker checkpoint ls container_id

# ì²´í¬í¬ì¸íŠ¸ì—ì„œ ë³µì›
docker start --checkpoint checkpoint1 container_id
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì»¨í…Œì´ë„ˆê°€ ì‹œì‘í•˜ì§€ ì•Šì„ ë•Œ

```
â–¡ docker ps -aë¡œ Exit Code í™•ì¸
  - 0: ì •ìƒ ì¢…ë£Œ
  - 1: ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜
  - 137: OOM Killed
  - 139: Segmentation Fault
  - 143: SIGTERM

â–¡ docker logsë¡œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸

â–¡ docker inspectë¡œ ì„¤ì • í™•ì¸
  - Cmd, Entrypoint
  - Environment
  - Mounts
  - Networks

â–¡ Dockerfile ê²€í† 
  - CMD/ENTRYPOINT ì˜¬ë°”ë¥¸ê°€?
  - í•„ìš”í•œ íŒŒì¼ ëª¨ë‘ COPYë˜ì—ˆë‚˜?
  - ê¶Œí•œ ë¬¸ì œ ì—†ë‚˜?

â–¡ ì˜ì¡´ì„± í™•ì¸
  - depends_on ì„¤ì •
  - ë°ì´í„°ë² ì´ìŠ¤/Redis ì¤€ë¹„ë˜ì—ˆë‚˜?
```

### ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ì»¨í…Œì´ë„ˆ IP ì£¼ì†Œ í™•ì¸
  docker inspect container_id | grep IPAddress

â–¡ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì¸ê°€?
  docker network inspect network_name

â–¡ DNS í•´ì„ ë˜ëŠ”ê°€?
  docker exec container_id ping target_container

â–¡ í¬íŠ¸ ë¦¬ìŠ¤ë‹ ì¤‘ì¸ê°€?
  docker exec container_id netstat -tuln

â–¡ ë°©í™”ë²½/ë³´ì•ˆ ê·¸ë£¹ í™•ì¸

â–¡ ì„œë¹„ìŠ¤ ì´ë¦„ ì‚¬ìš©í•˜ëŠ”ê°€?
  (localhost âŒ, service_name âœ…)
```

### ì„±ëŠ¥ ë¬¸ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ docker statsë¡œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸

â–¡ ë¦¬ì†ŒìŠ¤ ì œí•œ í™•ì¸
  docker inspect | grep -i "cpu\|memory"

â–¡ ë¡œê·¸ íŒŒì¼ í¬ê¸° í™•ì¸
  docker logs --tail 1 container_id

â–¡ ë³¼ë¥¨ I/O ì„±ëŠ¥ í™•ì¸

â–¡ ë„¤íŠ¸ì›Œí¬ ì§€ì—° í™•ì¸
  docker exec container_id ping -c 10 target

â–¡ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ë§
  (JProfiler, pprof, py-spy ë“±)
```

### ë°ì´í„° ì†ì‹¤ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ë³¼ë¥¨ ì‚¬ìš© ì¤‘ì¸ê°€?
  docker inspect container_id | jq '.[0].Mounts'

â–¡ ìµëª… ë³¼ë¥¨ì¸ê°€? (ì´ë¦„ ìˆëŠ” ë³¼ë¥¨ìœ¼ë¡œ ë³€ê²½)

â–¡ --rm ì˜µì…˜ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‚˜?

â–¡ docker-compose down -v ì‹¤í–‰í•˜ì§€ ì•Šì•˜ë‚˜?

â–¡ ë°±ì—… ì¡´ì¬í•˜ëŠ”ê°€?
  docker volume ls
```

---

## ì‹¤ì „ ë””ë²„ê¹… ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: "Service Unavailable"

```bash
# 1. ì¦ìƒ
$ curl http://localhost:8081/api/users
Service Unavailable

# 2. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
$ docker ps
CONTAINER ID   STATUS                    PORTS
a1b2c3d4e5f6   Up 2 minutes (unhealthy)  0.0.0.0:8081->8080/tcp

# 3. í—¬ìŠ¤ì²´í¬ ë¡œê·¸ í™•ì¸
$ docker inspect user-service | jq '.[0].State.Health.Log'
[
  {
    "ExitCode": 1,
    "Output": "curl: (7) Failed to connect to localhost port 8080"
  }
]

# 4. ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
$ docker logs user-service
Error: Cannot connect to database at postgres:5432
Connection refused

# 5. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
$ docker ps | grep postgres
(ì•„ë¬´ê²ƒë„ ì—†ìŒ)

# 6. ì›ì¸: ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘ ì•ˆë¨
$ docker-compose up -d postgres

# 7. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
$ docker-compose restart user-service

# 8. í™•ì¸
$ curl http://localhost:8081/health
{"status":"UP"}
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë©”ëª¨ë¦¬ ë¶€ì¡±

```bash
# 1. ì¦ìƒ
$ docker ps -a
CONTAINER ID   STATUS                      NAMES
a1b2c3d4e5f6   Exited (137) 1 minute ago   user-service

# Exit Code 137 = OOM Killed

# 2. ë©”ëª¨ë¦¬ ì œí•œ í™•ì¸
$ docker inspect user-service | jq '.[0].HostConfig.Memory'
536870912  # 512MB

# 3. ë¡œê·¸ í™•ì¸
$ docker logs user-service --tail 50
java.lang.OutOfMemoryError: Java heap space

# 4. í•´ê²°: ë©”ëª¨ë¦¬ ì¦ê°€
# docker-compose.yml
services:
  user-service:
    mem_limit: 1g
    environment:
      - JAVA_OPTS=-Xmx768m

# 5. ì¬ì‹œì‘
$ docker-compose up -d user-service
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ëŠë¦° ì‘ë‹µ

```bash
# 1. ì¦ìƒ
$ curl http://localhost:8081/api/users
(5ì´ˆ í›„ ì‘ë‹µ)

# 2. ë¦¬ì†ŒìŠ¤ í™•ì¸
$ docker stats user-service
CONTAINER   CPU %   MEM USAGE / LIMIT   MEM %
user-service  98%   450MiB / 512MiB     87.8%

# CPU ê±°ì˜ 100% ì‚¬ìš© ì¤‘!

# 3. í”„ë¡œì„¸ìŠ¤ í™•ì¸
$ docker exec user-service top
  PID USER      PR  NI    VIRT    RES  %CPU  %MEM
    1 root      20   0  2.5g    450m  98.0  11.2  java

# 4. ìŠ¤ë ˆë“œ ë¤í”„
$ docker exec user-service jstack 1 > thread-dump.txt

# 5. ë¶„ì„: ë¬´í•œ ë£¨í”„ ë°œê²¬
# (ì½”ë“œ ìˆ˜ì • í•„ìš”)

# 6. ì„ì‹œ í•´ê²°: CPU ì œí•œ ì™„í™”
# docker-compose.yml
services:
  user-service:
    cpus: "2.0"  # 1.0 â†’ 2.0

# 7. ê·¼ë³¸ í•´ê²°: ì½”ë“œ ìˆ˜ì • í›„ ì¬ë°°í¬
```

---

## ìœ ìš©í•œ ë””ë²„ê¹… ë„êµ¬

### ctop (ì»¨í…Œì´ë„ˆ top)

```bash
# ì„¤ì¹˜
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    quay.io/vektorlab/ctop:latest

# ì‹¤ì‹œê°„ ì»¨í…Œì´ë„ˆ ëª¨ë‹ˆí„°ë§
```

### lazydocker

```bash
# ì„¤ì¹˜
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v ~/.config/lazydocker:/.config/jesseduffield/lazydocker \
    lazyteam/lazydocker

# TUI ì¸í„°í˜ì´ìŠ¤ë¡œ Docker ê´€ë¦¬
```

### dive (ì´ë¯¸ì§€ ë¶„ì„)

```bash
# ì„¤ì¹˜
docker pull wagoodman/dive

# ì´ë¯¸ì§€ ë ˆì´ì–´ ë¶„ì„
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    wagoodman/dive:latest myapp:latest
```

---

## ë‹¤ìŒ ë‹¨ê³„

### 22. ì¼ì¼ ê°œë°œ ë£¨í‹´
- ê°œë°œ í™˜ê²½ ì‹œì‘
- ê°œë°œ ì¤‘ ëª¨ë‹ˆí„°ë§
- ì½”ë“œ ë³€ê²½ ì‹œ ì¬ë¹Œë“œ

### í•™ìŠµ ìë£Œ

**ë””ë²„ê¹…**:
- [Docker Debugging Guide](https://docs.docker.com/config/containers/logging/)
- [Troubleshooting Docker](https://docs.docker.com/config/daemon/troubleshoot/)

**ë„êµ¬**:
- [ctop](https://github.com/bcicen/ctop)
- [lazydocker](https://github.com/jesseduffield/lazydocker)
- [dive](https://github.com/wagoodman/dive)

---

**ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰** Docker ë””ë²„ê¹…ê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë§ˆìŠ¤í„°!