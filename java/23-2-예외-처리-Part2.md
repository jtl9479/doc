# ğŸ“ Chapter 23-2: ì˜ˆì™¸ ì²˜ë¦¬ (Exception Handling) Part 2

## ğŸ¯ í•™ìŠµ ëª©í‘œ
- ì‹¤ì œ ê¸°ì—…ì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì–´ë–»ê²Œ í™œìš©í•˜ëŠ”ì§€ í•™ìŠµí•©ë‹ˆë‹¤
- Spring Frameworkì˜ ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´ì„ ì´í•´í•©ë‹ˆë‹¤
- Database Transaction Rollback ë©”ì»¤ë‹ˆì¦˜ì„ í•™ìŠµí•©ë‹ˆë‹¤
- ì£¼ë‹ˆì–´ ê°œë°œìê°€ ìì£¼ ì‹¤ìˆ˜í•˜ëŠ” ì˜ˆì™¸ ì²˜ë¦¬ ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤
- ì‹¤ì „ì—ì„œ ë§ˆì£¼ì¹  ìˆ˜ ìˆëŠ” ë¬¸ì œì™€ í•´ê²° ë°©ë²•ì„ ìµí™ë‹ˆë‹¤

---

## ğŸ¢ ê¸°ì—… ì‚¬ë¡€ ì—°êµ¬

---

## ğŸ“˜ Case Study 1: Spring Framework - ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬

### ë°°ê²½
**Naver Pay** ê°œë°œ íŒ€ì€ ê²°ì œ ì‹œìŠ¤í…œì—ì„œ ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ì˜ˆì™¸ë¥¼ ê³„ì¸µë³„ë¡œ ì²´ê³„ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
- Controller: HTTP ìƒíƒœ ì½”ë“œì™€ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€
- Service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸
- Repository: ë°ì´í„°ë² ì´ìŠ¤ ì˜ˆì™¸

**í•´ê²°ì±…**: Custom Exceptionê³¼ @ControllerAdviceë¥¼ í™œìš©í•œ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬

### ì‹¤ì œ ì½”ë“œ

```java
// ğŸ“ SpringExceptionHandlingExample.java

import java.util.*;

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 1ï¸âƒ£ Custom Exception ê³„ì¸µ êµ¬ì¡°
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// Base Exception
class BusinessException extends RuntimeException {
    private final String errorCode;

    public BusinessException(String errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }

    public String getErrorCode() { return errorCode; }
}

// Domain-specific Exceptions
class InsufficientBalanceException extends BusinessException {
    public InsufficientBalanceException(int balance, int amount) {
        super("INSUFFICIENT_BALANCE",
              "ì”ì•¡ ë¶€ì¡±: í˜„ì¬ " + balance + "ì›, í•„ìš” " + amount + "ì›");
    }
}

class UserNotFoundException extends BusinessException {
    public UserNotFoundException(Long userId) {
        super("USER_NOT_FOUND", "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ID=" + userId);
    }
}

class InvalidPaymentMethodException extends BusinessException {
    public InvalidPaymentMethodException(String method) {
        super("INVALID_PAYMENT_METHOD", "ìœ íš¨í•˜ì§€ ì•Šì€ ê²°ì œ ìˆ˜ë‹¨: " + method);
    }
}

class DuplicateTransactionException extends BusinessException {
    public DuplicateTransactionException(String transactionId) {
        super("DUPLICATE_TRANSACTION", "ì¤‘ë³µëœ ê±°ë˜ì…ë‹ˆë‹¤: " + transactionId);
    }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 2ï¸âƒ£ Domain Models
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

class User {
    private Long id;
    private String name;
    private int balance;

    public User(Long id, String name, int balance) {
        this.id = id;
        this.name = name;
        this.balance = balance;
    }

    public Long getId() { return id; }
    public String getName() { return name; }
    public int getBalance() { return balance; }

    public void withdraw(int amount) {
        if (balance < amount) {
            throw new InsufficientBalanceException(balance, amount);
        }
        balance -= amount;
    }
}

class Payment {
    private String id;
    private Long userId;
    private int amount;
    private String method;
    private String status;

    public Payment(String id, Long userId, int amount, String method) {
        this.id = id;
        this.userId = userId;
        this.amount = amount;
        this.method = method;
        this.status = "PENDING";
    }

    public String getId() { return id; }
    public Long getUserId() { return userId; }
    public int getAmount() { return amount; }
    public String getMethod() { return method; }
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }

    @Override
    public String toString() {
        return String.format("Payment{id='%s', userId=%d, amount=%d, method='%s', status='%s'}",
                           id, userId, amount, method, status);
    }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 3ï¸âƒ£ Repository Layer
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

class UserRepository {
    private static Map<Long, User> users = new HashMap<>();

    static {
        users.put(1L, new User(1L, "ê¹€ì² ìˆ˜", 100000));
        users.put(2L, new User(2L, "ì´ì˜í¬", 50000));
    }

    public User findById(Long userId) {
        User user = users.get(userId);
        if (user == null) {
            throw new UserNotFoundException(userId);
        }
        return user;
    }
}

class PaymentRepository {
    private static Map<String, Payment> payments = new HashMap<>();

    public void save(Payment payment) {
        if (payments.containsKey(payment.getId())) {
            throw new DuplicateTransactionException(payment.getId());
        }
        payments.put(payment.getId(), payment);
        System.out.println("  ğŸ’¾ [Repository] ê²°ì œ ì •ë³´ ì €ì¥: " + payment.getId());
    }

    public Payment findById(String paymentId) {
        return payments.get(paymentId);
    }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 4ï¸âƒ£ Service Layer
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

class PaymentService {
    private final UserRepository userRepository = new UserRepository();
    private final PaymentRepository paymentRepository = new PaymentRepository();

    private static final Set<String> VALID_METHODS = Set.of("CARD", "BANK", "KAKAO_PAY", "NAVER_PAY");

    public Payment processPayment(String paymentId, Long userId, int amount, String method) {
        System.out.println("\nğŸ’³ [Service] ê²°ì œ ì²˜ë¦¬ ì‹œì‘");

        // 1. ê²°ì œ ìˆ˜ë‹¨ ê²€ì¦
        if (!VALID_METHODS.contains(method)) {
            throw new InvalidPaymentMethodException(method);
        }

        // 2. ì‚¬ìš©ì ì¡°íšŒ
        User user = userRepository.findById(userId);
        System.out.println("  âœ… ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ: " + user.getName());

        // 3. ì”ì•¡ ì°¨ê°
        user.withdraw(amount);
        System.out.println("  âœ… ì”ì•¡ ì°¨ê° ì™„ë£Œ: " + user.getBalance() + "ì› ë‚¨ìŒ");

        // 4. ê²°ì œ ì •ë³´ ì €ì¥
        Payment payment = new Payment(paymentId, userId, amount, method);
        paymentRepository.save(payment);

        // 5. ê²°ì œ ì™„ë£Œ ì²˜ë¦¬
        payment.setStatus("COMPLETED");
        System.out.println("  âœ… ê²°ì œ ì™„ë£Œ: " + payment);

        return payment;
    }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 5ï¸âƒ£ Controller Layer (ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

class ErrorResponse {
    private final String errorCode;
    private final String message;
    private final int httpStatus;

    public ErrorResponse(String errorCode, String message, int httpStatus) {
        this.errorCode = errorCode;
        this.message = message;
        this.httpStatus = httpStatus;
    }

    @Override
    public String toString() {
        return String.format("ErrorResponse{errorCode='%s', message='%s', httpStatus=%d}",
                           errorCode, message, httpStatus);
    }
}

class GlobalExceptionHandler {

    public ErrorResponse handleBusinessException(BusinessException e) {
        System.out.println("\nğŸ›¡ï¸ [GlobalExceptionHandler] BusinessException ì²˜ë¦¬");

        int httpStatus = switch (e.getErrorCode()) {
            case "USER_NOT_FOUND" -> 404;
            case "INSUFFICIENT_BALANCE" -> 400;
            case "INVALID_PAYMENT_METHOD" -> 400;
            case "DUPLICATE_TRANSACTION" -> 409;
            default -> 500;
        };

        ErrorResponse response = new ErrorResponse(e.getErrorCode(), e.getMessage(), httpStatus);
        System.out.println("  ğŸ“¤ ì‘ë‹µ: " + response);
        return response;
    }

    public ErrorResponse handleUnexpectedException(Exception e) {
        System.out.println("\nğŸ›¡ï¸ [GlobalExceptionHandler] ì˜ˆìƒì¹˜ ëª»í•œ ì˜ˆì™¸ ì²˜ë¦¬");
        ErrorResponse response = new ErrorResponse("INTERNAL_SERVER_ERROR",
                                                   "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤", 500);
        System.out.println("  ğŸ“¤ ì‘ë‹µ: " + response);
        return response;
    }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 6ï¸âƒ£ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

public class SpringExceptionHandlingExample {
    public static void main(String[] args) {
        System.out.println("=== Spring ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬ - Naver Pay ì‚¬ë¡€ ===\n");

        PaymentService paymentService = new PaymentService();
        GlobalExceptionHandler exceptionHandler = new GlobalExceptionHandler();

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // Case 1: ì •ìƒ ì²˜ë¦¬
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("=".repeat(60));
        System.out.println("Case 1: ì •ìƒ ê²°ì œ");
        System.out.println("=".repeat(60));

        try {
            Payment payment = paymentService.processPayment("PAY-001", 1L, 30000, "CARD");
            System.out.println("\nâœ… ê²°ì œ ì„±ê³µ: " + payment);
        } catch (BusinessException e) {
            exceptionHandler.handleBusinessException(e);
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // Case 2: ì”ì•¡ ë¶€ì¡±
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("\n" + "=".repeat(60));
        System.out.println("Case 2: ì”ì•¡ ë¶€ì¡±");
        System.out.println("=".repeat(60));

        try {
            paymentService.processPayment("PAY-002", 2L, 100000, "CARD");
        } catch (BusinessException e) {
            exceptionHandler.handleBusinessException(e);
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // Case 3: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ì
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("\n" + "=".repeat(60));
        System.out.println("Case 3: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ì");
        System.out.println("=".repeat(60));

        try {
            paymentService.processPayment("PAY-003", 999L, 10000, "CARD");
        } catch (BusinessException e) {
            exceptionHandler.handleBusinessException(e);
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // Case 4: ì˜ëª»ëœ ê²°ì œ ìˆ˜ë‹¨
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("\n" + "=".repeat(60));
        System.out.println("Case 4: ì˜ëª»ëœ ê²°ì œ ìˆ˜ë‹¨");
        System.out.println("=".repeat(60));

        try {
            paymentService.processPayment("PAY-004", 1L, 10000, "BITCOIN");
        } catch (BusinessException e) {
            exceptionHandler.handleBusinessException(e);
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // í•µì‹¬ ì •ë¦¬
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("\n" + "=".repeat(60));
        System.out.println("\nğŸ’¡ ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´:");

        System.out.println("\n1ï¸âƒ£ Repository Layer:");
        System.out.println("   - ë°ì´í„° ì ‘ê·¼ ì˜ˆì™¸");
        System.out.println("   - UserNotFoundException, DataAccessException");

        System.out.println("\n2ï¸âƒ£ Service Layer:");
        System.out.println("   - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸");
        System.out.println("   - InsufficientBalanceException, InvalidPaymentMethodException");

        System.out.println("\n3ï¸âƒ£ Controller Layer:");
        System.out.println("   - HTTP ì‘ë‹µ ë³€í™˜");
        System.out.println("   - @ControllerAdviceë¡œ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬");

        System.out.println("\nğŸ¯ ì¥ì :");
        System.out.println("   âœ… ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹");
        System.out.println("   âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ì™€ ê¸°ìˆ  ì˜ˆì™¸ ë¶„ë¦¬");
        System.out.println("   âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° (ì „ì—­ ì²˜ë¦¬)");
        System.out.println("   âœ… ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€");
    }
}
```

**ì‹¤í–‰ ê²°ê³¼:**
```
=== Spring ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬ - Naver Pay ì‚¬ë¡€ ===

============================================================
Case 1: ì •ìƒ ê²°ì œ
============================================================

ğŸ’³ [Service] ê²°ì œ ì²˜ë¦¬ ì‹œì‘
  âœ… ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ: ê¹€ì² ìˆ˜
  âœ… ì”ì•¡ ì°¨ê° ì™„ë£Œ: 70000ì› ë‚¨ìŒ
  ğŸ’¾ [Repository] ê²°ì œ ì •ë³´ ì €ì¥: PAY-001
  âœ… ê²°ì œ ì™„ë£Œ: Payment{id='PAY-001', userId=1, amount=30000, method='CARD', status='COMPLETED'}

âœ… ê²°ì œ ì„±ê³µ: Payment{id='PAY-001', userId=1, amount=30000, method='CARD', status='COMPLETED'}

============================================================
Case 2: ì”ì•¡ ë¶€ì¡±
============================================================

ğŸ’³ [Service] ê²°ì œ ì²˜ë¦¬ ì‹œì‘
  âœ… ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ: ì´ì˜í¬

ğŸ›¡ï¸ [GlobalExceptionHandler] BusinessException ì²˜ë¦¬
  ğŸ“¤ ì‘ë‹µ: ErrorResponse{errorCode='INSUFFICIENT_BALANCE', message='ì”ì•¡ ë¶€ì¡±: í˜„ì¬ 50000ì›, í•„ìš” 100000ì›', httpStatus=400}

============================================================
Case 3: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ì
============================================================

ğŸ’³ [Service] ê²°ì œ ì²˜ë¦¬ ì‹œì‘

ğŸ›¡ï¸ [GlobalExceptionHandler] BusinessException ì²˜ë¦¬
  ğŸ“¤ ì‘ë‹µ: ErrorResponse{errorCode='USER_NOT_FOUND', message='ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ID=999', httpStatus=404}

============================================================
Case 4: ì˜ëª»ëœ ê²°ì œ ìˆ˜ë‹¨
============================================================

ğŸ’³ [Service] ê²°ì œ ì²˜ë¦¬ ì‹œì‘

ğŸ›¡ï¸ [GlobalExceptionHandler] BusinessException ì²˜ë¦¬
  ğŸ“¤ ì‘ë‹µ: ErrorResponse{errorCode='INVALID_PAYMENT_METHOD', message='ìœ íš¨í•˜ì§€ ì•Šì€ ê²°ì œ ìˆ˜ë‹¨: BITCOIN', httpStatus=400}

============================================================

ğŸ’¡ ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´:

1ï¸âƒ£ Repository Layer:
   - ë°ì´í„° ì ‘ê·¼ ì˜ˆì™¸
   - UserNotFoundException, DataAccessException

2ï¸âƒ£ Service Layer:
   - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸
   - InsufficientBalanceException, InvalidPaymentMethodException

3ï¸âƒ£ Controller Layer:
   - HTTP ì‘ë‹µ ë³€í™˜
   - @ControllerAdviceë¡œ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬

ğŸ¯ ì¥ì :
   âœ… ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
   âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ì™€ ê¸°ìˆ  ì˜ˆì™¸ ë¶„ë¦¬
   âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° (ì „ì—­ ì²˜ë¦¬)
   âœ… ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€
```

---

## ğŸ“— Case Study 2: Database Transaction - Rollback ë©”ì»¤ë‹ˆì¦˜

### ë°°ê²½
**ì¹´ì¹´ì˜¤ë±…í¬** ê°œë°œ íŒ€ì€ ê³„ì¢Œ ì´ì²´ ì‹œ ì˜ˆì™¸ ë°œìƒ ì‹œ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
í•œ ê³„ì¢Œì—ì„œ ì¶œê¸ˆí–ˆëŠ”ë° ì…ê¸ˆì— ì‹¤íŒ¨í•˜ë©´ ë°ì´í„° ì •í•©ì„±ì´ ê¹¨ì§‘ë‹ˆë‹¤.

**í•´ê²°ì±…**: try-catchì™€ Rollback ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì›ìì„±(Atomicity) ë³´ì¥

### ì‹¤ì œ ì½”ë“œ

```java
// ğŸ“ TransactionRollbackExample.java

import java.util.*;

class Account {
    private String accountNumber;
    private String owner;
    private int balance;

    public Account(String accountNumber, String owner, int balance) {
        this.accountNumber = accountNumber;
        this.owner = owner;
        this.balance = balance;
    }

    public String getAccountNumber() { return accountNumber; }
    public String getOwner() { return owner; }
    public int getBalance() { return balance; }

    public void withdraw(int amount) throws InsufficientBalanceException {
        if (balance < amount) {
            throw new InsufficientBalanceException(accountNumber, balance, amount);
        }
        balance -= amount;
    }

    public void deposit(int amount) {
        balance += amount;
    }

    @Override
    public String toString() {
        return String.format("Account{%s, %s, %,dì›}", accountNumber, owner, balance);
    }
}

class TransferException extends Exception {
    public TransferException(String message, Throwable cause) {
        super(message, cause);
    }
}

class InsufficientBalanceException extends Exception {
    public InsufficientBalanceException(String accountNumber, int balance, int amount) {
        super(String.format("ì”ì•¡ ë¶€ì¡± [%s]: í˜„ì¬ %,dì›, ìš”ì²­ %,dì›",
                          accountNumber, balance, amount));
    }
}

class AccountService {
    private Map<String, Account> accounts = new HashMap<>();

    public AccountService() {
        accounts.put("1001", new Account("1001", "ê¹€ì² ìˆ˜", 1000000));
        accounts.put("1002", new Account("1002", "ì´ì˜í¬", 500000));
        accounts.put("1003", new Account("1003", "ë°•ë¯¼ìˆ˜", 0));  // ì”ì•¡ 0ì›
    }

    public Account getAccount(String accountNumber) {
        return accounts.get(accountNumber);
    }

    // âœ… íŠ¸ëœì­ì…˜ + ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜
    public void transfer(String fromAccount, String toAccount, int amount) throws TransferException {
        System.out.println("\nğŸ’¸ [Transaction Start] ê³„ì¢Œ ì´ì²´ ì‹œì‘");
        System.out.println("  ì¶œê¸ˆ ê³„ì¢Œ: " + fromAccount);
        System.out.println("  ì…ê¸ˆ ê³„ì¢Œ: " + toAccount);
        System.out.println("  ê¸ˆì•¡: " + amount + "ì›");

        Account from = getAccount(fromAccount);
        Account to = getAccount(toAccount);

        if (from == null || to == null) {
            throw new TransferException("ê³„ì¢Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤", null);
        }

        // ì´ì²´ ì „ ì”ì•¡ ì €ì¥ (ë¡¤ë°±ìš©)
        int originalFromBalance = from.getBalance();
        int originalToBalance = to.getBalance();

        System.out.println("\n  ğŸ“Š ì´ì²´ ì „ ì”ì•¡:");
        System.out.println("    " + from);
        System.out.println("    " + to);

        try {
            // 1ë‹¨ê³„: ì¶œê¸ˆ
            System.out.println("\n  1ï¸âƒ£ ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘...");
            from.withdraw(amount);
            System.out.println("    âœ… ì¶œê¸ˆ ì™„ë£Œ: " + from.getBalance() + "ì› ë‚¨ìŒ");

            // 2ë‹¨ê³„: ì…ê¸ˆ (ì‹œë®¬ë ˆì´ì…˜: ëœë¤ ì‹¤íŒ¨)
            System.out.println("\n  2ï¸âƒ£ ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...");

            // 30% í™•ë¥ ë¡œ ì…ê¸ˆ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
            if (Math.random() < 0.3) {
                throw new RuntimeException("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì…ê¸ˆ ì²˜ë¦¬ ì‹¤íŒ¨");
            }

            to.deposit(amount);
            System.out.println("    âœ… ì…ê¸ˆ ì™„ë£Œ: " + to.getBalance() + "ì›");

            // íŠ¸ëœì­ì…˜ ì»¤ë°‹
            System.out.println("\nâœ… [Transaction Commit] ì´ì²´ ì„±ê³µ!");
            System.out.println("  ğŸ“Š ì´ì²´ í›„ ì”ì•¡:");
            System.out.println("    " + from);
            System.out.println("    " + to);

        } catch (Exception e) {
            // âŒ ë¡¤ë°± ìˆ˜í–‰
            System.out.println("\nâŒ [Transaction Rollback] ì˜ˆì™¸ ë°œìƒ: " + e.getMessage());
            System.out.println("  ğŸ”„ ë¡¤ë°± ì‹œì‘...");

            // ì›ë˜ ì”ì•¡ìœ¼ë¡œ ë³µêµ¬
            from.deposit(from.getBalance() - originalFromBalance < 0 ?
                        originalFromBalance - from.getBalance() : 0);
            to.deposit(to.getBalance() - originalToBalance < 0 ?
                      originalToBalance - to.getBalance() : 0);

            System.out.println("  âœ… ë¡¤ë°± ì™„ë£Œ");
            System.out.println("  ğŸ“Š ë¡¤ë°± í›„ ì”ì•¡:");
            System.out.println("    " + from);
            System.out.println("    " + to);

            throw new TransferException("ì´ì²´ ì‹¤íŒ¨", e);
        }
    }
}

public class TransactionRollbackExample {
    public static void main(String[] args) {
        System.out.println("=== Transaction Rollback - ì¹´ì¹´ì˜¤ë±…í¬ ì‚¬ë¡€ ===\n");

        AccountService service = new AccountService();

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ì‹œë‚˜ë¦¬ì˜¤: ì—¬ëŸ¬ ë²ˆ ì´ì²´ ì‹œë„ (ì¼ë¶€ ì„±ê³µ, ì¼ë¶€ ì‹¤íŒ¨)
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("=".repeat(60));
        System.out.println("ì‹œë‚˜ë¦¬ì˜¤: ì—¬ëŸ¬ ë²ˆ ì´ì²´ ì‹œë„ (ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜ í™•ì¸)");
        System.out.println("=".repeat(60));

        for (int i = 1; i <= 3; i++) {
            System.out.println("\n" + "=".repeat(60));
            System.out.println("ì´ì²´ ì‹œë„ #" + i);
            System.out.println("=".repeat(60));

            try {
                service.transfer("1001", "1002", 100000);
            } catch (TransferException e) {
                System.out.println("\nâš ï¸ ìµœì¢… ê²°ê³¼: " + e.getMessage());
            }

            try {
                Thread.sleep(1000);  // ê°€ë…ì„±ì„ ìœ„í•œ ì§€ì—°
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // í•µì‹¬ ì •ë¦¬
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("\n" + "=".repeat(60));
        System.out.println("=".repeat(60));
        System.out.println("\nğŸ’¡ Transaction Rollback í•µì‹¬:");

        System.out.println("\n1ï¸âƒ£ ACID ì›ì¹™:");
        System.out.println("   - Atomicity (ì›ìì„±): ì „ë¶€ ì„±ê³µ ë˜ëŠ” ì „ë¶€ ì‹¤íŒ¨");
        System.out.println("   - Consistency (ì¼ê´€ì„±): ë°ì´í„° ì •í•©ì„± ìœ ì§€");
        System.out.println("   - Isolation (ê²©ë¦¬ì„±): íŠ¸ëœì­ì…˜ ê°„ ë…ë¦½");
        System.out.println("   - Durability (ì˜ì†ì„±): ì»¤ë°‹ í›„ ì˜êµ¬ ì €ì¥");

        System.out.println("\n2ï¸âƒ£ ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤:");
        System.out.println("   - ì¶œê¸ˆ ì„±ê³µ â†’ ì…ê¸ˆ ì‹¤íŒ¨ â†’ ì¶œê¸ˆ ì·¨ì†Œ (ë¡¤ë°±)");
        System.out.println("   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ëŠê¹€");
        System.out.println("   - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜");

        System.out.println("\n3ï¸âƒ£ êµ¬í˜„ ë°©ë²•:");
        System.out.println("   - try-catchë¡œ ì˜ˆì™¸ ê°ì§€");
        System.out.println("   - catch ë¸”ë¡ì—ì„œ ë¡¤ë°± ìˆ˜í–‰");
        System.out.println("   - ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬");

        System.out.println("\n4ï¸âƒ£ ì‹¤ë¬´ í™œìš©:");
        System.out.println("   - @Transactional (Spring)");
        System.out.println("   - Connection.rollback() (JDBC)");
        System.out.println("   - EntityManager.getTransaction().rollback() (JPA)");
    }
}
```

**ì‹¤í–‰ ê²°ê³¼ (ì˜ˆì‹œ):**
```
=== Transaction Rollback - ì¹´ì¹´ì˜¤ë±…í¬ ì‚¬ë¡€ ===

============================================================
ì‹œë‚˜ë¦¬ì˜¤: ì—¬ëŸ¬ ë²ˆ ì´ì²´ ì‹œë„ (ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜ í™•ì¸)
============================================================

============================================================
ì´ì²´ ì‹œë„ #1
============================================================

ğŸ’¸ [Transaction Start] ê³„ì¢Œ ì´ì²´ ì‹œì‘
  ì¶œê¸ˆ ê³„ì¢Œ: 1001
  ì…ê¸ˆ ê³„ì¢Œ: 1002
  ê¸ˆì•¡: 100000ì›

  ğŸ“Š ì´ì²´ ì „ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 1,000,000ì›}
    Account{1002, ì´ì˜í¬, 500,000ì›}

  1ï¸âƒ£ ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘...
    âœ… ì¶œê¸ˆ ì™„ë£Œ: 900000ì› ë‚¨ìŒ

  2ï¸âƒ£ ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...
    âœ… ì…ê¸ˆ ì™„ë£Œ: 600000ì›

âœ… [Transaction Commit] ì´ì²´ ì„±ê³µ!
  ğŸ“Š ì´ì²´ í›„ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 900,000ì›}
    Account{1002, ì´ì˜í¬, 600,000ì›}

============================================================
ì´ì²´ ì‹œë„ #2
============================================================

ğŸ’¸ [Transaction Start] ê³„ì¢Œ ì´ì²´ ì‹œì‘
  ì¶œê¸ˆ ê³„ì¢Œ: 1001
  ì…ê¸ˆ ê³„ì¢Œ: 1002
  ê¸ˆì•¡: 100000ì›

  ğŸ“Š ì´ì²´ ì „ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 900,000ì›}
    Account{1002, ì´ì˜í¬, 600,000ì›}

  1ï¸âƒ£ ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘...
    âœ… ì¶œê¸ˆ ì™„ë£Œ: 800000ì› ë‚¨ìŒ

  2ï¸âƒ£ ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...

âŒ [Transaction Rollback] ì˜ˆì™¸ ë°œìƒ: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì…ê¸ˆ ì²˜ë¦¬ ì‹¤íŒ¨
  ğŸ”„ ë¡¤ë°± ì‹œì‘...
  âœ… ë¡¤ë°± ì™„ë£Œ
  ğŸ“Š ë¡¤ë°± í›„ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 900,000ì›}
    Account{1002, ì´ì˜í¬, 600,000ì›}

âš ï¸ ìµœì¢… ê²°ê³¼: ì´ì²´ ì‹¤íŒ¨

============================================================
ì´ì²´ ì‹œë„ #3
============================================================

ğŸ’¸ [Transaction Start] ê³„ì¢Œ ì´ì²´ ì‹œì‘
  ì¶œê¸ˆ ê³„ì¢Œ: 1001
  ì…ê¸ˆ ê³„ì¢Œ: 1002
  ê¸ˆì•¡: 100000ì›

  ğŸ“Š ì´ì²´ ì „ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 900,000ì›}
    Account{1002, ì´ì˜í¬, 600,000ì›}

  1ï¸âƒ£ ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘...
    âœ… ì¶œê¸ˆ ì™„ë£Œ: 800000ì› ë‚¨ìŒ

  2ï¸âƒ£ ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...
    âœ… ì…ê¸ˆ ì™„ë£Œ: 700000ì›

âœ… [Transaction Commit] ì´ì²´ ì„±ê³µ!
  ğŸ“Š ì´ì²´ í›„ ì”ì•¡:
    Account{1001, ê¹€ì² ìˆ˜, 800,000ì›}
    Account{1002, ì´ì˜í¬, 700,000ì›}

============================================================
============================================================

ğŸ’¡ Transaction Rollback í•µì‹¬:

1ï¸âƒ£ ACID ì›ì¹™:
   - Atomicity (ì›ìì„±): ì „ë¶€ ì„±ê³µ ë˜ëŠ” ì „ë¶€ ì‹¤íŒ¨
   - Consistency (ì¼ê´€ì„±): ë°ì´í„° ì •í•©ì„± ìœ ì§€
   - Isolation (ê²©ë¦¬ì„±): íŠ¸ëœì­ì…˜ ê°„ ë…ë¦½
   - Durability (ì˜ì†ì„±): ì»¤ë°‹ í›„ ì˜êµ¬ ì €ì¥

2ï¸âƒ£ ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤:
   - ì¶œê¸ˆ ì„±ê³µ â†’ ì…ê¸ˆ ì‹¤íŒ¨ â†’ ì¶œê¸ˆ ì·¨ì†Œ (ë¡¤ë°±)
   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ëŠê¹€
   - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜

3ï¸âƒ£ êµ¬í˜„ ë°©ë²•:
   - try-catchë¡œ ì˜ˆì™¸ ê°ì§€
   - catch ë¸”ë¡ì—ì„œ ë¡¤ë°± ìˆ˜í–‰
   - ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬

4ï¸âƒ£ ì‹¤ë¬´ í™œìš©:
   - @Transactional (Spring)
   - Connection.rollback() (JDBC)
   - EntityManager.getTransaction().rollback() (JPA)
```

---

## ğŸ“™ Case Study 3: Retry ë©”ì»¤ë‹ˆì¦˜ - ì¼ì‹œì  ì˜¤ë¥˜ ëŒ€ì‘

### ë°°ê²½
**ì¿ íŒ¡** ì£¼ë¬¸ ì‹œìŠ¤í…œì—ì„œ ì™¸ë¶€ ê²°ì œ API í˜¸ì¶œ ì‹œ ì¼ì‹œì ì¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•œ ë²ˆ ì‹¤íŒ¨í–ˆë‹¤ê³  í¬ê¸°í•˜ë©´ ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ë¹ ì§‘ë‹ˆë‹¤.

**í•´ê²°ì±…**: Retry ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì¼ì‹œì  ì˜¤ë¥˜ë¥¼ ê·¹ë³µ

### ì‹¤ì œ ì½”ë“œ

```java
// ğŸ“ RetryMechanismExample.java

import java.util.Random;

class NetworkException extends Exception {
    public NetworkException(String message) {
        super(message);
    }
}

class PaymentGateway {
    private Random random = new Random();
    private int attemptCount = 0;

    // ì‹œë®¬ë ˆì´ì…˜: 70% í™•ë¥ ë¡œ ì„±ê³µ
    public String processPayment(String orderId, int amount) throws NetworkException {
        attemptCount++;
        System.out.println("\n  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #" + attemptCount);
        System.out.println("    ì£¼ë¬¸ ID: " + orderId);
        System.out.println("    ê¸ˆì•¡: " + amount + "ì›");

        // ëœë¤ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ
        if (random.nextDouble() < 0.3) {  // 30% í™•ë¥ ë¡œ ì‹¤íŒ¨
            throw new NetworkException("ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜");
        }

        String transactionId = "TXN-" + System.currentTimeMillis();
        System.out.println("    âœ… ê²°ì œ ì„±ê³µ: " + transactionId);
        return transactionId;
    }

    public int getAttemptCount() {
        return attemptCount;
    }

    public void resetAttemptCount() {
        attemptCount = 0;
    }
}

class OrderService {
    private PaymentGateway paymentGateway = new PaymentGateway();

    // âœ… Retry ë©”ì»¤ë‹ˆì¦˜ ì ìš©
    public String placeOrder(String orderId, int amount) throws Exception {
        System.out.println("ğŸ“¦ [ì£¼ë¬¸ ì„œë¹„ìŠ¤] ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: " + orderId);

        int maxRetries = 3;
        int retryDelay = 1000;  // 1ì´ˆ

        for (int attempt = 1; attempt <= maxRetries; attempt++) {
            try {
                System.out.println("\nğŸ”„ ì‹œë„ " + attempt + "/" + maxRetries);

                // ê²°ì œ ì²˜ë¦¬
                String transactionId = paymentGateway.processPayment(orderId, amount);

                System.out.println("\nâœ… [ì£¼ë¬¸ ì™„ë£Œ] ê±°ë˜ ID: " + transactionId);
                return transactionId;

            } catch (NetworkException e) {
                System.out.println("  âŒ ì‹¤íŒ¨: " + e.getMessage());

                if (attempt < maxRetries) {
                    System.out.println("  â³ " + (retryDelay / 1000) + "ì´ˆ í›„ ì¬ì‹œë„...");
                    try {
                        Thread.sleep(retryDelay);
                    } catch (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        throw new Exception("ì¬ì‹œë„ ì¤‘ë‹¨ë¨", ie);
                    }
                } else {
                    System.out.println("  âŒ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼");
                    throw new Exception("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼", e);
                }
            }
        }

        throw new Exception("ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜");
    }
}

public class RetryMechanismExample {
    public static void main(String[] args) {
        System.out.println("=== Retry ë©”ì»¤ë‹ˆì¦˜ - ì¿ íŒ¡ ì£¼ë¬¸ ì‹œìŠ¤í…œ ì‚¬ë¡€ ===\n");

        OrderService orderService = new OrderService();

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ì‹œë‚˜ë¦¬ì˜¤: 3ë²ˆì˜ ì£¼ë¬¸ ì‹œë„
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        for (int i = 1; i <= 3; i++) {
            System.out.println("=".repeat(60));
            System.out.println("ì£¼ë¬¸ #" + i);
            System.out.println("=".repeat(60));

            try {
                String transactionId = orderService.placeOrder("ORDER-" + i, 50000 * i);
                System.out.println("\nğŸ‰ ì£¼ë¬¸ ì„±ê³µ!");
            } catch (Exception e) {
                System.out.println("\nğŸ’” ì£¼ë¬¸ ì‹¤íŒ¨: " + e.getMessage());
            }

            System.out.println("\n");
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // í•µì‹¬ ì •ë¦¬
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        System.out.println("=".repeat(60));
        System.out.println("\nğŸ’¡ Retry ë©”ì»¤ë‹ˆì¦˜ í•µì‹¬:");

        System.out.println("\n1ï¸âƒ£ ì¼ì‹œì  ì˜¤ë¥˜ vs ì˜êµ¬ì  ì˜¤ë¥˜:");
        System.out.println("   âœ… Retry ê°€ëŠ¥: ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ, ì¼ì‹œì  ì„œë²„ ê³¼ë¶€í•˜");
        System.out.println("   âŒ Retry ë¶ˆê°€: ì˜ëª»ëœ íŒŒë¼ë¯¸í„°, ì¸ì¦ ì‹¤íŒ¨, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜");

        System.out.println("\n2ï¸âƒ£ Retry ì „ëµ:");
        System.out.println("   - Fixed Delay: ê³ ì • ì‹œê°„ ëŒ€ê¸°");
        System.out.println("   - Exponential Backoff: ì ì§„ì ìœ¼ë¡œ ëŒ€ê¸° ì‹œê°„ ì¦ê°€ (1ì´ˆ, 2ì´ˆ, 4ì´ˆ...)");
        System.out.println("   - Jitter: ëœë¤ ì§€ì—° ì¶”ê°€ (ë™ì‹œ ìš”ì²­ ë¶„ì‚°)");

        System.out.println("\n3ï¸âƒ£ ì£¼ì˜ì‚¬í•­:");
        System.out.println("   âš ï¸ Idempotent (ë©±ë“±ì„±) ë³´ì¥ í•„ìš”");
        System.out.println("   âš ï¸ ë¬´í•œ ì¬ì‹œë„ ë°©ì§€ (ìµœëŒ€ íšŸìˆ˜ ì„¤ì •)");
        System.out.println("   âš ï¸ Circuit Breaker íŒ¨í„´ í•¨ê»˜ ì‚¬ìš©");

        System.out.println("\n4ï¸âƒ£ ì‹¤ë¬´ ë¼ì´ë¸ŒëŸ¬ë¦¬:");
        System.out.println("   - Spring Retry");
        System.out.println("   - Resilience4j");
        System.out.println("   - Hystrix (Netflix)");
    }
}
```

**ì‹¤í–‰ ê²°ê³¼ (ì˜ˆì‹œ):**
```
=== Retry ë©”ì»¤ë‹ˆì¦˜ - ì¿ íŒ¡ ì£¼ë¬¸ ì‹œìŠ¤í…œ ì‚¬ë¡€ ===

============================================================
ì£¼ë¬¸ #1
============================================================
ğŸ“¦ [ì£¼ë¬¸ ì„œë¹„ìŠ¤] ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORDER-1

ğŸ”„ ì‹œë„ 1/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #1
    ì£¼ë¬¸ ID: ORDER-1
    ê¸ˆì•¡: 50000ì›
  âŒ ì‹¤íŒ¨: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
  â³ 1ì´ˆ í›„ ì¬ì‹œë„...

ğŸ”„ ì‹œë„ 2/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #2
    ì£¼ë¬¸ ID: ORDER-1
    ê¸ˆì•¡: 50000ì›
    âœ… ê²°ì œ ì„±ê³µ: TXN-1699012345678

âœ… [ì£¼ë¬¸ ì™„ë£Œ] ê±°ë˜ ID: TXN-1699012345678

ğŸ‰ ì£¼ë¬¸ ì„±ê³µ!

============================================================
ì£¼ë¬¸ #2
============================================================
ğŸ“¦ [ì£¼ë¬¸ ì„œë¹„ìŠ¤] ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORDER-2

ğŸ”„ ì‹œë„ 1/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #3
    ì£¼ë¬¸ ID: ORDER-2
    ê¸ˆì•¡: 100000ì›
    âœ… ê²°ì œ ì„±ê³µ: TXN-1699012346789

âœ… [ì£¼ë¬¸ ì™„ë£Œ] ê±°ë˜ ID: TXN-1699012346789

ğŸ‰ ì£¼ë¬¸ ì„±ê³µ!

============================================================
ì£¼ë¬¸ #3
============================================================
ğŸ“¦ [ì£¼ë¬¸ ì„œë¹„ìŠ¤] ì£¼ë¬¸ ì²˜ë¦¬ ì‹œì‘: ORDER-3

ğŸ”„ ì‹œë„ 1/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #4
    ì£¼ë¬¸ ID: ORDER-3
    ê¸ˆì•¡: 150000ì›
  âŒ ì‹¤íŒ¨: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
  â³ 1ì´ˆ í›„ ì¬ì‹œë„...

ğŸ”„ ì‹œë„ 2/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #5
    ì£¼ë¬¸ ID: ORDER-3
    ê¸ˆì•¡: 150000ì›
  âŒ ì‹¤íŒ¨: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
  â³ 1ì´ˆ í›„ ì¬ì‹œë„...

ğŸ”„ ì‹œë„ 3/3

  ğŸŒ [ì™¸ë¶€ API] ê²°ì œ ìš”ì²­ #6
    ì£¼ë¬¸ ID: ORDER-3
    ê¸ˆì•¡: 150000ì›
  âŒ ì‹¤íŒ¨: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
  âŒ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼

ğŸ’” ì£¼ë¬¸ ì‹¤íŒ¨: ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼

============================================================

ğŸ’¡ Retry ë©”ì»¤ë‹ˆì¦˜ í•µì‹¬:

1ï¸âƒ£ ì¼ì‹œì  ì˜¤ë¥˜ vs ì˜êµ¬ì  ì˜¤ë¥˜:
   âœ… Retry ê°€ëŠ¥: ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ, ì¼ì‹œì  ì„œë²„ ê³¼ë¶€í•˜
   âŒ Retry ë¶ˆê°€: ì˜ëª»ëœ íŒŒë¼ë¯¸í„°, ì¸ì¦ ì‹¤íŒ¨, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜

2ï¸âƒ£ Retry ì „ëµ:
   - Fixed Delay: ê³ ì • ì‹œê°„ ëŒ€ê¸°
   - Exponential Backoff: ì ì§„ì ìœ¼ë¡œ ëŒ€ê¸° ì‹œê°„ ì¦ê°€ (1ì´ˆ, 2ì´ˆ, 4ì´ˆ...)
   - Jitter: ëœë¤ ì§€ì—° ì¶”ê°€ (ë™ì‹œ ìš”ì²­ ë¶„ì‚°)

3ï¸âƒ£ ì£¼ì˜ì‚¬í•­:
   âš ï¸ Idempotent (ë©±ë“±ì„±) ë³´ì¥ í•„ìš”
   âš ï¸ ë¬´í•œ ì¬ì‹œë„ ë°©ì§€ (ìµœëŒ€ íšŸìˆ˜ ì„¤ì •)
   âš ï¸ Circuit Breaker íŒ¨í„´ í•¨ê»˜ ì‚¬ìš©

4ï¸âƒ£ ì‹¤ë¬´ ë¼ì´ë¸ŒëŸ¬ë¦¬:
   - Spring Retry
   - Resilience4j
   - Hystrix (Netflix)
```

---

## ğŸ‘¨â€ğŸ’» ì£¼ë‹ˆì–´ ê°œë°œì ì‹œë‚˜ë¦¬ì˜¤

---

## â“ Scenario 1: ì˜ˆì™¸ë¥¼ ë¬´ì‹œí•˜ëŠ” ë¹ˆ catch ë¸”ë¡

### ë¬¸ì œ ìƒí™©
ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì»´íŒŒì¼ ì—ëŸ¬ë¥¼ í”¼í•˜ê¸° ìœ„í•´ catch ë¸”ë¡ì„ ë¹„ì›Œë‘ì—ˆìŠµë‹ˆë‹¤.

```java
// âŒ ì˜ëª»ëœ ì½”ë“œ
try {
    dangerousOperation();
} catch (Exception e) {
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ - ì˜ˆì™¸ ë¬´ì‹œ!
}
```

**ë¬¸ì œì :**
- ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ì•„ë¬´ë„ ëª¨ë¦„
- ë””ë²„ê¹… ë¶ˆê°€ëŠ¥
- ë°ì´í„° ì†ì‹¤ ìœ„í—˜

**í•´ê²° ë°©ë²•:**
```java
// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
try {
    dangerousOperation();
} catch (Exception e) {
    // ìµœì†Œí•œ ë¡œê¹…ì´ë¼ë„!
    System.err.println("ì˜¤ë¥˜ ë°œìƒ: " + e.getMessage());
    e.printStackTrace();

    // ë˜ëŠ” ì ì ˆí•œ ì²˜ë¦¬
    // - ê¸°ë³¸ê°’ ë°˜í™˜
    // - ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
    // - ìƒìœ„ë¡œ ì˜ˆì™¸ ì „íŒŒ
}
```

---

## â“ Scenario 2: Exceptionì„ ì§€ë‚˜ì¹˜ê²Œ ê´‘ë²”ìœ„í•˜ê²Œ ì¡ê¸°

### ë¬¸ì œ ìƒí™©
ì£¼ë‹ˆì–´ ê°œë°œìê°€ ëª¨ë“  ì˜ˆì™¸ë¥¼ `Exception`ìœ¼ë¡œ ì¡ì•„ë²„ë ¸ìŠµë‹ˆë‹¤.

```java
// âŒ ì˜ëª»ëœ ì½”ë“œ
try {
    readFile();
    parseData();
    saveToDatabase();
} catch (Exception e) {  // ë„ˆë¬´ ê´‘ë²”ìœ„!
    System.out.println("ì˜¤ë¥˜ ë°œìƒ");
}
```

**ë¬¸ì œì :**
- ì–´ë–¤ ì˜ˆì™¸ì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ
- NullPointerException ê°™ì€ ë²„ê·¸ë„ ìˆ¨ê¹€
- ê° ì˜ˆì™¸ì— ë§ëŠ” ì²˜ë¦¬ ë¶ˆê°€ëŠ¥

**í•´ê²° ë°©ë²•:**
```java
// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
try {
    readFile();
    parseData();
    saveToDatabase();
} catch (IOException e) {
    System.out.println("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: " + e.getMessage());
    // íŒŒì¼ ê²½ë¡œ í™•ì¸ ì•ˆë‚´
} catch (ParseException e) {
    System.out.println("ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨: " + e.getMessage());
    // ë°ì´í„° í˜•ì‹ í™•ì¸ ì•ˆë‚´
} catch (SQLException e) {
    System.out.println("DB ì €ì¥ ì‹¤íŒ¨: " + e.getMessage());
    // DB ì—°ê²° í™•ì¸ ì•ˆë‚´
}
```

---

## â“ Scenario 3: finally ë¸”ë¡ì—ì„œ return ì‚¬ìš©

### ë¬¸ì œ ìƒí™©
ì£¼ë‹ˆì–´ ê°œë°œìê°€ finally ë¸”ë¡ì—ì„œ returnì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```java
// âŒ ì˜ëª»ëœ ì½”ë“œ
public int calculate() {
    try {
        return 10 / 0;  // ArithmeticException ë°œìƒ
    } catch (Exception e) {
        return -1;  // ì—ëŸ¬ ì½”ë“œ ë°˜í™˜
    } finally {
        return 0;  // â† ì´ê²Œ í•­ìƒ ë°˜í™˜ë¨!
    }
}
```

**ë¬¸ì œì :**
- finallyì˜ returnì´ try/catchì˜ returnì„ ë®ì–´ì”€
- ì˜ˆì™¸ ì •ë³´ ì†ì‹¤
- ì˜ˆìƒì¹˜ ëª»í•œ ë™ì‘

**í•´ê²° ë°©ë²•:**
```java
// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
public int calculate() {
    int result = 0;
    try {
        result = 10 / 0;
    } catch (Exception e) {
        result = -1;
        System.err.println("ê³„ì‚° ì˜¤ë¥˜: " + e.getMessage());
    } finally {
        // ë¦¬ì†ŒìŠ¤ ì •ë¦¬ë§Œ!
        // return ì‚¬ìš© ê¸ˆì§€
    }
    return result;
}
```

---

## â“ Scenario 4: throwsì™€ throw í˜¼ë™

### ë¬¸ì œ ìƒí™©
ì£¼ë‹ˆì–´ ê°œë°œìê°€ throwsì™€ throwë¥¼ í˜¼ë™í–ˆìŠµë‹ˆë‹¤.

```java
// âŒ ì˜ëª»ëœ ì½”ë“œ
public void method1() throw Exception {  // ë¬¸ë²• ì˜¤ë¥˜!
    // ...
}

public void method2() throws Exception {
    // ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠìŒ - throwsë§Œ ì„ ì–¸
}

public void method3() {
    throw new Exception();  // ì»´íŒŒì¼ ì—ëŸ¬! (throws ì„ ì–¸ ì—†ìŒ)
}
```

**í•´ê²° ë°©ë²•:**
```java
// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ

// throws: ë©”ì„œë“œê°€ ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ìˆ˜ ìˆìŒì„ ì„ ì–¸
public void method1() throws IOException {
    // IOExceptionì„ ë˜ì§ˆ ìˆ˜ ìˆìŒ
}

// throw: ì‹¤ì œë¡œ ì˜ˆì™¸ë¥¼ ë˜ì§
public void method2() throws IllegalArgumentException {
    if (condition) {
        throw new IllegalArgumentException("ì˜ëª»ëœ ì¸ì");
    }
}

// throws ì—†ì´ throw (Unchecked Exceptionë§Œ ê°€ëŠ¥)
public void method3() {
    throw new RuntimeException("ëŸ°íƒ€ì„ ì—ëŸ¬");  // OK
}
```

**ì •ë¦¬:**
- `throws`: ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ì— ì„ ì–¸ (ì˜ˆì™¸ ê°€ëŠ¥ì„± ì•Œë¦¼)
- `throw`: ì‹¤ì œë¡œ ì˜ˆì™¸ ê°ì²´ë¥¼ ë˜ì§

---

## ğŸ“ ì „ì²´ ìš”ì•½

### ê³„ì¸µë³„ ì˜ˆì™¸ ì²˜ë¦¬
- Repository: ë°ì´í„° ì ‘ê·¼ ì˜ˆì™¸
- Service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸
- Controller: HTTP ì‘ë‹µ ë³€í™˜

### Transaction Rollback
- ACID ì›ì¹™ ì¤€ìˆ˜
- ì˜ˆì™¸ ë°œìƒ ì‹œ ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬
- ë°ì´í„° ì •í•©ì„± ë³´ì¥

### Retry ë©”ì»¤ë‹ˆì¦˜
- ì¼ì‹œì  ì˜¤ë¥˜ ê·¹ë³µ
- ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì„¤ì •
- Exponential Backoff ì „ëµ

### ì£¼ë‹ˆì–´ ì‹¤ìˆ˜ ë°©ì§€
1. ë¹ˆ catch ë¸”ë¡ ê¸ˆì§€
2. êµ¬ì²´ì ì¸ ì˜ˆì™¸ íƒ€ì… ì‚¬ìš©
3. finallyì—ì„œ return ê¸ˆì§€
4. throws vs throw êµ¬ë¶„

---

**ğŸ“Œ ë‹¤ìŒ Part 3ì—ì„œëŠ”**
ì‹¤ì „ í”„ë¡œì íŠ¸, FAQ, ë©´ì ‘ ì§ˆë¬¸ì„ í†µí•´ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì™„ì „íˆ ë§ˆìŠ¤í„°í•©ë‹ˆë‹¤!
