# 2-4. íšŒì› ë„ë©”ì¸ ê°œë°œ

## í•™ìŠµ ëª©í‘œ
- íšŒì› ë„ë©”ì¸ì˜ ì‹¤ì œ êµ¬í˜„ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤
- ì—”í‹°í‹°, ë¦¬í¬ì§€í† ë¦¬, ì„œë¹„ìŠ¤ì˜ ì—­í• ì„ ì´í•´í•œë‹¤
- ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤
- Javaì˜ enum, HashMap, ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ë°©ë²•ì„ í•™ìŠµí•œë‹¤

## ì—°ê´€ ê°œë…
- **ì—”í‹°í‹°(Entity)**: ë„ë©”ì¸ì˜ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë¥¼ ë‹´ëŠ” ê°ì²´
- **ë¦¬í¬ì§€í† ë¦¬(Repository)**: ë°ì´í„° ì €ì¥ê³¼ ì¡°íšŒë¥¼ ë‹´ë‹¹í•˜ëŠ” ê³„ì¸µ
- **ì„œë¹„ìŠ¤(Service)**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ê³„ì¸µ
- **enum**: ê³ ì •ëœ ìƒìˆ˜ ì§‘í•©ì„ í‘œí˜„í•˜ëŠ” Java íƒ€ì…

---

## TL;DR (ê°„ë‹¨ ìš”ì•½)

### êµ¬í˜„í•  ì»´í¬ë„ŒíŠ¸
1. **Grade (enum)**: íšŒì› ë“±ê¸‰ (BASIC, VIP)
2. **Member**: íšŒì› ì—”í‹°í‹° (id, name, grade)
3. **MemberRepository**: ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤
4. **MemoryMemberRepository**: ë©”ëª¨ë¦¬ ê¸°ë°˜ ì €ì¥ì†Œ êµ¬í˜„ì²´
5. **MemberService**: ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤
6. **MemberServiceImpl**: ì„œë¹„ìŠ¤ êµ¬í˜„ì²´

### êµ¬í˜„ ìˆœì„œ
```
ì—”í‹°í‹° â†’ ë¦¬í¬ì§€í† ë¦¬ â†’ ì„œë¹„ìŠ¤
(ë°ì´í„° â†’ ì €ì¥ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
```

---

## íšŒì› ì—”í‹°í‹° êµ¬í˜„

### Grade - íšŒì› ë“±ê¸‰

```java
package hello.core.member;

public enum Grade {
    BASIC,
    VIP
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/Grade.java`

#### enum ì‚¬ìš© ì´ìœ 
- íšŒì› ë“±ê¸‰ì€ ì œí•œëœ ê°’ë§Œ ê°€ëŠ¥ (BASIC, VIP)
- ë¬¸ìì—´ ì‚¬ìš© ì‹œ ì˜¤íƒ€ ê°€ëŠ¥ì„± ì œê±°
- íƒ€ì… ì•ˆì •ì„± í™•ë³´
- IDEì˜ ìë™ì™„ì„± ì§€ì›

```java
// âŒ ë¬¸ìì—´ ì‚¬ìš© ì‹œ ë¬¸ì œì 
String grade = "VPI";  // ì˜¤íƒ€ ë°œìƒ, ì»´íŒŒì¼ íƒ€ì„ì— ë°œê²¬ ë¶ˆê°€

// âœ… enum ì‚¬ìš©
Grade grade = Grade.VIP;  // íƒ€ì… ì•ˆì „, ì˜¤íƒ€ ë¶ˆê°€ëŠ¥
```

---

### Member - íšŒì› ì—”í‹°í‹°

```java
package hello.core.member;

public class Member {

    private Long id;
    private String name;
    private Grade grade;

    // ìƒì„±ì
    public Member(Long id, String name, Grade grade) {
        this.id = id;
        this.name = name;
        this.grade = grade;
    }

    // Getter & Setter
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Grade getGrade() {
        return grade;
    }

    public void setGrade(Grade grade) {
        this.grade = grade;
    }
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/Member.java`

#### Member í´ë˜ìŠ¤ ì„¤ëª…
- **í•„ë“œ**: id (ì‹ë³„ì), name (ì´ë¦„), grade (ë“±ê¸‰)
- **ìƒì„±ì**: ê°ì²´ ìƒì„± ì‹œ ëª¨ë“  í•„ë“œ ì´ˆê¸°í™”
- **Getter/Setter**: í•„ë“œ ì ‘ê·¼ ë° ìˆ˜ì • ë©”ì„œë“œ

#### ì„¤ê³„ íŠ¹ì§•
```java
// ìˆœìˆ˜í•œ Java ê°ì²´ (POJO - Plain Old Java Object)
// Spring, JPA ë“±ì˜ í”„ë ˆì„ì›Œí¬ ì˜ì¡´ì„± ì—†ìŒ
// ë„ë©”ì¸ì˜ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í¬í•¨
```

---

## íšŒì› ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„

### MemberRepository - ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.member;

public interface MemberRepository {

    void save(Member member);

    Member findById(Long memberId);
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/MemberRepository.java`

#### ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œ
- `save()`: íšŒì› ì €ì¥
- `findById()`: IDë¡œ íšŒì› ì¡°íšŒ

#### ì¶”ìƒí™” ìˆ˜ì¤€
```
êµ¬ì²´ì ì¸ ì €ì¥ ë°©ì‹ì€ ëª…ì‹œí•˜ì§€ ì•ŠìŒ
â†’ ë©”ëª¨ë¦¬, DB, íŒŒì¼ ë“± ë‹¤ì–‘í•œ êµ¬í˜„ ê°€ëŠ¥
â†’ OCP(ê°œë°©-íì‡„ ì›ì¹™) ì¤€ìˆ˜
```

---

### MemoryMemberRepository - êµ¬í˜„ì²´

```java
package hello.core.member;

import java.util.HashMap;
import java.util.Map;

public class MemoryMemberRepository implements MemberRepository {

    private static Map<Long, Member> store = new HashMap<>();

    @Override
    public void save(Member member) {
        store.put(member.getId(), member);
    }

    @Override
    public Member findById(Long memberId) {
        return store.get(memberId);
    }
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/MemoryMemberRepository.java`

#### êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

##### static ì‚¬ìš© ì´ìœ 
```java
private static Map<Long, Member> store = new HashMap<>();
```
- ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ ê°™ì€ ì €ì¥ì†Œë¥¼ ê³µìœ 
- ì‹±ê¸€í†¤ì²˜ëŸ¼ ë™ì‘ (í•˜ë‚˜ì˜ ì €ì¥ì†Œë§Œ ì¡´ì¬)

##### HashMap ì‚¬ìš©
- Key: memberId (Long)
- Value: Member ê°ì²´
- O(1) ì‹œê°„ë³µì¡ë„ë¡œ ë¹ ë¥¸ ì¡°íšŒ

---

## ì‹¬í™” ë‚´ìš©

### 1. ë™ì‹œì„± ë¬¸ì œ

#### í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì 
```java
private static Map<Long, Member> store = new HashMap<>();
```

HashMapì€ **thread-safeí•˜ì§€ ì•ŠìŒ**:
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë©´ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
- ì‹¤ë¬´ì—ì„œëŠ” ë™ì‹œì„± ì´ìŠˆ ë°œìƒ

#### í•´ê²° ë°©ë²•

**ë°©ë²• 1: ConcurrentHashMap ì‚¬ìš©**
```java
private static Map<Long, Member> store = new ConcurrentHashMap<>();
```
- Thread-safeí•œ HashMap êµ¬í˜„ì²´
- ë‚´ë¶€ì ìœ¼ë¡œ ë½ ë¶„í• (Lock Striping) ì‚¬ìš©
- ì„±ëŠ¥ê³¼ ì•ˆì „ì„± ëª¨ë‘ í™•ë³´

**ë°©ë²• 2: Collections.synchronizedMap ì‚¬ìš©**
```java
private static Map<Long, Member> store =
    Collections.synchronizedMap(new HashMap<>());
```
- ëª¨ë“  ë©”ì„œë“œì— synchronized ì ìš©
- ConcurrentHashMapë³´ë‹¤ ì„±ëŠ¥ì´ ë‚®ìŒ

**ë°©ë²• 3: ë¶ˆë³€ ê°ì²´ ì‚¬ìš©**
```java
public Member findById(Long memberId) {
    Member member = store.get(memberId);
    // ë°©ì–´ì  ë³µì‚¬
    return new Member(member.getId(), member.getName(), member.getGrade());
}
```

### 2. ID ìƒì„± ì „ëµ

í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ IDë¥¼ ì§ì ‘ ìƒì„±:
```java
Member member = new Member(1L, "memberA", Grade.VIP);
```

#### ì‹¤ë¬´ ID ìƒì„± ì „ëµ

**AUTO_INCREMENT (DB ìƒì„±)**
```java
public class MemoryMemberRepository implements MemberRepository {
    private static AtomicLong sequence = new AtomicLong(0);
    private static Map<Long, Member> store = new ConcurrentHashMap<>();

    @Override
    public void save(Member member) {
        // IDê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„±
        if (member.getId() == null) {
            member.setId(sequence.incrementAndGet());
        }
        store.put(member.getId(), member);
    }
}
```

**UUID ì‚¬ìš©**
```java
public class Member {
    private String id;  // UUIDëŠ” Stringìœ¼ë¡œ
    private String name;
    private Grade grade;

    public Member(String name, Grade grade) {
        this.id = UUID.randomUUID().toString();
        this.name = name;
        this.grade = grade;
    }
}
```

**Snowflake ì•Œê³ ë¦¬ì¦˜ (ë¶„ì‚° í™˜ê²½)**
```java
// Twitterì˜ Snowflake ì•Œê³ ë¦¬ì¦˜
// 64bit: 1bit(ì˜ˆì•½) + 41bit(timestamp) + 10bit(machine) + 12bit(sequence)
public class SnowflakeIdGenerator {
    private long workerId;
    private long sequence = 0L;
    private long lastTimestamp = -1L;

    public synchronized long nextId() {
        long timestamp = System.currentTimeMillis();
        // ... Snowflake ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
        return id;
    }
}
```

---

## íšŒì› ì„œë¹„ìŠ¤ êµ¬í˜„

### MemberService - ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.member;

public interface MemberService {

    void join(Member member);

    Member findMember(Long memberId);
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/MemberService.java`

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
- `join()`: íšŒì› ê°€ì…
- `findMember()`: íšŒì› ì¡°íšŒ

#### ë„¤ì´ë° ì² í•™
```
save/find (ë¦¬í¬ì§€í† ë¦¬ ìš©ì–´)
vs
join/findMember (ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´)

ì„œë¹„ìŠ¤ ê³„ì¸µì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ ì‚¬ìš©
â†’ ë„ë©”ì¸ ì „ë¬¸ê°€ì™€ì˜ ì†Œí†µ ê°œì„ 
```

---

### MemberServiceImpl - êµ¬í˜„ì²´

```java
package hello.core.member;

public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

**íŒŒì¼ ìœ„ì¹˜**: `src/main/java/hello/core/member/MemberServiceImpl.java`

#### êµ¬í˜„ ì„¤ëª…
- MemberRepositoryë¥¼ í†µí•´ íšŒì› ì €ì¥/ì¡°íšŒ
- í˜„ì¬ëŠ” ë‹¨ìˆœíˆ ë¦¬í¬ì§€í† ë¦¬ ë©”ì„œë“œ í˜¸ì¶œ
- í–¥í›„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥ (ì¤‘ë³µ ê²€ì¦ ë“±)

---

## ì‹¬í™” ë‚´ìš©

### 1. í˜„ì¬ ì„¤ê³„ì˜ ë¬¸ì œì  - DIP ìœ„ë°˜

```java
private final MemberRepository memberRepository = new MemoryMemberRepository();
```

#### ë¬¸ì œì  ë¶„ì„
```java
// MemberServiceImplì€ ë‘ ê°€ì§€ì— ì˜ì¡´
1. MemberRepository (ì¸í„°í˜ì´ìŠ¤ - ì¶”ìƒ)
2. MemoryMemberRepository (êµ¬í˜„ì²´ - êµ¬ì²´)

â†’ DIP ìœ„ë°˜: "ì¶”ìƒí™”ì— ì˜ì¡´í•´ì•¼ì§€, êµ¬ì²´í™”ì— ì˜ì¡´í•˜ë©´ ì•ˆëœë‹¤"
```

#### ì˜ì¡´ê´€ê³„ ë‹¤ì´ì–´ê·¸ë¨
```mermaid
graph TD
    A[MemberServiceImpl] -->|ì˜ì¡´| B[MemberRepository<br/>interface]
    A -->|ì˜ì¡´| C[MemoryMemberRepository<br/>êµ¬í˜„ì²´]
    C -.êµ¬í˜„.-> B

    style A fill:#ffe6e6
    style C fill:#ffe6e6
```

#### ê°œì„  ë°©ë²• (DI - ì˜ì¡´ì„± ì£¼ì…)
```java
public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository;

    // ìƒì„±ì ì£¼ì… - ì™¸ë¶€ì—ì„œ êµ¬í˜„ì²´ ê²°ì •
    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}

// ì‚¬ìš©
MemberRepository repository = new MemoryMemberRepository();
MemberService service = new MemberServiceImpl(repository);
```

ì´ì œ MemberServiceImplì€ ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´:
```mermaid
graph TD
    A[MemberServiceImpl] -->|ì˜ì¡´| B[MemberRepository<br/>interface]
    C[MemoryMemberRepository] -.êµ¬í˜„.-> B
    D[ì™¸ë¶€ ì¡°ë¦½ì] -->|ì£¼ì…| A
    D -->|ìƒì„±| C

    style A fill:#e6ffe6
    style D fill:#fff4e1
```

### 2. ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì±…ì„

#### í˜„ì¬ ìƒíƒœ
```java
@Override
public void join(Member member) {
    memberRepository.save(member);  // ë‹¨ìˆœ ìœ„ì„
}
```

#### ì‹¤ë¬´ ì˜ˆì‹œ - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€
```java
@Override
public void join(Member member) {
    // 1. ì¤‘ë³µ íšŒì› ê²€ì¦
    validateDuplicateMember(member);

    // 2. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
    validateBusinessRules(member);

    // 3. ì €ì¥
    memberRepository.save(member);

    // 4. ì´ë²¤íŠ¸ ë°œí–‰ (ê°€ì… ì¶•í•˜ ì´ë©”ì¼ ë“±)
    publishMemberJoinedEvent(member);
}

private void validateDuplicateMember(Member member) {
    Member existMember = memberRepository.findById(member.getId());
    if (existMember != null) {
        throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }
}

private void validateBusinessRules(Member member) {
    if (member.getName() == null || member.getName().trim().isEmpty()) {
        throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    if (member.getName().length() > 20) {
        throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ 20ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}

private void publishMemberJoinedEvent(Member member) {
    // ì´ë²¤íŠ¸ ë°œí–‰ ë¡œì§
    eventPublisher.publish(new MemberJoinedEvent(member));
}
```

---

## Tip

### íŒ¨í‚¤ì§€ êµ¬ì¡°
```
hello.core
â””â”€â”€ member
    â”œâ”€â”€ Grade.java              (enum)
    â”œâ”€â”€ Member.java             (ì—”í‹°í‹°)
    â”œâ”€â”€ MemberRepository.java   (ì¸í„°í˜ì´ìŠ¤)
    â”œâ”€â”€ MemoryMemberRepository.java  (êµ¬í˜„ì²´)
    â”œâ”€â”€ MemberService.java      (ì¸í„°í˜ì´ìŠ¤)
    â””â”€â”€ MemberServiceImpl.java  (êµ¬í˜„ì²´)
```

### ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ë‹¨ì¶•í‚¤ (IntelliJ)
```
1. ì¸í„°í˜ì´ìŠ¤ ì‘ì„± í›„
2. Alt + Enter â†’ Implement interface
3. ìë™ìœ¼ë¡œ @Override ë©”ì„œë“œ ìƒì„±
```

### Getter/Setter ìƒì„± (IntelliJ)
```
1. í•„ë“œ ì„ ì–¸ í›„
2. Alt + Insert â†’ Getter and Setter
3. í•„ë“œ ì„ íƒ â†’ ìë™ ìƒì„±
```

---

## ì£¼ì˜ì‚¬í•­

### 1. HashMap vs ConcurrentHashMap
```java
// âŒ ì‹¤ë¬´ ì‚¬ìš© ê¸ˆì§€
private static Map<Long, Member> store = new HashMap<>();

// âœ… ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‚¬ìš©
private static Map<Long, Member> store = new ConcurrentHashMap<>();
```

### 2. static í•„ë“œ ì‚¬ìš© ì£¼ì˜
```java
private static Map<Long, Member> store = new HashMap<>();
```
- staticì€ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ ê³µìœ 
- í…ŒìŠ¤íŠ¸ ì‹œ ë°ì´í„° ì´ˆê¸°í™” í•„ìš”
- ì‹¤ë¬´ì—ì„œëŠ” Spring Beanìœ¼ë¡œ ê´€ë¦¬ (ì‹±ê¸€í†¤)

### 3. null ì²´í¬
```java
@Override
public Member findById(Long memberId) {
    return store.get(memberId);  // null ë°˜í™˜ ê°€ëŠ¥
}

// ê°œì„ 
@Override
public Member findById(Long memberId) {
    Member member = store.get(memberId);
    if (member == null) {
        throw new MemberNotFoundException("íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + memberId);
    }
    return member;
}

// Java 8+ Optional ì‚¬ìš©
public Optional<Member> findById(Long memberId) {
    return Optional.ofNullable(store.get(memberId));
}
```

---

## ë©´ì ‘ ì§ˆë¬¸

### ì´ˆê¸‰ - ì½”ë“œ ì´í•´

**Q1. Gradeë¥¼ enumìœ¼ë¡œ ì •ì˜í•œ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

A: íšŒì› ë“±ê¸‰ì€ BASICê³¼ VIPë¡œ ì œí•œëœ ê°’ë§Œ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. enumì„ ì‚¬ìš©í•˜ë©´:
1. íƒ€ì… ì•ˆì •ì„± í™•ë³´ - ì˜ëª»ëœ ê°’ ì…ë ¥ ë°©ì§€
2. ì»´íŒŒì¼ íƒ€ì„ ì˜¤ë¥˜ ê²€ì¦ - String ì‚¬ìš© ì‹œ ì˜¤íƒ€ë¥¼ ëŸ°íƒ€ì„ì— ë°œê²¬í•˜ì§€ë§Œ enumì€ ì»´íŒŒì¼ ì‹œ ë°œê²¬
3. IDE ìë™ì™„ì„± ì§€ì›
4. ì½”ë“œ ê°€ë…ì„± í–¥ìƒ

```java
// âŒ String ì‚¬ìš© ì‹œ
String grade = "VIIP";  // ì˜¤íƒ€, ëŸ°íƒ€ì„ ì˜¤ë¥˜

// âœ… enum ì‚¬ìš©
Grade grade = Grade.VIP;  // ì»´íŒŒì¼ íƒ€ì„ ê²€ì¦
```

**Q2. MemoryMemberRepositoryì—ì„œ HashMapì„ staticìœ¼ë¡œ ì„ ì–¸í•œ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

A: staticìœ¼ë¡œ ì„ ì–¸í•˜ë©´ ëª¨ë“  MemoryMemberRepository ì¸ìŠ¤í„´ìŠ¤ê°€ ê°™ì€ ì €ì¥ì†Œë¥¼ ê³µìœ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´:
1. ì—¬ëŸ¬ ê³³ì—ì„œ repositoryë¥¼ ìƒì„±í•´ë„ ê°™ì€ ë°ì´í„° ì ‘ê·¼
2. ì‹±ê¸€í†¤ê³¼ ìœ ì‚¬í•œ ë™ì‘
3. ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±

ë‹¤ë§Œ ì‹¤ë¬´ì—ì„œëŠ” staticë³´ë‹¤ Springì˜ ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•©ë‹ˆë‹¤.

### ì¤‘ê¸‰ - ì„¤ê³„ ì›ì¹™

**Q3. MemberServiceImplì´ DIPë¥¼ ìœ„ë°˜í•˜ëŠ” ì´ìœ ì™€ í•´ê²° ë°©ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

A:
**ìœ„ë°˜ ì´ìœ :**
```java
private final MemberRepository memberRepository = new MemoryMemberRepository();
```
ì´ ì½”ë“œëŠ” MemberRepository ì¸í„°í˜ì´ìŠ¤ì™€ MemoryMemberRepository êµ¬í˜„ì²´ ëª¨ë‘ì— ì˜ì¡´í•©ë‹ˆë‹¤. DIPëŠ” "ì¶”ìƒí™”ì— ì˜ì¡´í•˜ê³  êµ¬ì²´í™”ì— ì˜ì¡´í•˜ì§€ ë§ë¼"ëŠ” ì›ì¹™ì´ë¯€ë¡œ ì´ë¥¼ ìœ„ë°˜í•©ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•: ìƒì„±ì ì£¼ì…**
```java
public class MemberServiceImpl implements MemberService {
    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
}
```

ì´ë ‡ê²Œ í•˜ë©´ MemberServiceImplì€ ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ê³ , ì‹¤ì œ êµ¬í˜„ì²´ëŠ” ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— Springì„ ì‚¬ìš©í•˜ë©´ @Autowiredë‚˜ ìƒì„±ì ì£¼ì…ìœ¼ë¡œ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Q4. HashMapì˜ ë™ì‹œì„± ë¬¸ì œì™€ í•´ê²° ë°©ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

A:
**ë¬¸ì œì :**
HashMapì€ thread-safeí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì‹œì— put/get ì‘ì—…ì„ í•˜ë©´:
1. ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
2. ConcurrentModificationException ë°œìƒ ê°€ëŠ¥
3. ë¬´í•œ ë£¨í”„ ë°œìƒ ê°€ëŠ¥ (Java 7 ì´í•˜)

**í•´ê²° ë°©ë²•:**

1. **ConcurrentHashMap ì‚¬ìš© (ê¶Œì¥)**
```java
private static Map<Long, Member> store = new ConcurrentHashMap<>();
```
- Lock Striping ê¸°ë²•ìœ¼ë¡œ ì„±ëŠ¥ê³¼ ì•ˆì „ì„± ëª¨ë‘ í™•ë³´
- ì½ê¸° ì‘ì—…ì€ ë½ ì—†ì´ ìˆ˜í–‰
- ì“°ê¸° ì‘ì—…ë§Œ ë¶€ë¶„ì ìœ¼ë¡œ ë½

2. **Collections.synchronizedMap**
```java
private static Map<Long, Member> store =
    Collections.synchronizedMap(new HashMap<>());
```
- ëª¨ë“  ë©”ì„œë“œì— synchronized ì ìš©
- ì„±ëŠ¥ì´ ConcurrentHashMapë³´ë‹¤ ë‚®ìŒ

3. **synchronized ë¸”ë¡ ì§ì ‘ ì‚¬ìš©**
```java
public synchronized void save(Member member) {
    store.put(member.getId(), member);
}
```
- ê°€ì¥ ë‹¨ìˆœí•˜ì§€ë§Œ ì„±ëŠ¥ì´ ê°€ì¥ ë‚®ìŒ

### ê³ ê¸‰ - ì•„í‚¤í…ì²˜ ì„¤ê³„

**Q5. í˜„ì¬ Member ì—”í‹°í‹°ê°€ ë¹ˆí˜ˆ ë„ë©”ì¸ ëª¨ë¸(Anemic Domain Model)ì¸ ì´ìœ ì™€ ê°œì„  ë°©ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.**

A:
**ë¹ˆí˜ˆ ë„ë©”ì¸ ëª¨ë¸ì´ë€:**
ë°ì´í„°(í•„ë“œ)ë§Œ ìˆê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì—†ëŠ” ë„ë©”ì¸ ê°ì²´ë¥¼ ë§í•©ë‹ˆë‹¤. í˜„ì¬ Member í´ë˜ìŠ¤ëŠ” Getter/Setterë§Œ ìˆê³  í–‰ìœ„ê°€ ì—†ìŠµë‹ˆë‹¤.

```java
// âŒ ë¹ˆí˜ˆ ë„ë©”ì¸ ëª¨ë¸
public class Member {
    private Long id;
    private String name;
    private Grade grade;

    // Getter/Setterë§Œ ì¡´ì¬
}

// ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„œë¹„ìŠ¤ ê³„ì¸µì— ì§‘ì¤‘
public class MemberServiceImpl {
    public void upgradeMember(Long memberId) {
        Member member = memberRepository.findById(memberId);
        if (member.getGrade() == Grade.BASIC) {
            member.setGrade(Grade.VIP);  // ì„œë¹„ìŠ¤ê°€ ë“±ê¸‰ ë³€ê²½ ë¡œì§ ë‹´ë‹¹
        }
    }
}
```

**ë¬¸ì œì :**
1. ê°ì²´ì§€í–¥ì˜ ìº¡ìŠí™” ìœ„ë°˜
2. ë„ë©”ì¸ ë¡œì§ì´ ì„œë¹„ìŠ¤ ê³„ì¸µì— ë¶„ì‚°ë˜ì–´ ì‘ì§‘ë„ ì €í•˜
3. ì¤‘ë³µ ì½”ë“œ ë°œìƒ ê°€ëŠ¥

**ê°œì„ : í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸(Rich Domain Model)**

```java
// âœ… í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸
public class Member {
    private Long id;
    private String name;
    private Grade grade;
    private LocalDateTime joinedAt;
    private int purchaseCount;

    // ìƒì„±ì
    private Member(Long id, String name, Grade grade) {
        validateName(name);
        this.id = id;
        this.name = name;
        this.grade = grade;
        this.joinedAt = LocalDateTime.now();
        this.purchaseCount = 0;
    }

    // ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
    public static Member createBasicMember(Long id, String name) {
        return new Member(id, name, Grade.BASIC);
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ - ë“±ê¸‰ ì—…ê·¸ë ˆì´ë“œ
    public void upgradeToVip() {
        if (this.grade == Grade.VIP) {
            throw new IllegalStateException("ì´ë¯¸ VIP íšŒì›ì…ë‹ˆë‹¤.");
        }
        if (!canUpgradeToVip()) {
            throw new IllegalStateException("VIP ìŠ¹ê¸‰ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
        this.grade = Grade.VIP;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™
    private boolean canUpgradeToVip() {
        return this.purchaseCount >= 10
            && ChronoUnit.MONTHS.between(joinedAt, LocalDateTime.now()) >= 6;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ - êµ¬ë§¤ ê¸°ë¡
    public void recordPurchase() {
        this.purchaseCount++;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ - VIP ì—¬ë¶€ í™•ì¸
    public boolean isVip() {
        return this.grade == Grade.VIP;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ - ì´ë¦„ ë³€ê²½
    public void changeName(String newName) {
        validateName(newName);
        this.name = newName;
    }

    // ê²€ì¦ ë¡œì§
    private void validateName(String name) {
        if (name == null || name.trim().isEmpty()) {
            throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
        }
        if (name.length() > 20) {
            throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ 20ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    // í•„ìš”í•œ Getterë§Œ ì œê³µ (Setter ì œê±°)
    public Long getId() { return id; }
    public String getName() { return name; }
    public Grade getGrade() { return grade; }
    public int getPurchaseCount() { return purchaseCount; }
}
```

**ì„œë¹„ìŠ¤ ê³„ì¸µ ê°œì„ :**
```java
public class MemberServiceImpl implements MemberService {
    private final MemberRepository memberRepository;

    public void upgradeMemberToVip(Long memberId) {
        Member member = memberRepository.findById(memberId);
        member.upgradeToVip();  // ë„ë©”ì¸ ê°ì²´ê°€ ìŠ¤ìŠ¤ë¡œ ì²˜ë¦¬
        memberRepository.save(member);
    }

    public void recordMemberPurchase(Long memberId) {
        Member member = memberRepository.findById(memberId);
        member.recordPurchase();  // ë„ë©”ì¸ ê°ì²´ì˜ ë©”ì„œë“œ í˜¸ì¶œ
        memberRepository.save(member);
    }
}
```

**Value Object ë„ì… (ë” ë‚˜ì•„ê°€ê¸°):**
```java
// íšŒì› ì´ë¦„ì„ ê°’ ê°ì²´ë¡œ
public class MemberName {
    private final String value;

    public MemberName(String value) {
        validate(value);
        this.value = value;
    }

    private void validate(String value) {
        if (value == null || value.trim().isEmpty()) {
            throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
        }
        if (value.length() > 20) {
            throw new IllegalArgumentException("íšŒì› ì´ë¦„ì€ 20ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    public String getValue() {
        return value;
    }
}

// Member ì—”í‹°í‹°ì—ì„œ ì‚¬ìš©
public class Member {
    private Long id;
    private MemberName name;  // String â†’ MemberName
    private Grade grade;

    // ìƒì„±ì
    public Member(Long id, MemberName name, Grade grade) {
        this.id = id;
        this.name = name;  // ê²€ì¦ì€ MemberNameì—ì„œ ìˆ˜í–‰
        this.grade = grade;
    }
}
```

**ì¥ì :**
1. **ìº¡ìŠí™”**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë°ì´í„°ì™€ í•¨ê»˜ ì‘ì§‘
2. **ì¬ì‚¬ìš©ì„±**: ë„ë©”ì¸ ë¡œì§ì„ ì—¬ëŸ¬ ê³³ì—ì„œ ì•ˆì „í•˜ê²Œ ì¬ì‚¬ìš©
3. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: ë„ë©”ì¸ ê°ì²´ë§Œ ë‹¨ë…ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
4. **ë³€ê²½ ìš©ì´ì„±**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³€ê²½ ì‹œ ë„ë©”ì¸ ê°ì²´ë§Œ ìˆ˜ì •
5. **ë¶ˆë³€ì„±**: Setter ì œê±°ë¡œ ê°ì²´ ìƒíƒœ ë³´í˜¸

**ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­:**
- JPA ì‚¬ìš© ì‹œ ê¸°ë³¸ ìƒì„±ìì™€ Setterê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ â†’ protectedë¡œ ì œí•œ
- ê³¼ë„í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬
- ì˜ì†ì„± ê´€ë ¨ ë¡œì§ì€ ë¦¬í¬ì§€í† ë¦¬ì— ìœ ì§€

---

## ì „ì²´ ìš”ì•½

íšŒì› ë„ë©”ì¸ ê°œë°œì€ **ì—”í‹°í‹° â†’ ë¦¬í¬ì§€í† ë¦¬ â†’ ì„œë¹„ìŠ¤** ìˆœì„œë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

### êµ¬í˜„í•œ ì»´í¬ë„ŒíŠ¸
1. **Grade**: BASIC, VIP ì—´ê±°í˜•
2. **Member**: id, name, gradeë¥¼ ê°€ì§„ íšŒì› ì—”í‹°í‹°
3. **MemberRepository**: save/findById ë©”ì„œë“œë¥¼ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤
4. **MemoryMemberRepository**: HashMapì„ ì‚¬ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ
5. **MemberService**: join/findMember ë©”ì„œë“œë¥¼ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤
6. **MemberServiceImpl**: ë¦¬í¬ì§€í† ë¦¬ë¥¼ í™œìš©í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### í•µì‹¬ í¬ì¸íŠ¸
- ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ë¶„ë¦¬í•˜ì—¬ ìœ ì—°í•œ êµ¬ì¡° êµ¬ì¶•
- enumìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± í™•ë³´
- HashMapìœ¼ë¡œ ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ êµ¬í˜„

### ë‚¨ì€ ë¬¸ì œ
- DIP ìœ„ë°˜: êµ¬í˜„ì²´ë¥¼ ì§ì ‘ ìƒì„±
- ë™ì‹œì„± ì´ìŠˆ: HashMapì€ thread-safeí•˜ì§€ ì•ŠìŒ
- ë¹ˆí˜ˆ ë„ë©”ì¸: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„œë¹„ìŠ¤ì— ì§‘ì¤‘

â†’ ë‹¤ìŒ ì„¹ì…˜ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©° ë™ì‘ í™•ì¸

---

## í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] íšŒì› ì—”í‹°í‹°(Member)ì™€ ë“±ê¸‰(Grade)ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
- [ ] ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] HashMapì˜ ë™ì‹œì„± ë¬¸ì œë¥¼ ì´í•´í–ˆë‹¤
- [ ] í˜„ì¬ ì½”ë“œì˜ DIP ìœ„ë°˜ ë¬¸ì œë¥¼ ì¸ì‹í–ˆë‹¤

---

## ë‹¤ìŒ í•™ìŠµ
ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” ì‘ì„±í•œ íšŒì› ë„ë©”ì¸ì„ **í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ê²€ì¦**í•©ë‹ˆë‹¤.
- main ë©”ì„œë“œë¡œ ê°„ë‹¨í•œ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- JUnitì„ ì‚¬ìš©í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- AssertJë¥¼ í™œìš©í•œ ê²€ì¦

**[2-5. íšŒì› ë„ë©”ì¸ ì‹¤í–‰ê³¼ í…ŒìŠ¤íŠ¸](2-5-íšŒì›ë„ë©”ì¸ì‹¤í–‰ê³¼í…ŒìŠ¤íŠ¸.md)** ì—ì„œ ê³„ì†ë©ë‹ˆë‹¤.

---

## ğŸ“š ì°¸ê³ ìë£Œ
- [Effective Java 3/E - Joshua Bloch](http://www.yes24.com/Product/Goods/65551284) - Item 34: enum ì‚¬ìš©
- [Java Concurrency in Practice](http://www.yes24.com/Product/Goods/2496346) - ConcurrentHashMap ì„¤ëª…
- [ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ - ì—ë¦­ ì—ë°˜ìŠ¤](http://www.yes24.com/Product/Goods/5312881) - ë¹ˆí˜ˆ vs í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸
- [ì˜¤ë¸Œì íŠ¸ - ì¡°ì˜í˜¸](http://www.yes24.com/Product/Goods/74219491) - ë„ë©”ì¸ ê°ì²´ì˜ ì±…ì„
- [Java HashMap Documentation](https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html)
