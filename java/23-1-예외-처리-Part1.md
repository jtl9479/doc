# 📝 Chapter 23-1: 예외 처리 (Exception Handling) Part 1

## 🎯 학습 목표
- 예외 처리(Exception Handling)의 개념을 실생활 비유를 통해 이해합니다
- try-catch-finally 구문의 사용법을 익힙니다
- Checked Exception과 Unchecked Exception의 차이를 이해합니다
- throws 키워드와 throw 키워드를 구분하여 사용합니다
- 실무에서 자주 사용되는 예외 처리 패턴을 학습합니다

---

## 📚 실생활 비유로 이해하는 예외 처리

예외 처리(Exception Handling)는 프로그램 실행 중 **예상치 못한 문제가 발생했을 때 이를 처리하는 메커니즘**입니다.
마치 일상생활에서 **비상 상황에 대비한 대응 계획**을 세우는 것과 같습니다.

---

## 🚗 비유 1: try-catch-finally - 자동차 운전 중 타이어 펑크

### 실생활 비유
**고속도로를 운전하다가 타이어가 펑크**나는 상황과 같습니다.
- 🚗 **try**: 정상적인 운전 시도
- 🛑 **catch**: 타이어 펑크 발생 시 대응 (갓길 정차, 비상등 켜기)
- 🔧 **finally**: 어떤 상황이든 반드시 해야 할 일 (안전벨트 착용, 보험회사 연락)

### 코드로 이해하기

```java
// 📁 TryCatchFinallyExample.java

class Car {
    private String brand;
    private int speed;
    private boolean tirePunctured = false;

    public Car(String brand) {
        this.brand = brand;
        this.speed = 0;
    }

    public void accelerate(int speedIncrease) throws TirePunctureException {
        speed += speedIncrease;
        System.out.println("  🚗 속도 증가: " + speed + "km/h");

        // 랜덤으로 타이어 펑크 시뮬레이션
        if (Math.random() < 0.3) {  // 30% 확률
            tirePunctured = true;
            throw new TirePunctureException("타이어 펑크 발생! 현재 속도: " + speed + "km/h");
        }
    }

    public void stop() {
        speed = 0;
        System.out.println("  🛑 차량 정지");
    }
}

// Custom Exception
class TirePunctureException extends Exception {
    public TirePunctureException(String message) {
        super(message);
    }
}

public class TryCatchFinallyExample {
    public static void main(String[] args) {
        System.out.println("=== try-catch-finally - 자동차 운전 비유 ===\n");

        Car car = new Car("Tesla");

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // 시나리오 1: 정상 주행
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("=".repeat(50));
        System.out.println("시나리오 1: 고속도로 주행 시도");
        System.out.println("=".repeat(50) + "\n");

        try {
            System.out.println("🚗 [try 블록] 정상 운전 시도");
            car.accelerate(50);
            car.accelerate(30);
            car.accelerate(20);
            System.out.println("  ✅ 목적지 도착!");

        } catch (TirePunctureException e) {
            System.out.println("\n❌ [catch 블록] 비상 상황 발생!");
            System.out.println("  에러 메시지: " + e.getMessage());
            System.out.println("  대응:");
            System.out.println("    1. 갓길에 정차");
            System.out.println("    2. 비상등 켜기");
            System.out.println("    3. 견인 서비스 호출");

        } finally {
            System.out.println("\n🔧 [finally 블록] 어떤 상황이든 반드시 실행");
            System.out.println("  - 안전벨트 확인");
            System.out.println("  - 보험회사에 사고 접수");
            car.stop();
        }

        System.out.println("\n📝 프로그램 계속 실행 중...\n");

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // 핵심 설명
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("=".repeat(50));
        System.out.println("\n💡 try-catch-finally 구조:");

        System.out.println("\n📌 try 블록:");
        System.out.println("   - 예외가 발생할 수 있는 코드 작성");
        System.out.println("   - 정상적인 로직 실행");

        System.out.println("\n📌 catch 블록:");
        System.out.println("   - 예외 발생 시 실행되는 코드");
        System.out.println("   - 예외 타입별로 여러 개 작성 가능");
        System.out.println("   - 예외 처리 로직 (로깅, 복구, 사용자 알림)");

        System.out.println("\n📌 finally 블록:");
        System.out.println("   - 예외 발생 여부와 무관하게 항상 실행");
        System.out.println("   - 리소스 정리 (파일 닫기, DB 연결 종료)");
        System.out.println("   - 생략 가능 (선택사항)");

        System.out.println("\n🔄 실행 순서:");
        System.out.println("   1. try 블록 실행");
        System.out.println("   2-1. 예외 없음 → finally 실행 → 계속 진행");
        System.out.println("   2-2. 예외 발생 → catch 실행 → finally 실행 → 계속 진행");
    }
}
```

**실행 결과 (타이어 펑크 발생 시):**
```
=== try-catch-finally - 자동차 운전 비유 ===

==================================================
시나리오 1: 고속도로 주행 시도
==================================================

🚗 [try 블록] 정상 운전 시도
  🚗 속도 증가: 50km/h
  🚗 속도 증가: 80km/h

❌ [catch 블록] 비상 상황 발생!
  에러 메시지: 타이어 펑크 발생! 현재 속도: 100km/h
  대응:
    1. 갓길에 정차
    2. 비상등 켜기
    3. 견인 서비스 호출

🔧 [finally 블록] 어떤 상황이든 반드시 실행
  - 안전벨트 확인
  - 보험회사에 사고 접수
  🛑 차량 정지

📝 프로그램 계속 실행 중...

==================================================

💡 try-catch-finally 구조:

📌 try 블록:
   - 예외가 발생할 수 있는 코드 작성
   - 정상적인 로직 실행

📌 catch 블록:
   - 예외 발생 시 실행되는 코드
   - 예외 타입별로 여러 개 작성 가능
   - 예외 처리 로직 (로깅, 복구, 사용자 알림)

📌 finally 블록:
   - 예외 발생 여부와 무관하게 항상 실행
   - 리소스 정리 (파일 닫기, DB 연결 종료)
   - 생략 가능 (선택사항)

🔄 실행 순서:
   1. try 블록 실행
   2-1. 예외 없음 → finally 실행 → 계속 진행
   2-2. 예외 발생 → catch 실행 → finally 실행 → 계속 진행
```

### 핵심 정리
- `try`: 예외가 발생할 수 있는 코드
- `catch`: 예외 발생 시 처리 로직
- `finally`: 항상 실행되는 정리 코드 (리소스 해제)

---

## 📁 비유 2: Checked Exception - 해외여행 비자 신청

### 실생활 비유
**해외여행 시 비자 신청**과 같습니다.
- ✅ **Checked Exception**: 반드시 확인해야 함 (비자 없으면 출국 불가)
- 📋 컴파일러가 강제로 확인
- 🛂 비자가 없으면 공항에서 제지당함

### 코드로 이해하기

```java
// 📁 CheckedExceptionExample.java

import java.io.*;

// Custom Checked Exception
class VisaRequiredException extends Exception {
    public VisaRequiredException(String message) {
        super(message);
    }
}

class TravelService {

    // ✅ Checked Exception은 반드시 throws 선언
    public void bookFlight(String destination) throws VisaRequiredException {
        System.out.println("✈️ " + destination + " 행 항공권 예약 시도...");

        // 특정 국가는 비자 필요
        if (destination.equals("미국") || destination.equals("중국")) {
            throw new VisaRequiredException(destination + "은(는) 비자가 필요합니다!");
        }

        System.out.println("  ✅ 항공권 예약 완료");
    }

    // 파일 읽기 (Checked Exception: IOException)
    public String readPassport(String filename) throws IOException {
        System.out.println("\n📄 여권 정보 읽기: " + filename);

        BufferedReader reader = new BufferedReader(new FileReader(filename));
        try {
            String line = reader.readLine();
            System.out.println("  ✅ 여권 번호: " + line);
            return line;
        } finally {
            reader.close();  // finally에서 리소스 정리
        }
    }
}

public class CheckedExceptionExample {
    public static void main(String[] args) {
        System.out.println("=== Checked Exception - 해외여행 비자 비유 ===\n");

        TravelService service = new TravelService();

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 1: 비자 불필요 국가 (정상 처리)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("=".repeat(50));
        System.out.println("Case 1: 비자 불필요 국가 (일본)");
        System.out.println("=".repeat(50) + "\n");

        try {
            service.bookFlight("일본");
        } catch (VisaRequiredException e) {
            System.out.println("❌ 예외 발생: " + e.getMessage());
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 2: 비자 필요 국가 (예외 발생)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("Case 2: 비자 필요 국가 (미국)");
        System.out.println("=".repeat(50) + "\n");

        try {
            service.bookFlight("미국");
        } catch (VisaRequiredException e) {
            System.out.println("❌ 예외 발생: " + e.getMessage());
            System.out.println("  대응: 비자 신청 진행");
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 3: 파일 읽기 (IOException - Checked Exception)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("Case 3: 파일 읽기 (존재하지 않는 파일)");
        System.out.println("=".repeat(50));

        try {
            service.readPassport("passport.txt");
        } catch (IOException e) {
            System.out.println("❌ 파일 읽기 실패: " + e.getMessage());
            System.out.println("  대응: 파일 경로 확인 또는 새로 생성");
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Checked Exception의 특징
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("\n💡 Checked Exception의 특징:");

        System.out.println("\n1️⃣ 컴파일 타임 체크:");
        System.out.println("   - 컴파일러가 예외 처리 강제");
        System.out.println("   - try-catch 또는 throws 필수");

        System.out.println("\n2️⃣ 예측 가능한 예외:");
        System.out.println("   - 외부 환경에 의존 (파일, 네트워크, DB)");
        System.out.println("   - 개발자가 미리 대응 가능");

        System.out.println("\n3️⃣ Exception 클래스 상속:");
        System.out.println("   - Exception을 직접 상속");
        System.out.println("   - RuntimeException은 제외");

        System.out.println("\n4️⃣ 주요 Checked Exception:");
        System.out.println("   - IOException: 파일 입출력");
        System.out.println("   - SQLException: 데이터베이스");
        System.out.println("   - ClassNotFoundException: 클래스 로딩");
        System.out.println("   - InterruptedException: 스레드");

        System.out.println("\n⚠️ 처리 방법:");
        System.out.println("```java");
        System.out.println("// 방법 1: try-catch로 직접 처리");
        System.out.println("try {");
        System.out.println("    method();");
        System.out.println("} catch (Exception e) {");
        System.out.println("    // 예외 처리");
        System.out.println("}");
        System.out.println("");
        System.out.println("// 방법 2: throws로 상위 메서드에 전달");
        System.out.println("public void method() throws Exception {");
        System.out.println("    // ...");
        System.out.println("}");
        System.out.println("```");
    }
}
```

**실행 결과:**
```
=== Checked Exception - 해외여행 비자 비유 ===

==================================================
Case 1: 비자 불필요 국가 (일본)
==================================================

✈️ 일본 행 항공권 예약 시도...
  ✅ 항공권 예약 완료

==================================================
Case 2: 비자 필요 국가 (미국)
==================================================

✈️ 미국 행 항공권 예약 시도...
❌ 예외 발생: 미국은(는) 비자가 필요합니다!
  대응: 비자 신청 진행

==================================================
Case 3: 파일 읽기 (존재하지 않는 파일)
==================================================

📄 여권 정보 읽기: passport.txt
❌ 파일 읽기 실패: passport.txt (지정된 파일을 찾을 수 없습니다)
  대응: 파일 경로 확인 또는 새로 생성

==================================================

💡 Checked Exception의 특징:

1️⃣ 컴파일 타임 체크:
   - 컴파일러가 예외 처리 강제
   - try-catch 또는 throws 필수

2️⃣ 예측 가능한 예외:
   - 외부 환경에 의존 (파일, 네트워크, DB)
   - 개발자가 미리 대응 가능

3️⃣ Exception 클래스 상속:
   - Exception을 직접 상속
   - RuntimeException은 제외

4️⃣ 주요 Checked Exception:
   - IOException: 파일 입출력
   - SQLException: 데이터베이스
   - ClassNotFoundException: 클래스 로딩
   - InterruptedException: 스레드

⚠️ 처리 방법:
```java
// 방법 1: try-catch로 직접 처리
try {
    method();
} catch (Exception e) {
    // 예외 처리
}

// 방법 2: throws로 상위 메서드에 전달
public void method() throws Exception {
    // ...
}
```
```

### 핵심 정리
- **Checked Exception**은 컴파일러가 강제로 체크
- 반드시 **try-catch** 또는 **throws**로 처리
- 외부 환경 의존적 예외 (파일, 네트워크, DB)

---

## 🎮 비유 3: Unchecked Exception - 게임 중 버그

### 실생활 비유
**게임 플레이 중 버그**와 같습니다.
- ❌ **Unchecked Exception**: 예상 못한 프로그래밍 오류
- 🐛 개발자의 실수로 발생 (null 참조, 배열 인덱스 초과)
- 🔧 사전 예방 가능 (코드 검증)

### 코드로 이해하기

```java
// 📁 UncheckedExceptionExample.java

class GameCharacter {
    private String name;
    private int[] inventory;
    private int hp;

    public GameCharacter(String name) {
        this.name = name;
        this.inventory = new int[5];  // 인벤토리 크기 5
        this.hp = 100;
    }

    // ❌ Unchecked Exception 발생 가능 (NullPointerException)
    public void attack(GameCharacter target) {
        System.out.println(name + "이(가) " + target.name + "을(를) 공격!");
        // target이 null이면 NullPointerException 발생
    }

    // ❌ Unchecked Exception 발생 가능 (ArrayIndexOutOfBoundsException)
    public void getItem(int slot) {
        System.out.println("슬롯 " + slot + "의 아이템: " + inventory[slot]);
        // slot이 0~4 범위를 벗어나면 예외 발생
    }

    // ❌ Unchecked Exception 발생 가능 (ArithmeticException)
    public void calculateDamage(int totalDamage, int defenderCount) {
        int damagePerDefender = totalDamage / defenderCount;
        // defenderCount가 0이면 ArithmeticException 발생
        System.out.println("개당 데미지: " + damagePerDefender);
    }
}

public class UncheckedExceptionExample {
    public static void main(String[] args) {
        System.out.println("=== Unchecked Exception - 게임 버그 비유 ===\n");

        GameCharacter player = new GameCharacter("용사");

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 1: NullPointerException
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("=".repeat(50));
        System.out.println("Case 1: NullPointerException");
        System.out.println("=".repeat(50) + "\n");

        GameCharacter enemy = null;  // null 객체

        try {
            player.attack(enemy);  // NullPointerException 발생!
        } catch (NullPointerException e) {
            System.out.println("❌ 버그 발생: " + e.getClass().getSimpleName());
            System.out.println("  원인: 적이 존재하지 않습니다 (null)");
            System.out.println("  해결: 공격 전 null 체크 필요");
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 2: ArrayIndexOutOfBoundsException
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("Case 2: ArrayIndexOutOfBoundsException");
        System.out.println("=".repeat(50) + "\n");

        try {
            player.getItem(10);  // 배열 크기 5인데 인덱스 10 접근!
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("❌ 버그 발생: " + e.getClass().getSimpleName());
            System.out.println("  원인: 인벤토리 슬롯 범위 초과 (0~4만 유효)");
            System.out.println("  해결: 인덱스 범위 검증 필요");
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Case 3: ArithmeticException
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("Case 3: ArithmeticException");
        System.out.println("=".repeat(50) + "\n");

        try {
            player.calculateDamage(100, 0);  // 0으로 나누기!
        } catch (ArithmeticException e) {
            System.out.println("❌ 버그 발생: " + e.getClass().getSimpleName());
            System.out.println("  원인: 0으로 나눔");
            System.out.println("  해결: 나누기 전 0 체크 필요");
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Unchecked Exception의 특징
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(50));
        System.out.println("\n💡 Unchecked Exception의 특징:");

        System.out.println("\n1️⃣ 런타임 체크:");
        System.out.println("   - 컴파일러가 체크하지 않음");
        System.out.println("   - try-catch 또는 throws 선택사항");
        System.out.println("   - 실행 중에만 발견");

        System.out.println("\n2️⃣ 프로그래밍 오류:");
        System.out.println("   - 개발자의 실수로 발생");
        System.out.println("   - 코드 검증으로 사전 예방 가능");

        System.out.println("\n3️⃣ RuntimeException 상속:");
        System.out.println("   - RuntimeException을 상속");
        System.out.println("   - RuntimeException도 Exception을 상속");

        System.out.println("\n4️⃣ 주요 Unchecked Exception:");
        System.out.println("   - NullPointerException: null 참조");
        System.out.println("   - ArrayIndexOutOfBoundsException: 배열 인덱스 초과");
        System.out.println("   - ArithmeticException: 0으로 나누기");
        System.out.println("   - IllegalArgumentException: 잘못된 인자");
        System.out.println("   - ClassCastException: 잘못된 타입 캐스팅");

        System.out.println("\n✅ 예방 방법:");
        System.out.println("```java");
        System.out.println("// NullPointerException 예방");
        System.out.println("if (enemy != null) {");
        System.out.println("    player.attack(enemy);");
        System.out.println("}");
        System.out.println("");
        System.out.println("// ArrayIndexOutOfBoundsException 예방");
        System.out.println("if (slot >= 0 && slot < inventory.length) {");
        System.out.println("    player.getItem(slot);");
        System.out.println("}");
        System.out.println("");
        System.out.println("// ArithmeticException 예방");
        System.out.println("if (defenderCount != 0) {");
        System.out.println("    player.calculateDamage(100, defenderCount);");
        System.out.println("}");
        System.out.println("```");
    }
}
```

**실행 결과:**
```
=== Unchecked Exception - 게임 버그 비유 ===

==================================================
Case 1: NullPointerException
==================================================

❌ 버그 발생: NullPointerException
  원인: 적이 존재하지 않습니다 (null)
  해결: 공격 전 null 체크 필요

==================================================
Case 2: ArrayIndexOutOfBoundsException
==================================================

❌ 버그 발생: ArrayIndexOutOfBoundsException
  원인: 인벤토리 슬롯 범위 초과 (0~4만 유효)
  해결: 인덱스 범위 검증 필요

==================================================
Case 3: ArithmeticException
==================================================

❌ 버그 발생: ArithmeticException
  원인: 0으로 나눔
  해결: 나누기 전 0 체크 필요

==================================================

💡 Unchecked Exception의 특징:

1️⃣ 런타임 체크:
   - 컴파일러가 체크하지 않음
   - try-catch 또는 throws 선택사항
   - 실행 중에만 발견

2️⃣ 프로그래밍 오류:
   - 개발자의 실수로 발생
   - 코드 검증으로 사전 예방 가능

3️⃣ RuntimeException 상속:
   - RuntimeException을 상속
   - RuntimeException도 Exception을 상속

4️⃣ 주요 Unchecked Exception:
   - NullPointerException: null 참조
   - ArrayIndexOutOfBoundsException: 배열 인덱스 초과
   - ArithmeticException: 0으로 나누기
   - IllegalArgumentException: 잘못된 인자
   - ClassCastException: 잘못된 타입 캐스팅

✅ 예방 방법:
```java
// NullPointerException 예방
if (enemy != null) {
    player.attack(enemy);
}

// ArrayIndexOutOfBoundsException 예방
if (slot >= 0 && slot < inventory.length) {
    player.getItem(slot);
}

// ArithmeticException 예방
if (defenderCount != 0) {
    player.calculateDamage(100, defenderCount);
}
```
```

### 핵심 정리
- **Unchecked Exception**은 런타임 에러
- 컴파일러가 체크하지 않음
- 개발자의 실수로 발생 → 코드 검증으로 예방

---

## 🏥 비유 4: Custom Exception - 병원 진료과 분류

### 실생활 비유
**병원에서 환자의 증상에 따라 적절한 진료과로 안내**하는 것과 같습니다.
- 🏥 **Custom Exception**: 증상별로 분류하여 적절한 처리
- 👨‍⚕️ 내과, 외과, 정형외과 등 전문 진료과
- 📋 환자 카드에 증상과 진료 이력 기록

### 코드로 이해하기

```java
// 📁 CustomExceptionExample.java

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 1️⃣ 최상위 병원 예외 (Base Exception)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

abstract class HospitalException extends Exception {
    private final String patientId;
    private final String symptom;

    public HospitalException(String patientId, String symptom, String message) {
        super(message);
        this.patientId = patientId;
        this.symptom = symptom;
    }

    public String getPatientId() { return patientId; }
    public String getSymptom() { return symptom; }

    // 어느 진료과로 가야 하는지
    public abstract String getDepartment();
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 2️⃣ 진료과별 Custom Exception
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

class InternalMedicineException extends HospitalException {
    public InternalMedicineException(String patientId, String symptom) {
        super(patientId, symptom, "내과 진료 필요: " + symptom);
    }

    @Override
    public String getDepartment() {
        return "내과 (Internal Medicine)";
    }
}

class OrthopedicsException extends HospitalException {
    private final String injuredPart;

    public OrthopedicsException(String patientId, String symptom, String injuredPart) {
        super(patientId, symptom, "정형외과 진료 필요: " + symptom);
        this.injuredPart = injuredPart;
    }

    @Override
    public String getDepartment() {
        return "정형외과 (Orthopedics)";
    }

    public String getInjuredPart() { return injuredPart; }
}

class EmergencyException extends HospitalException {
    private final int severityLevel;  // 1-10 (10이 가장 위급)

    public EmergencyException(String patientId, String symptom, int severityLevel) {
        super(patientId, symptom, "응급실 즉시 이송 필요: " + symptom);
        this.severityLevel = severityLevel;
    }

    @Override
    public String getDepartment() {
        return "응급실 (Emergency Room)";
    }

    public int getSeverityLevel() { return severityLevel; }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 3️⃣ 병원 시스템
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

class Hospital {

    public void diagnose(String patientId, String symptom) throws HospitalException {
        System.out.println("\n🏥 환자 접수: " + patientId);
        System.out.println("   증상: " + symptom);

        // 증상에 따라 적절한 Custom Exception 발생
        if (symptom.contains("발열") || symptom.contains("두통") || symptom.contains("복통")) {
            throw new InternalMedicineException(patientId, symptom);
        }
        else if (symptom.contains("골절") || symptom.contains("염좌") || symptom.contains("탈골")) {
            String injuredPart = extractInjuredPart(symptom);
            throw new OrthopedicsException(patientId, symptom, injuredPart);
        }
        else if (symptom.contains("의식불명") || symptom.contains("심장마비") || symptom.contains("대량출혈")) {
            int severity = 10;
            throw new EmergencyException(patientId, symptom, severity);
        }

        System.out.println("   ✅ 일반 검진 진행");
    }

    private String extractInjuredPart(String symptom) {
        if (symptom.contains("팔")) return "팔";
        if (symptom.contains("다리")) return "다리";
        if (symptom.contains("발목")) return "발목";
        return "알 수 없음";
    }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 4️⃣ 진료과별 처리 (Exception Handler)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

class MedicalStaff {

    public void handlePatient(HospitalException e) {
        System.out.println("\n📋 진료과 안내:");
        System.out.println("   환자 ID: " + e.getPatientId());
        System.out.println("   증상: " + e.getSymptom());
        System.out.println("   배정 진료과: " + e.getDepartment());

        // 타입별 특수 처리
        if (e instanceof EmergencyException) {
            EmergencyException emergency = (EmergencyException) e;
            System.out.println("   🚨 심각도 레벨: " + emergency.getSeverityLevel() + "/10");
            System.out.println("   🚑 응급팀 출동!");

        } else if (e instanceof OrthopedicsException) {
            OrthopedicsException ortho = (OrthopedicsException) e;
            System.out.println("   🦴 부상 부위: " + ortho.getInjuredPart());
            System.out.println("   📸 X-Ray 촬영 예약");

        } else if (e instanceof InternalMedicineException) {
            System.out.println("   💊 내과 의사 배정");
            System.out.println("   🩺 혈액 검사 진행");
        }
    }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 5️⃣ 실행 및 테스트
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

public class CustomExceptionExample {
    public static void main(String[] args) {
        System.out.println("=== Custom Exception - 병원 진료과 분류 비유 ===");

        Hospital hospital = new Hospital();
        MedicalStaff staff = new MedicalStaff();

        // 환자 목록
        String[][] patients = {
            {"P-001", "고열과 두통"},
            {"P-002", "팔 골절"},
            {"P-003", "심장마비 의심"}
        };

        // 각 환자 처리
        for (String[] patient : patients) {
            String patientId = patient[0];
            String symptom = patient[1];

            System.out.println("\n" + "=".repeat(60));

            try {
                hospital.diagnose(patientId, symptom);

            } catch (HospitalException e) {
                staff.handlePatient(e);
            }
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // Custom Exception의 장점
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(60));
        System.out.println("\n💡 Custom Exception의 장점:");

        System.out.println("\n1️⃣ 명확한 의미:");
        System.out.println("   - InternalMedicineException → 내과 질환임을 명확히 표현");
        System.out.println("   - Exception보다 구체적");

        System.out.println("\n2️⃣ 추가 정보 제공:");
        System.out.println("   - 환자 ID, 증상, 부상 부위, 심각도 등");
        System.out.println("   - 예외 처리에 필요한 컨텍스트 정보");

        System.out.println("\n3️⃣ 타입별 처리:");
        System.out.println("   - instanceof로 예외 타입 구분");
        System.out.println("   - 각 타입에 맞는 적절한 처리");

        System.out.println("\n4️⃣ 계층 구조:");
        System.out.println("   - HospitalException으로 모든 병원 예외 그룹화");
        System.out.println("   - 공통 메서드 (getDepartment) 제공");
    }
}
```

**실행 결과:**
```
=== Custom Exception - 병원 진료과 분류 비유 ===

============================================================

🏥 환자 접수: P-001
   증상: 고열과 두통

📋 진료과 안내:
   환자 ID: P-001
   증상: 고열과 두통
   배정 진료과: 내과 (Internal Medicine)
   💊 내과 의사 배정
   🩺 혈액 검사 진행

============================================================

🏥 환자 접수: P-002
   증상: 팔 골절

📋 진료과 안내:
   환자 ID: P-002
   증상: 팔 골절
   배정 진료과: 정형외과 (Orthopedics)
   🦴 부상 부위: 팔
   📸 X-Ray 촬영 예약

============================================================

🏥 환자 접수: P-003
   증상: 심장마비 의심

📋 진료과 안내:
   환자 ID: P-003
   증상: 심장마비 의심
   배정 진료과: 응급실 (Emergency Room)
   🚨 심각도 레벨: 10/10
   🚑 응급팀 출동!

============================================================

💡 Custom Exception의 장점:

1️⃣ 명확한 의미:
   - InternalMedicineException → 내과 질환임을 명확히 표현
   - Exception보다 구체적

2️⃣ 추가 정보 제공:
   - 환자 ID, 증상, 부상 부위, 심각도 등
   - 예외 처리에 필요한 컨텍스트 정보

3️⃣ 타입별 처리:
   - instanceof로 예외 타입 구분
   - 각 타입에 맞는 적절한 처리

4️⃣ 계층 구조:
   - HospitalException으로 모든 병원 예외 그룹화
   - 공통 메서드 (getDepartment) 제공
```

### 핵심 정리
- **Custom Exception**은 도메인에 특화된 예외
- 계층 구조로 예외를 그룹화
- 추가 정보(컨텍스트)를 담아 전달
- 타입별로 다른 처리 가능

---

## 📢 비유 5: throws와 예외 전파 - 회사 보고 체계

### 실생활 비유
**회사에서 문제가 발생하면 상위 책임자에게 보고**하는 것과 같습니다.
- 👷 **사원**: 문제 발견 → throws로 팀장에게 보고
- 👨‍💼 **팀장**: 처리 불가 → throws로 부장에게 보고
- 👔 **부장**: 처리 불가 → throws로 임원에게 보고
- 🎩 **임원**: 최종 의사결정 및 처리

### 코드로 이해하기

```java
// 📁 ThrowsExceptionPropagationExample.java

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 1️⃣ 문제 상황 정의
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

class BudgetExceededException extends Exception {
    private final int requestedBudget;
    private final int availableBudget;

    public BudgetExceededException(int requestedBudget, int availableBudget) {
        super(String.format("예산 초과: 요청 %,d원, 가용 %,d원",
                          requestedBudget, availableBudget));
        this.requestedBudget = requestedBudget;
        this.availableBudget = availableBudget;
    }

    public int getRequestedBudget() { return requestedBudget; }
    public int getAvailableBudget() { return availableBudget; }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 2️⃣ 회사 조직도
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

class Employee {
    private String name;
    private int availableBudget;

    public Employee(String name, int availableBudget) {
        this.name = name;
        this.availableBudget = availableBudget;
    }

    // 사원: 문제 발견 → throws로 상위에게 전달
    public void requestPurchase(int amount) throws BudgetExceededException {
        System.out.println("\n👷 [사원 " + name + "] 구매 요청: " + amount + "원");

        if (amount > availableBudget) {
            System.out.println("   ❌ 권한 부족! 팀장에게 보고합니다.");
            throw new BudgetExceededException(amount, availableBudget);
        }

        System.out.println("   ✅ 승인 완료 (사원 권한 내)");
    }
}

class TeamLeader {
    private String name;
    private int availableBudget;

    public TeamLeader(String name, int availableBudget) {
        this.name = name;
        this.availableBudget = availableBudget;
    }

    // 팀장: 사원의 보고를 받아 처리 또는 상위 전달
    public void approveRequest(int amount) throws BudgetExceededException {
        System.out.println("\n👨‍💼 [팀장 " + name + "] 요청 검토: " + amount + "원");

        if (amount > availableBudget) {
            System.out.println("   ❌ 권한 부족! 부장에게 보고합니다.");
            throw new BudgetExceededException(amount, availableBudget);
        }

        System.out.println("   ✅ 승인 완료 (팀장 권한 내)");
    }
}

class Director {
    private String name;
    private int availableBudget;

    public Director(String name, int availableBudget) {
        this.name = name;
        this.availableBudget = availableBudget;
    }

    // 부장: 팀장의 보고를 받아 처리 또는 상위 전달
    public void approveRequest(int amount) throws BudgetExceededException {
        System.out.println("\n👔 [부장 " + name + "] 요청 검토: " + amount + "원");

        if (amount > availableBudget) {
            System.out.println("   ❌ 권한 부족! 임원에게 보고합니다.");
            throw new BudgetExceededException(amount, availableBudget);
        }

        System.out.println("   ✅ 승인 완료 (부장 권한 내)");
    }
}

class Executive {
    private String name;

    public Executive(String name) {
        this.name = name;
    }

    // 임원: 최종 의사결정 (try-catch로 처리)
    public void finalDecision(int amount, BudgetExceededException e) {
        System.out.println("\n🎩 [임원 " + name + "] 최종 의사결정");
        System.out.println("   요청 금액: " + e.getRequestedBudget() + "원");
        System.out.println("   가용 예산: " + e.getAvailableBudget() + "원");

        int shortage = e.getRequestedBudget() - e.getAvailableBudget();

        if (shortage < 10000000) {  // 1천만원 미만
            System.out.println("   ✅ 특별 승인! (임원 권한)");
            System.out.println("   추가 예산 " + shortage + "원 배정");
        } else {
            System.out.println("   ❌ 승인 거부 (예산 초과 폭이 너무 큼)");
            System.out.println("   대안 제시: 분할 구매 또는 차기 연도 예산 활용");
        }
    }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 3️⃣ 실행 및 테스트
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

public class ThrowsExceptionPropagationExample {
    public static void main(String[] args) {
        System.out.println("=== throws와 예외 전파 - 회사 보고 체계 비유 ===");

        Employee employee = new Employee("김사원", 1000000);      // 100만원 권한
        TeamLeader teamLeader = new TeamLeader("이팀장", 5000000);   // 500만원 권한
        Director director = new Director("박부장", 20000000);   // 2000만원 권한
        Executive executive = new Executive("최임원");

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // 시나리오 1: 사원 권한 내 (예외 발생 안 함)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(60));
        System.out.println("시나리오 1: 50만원 구매 요청 (사원 권한 내)");
        System.out.println("=".repeat(60));

        try {
            employee.requestPurchase(500000);
        } catch (BudgetExceededException e) {
            System.out.println("예상치 못한 예외: " + e.getMessage());
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // 시나리오 2: 팀장까지 전파 (팀장이 처리)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(60));
        System.out.println("시나리오 2: 300만원 구매 요청 (팀장 권한까지 전파)");
        System.out.println("=".repeat(60));

        try {
            employee.requestPurchase(3000000);  // 사원 권한 초과
        } catch (BudgetExceededException e) {
            try {
                teamLeader.approveRequest(3000000);  // 팀장이 처리
            } catch (BudgetExceededException e2) {
                System.out.println("팀장도 처리 못함");
            }
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // 시나리오 3: 임원까지 전파 (최종 의사결정)
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(60));
        System.out.println("시나리오 3: 2500만원 구매 요청 (임원까지 전파)");
        System.out.println("=".repeat(60));

        try {
            employee.requestPurchase(25000000);  // 사원 권한 초과
        } catch (BudgetExceededException e1) {
            try {
                teamLeader.approveRequest(25000000);  // 팀장 권한 초과
            } catch (BudgetExceededException e2) {
                try {
                    director.approveRequest(25000000);  // 부장 권한 초과
                } catch (BudgetExceededException e3) {
                    // 임원이 최종 처리
                    executive.finalDecision(25000000, e3);
                }
            }
        }

        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        // throws의 핵심 개념
        // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        System.out.println("\n" + "=".repeat(60));
        System.out.println("\n💡 throws와 예외 전파:");

        System.out.println("\n1️⃣ 예외 전파 (Exception Propagation):");
        System.out.println("   - 하위에서 발생한 예외를 상위로 전달");
        System.out.println("   - throws 키워드로 선언");

        System.out.println("\n2️⃣ 책임의 이동:");
        System.out.println("   - 현재 메서드에서 처리 안 함");
        System.out.println("   - 호출자(상위)가 처리하도록 위임");

        System.out.println("\n3️⃣ 최종 처리:");
        System.out.println("   - 어딘가에서는 try-catch로 반드시 처리");
        System.out.println("   - 처리 안 하면 프로그램 종료");

        System.out.println("\n4️⃣ 호출 체인:");
        System.out.println("   사원.requestPurchase()");
        System.out.println("     → throws → 팀장.approveRequest()");
        System.out.println("       → throws → 부장.approveRequest()");
        System.out.println("         → throws → 임원.finalDecision() [try-catch로 최종 처리]");
    }
}
```

**실행 결과:**
```
=== throws와 예외 전파 - 회사 보고 체계 비유 ===

============================================================
시나리오 1: 50만원 구매 요청 (사원 권한 내)
============================================================

👷 [사원 김사원] 구매 요청: 500000원
   ✅ 승인 완료 (사원 권한 내)

============================================================
시나리오 2: 300만원 구매 요청 (팀장 권한까지 전파)
============================================================

👷 [사원 김사원] 구매 요청: 3000000원
   ❌ 권한 부족! 팀장에게 보고합니다.

👨‍💼 [팀장 이팀장] 요청 검토: 3000000원
   ✅ 승인 완료 (팀장 권한 내)

============================================================
시나리오 3: 2500만원 구매 요청 (임원까지 전파)
============================================================

👷 [사원 김사원] 구매 요청: 25000000원
   ❌ 권한 부족! 팀장에게 보고합니다.

👨‍💼 [팀장 이팀장] 요청 검토: 25000000원
   ❌ 권한 부족! 부장에게 보고합니다.

👔 [부장 박부장] 요청 검토: 25000000원
   ❌ 권한 부족! 임원에게 보고합니다.

🎩 [임원 최임원] 최종 의사결정
   요청 금액: 25000000원
   가용 예산: 20000000원
   ✅ 특별 승인! (임원 권한)
   추가 예산 5000000원 배정

============================================================

💡 throws와 예외 전파:

1️⃣ 예외 전파 (Exception Propagation):
   - 하위에서 발생한 예외를 상위로 전달
   - throws 키워드로 선언

2️⃣ 책임의 이동:
   - 현재 메서드에서 처리 안 함
   - 호출자(상위)가 처리하도록 위임

3️⃣ 최종 처리:
   - 어딘가에서는 try-catch로 반드시 처리
   - 처리 안 하면 프로그램 종료

4️⃣ 호출 체인:
   사원.requestPurchase()
     → throws → 팀장.approveRequest()
       → throws → 부장.approveRequest()
         → throws → 임원.finalDecision() [try-catch로 최종 처리]
```

### 핵심 정리
- **throws**는 예외를 상위 메서드로 전달
- 현재 메서드에서 처리하지 않고 호출자에게 위임
- 호출 체인을 따라 예외가 전파됨
- 최종적으로는 try-catch로 처리해야 함

---

## 🎓 Part 1 요약

### Checked vs Unchecked Exception

| 구분 | Checked Exception | Unchecked Exception |
|-----|------------------|---------------------|
| 상속 | Exception 직접 상속 | RuntimeException 상속 |
| 컴파일 체크 | O (강제) | X |
| 처리 | 필수 (try-catch 또는 throws) | 선택 |
| 발생 원인 | 외부 환경 (파일, 네트워크) | 프로그래밍 오류 |
| 예시 | IOException, SQLException | NullPointerException, ArrayIndexOutOfBoundsException |
| 예방 | 예외 처리 | 코드 검증 |

---

**📌 다음 Part 2에서는**
기업 사례와 주니어 개발자 시나리오를 통해 예외 처리의 실전 활용법을 배웁니다!
