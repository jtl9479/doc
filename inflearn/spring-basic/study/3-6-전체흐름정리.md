# 3-6. μ „μ²΄ νλ¦„ μ •λ¦¬

**μ¶μ²**: μΈν”„λ° - μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ κΈ°λ³ΈνΈ
**μ±•ν„°**: 3. μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ μ΄ν•΄2 - κ°μ²΄ μ§€ν–¥ μ›λ¦¬ μ μ©

---

## ν•™μµ λ©ν‘

- [ ] μ§€κΈκΉμ§€μ μ „μ²΄ νλ¦„μ„ μ •λ¦¬ν•  μ μλ‹¤
- [ ] κ° λ‹¨κ³„λ³„ κ°μ„  μ‚¬ν•­μ„ μ„¤λ…ν•  μ μλ‹¤
- [ ] Before/After λΉ„κµλ¥Ό ν†µν•΄ κ°μ„  ν¨κ³Όλ¥Ό μ΄ν•΄ν•λ‹¤

---

## μ§€κΈκΉμ§€μ νλ¦„ μ”μ•½

### 1λ‹¨κ³„: μƒλ΅μ΄ ν• μΈ μ •μ±… κ°λ°

**λ©ν‘**: μ •λ¥ % ν• μΈ μ •μ±… μ¶”κ°€

**κ²°κ³Ό**:
- β… λ‹¤ν•μ„± λ•λ¶„μ— μƒλ΅μ΄ μ •λ¥  ν• μΈ μ •μ±… μ½”λ“λ¥Ό μ¶”κ°€λ΅ κ°λ°ν•λ” κ²ƒ μμ²΄λ” μ•„λ¬΄ λ¬Έμ κ°€ μ—†μ

**κµ¬ν„**:
```java
public class RateDiscountPolicy implements DiscountPolicy {
    private int discountPercent = 10;

    @Override
    public int discount(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return price * discountPercent / 100;
        } else {
            return 0;
        }
    }
}
```

---

### 2λ‹¨κ³„: μƒλ΅μ΄ ν• μΈ μ •μ±… μ μ©κ³Ό λ¬Έμ μ 

**λ©ν‘**: κ°λ°ν• μ •λ¥  ν• μΈ μ •μ±…μ„ μ‹¤μ λ΅ μ μ©

**λ¬Έμ  λ°κ²¬**:
- β μƒλ΅ κ°λ°ν• μ •λ¥  ν• μΈ μ •μ±…μ„ μ μ©ν•λ ¤κ³  ν•λ‹ **ν΄λΌμ΄μ–ΈνΈ μ½”λ“**μΈ μ£Όλ¬Έ μ„λΉ„μ¤ κµ¬ν„μ²΄λ„ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•¨
- β μ£Όλ¬Έ μ„λΉ„μ¤ ν΄λΌμ΄μ–ΈνΈκ°€ μΈν„°νμ΄μ¤μΈ `DiscountPolicy` λΏλ§ μ•„λ‹λΌ, κµ¬μ²΄ ν΄λμ¤μΈ `FixDiscountPolicy`λ„ ν•¨κ» μμ΅΄ β†’ **DIP μ„λ°**

**λ¬Έμ  μ½”λ“**:
```java
public class OrderServiceImpl implements OrderService {
    // DIP μ„λ°: μΈν„°νμ΄μ¤ + κµ¬μ²΄ ν΄λμ¤ μμ΅΄
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
}
```

**DIP μ„λ° λ‹¤μ΄μ–΄κ·Έλ¨**:
```mermaid
classDiagram
    class OrderServiceImpl
    class DiscountPolicy {
        <<interface>>
    }
    class FixDiscountPolicy

    OrderServiceImpl --> DiscountPolicy : μ¶”μƒ μμ΅΄
    OrderServiceImpl --> FixDiscountPolicy : κµ¬μ²΄ μμ΅΄ (DIP μ„λ°!)
    DiscountPolicy <|.. FixDiscountPolicy
```

---

### 3λ‹¨κ³„: κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬

**λ©ν‘**: DIP μ„λ° λ¬Έμ  ν•΄κ²°

**ν•΄κ²° λ°©λ²•**:
- μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν•λ‚μ **κ³µμ—°**μΌλ΅ μƒκ°
- κΈ°μ΅΄μ—λ” ν΄λΌμ΄μ–ΈνΈκ°€ μμ΅΄ν•λ” μ„λ²„ κµ¬ν„ κ°μ²΄λ¥Ό μ§μ ‘ μƒμ„±ν•κ³ , μ‹¤ν–‰ν•¨
- λΉ„μ λ¥Ό ν•λ©΄ κΈ°μ΅΄μ—λ” λ‚¨μ μ£ΌμΈκ³µ λ°°μ°κ°€ κ³µμ—°λ„ ν•κ³ , λ™μ‹μ— μ—¬μ μ£ΌμΈκ³µλ„ μ§μ ‘ μ΄λΉ™ν•λ” **λ‹¤μ–‘ν• μ±…μ„**μ„ κ°€μ§€κ³  μμ

**κ³µμ—° κΈ°νμ AppConfig λ“±μ¥**:
- κ³µμ—°μ„ κµ¬μ„±ν•κ³ , λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„­μ™Έν•κ³ , μ§€μ •ν•λ” μ±…μ„μ„ λ‹΄λ‹Ήν•λ” λ³„λ„μ **κ³µμ—° κΈ°νμ**κ°€ λ‚μ¬ μ‹μ 
- AppConfigλ” μ• ν”λ¦¬μΌ€μ΄μ…μ μ „μ²΄ λ™μ‘ λ°©μ‹μ„ **κµ¬μ„±(config)**ν•κΈ° μ„ν•΄, **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•κ³ , **μ—°κ²°**ν•λ” μ±…μ„
- μ΄μ λ¶€ν„° ν΄λΌμ΄μ–ΈνΈ κ°μ²΄λ” μμ‹ μ μ—­ν• μ„ μ‹¤ν–‰ν•λ” κ²ƒλ§ μ§‘μ¤‘, κ¶ν•μ΄ μ¤„μ–΄λ“¬(**μ±…μ„μ΄ λ…ν™•**ν•΄μ§)

**AppConfig μ½”λ“**:
```java
public class AppConfig {
    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(
            new MemoryMemberRepository(),
            new FixDiscountPolicy()
        );
    }
}
```

**μƒμ„±μ μ£Όμ…**:
```java
public class OrderServiceImpl implements OrderService {
    // μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ - DIP μ¤€μ!
    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    // μƒμ„±μλ¥Ό ν†µν•΄ μ™Έλ¶€μ—μ„ μ£Όμ…
    public OrderServiceImpl(MemberRepository memberRepository,
                           DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```

**κ°μ„  ν¨κ³Ό**:
- β… `OrderServiceImpl`μ€ `DiscountPolicy` μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
- β… `OrderServiceImpl` μ…μ¥μ—μ„ μƒμ„±μλ¥Ό ν†µν•΄ μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ λ“¤μ–΄μ¬μ§€(μ£Όμ…λ μ§€)λ” μ• μ μ—†μ
- β… `OrderServiceImpl`μ μƒμ„±μλ¥Ό ν†µν•΄μ„ μ–΄λ–¤ κµ¬ν„ κ°μ²΄λ¥Ό μ£Όμ…ν• μ§€λ” μ¤μ§ μ™Έλ¶€(`AppConfig`)μ—μ„ κ²°μ •
- β… `OrderServiceImpl`μ€ μ΄μ λ¶€ν„° **μ‹¤ν–‰μ—λ§ μ§‘μ¤‘**

---

### 4λ‹¨κ³„: AppConfig λ¦¬ν©ν„°λ§

**λ©ν‘**: μ¤‘λ³µ μ κ±° λ° μ—­ν• κ³Ό κµ¬ν„ λ…ν™•ν λ¶„λ¦¬

**λ¬Έμ μ **:
- `new MemoryMemberRepository()`κ°€ μ¤‘λ³µ
- μ—­ν• μ— λ”°λ¥Έ κµ¬ν„μ΄ μ μ•λ³΄μ„

**λ¦¬ν©ν„°λ§ ν›„**:
```java
public class AppConfig {
    // μ—­ν• : νμ› μ„λΉ„μ¤
    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    // μ—­ν• : μ£Όλ¬Έ μ„λΉ„μ¤
    public OrderService orderService() {
        return new OrderServiceImpl(
            memberRepository(),
            discountPolicy()
        );
    }

    // μ—­ν• : νμ› μ €μ¥μ†
    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    // μ—­ν• : ν• μΈ μ •μ±…
    public DiscountPolicy discountPolicy() {
        return new FixDiscountPolicy();
    }
}
```

**κ°μ„  ν¨κ³Ό**:
- β… `new MemoryMemberRepository()` μ¤‘λ³µ μ κ±°
- β… `MemoryMemberRepository`λ¥Ό λ‹¤λ¥Έ κµ¬ν„μ²΄λ΅ λ³€κ²½ν•  λ• **ν• λ¶€λ¶„λ§** λ³€κ²½ν•λ©΄ λ¨
- β… `AppConfig`λ¥Ό λ³΄λ©΄ **μ—­ν• **κ³Ό **κµ¬ν„ ν΄λμ¤**κ°€ ν•λμ— λ“¤μ–΄μ΄
- β… μ• ν”λ¦¬μΌ€μ΄μ… μ „μ²΄ κµ¬μ„±μ΄ μ–΄λ–»κ² λμ–΄μλ”μ§€ λΉ λ¥΄κ² νμ•…ν•  μ μμ

---

### 5λ‹¨κ³„: μƒλ΅μ΄ κµ¬μ΅°μ™€ ν• μΈ μ •μ±… μ μ©

**λ©ν‘**: μ •μ•΅ ν• μΈ μ •μ±… β†’ μ •λ¥ % ν• μΈ μ •μ±…μΌλ΅ λ³€κ²½

**μ§λ¬Έ**: μ–΄λ–¤ λ¶€λ¶„λ§ λ³€κ²½ν•λ©΄ λ κΉ?

**μ •λ‹µ**: β… **AppConfigμ `discountPolicy()` λ©”μ„λ“λ§ λ³€κ²½!**

**μ‚¬μ© μμ—­κ³Ό κµ¬μ„± μμ—­ λ¶„λ¦¬**:
```mermaid
graph TB
    subgraph "μ‚¬μ© μμ—­ - λ³€κ²½ μ—†μ"
        A[OrderServiceImpl]
        B[DiscountPolicy<br/>interface]
        A --> B
    end

    subgraph "κµ¬μ„± μμ—­ - λ³€κ²½ μμ"
        C[AppConfig]
    end

    subgraph "κµ¬ν„μ²΄"
        D[FixDiscountPolicy<br/>μ΄μ „]
        E[RateDiscountPolicy<br/>λ³€κ²½]
    end

    C -.X μ΄μ „.-> D
    C -.O λ³€κ²½.-> E
    E -.-> B

    style A fill:#ccffcc
    style C fill:#ffcccc
    style E fill:#ffffcc
```

**μ½”λ“ λ³€κ²½ - λ”± ν• μ¤„!**:
```java
public class AppConfig {
    public DiscountPolicy discountPolicy() {
        // return new FixDiscountPolicy();      // μ •μ•΅ ν• μΈ (μ΄μ „)
        return new RateDiscountPolicy();        // μ •λ¥  ν• μΈ (λ³€κ²½)
    }
}
```

**κ°μ„  ν¨κ³Ό**:
- β… μ΄μ  ν• μΈ μ •μ±…μ„ λ³€κ²½ν•΄λ„, μ• ν”λ¦¬μΌ€μ΄μ…μ **κµ¬μ„± μ—­ν• **μ„ λ‹΄λ‹Ήν•λ” `AppConfig`λ§ λ³€κ²½ν•λ©΄ λ¨
- β… ν΄λΌμ΄μ–ΈνΈ μ½”λ“μΈ `OrderServiceImpl`λ¥Ό ν¬ν•¨ν•΄μ„ **μ‚¬μ© μμ—­**μ μ–΄λ–¤ μ½”λ“λ„ λ³€κ²½ν•  ν•„μ”κ°€ μ—†μ
- β… **κµ¬μ„± μμ—­**μ€ λ‹Ήμ—°ν λ³€κ²½λ¨ (κµ¬μ„± μ—­ν• μ„ λ‹΄λ‹Ήν•λ” AppConfigλ¥Ό μ• ν”λ¦¬μΌ€μ΄μ…μ΄λΌλ” κ³µμ—°μ κΈ°νμλ΅ μƒκ°ν•μ)

---

## Before / After λΉ„κµ

### Before: λ¬Έμ κ°€ μλ κµ¬μ΅°

**μ½”λ“**:
```java
public class OrderServiceImpl implements OrderService {
    // DIP μ„λ°: κµ¬μ²΄ ν΄λμ¤μ— μμ΅΄
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
}
```

**λ¬Έμ μ **:
- β DIP μ„λ°: μ¶”μƒν™”(μΈν„°νμ΄μ¤) + κµ¬μ²΄ν™”(κµ¬ν„ ν΄λμ¤) λ¨λ‘ μμ΅΄
- β OCP μ„λ°: κΈ°λ¥ ν™•μ¥ μ‹ ν΄λΌμ΄μ–ΈνΈ μ½”λ“ λ³€κ²½ ν•„μ”
- β ν΄λΌμ΄μ–ΈνΈκ°€ λ„λ¬΄ λ§μ€ μ±…μ„μ„ κ°€μ§

---

### After: κ°μ„ λ κµ¬μ΅°

**μ½”λ“**:
```java
// ν΄λΌμ΄μ–ΈνΈ: μ‹¤ν–‰μ—λ§ μ§‘μ¤‘
public class OrderServiceImpl implements OrderService {
    // DIP μ¤€μ: μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
    private final DiscountPolicy discountPolicy;

    public OrderServiceImpl(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;
    }
}

// AppConfig: κ°μ²΄ μƒμ„±κ³Ό μ—°κ²° λ‹΄λ‹Ή
public class AppConfig {
    public DiscountPolicy discountPolicy() {
        return new RateDiscountPolicy();  // μ—¬κΈ°λ§ λ³€κ²½!
    }
}
```

**κ°μ„  ν¨κ³Ό**:
- β… DIP μ¤€μ: μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
- β… OCP μ¤€μ: ν™•μ¥μ— μ—΄λ ¤μκ³  λ³€κ²½μ— λ‹«ν€μμ
- β… κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬: μ‹¤ν–‰ μ±…μ„ / κµ¬μ„± μ±…μ„ λ…ν™•ν λ¶„λ¦¬
- β… μ—­ν• κ³Ό κµ¬ν„ λ¶„λ¦¬: μ½”λ“μ κ°€λ…μ„± ν–¥μƒ

---

## μ „μ²΄ νλ¦„ λ‹¤μ΄μ–΄κ·Έλ¨

```mermaid
graph TB
    subgraph "1. μ΄κΈ° λ¬Έμ "
        A1[OrderServiceImpl]
        A2[FixDiscountPolicy]
        A1 -->|μ§μ ‘ μƒμ„± λ° μμ΅΄| A2
        A1_note[DIP, OCP μ„λ°]
    end

    subgraph "2. AppConfig λ„μ…"
        B1[AppConfig]
        B2[OrderServiceImpl]
        B3[FixDiscountPolicy]
        B1 -.μƒμ„±.-> B2
        B1 -.μƒμ„±.-> B3
        B1 -.μ£Όμ….-> B2
        B2_note[DIP μ¤€μ]
    end

    subgraph "3. μ •μ±… λ³€κ²½"
        C1[AppConfig]
        C2[OrderServiceImpl<br/>λ³€κ²½ μ—†μ!]
        C3[RateDiscountPolicy]
        C1 -.μƒμ„±.-> C2
        C1 -.μƒμ„±.-> C3
        C1 -.μ£Όμ….-> C2
        C3_note[OCP μ¤€μ]
    end

    style A1 fill:#ffcccc
    style B2 fill:#ccffcc
    style C2 fill:#ccffcc
```

---

## π’΅ ν•µμ‹¬ μ •λ¦¬

### AppConfigμ μ—­ν• 

**κ³µμ—° κΈ°νμλ΅μ„**:
1. κ³µμ—°μ„ κµ¬μ„±
2. λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„­μ™Έ
3. μ—­ν• μ— λ§λ” λ°°μ°λ¥Ό μ§€μ •
4. λ°°μ° κµμ²΄λ” κΈ°νμμ λ«

**μ½”λ“λ΅μ„**:
1. κµ¬ν„ κ°μ²΄ μƒμ„±
2. μƒμ„±μλ¥Ό ν†µν•΄ μμ΅΄κ΄€κ³„ μ£Όμ…(μ—°κ²°)
3. μ „μ²΄ κµ¬μ„± μ±…μ„

### ν΄λΌμ΄μ–ΈνΈ(ServiceImpl)μ μ—­ν• 

**λ°°μ°λ΅μ„**:
- μμ‹ μ μ—­ν• (λ°°μ—­)μ„ μν–‰ν•λ” κ²ƒμ—λ§ μ§‘μ¤‘
- μ–΄λ–¤ μƒλ€μ—­(κµ¬ν„μ²΄)μ΄ μ„ νƒλλ”λΌλ„ λ‘κ°™μ΄ κ³µμ—° κ°€λ¥

**μ½”λ“λ΅μ„**:
- λ‹΄λ‹Ή **κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„**λ§
- μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ μ£Όμ…λ μ§€λ” μ• ν•„μ” μ—†μ
- **μ‹¤ν–‰μ—λ§ μ§‘μ¤‘**

---

## λ³€κ²½μ νλ¦„

```mermaid
sequenceDiagram
    participant μ”κµ¬μ‚¬ν•­
    participant AppConfig
    participant OrderServiceImpl
    participant DiscountPolicy

    μ”κµ¬μ‚¬ν•­->>AppConfig: ν• μΈ μ •μ±… λ³€κ²½ μ”μ²­
    AppConfig->>AppConfig: discountPolicy() μμ •
    Note over AppConfig: return new RateDiscountPolicy()
    AppConfig->>OrderServiceImpl: RateDiscountPolicy μ£Όμ…
    Note over OrderServiceImpl: μ½”λ“ λ³€κ²½ μ—†μ!
    OrderServiceImpl->>DiscountPolicy: discount() νΈμ¶
    DiscountPolicy-->>OrderServiceImpl: 10% ν• μΈ κ²°κ³Ό
```

---

## μ •λ¦¬

### κ°μ„ λ μ„¤κ³„μ μ¥μ 

**1. λ‹¨μΌ μ±…μ„ μ›μΉ™ (SRP)**:
- AppConfig: κ°μ²΄ μƒμ„± λ° μ—°κ²°
- OrderServiceImpl: λΉ„μ¦λ‹μ¤ λ΅μ§ μ‹¤ν–‰

**2. μμ΅΄κ΄€κ³„ μ—­μ „ μ›μΉ™ (DIP)**:
- ν΄λΌμ΄μ–ΈνΈ μ½”λ“κ°€ μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
- κµ¬μ²΄ ν΄λμ¤λ” μ „ν€ λ°λΌλ„ λ¨

**3. κ°λ°©-νμ‡„ μ›μΉ™ (OCP)**:
- μ†ν”„νΈμ›¨μ–΄ μ”μ†λ¥Ό μƒλ΅­κ² ν™•μ¥
- μ‚¬μ© μμ—­μ λ³€κ²½μ€ λ‹«ν€ μμ

**4. κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬**:
- κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ—°κ²°ν•λ” μ—­ν• 
- μ‹¤ν–‰ν•λ” μ—­ν• 
- κ΄€μ‹¬μ‚¬κ°€ λ…ν™•ν λ¶„λ¦¬λ¨

---

## λ‹¤μ ν•™μµ

β΅οΈ **[3-7. μΆ‹μ€ κ°μ²΄ μ§€ν–¥ μ„¤κ³„μ 5κ°€μ§€ μ›μΉ™μ μ μ©](./3-7-μΆ‹μ€κ°μ²΄μ§€ν–¥μ„¤κ³„μ5κ°€μ§€μ›μΉ™μμ μ©.md)**
- SRP, DIP, OCP μ›μΉ™ μƒμ„Έ λ¶„μ„
- κ° μ›μΉ™μ΄ μ–΄λ–»κ² μ μ©λμ—λ”μ§€ ν™•μΈ
- SOLID μ›μΉ™μ μ‹¤μ „ μ μ©
