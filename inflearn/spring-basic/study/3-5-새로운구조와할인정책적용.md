# 3-5. ìƒˆë¡œìš´ êµ¬ì¡°ì™€ í• ì¸ ì •ì±… ì ìš©

**ì¶œì²˜**: ì¸í”„ëŸ° - ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ ê¸°ë³¸í¸
**ì±•í„°**: 3. ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ ì´í•´2 - ê°ì²´ ì§€í–¥ ì›ë¦¬ ì ìš©

---

## í•™ìŠµ ëª©í‘œ

- [ ] êµ¬ì„± ì˜ì—­ê³¼ ì‚¬ìš© ì˜ì—­ì˜ ë¶„ë¦¬ë¥¼ ì´í•´í•œë‹¤
- [ ] AppConfigë§Œ ë³€ê²½í•˜ì—¬ ì •ì±…ì„ ì „í™˜í•  ìˆ˜ ìˆë‹¤
- [ ] OCP, DIP ì›ì¹™ì´ ì§€ì¼œì§€ëŠ” ê²ƒì„ í™•ì¸í•œë‹¤

---

## í• ì¸ ì •ì±… ë³€ê²½í•˜ê¸°

### ìš”êµ¬ì‚¬í•­ ì¬í™•ì¸

**ë³€ê²½ ì‚¬í•­**:
- `FixDiscountPolicy` (ì •ì•¡ í• ì¸) â†’ `RateDiscountPolicy` (ì •ë¥  í• ì¸)

**ì§ˆë¬¸**:
> ì–´ë–¤ ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ë ê¹Œìš”?

**ì •ë‹µ**:
> âœ… **AppConfigì˜ `discountPolicy()` ë©”ì„œë“œë§Œ ë³€ê²½!**

---

## ì‚¬ìš© ì˜ì—­ê³¼ êµ¬ì„± ì˜ì—­ì˜ ë¶„ë¦¬

### ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°

```mermaid
graph TB
    subgraph "ì‚¬ìš© ì˜ì—­ - ë³€ê²½ ì—†ìŒ"
        A[OrderServiceImpl]
        B[DiscountPolicy<br/>interface]

        A --> B
    end

    subgraph "êµ¬ì„± ì˜ì—­ - ë³€ê²½ ìˆìŒ"
        E[AppConfig]
    end

    subgraph "êµ¬í˜„ì²´"
        C[FixDiscountPolicy<br/>ì´ì „]
        D[RateDiscountPolicy<br/>ë³€ê²½]
    end

    E -.X ì´ì „ ìƒì„±.-> C
    E -.âœ“ ìƒˆë¡œ ìƒì„±.-> D
    D -.-> B

    style A fill:#ccffcc
    style E fill:#ffcccc
    style D fill:#ffffcc
```

**ë¶„ë¦¬ì˜ íš¨ê³¼**:
- ğŸŸ¢ **ì‚¬ìš© ì˜ì—­**: ë³€ê²½ ì—†ìŒ (ì•ˆì •ì )
- ğŸ”´ **êµ¬ì„± ì˜ì—­**: ë³€ê²½ ìˆìŒ (ë‹¹ì—°í•¨, ì„¤ì • ë³€ê²½)

---

## í• ì¸ ì •ì±… ë³€ê²½ ì½”ë“œ

### AppConfig ìˆ˜ì •

**ë³€ê²½ ì‚¬í•­ - ë”± í•œ ì¤„ë§Œ!**:

```java
package hello.core;

import hello.core.discount.DiscountPolicy;
import hello.core.discount.FixDiscountPolicy;
import hello.core.discount.RateDiscountPolicy;  // ì¶”ê°€
import hello.core.member.MemberRepository;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;

public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(
            memberRepository(),
            discountPolicy()  // ë³€ê²½ ì—†ìŒ
        );
    }

    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    // í• ì¸ ì •ì±… ì—­í•  - êµ¬í˜„ì²´ë§Œ ë³€ê²½!
    public DiscountPolicy discountPolicy() {
        // return new FixDiscountPolicy();      // ì •ì•¡ í• ì¸ (ì´ì „)
        return new RateDiscountPolicy();        // ì •ë¥  í• ì¸ (ë³€ê²½)
    }
}
```

**ë³€ê²½ ì§€ì **:
- âœ… `discountPolicy()` ë©”ì„œë“œì˜ return ë¬¸ **í•œ ì¤„ë§Œ ë³€ê²½**
- âŒ ë‹¤ë¥¸ ì½”ë“œëŠ” ì „í˜€ ë³€ê²½í•˜ì§€ ì•ŠìŒ

---

## ë³€ê²½ ì˜í–¥ ë²”ìœ„

### ì˜í–¥ ë²”ìœ„ ë¶„ì„

| ì˜ì—­ | ë³€ê²½ ì—¬ë¶€ | ë³€ê²½ íŒŒì¼ | ì„¤ëª… |
|------|----------|----------|------|
| **êµ¬ì„± ì˜ì—­** | âœ… ë³€ê²½ | `AppConfig.java` | í• ì¸ ì •ì±… êµ¬í˜„ì²´ ë³€ê²½ |
| **ì‚¬ìš© ì˜ì—­** | âŒ ë³€ê²½ ì—†ìŒ | `OrderServiceImpl.java` | í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ê·¸ëŒ€ë¡œ |
| **ì‚¬ìš© ì˜ì—­** | âŒ ë³€ê²½ ì—†ìŒ | `OrderService.java` | ì¸í„°í˜ì´ìŠ¤ ê·¸ëŒ€ë¡œ |
| **ì‚¬ìš© ì˜ì—­** | âŒ ë³€ê²½ ì—†ìŒ | í…ŒìŠ¤íŠ¸ ì½”ë“œ | ì „í˜€ ìˆ˜ì • ì—†ìŒ |

### ë³€ê²½ ì „í›„ ë¹„êµ

**Before (ê¸°ì¡´ êµ¬ì¡°)**:
```java
// OrderServiceImplì„ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í–ˆìŒ
public class OrderServiceImpl implements OrderService {
    // private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
```

**After (ê°œì„ ëœ êµ¬ì¡°)**:
```java
// OrderServiceImplì€ ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
public class OrderServiceImpl implements OrderService {
    private final DiscountPolicy discountPolicy;  // ë³€ê²½ ì—†ìŒ

    public OrderServiceImpl(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;  // ë³€ê²½ ì—†ìŒ
    }
}

// AppConfigë§Œ ìˆ˜ì •
public DiscountPolicy discountPolicy() {
    return new RateDiscountPolicy();  // ì—¬ê¸°ë§Œ ë³€ê²½!
}
```

---

## êµ¬ì„± ì˜ì—­ê³¼ ì‚¬ìš© ì˜ì—­ ë¶„ë¦¬ ë‹¤ì´ì–´ê·¸ë¨

### ìƒì„¸ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "ì‚¬ìš© ì˜ì—­ - Closed for modification"
        A[OrderServiceImpl<br/>ë³€ê²½ ì—†ìŒ]
        B[DiscountPolicy<br/>interface]
        A --> B
    end

    subgraph "êµ¬ì„± ì˜ì—­ - Open for extension"
        C[AppConfig<br/>ë³€ê²½]
        C -.ìƒì„± ë° ì£¼ì….-> A
    end

    subgraph "êµ¬í˜„ì²´ ì„ íƒ"
        D[FixDiscountPolicy]
        E[RateDiscountPolicy<br/>ì„ íƒë¨]
        F[SpecialDiscountPolicy<br/>ë¯¸ë˜ í™•ì¥]
    end

    C -.ì„ íƒ.-> D
    C -.ì„ íƒ.-> E
    C -.ì„ íƒ.-> F
    E -.-> B

    style A fill:#ccffcc
    style C fill:#ffcccc
    style E fill:#ffffcc
```

**í•µì‹¬**:
- **ì‚¬ìš© ì˜ì—­**: ë³€ê²½ì— ë‹«í˜€ìˆìŒ (Closed)
- **êµ¬ì„± ì˜ì—­**: í™•ì¥ì— ì—´ë ¤ìˆìŒ (Open)

---

## ğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸

### AppConfigëŠ” ê³µì—° ê¸°íšì

**ê³µì—° ê¸°íšìì˜ ì—­í• **:
1. ë°°ì—­(ì—­í• )ì— ë§ëŠ” ë°°ìš°(êµ¬í˜„ í´ë˜ìŠ¤) ì„ íƒ
2. ë°°ìš° êµì²´ëŠ” ê¸°íšìì˜ ëª«
3. ë°°ìš°(ServiceImpl)ëŠ” ìì‹ ì˜ ì—­í• (ì‹¤í–‰)ë§Œ ì§‘ì¤‘

**ì½”ë“œë¡œ ë¹„ìœ **:
```java
// ê³µì—° ê¸°íšì
public class AppConfig {

    // ë¡œë¯¸ì˜¤ ì—­í• ì— ë””ì¹´í”„ë¦¬ì˜¤ ë°°ì •
    public OrderService orderService() {
        return new OrderServiceImpl(
            memberRepository(),
            discountPolicy()  // ë°°ìš° ì„ íƒì€ ì—¬ê¸°ì„œ!
        );
    }

    // í• ì¸ ì •ì±… ë°°ì—­ì— ì •ë¥  í• ì¸ ë°°ì •
    public DiscountPolicy discountPolicy() {
        return new RateDiscountPolicy();  // ë°°ìš° êµì²´!
    }
}
```

---

### êµ¬ì„± ì˜ì—­ì˜ ë‹¹ì—°í•œ ë³€ê²½

**ë‹¹ì—°í•œ ì´ìœ **:
- êµ¬ì„±(Configuration) ì˜ì—­ì€ **ì„¤ì •ì„ ë‹´ë‹¹**
- ì •ì±… ë³€ê²½ì€ **ì„¤ì • ë³€ê²½**ì´ë¯€ë¡œ êµ¬ì„± ì˜ì—­ì´ ë³€ê²½ë˜ëŠ” ê²ƒì€ ë‹¹ì—°
- ì¤‘ìš”í•œ ê²ƒì€ **ì‚¬ìš© ì˜ì—­ì´ ì˜í–¥ë°›ì§€ ì•ŠëŠ” ê²ƒ**

**ì´ê²ƒì´ ì¢‹ì€ ê°ì²´ ì§€í–¥ ì„¤ê³„!**

---

## OCP, DIP ì›ì¹™ ì¤€ìˆ˜ í™•ì¸

### DIP (ì˜ì¡´ê´€ê³„ ì—­ì „ ì›ì¹™) ì¤€ìˆ˜ âœ…

**OrderServiceImpl**:
```java
// ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´ - DIP ì¤€ìˆ˜!
private final DiscountPolicy discountPolicy;

// êµ¬ì²´ í´ë˜ìŠ¤ëŠ” ëª¨ë¦„
public OrderServiceImpl(DiscountPolicy discountPolicy) {
    this.discountPolicy = discountPolicy;
}
```

**í™•ì¸**:
- âœ… `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´
- âœ… `RateDiscountPolicy` êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ì „í˜€ ëª¨ë¦„
- âœ… DIP ì™„ë²½ ì¤€ìˆ˜

---

### OCP (ê°œë°©-íì‡„ ì›ì¹™) ì¤€ìˆ˜ âœ…

**í™•ì¥ê³¼ ë³€ê²½**:
```java
// ì‚¬ìš© ì˜ì—­ - ë³€ê²½ì— ë‹«í˜€ìˆìŒ (Closed)
public class OrderServiceImpl implements OrderService {
    // ì „í˜€ ë³€ê²½í•˜ì§€ ì•ŠìŒ!
}

// êµ¬ì„± ì˜ì—­ - í™•ì¥ì— ì—´ë ¤ìˆìŒ (Open)
public class AppConfig {
    public DiscountPolicy discountPolicy() {
        return new RateDiscountPolicy();  // ìƒˆë¡œìš´ ì •ì±…ìœ¼ë¡œ í™•ì¥
    }
}
```

**í™•ì¸**:
- âœ… ì†Œí”„íŠ¸ì›¨ì–´ ìš”ì†Œë¥¼ ìƒˆë¡­ê²Œ í™•ì¥
- âœ… ì‚¬ìš© ì˜ì—­ì˜ ë³€ê²½ì€ ë‹«í˜€ ìˆìŒ
- âœ… OCP ì™„ë²½ ì¤€ìˆ˜

---

## ì •ë¦¬

### ê°œì„ ëœ êµ¬ì¡°ì˜ ì¥ì 

**1. ì±…ì„ ë¶„ë¦¬**:
- `AppConfig`: ê°ì²´ ìƒì„± ë° ì—°ê²°
- `OrderServiceImpl`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰

**2. ìœ ì—°í•œ ë³€ê²½**:
- ì •ì±… ë³€ê²½ ì‹œ AppConfigë§Œ ìˆ˜ì •
- í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ

**3. SOLID ì›ì¹™ ì¤€ìˆ˜**:
- DIP: ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´
- OCP: í™•ì¥ì— ì—´ë ¤ìˆê³  ë³€ê²½ì— ë‹«í˜€ìˆìŒ

---

### ë³€ê²½ì˜ íë¦„

```mermaid
sequenceDiagram
    participant ìš”êµ¬ì‚¬í•­
    participant AppConfig
    participant OrderServiceImpl
    participant DiscountPolicy

    ìš”êµ¬ì‚¬í•­->>AppConfig: í• ì¸ ì •ì±… ë³€ê²½ ìš”ì²­
    AppConfig->>AppConfig: discountPolicy() ìˆ˜ì •
    Note over AppConfig: return new RateDiscountPolicy()
    AppConfig->>OrderServiceImpl: RateDiscountPolicy ì£¼ì…
    Note over OrderServiceImpl: ì½”ë“œ ë³€ê²½ ì—†ìŒ!
    OrderServiceImpl->>DiscountPolicy: discount() í˜¸ì¶œ
    DiscountPolicy-->>OrderServiceImpl: 10% í• ì¸ ê²°ê³¼
```

**í•µì‹¬**:
- `OrderServiceImpl`ì€ ì „í˜€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
- `AppConfig`ë§Œ ìˆ˜ì •
- ì˜ì¡´ê´€ê³„ ì£¼ì…ìœ¼ë¡œ ìœ ì—°í•œ êµ¬ì¡° ë‹¬ì„±

---

## ë‹¤ìŒ í•™ìŠµ

â¡ï¸ **[3-6. ì „ì²´ íë¦„ ì •ë¦¬](./3-6-ì „ì²´íë¦„ì •ë¦¬.md)**
- ì§€ê¸ˆê¹Œì§€ì˜ ê³¼ì • ì •ë¦¬
- ê° ë‹¨ê³„ë³„ ê°œì„  ì‚¬í•­ ìš”ì•½
- Before/After ë¹„êµ
