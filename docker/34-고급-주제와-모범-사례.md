# ì„¹ì…˜ 34: ê³ ê¸‰ ì£¼ì œì™€ ëª¨ë²” ì‚¬ë¡€

## ë¹„ìœ ë¡œ ì‹œì‘í•˜ê¸°

Docker ëª¨ë²” ì‚¬ë¡€ëŠ” **ê±´ì¶• ì„¤ê³„ ì›ì¹™**ê³¼ ê°™ìŠµë‹ˆë‹¤.

```
ê±´ì¶• ì„¤ê³„                            Docker ëª¨ë²” ì‚¬ë¡€
=========                            =================
ğŸ—ï¸ ê²¬ê³ í•œ ê¸°ì´ˆ                  â†’    ìµœì í™”ëœ ì´ë¯¸ì§€
ğŸ”§ í’ˆì§ˆ ì¢‹ì€ ìì¬                â†’    ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€
ğŸ“ í‘œì¤€ ê·œê²©                     â†’    ì»¨í…Œì´ë„ˆ ë””ìì¸ íŒ¨í„´
ğŸšª ë¹„ìƒêµ¬                        â†’    í—¬ìŠ¤ì²´í¬, ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´
ğŸ”¥ í™”ì¬ ê²½ë³´                     â†’    ëª¨ë‹ˆí„°ë§, ì•Œë¦¼
ğŸ“‹ ì„¤ê³„ë„                        â†’    ë¬¸ì„œí™”
â™»ï¸ ì¹œí™˜ê²½ ì„¤ê³„                   â†’    ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±
```

ê±´ì¶•ë¬¼ì´ ì„¤ê³„ ì›ì¹™ ì—†ì´ ì§€ì–´ì§€ë©´ ë¬´ë„ˆì§€ë“¯ì´, Dockerë„ ëª¨ë²” ì‚¬ë¡€ ì—†ì´ ìš´ì˜í•˜ë©´ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.

---

## 1. ì´ë¯¸ì§€ ìµœì í™”

### 1.1 ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ ë§ˆìŠ¤í„°í•˜ê¸°

```dockerfile
# âŒ ë‚˜ìœ ì˜ˆ: ë¹Œë“œ ë„êµ¬ê°€ í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ì— í¬í•¨
FROM gradle:8.5-jdk17
WORKDIR /app
COPY . .
RUN gradle build --no-daemon
CMD ["java", "-jar", "build/libs/app.jar"]
# ê²°ê³¼: ì´ë¯¸ì§€ í¬ê¸° ~800MB


# âœ… ì¢‹ì€ ì˜ˆ: ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ
FROM gradle:8.5-jdk17 AS builder
WORKDIR /app
COPY build.gradle.kts settings.gradle.kts ./
COPY gradle ./gradle
# ì˜ì¡´ì„±ë§Œ ë¨¼ì € ë‹¤ìš´ë¡œë“œ (ìºì‹± í™œìš©)
RUN gradle dependencies --no-daemon
# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ ë° ë¹Œë“œ
COPY src ./src
RUN gradle build --no-daemon -x test

# í”„ë¡œë•ì…˜ ìŠ¤í…Œì´ì§€
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
# ë¹Œë“œëœ JARë§Œ ë³µì‚¬
COPY --from=builder /app/build/libs/*.jar app.jar
# non-root ì‚¬ìš©ì
RUN addgroup -g 1000 appuser && \
    adduser -D -u 1000 -G appuser appuser && \
    chown -R appuser:appuser /app
USER appuser
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
# ê²°ê³¼: ì´ë¯¸ì§€ í¬ê¸° ~200MB (75% ê°ì†Œ)
```

### 1.2 ë ˆì´ì–´ ìºì‹± ìµœì í™”

```dockerfile
# âŒ ë‚˜ìœ ì˜ˆ: ì†ŒìŠ¤ ë³€ê²½ë§ˆë‹¤ ì „ì²´ ì¬ë¹Œë“œ
FROM node:18-alpine
WORKDIR /app
COPY . .                    # ëª¨ë“  íŒŒì¼ ë³µì‚¬
RUN npm install             # ì†ŒìŠ¤ ë³€ê²½ ì‹œì—ë„ ì¬ì‹¤í–‰
RUN npm run build
CMD ["npm", "start"]


# âœ… ì¢‹ì€ ì˜ˆ: ë ˆì´ì–´ ìºì‹± í™œìš©
FROM node:18-alpine
WORKDIR /app

# 1. ì˜ì¡´ì„± íŒŒì¼ë§Œ ë¨¼ì € ë³µì‚¬
COPY package*.json ./

# 2. ì˜ì¡´ì„± ì„¤ì¹˜ (package.json ë³€ê²½ ì‹œì—ë§Œ ì¬ì‹¤í–‰)
RUN npm ci --only=production

# 3. ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ (ìì£¼ ë³€ê²½ë¨)
COPY . .

# 4. ë¹Œë“œ
RUN npm run build

CMD ["npm", "start"]

# package.jsonì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ npm ciëŠ” ìºì‹œ ì‚¬ìš©
```

### 1.3 ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œì™¸ (.dockerignore)

```bash
# .dockerignore
# VCS
.git
.gitignore
.gitattributes

# CI/CD
.github
.gitlab-ci.yml
Jenkinsfile

# ë¬¸ì„œ
README.md
CHANGELOG.md
docs/
*.md

# ë¹Œë“œ ì‚°ì¶œë¬¼
build/
dist/
target/
*.jar
*.war

# ì˜ì¡´ì„±
node_modules/
.gradle/
.m2/

# IDE
.idea/
.vscode/
*.iml
.project
.classpath

# ë¡œê·¸
*.log
logs/

# í™˜ê²½ ë³€ìˆ˜
.env
.env.local
secrets/

# í…ŒìŠ¤íŠ¸
test/
tests/
__tests__/
*.test.js
*.spec.js

# OS
.DS_Store
Thumbs.db

# Docker
Dockerfile*
docker-compose*.yml
```

### 1.4 Distroless ì´ë¯¸ì§€ ì‚¬ìš©

```dockerfile
# ìµœì†Œí•œì˜ ì´ë¯¸ì§€ (OS ì—†ìŒ)
FROM gcr.io/distroless/java17-debian11

COPY --from=builder /app/build/libs/*.jar /app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]

# ì¥ì :
# - ìµœì†Œ ì´ë¯¸ì§€ í¬ê¸°
# - ê³µê²© í‘œë©´ ìµœì†Œí™”
# - ë¶ˆí•„ìš”í•œ ë„êµ¬ ì—†ìŒ (shell, package manager)
```

---

## 2. ì»¨í…Œì´ë„ˆ ë””ìì¸ íŒ¨í„´

### 2.1 ì‚¬ì´ë“œì¹´ íŒ¨í„´ (Sidecar Pattern)

```yaml
# ë¡œê·¸ ìˆ˜ì§‘ ì‚¬ì´ë“œì¹´
apiVersion: v1
kind: Pod
metadata:
  name: app-with-logging
spec:
  containers:
  # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  - name: app
    image: lk-trade/user-service:latest
    volumeMounts:
    - name: logs
      mountPath: /app/logs

  # ì‚¬ì´ë“œì¹´: ë¡œê·¸ ìˆ˜ì§‘
  - name: log-collector
    image: fluentd:latest
    volumeMounts:
    - name: logs
      mountPath: /app/logs
      readOnly: true

  volumes:
  - name: logs
    emptyDir: {}
```

ìš©ë„:
- ë¡œê·¸ ìˆ˜ì§‘ ë° ì „ì†¡
- ì„¤ì • íŒŒì¼ ë™ê¸°í™”
- í”„ë¡ì‹œ (Envoy, Linkerd)
- ëª¨ë‹ˆí„°ë§ ì—ì´ì „íŠ¸

### 2.2 ì•°ë°°ì„œë” íŒ¨í„´ (Ambassador Pattern)

```yaml
# ë°ì´í„°ë² ì´ìŠ¤ í”„ë¡ì‹œ
apiVersion: v1
kind: Pod
metadata:
  name: app-with-db-proxy
spec:
  containers:
  # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  - name: app
    image: lk-trade/user-service:latest
    env:
    - name: DB_HOST
      value: "localhost"  # ì•°ë°°ì„œë”ë¥¼ í†µí•´ ì ‘ê·¼
    - name: DB_PORT
      value: "5432"

  # ì•°ë°°ì„œë”: DB í”„ë¡ì‹œ
  - name: db-proxy
    image: haproxy:latest
    # DB ì—°ê²° ê´€ë¦¬, ë¡œë“œ ë°¸ëŸ°ì‹±, SSL ì¢…ë£Œ
```

ìš©ë„:
- ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ì¶”ìƒí™”
- ì—°ê²° í’€ë§
- ì¬ì‹œë„ ë¡œì§
- ì„œí‚· ë¸Œë ˆì´ì»¤

### 2.3 ì–´ëŒ‘í„° íŒ¨í„´ (Adapter Pattern)

```yaml
# ë©”íŠ¸ë¦­ ë³€í™˜ ì–´ëŒ‘í„°
apiVersion: v1
kind: Pod
metadata:
  name: app-with-adapter
spec:
  containers:
  # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (ìì²´ ë©”íŠ¸ë¦­ í¬ë§·)
  - name: app
    image: legacy-app:latest
    ports:
    - containerPort: 8080

  # ì–´ëŒ‘í„°: Prometheus í¬ë§·ìœ¼ë¡œ ë³€í™˜
  - name: metrics-adapter
    image: prometheus-adapter:latest
    ports:
    - containerPort: 9090
```

ìš©ë„:
- ë©”íŠ¸ë¦­ í¬ë§· ë³€í™˜
- ë¡œê·¸ í¬ë§· í‘œì¤€í™”
- ë ˆê±°ì‹œ ì‹œìŠ¤í…œ í†µí•©

---

## 3. í—¬ìŠ¤ì²´í¬ ë° ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´

### 3.1 ì˜¬ë°”ë¥¸ í—¬ìŠ¤ì²´í¬ êµ¬í˜„

```kotlin
// Spring Boot Actuator
@RestController
class HealthController {

    // Liveness: "ë‚˜ ì‚´ì•„ìˆë‹ˆ?"
    @GetMapping("/actuator/health/liveness")
    fun liveness(): ResponseEntity<Map<String, Any>> {
        // ê°„ë‹¨í•œ ì²´í¬ë§Œ
        return ResponseEntity.ok(mapOf(
            "status" to "UP",
            "timestamp" to Instant.now()
        ))
    }

    // Readiness: "ìš”ì²­ ë°›ì„ ì¤€ë¹„ ëë‹ˆ?"
    @GetMapping("/actuator/health/readiness")
    fun readiness(): ResponseEntity<Map<String, Any>> {
        // ì˜ì¡´ì„± ì²´í¬
        val dbHealthy = checkDatabaseConnection()
        val redisHealthy = checkRedisConnection()
        val externalApiHealthy = checkExternalApi()

        val allHealthy = dbHealthy && redisHealthy && externalApiHealthy

        return if (allHealthy) {
            ResponseEntity.ok(mapOf(
                "status" to "UP",
                "checks" to mapOf(
                    "database" to "UP",
                    "redis" to "UP",
                    "externalApi" to "UP"
                )
            ))
        } else {
            ResponseEntity.status(503).body(mapOf(
                "status" to "DOWN",
                "checks" to mapOf(
                    "database" to if (dbHealthy) "UP" else "DOWN",
                    "redis" to if (redisHealthy) "UP" else "DOWN",
                    "externalApi" to if (externalApiHealthy) "UP" else "DOWN"
                )
            ))
        }
    }
}
```

```yaml
# Kubernetes Deployment
spec:
  containers:
  - name: app
    livenessProbe:
      httpGet:
        path: /actuator/health/liveness
        port: 8080
      initialDelaySeconds: 60  # ì‹œì‘ í›„ 60ì´ˆ í›„ë¶€í„° ì²´í¬
      periodSeconds: 10         # 10ì´ˆë§ˆë‹¤ ì²´í¬
      timeoutSeconds: 3         # 3ì´ˆ ë‚´ì— ì‘ë‹µ ì—†ìœ¼ë©´ ì‹¤íŒ¨
      failureThreshold: 3       # 3ë²ˆ ì—°ì† ì‹¤íŒ¨ ì‹œ ì¬ì‹œì‘

    readinessProbe:
      httpGet:
        path: /actuator/health/readiness
        port: 8080
      initialDelaySeconds: 30
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3       # 3ë²ˆ ì‹¤íŒ¨ ì‹œ íŠ¸ë˜í”½ ì°¨ë‹¨
```

### 3.2 ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´ (Graceful Shutdown)

```kotlin
// application.yml
server:
  shutdown: graceful  # ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´ í™œì„±í™”

spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s  # ìµœëŒ€ 30ì´ˆ ëŒ€ê¸°

// ì»¤ìŠ¤í…€ ì…§ë‹¤ìš´ ë¡œì§
@Component
class GracefulShutdown : DisposableBean {
    private val logger = LoggerFactory.getLogger(GracefulShutdown::class.java)

    override fun destroy() {
        logger.info("Graceful shutdown initiated...")

        // 1. ìƒˆ ìš”ì²­ ë°›ì§€ ì•Šê¸°
        logger.info("Stopping accepting new requests")

        // 2. ì§„í–‰ ì¤‘ì¸ ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°
        logger.info("Waiting for in-flight requests to complete")
        Thread.sleep(5000)  // ì‹¤ì œë¡œëŠ” ìš”ì²­ ì¹´ìš´í„° í™•ì¸

        // 3. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
        logger.info("Cleaning up resources")
        // DB ì—°ê²° í’€ ì¢…ë£Œ
        // ìºì‹œ í”ŒëŸ¬ì‹œ
        // ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì¢…ë£Œ

        logger.info("Graceful shutdown completed")
    }
}
```

```yaml
# Kubernetesì—ì„œ ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´
spec:
  containers:
  - name: app
    lifecycle:
      preStop:
        exec:
          command: ["/bin/sh", "-c", "sleep 15"]
    # SIGTERM ë°›ì€ í›„ 15ì´ˆ ëŒ€ê¸° â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì…§ë‹¤ìš´ ì‹œì‘
    terminationGracePeriodSeconds: 30
    # ìµœëŒ€ 30ì´ˆ í›„ SIGKILL
```

---

## 4. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ëª¨ë²” ì‚¬ë¡€

### 4.1 ì ì ˆí•œ ë¦¬ì†ŒìŠ¤ ì„¤ì •

```yaml
# âŒ ë‚˜ìœ ì˜ˆ: ë¦¬ì†ŒìŠ¤ ì„¤ì • ì—†ìŒ
spec:
  containers:
  - name: app
    image: myapp:latest
    # requests/limits ì—†ìŒ â†’ ë¦¬ì†ŒìŠ¤ ë¬´í•œ ì‚¬ìš© ê°€ëŠ¥


# âœ… ì¢‹ì€ ì˜ˆ: ì ì ˆí•œ ë¦¬ì†ŒìŠ¤ ì„¤ì •
spec:
  containers:
  - name: app
    image: myapp:latest
    resources:
      requests:
        cpu: "500m"      # 0.5 CPU ì˜ˆì•½
        memory: "512Mi"  # 512MB ì˜ˆì•½
      limits:
        cpu: "1000m"     # ìµœëŒ€ 1 CPU
        memory: "1Gi"    # ìµœëŒ€ 1GB

# ê°€ì´ë“œë¼ì¸:
# requests: í‰ê·  ì‚¬ìš©ëŸ‰ì˜ 80%
# limits: í”¼í¬ ì‚¬ìš©ëŸ‰ì˜ 120%
```

### 4.2 JVM ë©”ëª¨ë¦¬ ì„¤ì •

```dockerfile
# Dockerfile
FROM eclipse-temurin:17-jre-alpine

ENV JAVA_OPTS="-XX:+UseContainerSupport \
               -XX:MaxRAMPercentage=75.0 \
               -XX:InitialRAMPercentage=50.0 \
               -XX:+UseG1GC \
               -XX:MaxGCPauseMillis=200"

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar /app.jar"]
```

```yaml
# Kubernetes
spec:
  containers:
  - name: app
    resources:
      requests:
        memory: "1Gi"
      limits:
        memory: "1Gi"
    env:
    - name: JAVA_OPTS
      value: "-XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0"
    # 1GB ì»¨í…Œì´ë„ˆì—ì„œ JVMì€ 750MB ì‚¬ìš©
```

### 4.3 ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top nodes
kubectl top pods -n lk-trade

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì´ ë†’ì€ Pod ì°¾ê¸°
kubectl top pods -n lk-trade --sort-by=memory
kubectl top pods -n lk-trade --sort-by=cpu

# íŠ¹ì • Podì˜ ìƒì„¸ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl describe pod <pod-name> -n lk-trade
```

---

## 5. ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 5.1 ì´ë¯¸ì§€ ë³´ì•ˆ

```bash
# âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
â–¡ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì‚¬ìš©
â–¡ íŠ¹ì • ë²„ì „ íƒœê·¸ ì‚¬ìš© (latest ê¸ˆì§€)
â–¡ ì´ë¯¸ì§€ ìŠ¤ìº” (Trivy, Clair)
â–¡ ì´ë¯¸ì§€ ì„œëª… (Docker Content Trust)
â–¡ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ
â–¡ non-root ì‚¬ìš©ì
â–¡ ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì œê±°
â–¡ .dockerignore ì„¤ì •
```

### 5.2 ì»¨í…Œì´ë„ˆ ë³´ì•ˆ

```yaml
# SecurityContext ì„¤ì •
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault

  containers:
  - name: app
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
        add:
        - NET_BIND_SERVICE
```

### 5.3 Secret ê´€ë¦¬

```bash
# âŒ ë‚˜ìœ ì˜ˆ
docker run -e DB_PASSWORD=supersecret myapp

# âœ… ì¢‹ì€ ì˜ˆ
# 1. Docker Secret ì‚¬ìš©
echo "supersecret" | docker secret create db_password -
docker service create --secret db_password myapp

# 2. Kubernetes Secret ì‚¬ìš©
kubectl create secret generic db-secret --from-literal=password=supersecret
```

---

## 6. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 6.1 êµ¬ì¡°í™”ëœ ë¡œê¹…

```kotlin
// âŒ ë‚˜ìœ ì˜ˆ
logger.info("User login: ${user.email}")


// âœ… ì¢‹ì€ ì˜ˆ
logger.info(
    "User login",
    kv("userId", user.id),
    kv("email", user.email.maskEmail()),
    kv("ip", request.remoteAddr),
    kv("userAgent", request.getHeader("User-Agent"))
)

// JSON ì¶œë ¥:
{
  "timestamp": "2025-09-30T10:15:32.123Z",
  "level": "INFO",
  "message": "User login",
  "userId": 123,
  "email": "te**@example.com",
  "ip": "203.0.113.1",
  "userAgent": "Mozilla/5.0...",
  "correlationId": "abc-123-def"
}
```

### 6.2 ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```kotlin
// Prometheus ë©”íŠ¸ë¦­
import io.micrometer.core.instrument.MeterRegistry

@Service
class OrderService(
    private val meterRegistry: MeterRegistry
) {
    private val orderCounter = meterRegistry.counter("orders.created")
    private val orderTimer = meterRegistry.timer("orders.processing.time")

    fun createOrder(request: OrderRequest): Order {
        return orderTimer.record {
            // ì£¼ë¬¸ ìƒì„± ë¡œì§
            val order = processOrder(request)

            // ì¹´ìš´í„° ì¦ê°€
            orderCounter.increment()

            // íƒœê·¸ ì¶”ê°€
            meterRegistry.counter(
                "orders.created",
                "type", request.type,
                "status", "success"
            ).increment()

            order
        }
    }
}
```

---

## 7. í”„ë¡œë•ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 7.1 ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ì´ë¯¸ì§€
  â–¡ ìµœì í™”ëœ ì´ë¯¸ì§€ í¬ê¸° (<500MB)
  â–¡ ë³´ì•ˆ ìŠ¤ìº” ì™„ë£Œ (HIGH/CRITICAL ì—†ìŒ)
  â–¡ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ
  â–¡ non-root ì‚¬ìš©ì
  â–¡ í—¬ìŠ¤ì²´í¬ êµ¬í˜„

â–¡ ì„¤ì •
  â–¡ í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬ (dev/staging/prod)
  â–¡ Secret ì•”í˜¸í™”
  â–¡ ë¦¬ì†ŒìŠ¤ requests/limits ì„¤ì •
  â–¡ ì ì ˆí•œ ë ˆí”Œë¦¬ì¹´ ìˆ˜

â–¡ ë„¤íŠ¸ì›Œí‚¹
  â–¡ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì„¤ì •
  â–¡ ë¡œë“œ ë°¸ëŸ°ì„œ êµ¬ì„±
  â–¡ Ingress ê·œì¹™ ì •ì˜
  â–¡ ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©

â–¡ ìŠ¤í† ë¦¬ì§€
  â–¡ PersistentVolume ì„¤ì •
  â–¡ ë°±ì—… ì „ëµ ìˆ˜ë¦½
  â–¡ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

â–¡ ëª¨ë‹ˆí„°ë§
  â–¡ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Prometheus)
  â–¡ ë¡œê·¸ ì§‘ê³„ (ELK/Loki)
  â–¡ ì•Œë¦¼ ê·œì¹™ ì„¤ì •
  â–¡ ëŒ€ì‹œë³´ë“œ êµ¬ì„± (Grafana)

â–¡ ë³´ì•ˆ
  â–¡ RBAC ì„¤ì •
  â–¡ NetworkPolicy ì ìš©
  â–¡ PodSecurityPolicy ì„¤ì •
  â–¡ ì´ë¯¸ì§€ ìŠ¤ìº” ìë™í™”

â–¡ ë°±ì—… ë° ì¬í•´ ë³µêµ¬
  â–¡ ì •ê¸° ë°±ì—… ìŠ¤ì¼€ì¤„
  â–¡ ë°±ì—… ë³µêµ¬ í…ŒìŠ¤íŠ¸
  â–¡ DR ê³„íš ìˆ˜ë¦½
  â–¡ RTO/RPO ì •ì˜

â–¡ ë¬¸ì„œí™”
  â–¡ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
  â–¡ ë°°í¬ ê°€ì´ë“œ
  â–¡ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ
  â–¡ ëŸ°ë¶ (Runbook)
```

### 7.2 ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
ì¼ì¼ ì²´í¬
â–¡ í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
â–¡ Pod ìƒíƒœ í™•ì¸
â–¡ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
â–¡ ì—ëŸ¬ ë¡œê·¸ ê²€í† 

ì£¼ê°„ ì²´í¬
â–¡ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í™•ì¸
â–¡ ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
â–¡ ë°±ì—… ê²€ì¦
â–¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ë¶„ì„

ì›”ê°„ ì²´í¬
â–¡ ìš©ëŸ‰ ê³„íš ê²€í† 
â–¡ ë¹„ìš© ë¶„ì„
â–¡ ë³´ì•ˆ ê°ì‚¬
â–¡ DR í›ˆë ¨
```

---

## 8. ì„±ëŠ¥ ìµœì í™”

### 8.1 ì´ë¯¸ì§€ ë¹Œë“œ ìµœì í™”

```dockerfile
# BuildKit í™œì„±í™”
# syntax=docker/dockerfile:1

FROM node:18-alpine AS builder

WORKDIR /app

# ìºì‹œ ë§ˆìš´íŠ¸ í™œìš©
RUN --mount=type=cache,target=/root/.npm \
    npm ci --only=production

# ë¹Œë“œ ìºì‹œ í™œìš©
RUN --mount=type=cache,target=/app/.cache \
    npm run build

FROM node:18-alpine

COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules

CMD ["node", "dist/main.js"]
```

```bash
# BuildKitìœ¼ë¡œ ë¹Œë“œ
DOCKER_BUILDKIT=1 docker build -t myapp:latest .

# ë¹Œë“œ ì†ë„ ë¹„êµ
# BuildKit ì—†ì´: 300ì´ˆ
# BuildKit ì‚¬ìš©: 60ì´ˆ (5ë°° ë¹ ë¦„)
```

### 8.2 ë„¤íŠ¸ì›Œí¬ ìµœì í™”

```yaml
# Service Mesh (Istio) ì—†ì´ ì„œë¹„ìŠ¤ ê°„ í†µì‹  ìµœì í™”
apiVersion: v1
kind: Service
metadata:
  name: user-service
spec:
  type: ClusterIP
  clusterIP: None  # Headless Service
  selector:
    app: user-service
  ports:
  - port: 8080

# ì¥ì :
# - DNSë¡œ ì§ì ‘ Pod IP ë°˜í™˜
# - ë¡œë“œ ë°¸ëŸ°ì„œ ì˜¤ë²„í—¤ë“œ ì—†ìŒ
# - ë¹ ë¥¸ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬
```

### 8.3 ìŠ¤í† ë¦¬ì§€ ìµœì í™”

```yaml
# ë¡œì»¬ SSD ì‚¬ìš© (ë†’ì€ IOPS)
apiVersion: v1
kind: PersistentVolume
metadata:
  name: local-ssd
spec:
  capacity:
    storage: 100Gi
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: local-storage
  local:
    path: /mnt/disks/ssd0
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - node1
```

---

## 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 9.1 ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²°

```bash
# ë¬¸ì œ 1: Podê°€ Pending ìƒíƒœ
kubectl describe pod <pod-name>
# í™•ì¸: ë¦¬ì†ŒìŠ¤ ë¶€ì¡±, PV ë°”ì¸ë”© ì‹¤íŒ¨, ë…¸ë“œ ì„ íƒ ë¬¸ì œ

# í•´ê²°:
# - ë…¸ë“œ ë¦¬ì†ŒìŠ¤ í™•ì¸: kubectl top nodes
# - PV í™•ì¸: kubectl get pv
# - ì´ë²¤íŠ¸ í™•ì¸: kubectl get events


# ë¬¸ì œ 2: Podê°€ CrashLoopBackOff
kubectl logs <pod-name> --previous
# í™•ì¸: ì• í”Œë¦¬ì¼€ì´ì…˜ ì—ëŸ¬, ì„¤ì • ì˜¤ë¥˜, í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨

# í•´ê²°:
# - ë¡œê·¸ í™•ì¸
# - í™˜ê²½ ë³€ìˆ˜ í™•ì¸
# - í—¬ìŠ¤ì²´í¬ ì„¤ì • í™•ì¸


# ë¬¸ì œ 3: ì´ë¯¸ì§€ Pull ì‹¤íŒ¨
kubectl describe pod <pod-name>
# ErrImagePull, ImagePullBackOff

# í•´ê²°:
# - ì´ë¯¸ì§€ ì´ë¦„ í™•ì¸
# - ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì¸ì¦ í™•ì¸
# - imagePullSecrets ì„¤ì •


# ë¬¸ì œ 4: ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨
# ë””ë²„ê·¸ Pod ì‹¤í–‰
kubectl run -it --rm debug --image=nicolaka/netshoot --restart=Never -- bash
# nslookup <service-name>
# ping <service-name>
# curl http://<service-name>:<port>
```

### 9.2 ë””ë²„ê¹… ë„êµ¬

```bash
# 1. kubectl debug (Kubernetes 1.23+)
kubectl debug <pod-name> -it --image=busybox --target=<container-name>

# 2. ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
kubectl logs -f <pod-name>

# 3. ì—¬ëŸ¬ Pod ë¡œê·¸ ë™ì‹œ í™•ì¸
kubectl logs -l app=user-service -f --all-containers=true

# 4. ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
kubectl get events -w

# 5. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top pods --containers
```

---

## 10. ë„êµ¬ ì¶”ì²œ

### 10.1 í•„ìˆ˜ ë„êµ¬

```bash
# CLI ë„êµ¬
1. kubectl - Kubernetes CLI
2. docker - Docker CLI
3. k9s - Kubernetes TUI (í…ìŠ¤íŠ¸ UI)
4. stern - ì—¬ëŸ¬ Pod ë¡œê·¸ ë™ì‹œ í™•ì¸
5. kubectx/kubens - ì»¨í…ìŠ¤íŠ¸/ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¹ ë¥¸ ì „í™˜

# ì„¤ì¹˜
brew install k9s stern kubectx

# ì‚¬ìš©
k9s  # ì‹¤í–‰
stern -n lk-trade user-service  # ë¡œê·¸ í™•ì¸
kubectx  # ì»¨í…ìŠ¤íŠ¸ ëª©ë¡
kubens lk-trade  # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì „í™˜
```

### 10.2 GUI ë„êµ¬

```bash
# 1. Lens - Kubernetes IDE
https://k8slens.dev/

# 2. Portainer - Docker/Kubernetes ì›¹ UI
docker run -d -p 9000:9000 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  portainer/portainer-ce

# 3. Kubernetes Dashboard
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
kubectl proxy
# http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
```

---

## ë§ˆë¬´ë¦¬

ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰ Dockerì˜ ê³ ê¸‰ ì£¼ì œì™€ ëª¨ë²” ì‚¬ë¡€ë¥¼ ëª¨ë‘ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤.

### ì´ë²ˆ ì„¹ì…˜ì—ì„œ ë°°ìš´ ê²ƒ

âœ… ì´ë¯¸ì§€ ìµœì í™” (ë©€í‹° ìŠ¤í…Œì´ì§€, ìºì‹±, .dockerignore)
âœ… ì»¨í…Œì´ë„ˆ ë””ìì¸ íŒ¨í„´ (Sidecar, Ambassador, Adapter)
âœ… í—¬ìŠ¤ì²´í¬ ë° ê·¸ë ˆì´ìŠ¤í’€ ì…§ë‹¤ìš´
âœ… ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ëª¨ë²” ì‚¬ë¡€
âœ… ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸
âœ… ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì „ëµ
âœ… í”„ë¡œë•ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
âœ… ì„±ëŠ¥ ìµœì í™”
âœ… íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ
âœ… ìœ ìš©í•œ ë„êµ¬

### ë‹¤ìŒ ì„¹ì…˜

ì´ì œ Dockerì˜ ì „ë°˜ì ì¸ ë‚´ìš©ì„ ëª¨ë‘ í•™ìŠµí–ˆìŠµë‹ˆë‹¤! ğŸ“

**ì„¹ì…˜ 35-44**ì—ì„œëŠ”:
- ì‹¤ì „ ì˜ˆì œ ë° ì‚¬ë¡€ ì—°êµ¬
- íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ë³„ ê°€ì´ë“œ
- ì¶”ê°€ í•™ìŠµ ìë£Œ
- ì»¤ë®¤ë‹ˆí‹° ë° ë¦¬ì†ŒìŠ¤
- ë§ˆë¬´ë¦¬

### ê³„ì† í•™ìŠµí•˜ê¸°

**ê³µì‹ ë¬¸ì„œ:**
- [Docker Best Practices](https://docs.docker.com/develop/dev-best-practices/)
- [Kubernetes Best Practices](https://kubernetes.io/docs/concepts/configuration/overview/)

**ì±…:**
- "Docker Deep Dive" by Nigel Poulton
- "Kubernetes in Action" by Marko Luksa

**ì»¤ë®¤ë‹ˆí‹°:**
- [Docker Community](https://www.docker.com/community/)
- [CNCF Slack](https://slack.cncf.io/)

---

**Docker ë§ˆìŠ¤í„°ê°€ ë˜ì‹  ê²ƒì„ ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸš€