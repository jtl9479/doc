# Redis 09ì¥: íŠ¸ëœì­ì…˜, íŒŒì´í”„ë¼ì¸, ìŠ¤í¬ë¦½íŠ¸ ì™„ì „ ê°€ì´ë“œ

> **í•™ìŠµ ëª©í‘œ**: Redisì˜ íŠ¸ëœì­ì…˜, íŒŒì´í”„ë¼ì¸, Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ê³ , ë™ì‹œì„± ì œì–´ì™€ ì„±ëŠ¥ ìµœì í™”ë¥¼ ì‹¤ë¬´ì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**â±ï¸ ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: 4-6ì‹œê°„
**ë‚œì´ë„**: â­â­â­â­â˜† (4ê°œ/5ê°œ)

---

## ğŸ“š ëª©ì°¨
- [ì™œ ì´ ê¸°ìˆ ì´ í•„ìš”í•œê°€](#ì™œ-ì´-ê¸°ìˆ ì´-í•„ìš”í•œê°€)
- [ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°](#ì‹¤ìƒí™œ-ë¹„ìœ ë¡œ-ì´í•´í•˜ê¸°)
- [Redis íŠ¸ëœì­ì…˜ ì™„ì „ ì´í•´](#redis-íŠ¸ëœì­ì…˜-ì™„ì „-ì´í•´)
- [Redis íŒŒì´í”„ë¼ì¸ ì™„ì „ ë§ˆìŠ¤í„°](#redis-íŒŒì´í”„ë¼ì¸-ì™„ì „-ë§ˆìŠ¤í„°)
- [Redis Lua ìŠ¤í¬ë¦½íŠ¸ ì™„ì „ ì •ë³µ](#redis-lua-ìŠ¤í¬ë¦½íŠ¸-ì™„ì „-ì •ë³µ)
- [ì£¼ë‹ˆì–´ ì‹œë‚˜ë¦¬ì˜¤](#ì£¼ë‹ˆì–´-ì‹œë‚˜ë¦¬ì˜¤)
- [ì‹¤ì „ í”„ë¡œì íŠ¸](#ì‹¤ì „-í”„ë¡œì íŠ¸)
- [FAQ](#faq)
- [ë©´ì ‘ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸](#ë©´ì ‘-ì§ˆë¬¸-ë¦¬ìŠ¤íŠ¸)
- [í•µì‹¬ ì •ë¦¬](#í•µì‹¬-ì •ë¦¬)

---

## ğŸ¤” ì™œ ì´ ê¸°ìˆ ì´ í•„ìš”í•œê°€?

### ì‹¤ë¬´ ë°°ê²½
**ì „ììƒê±°ë˜ ì‡¼í•‘ëª°ì—ì„œ ë§ˆì§€ë§‰ 1ê°œ ë‚¨ì€ ìƒí’ˆì„ 1000ëª…ì´ ë™ì‹œì— ì£¼ë¬¸í•  ë•Œ, ì–´ë–»ê²Œ í•´ì•¼ ì •í™•íˆ 1ëª…ë§Œ êµ¬ë§¤í•  ìˆ˜ ìˆì„ê¹Œìš”?**

#### ë¬¸ì œ 1: ë™ì‹œì„± ë¬¸ì œ (Race Condition)
```
ì¦ìƒ: ì¬ê³  1ê°œì¸ë° ì—¬ëŸ¬ ëª…ì´ ë™ì‹œì— êµ¬ë§¤ ì„±ê³µ
- ì‚¬ìš©ì A: ì¬ê³  í™•ì¸ (1ê°œ) â†’ êµ¬ë§¤ ì§„í–‰
- ì‚¬ìš©ì B: ì¬ê³  í™•ì¸ (1ê°œ) â†’ êµ¬ë§¤ ì§„í–‰
- ê²°ê³¼: ì¬ê³  -1ê°œ (ì¬ê³  ë¶€ì¡± ë°œìƒ)

ì˜í–¥: ê³ ê° ë¶ˆë§Œ, í™˜ë¶ˆ ì²˜ë¦¬, ì‹ ë¢°ë„ í•˜ë½
ë¹„ìš©: ì›” í‰ê·  500ë§Œì› ì†ì‹¤ (ì¿ íŒ¡ ì‚¬ë¡€)
```

#### ë¬¸ì œ 2: ì„±ëŠ¥ ì €í•˜ (ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì‹œê°„)
```
ì¦ìƒ: 10,000ê°œ ë°ì´í„° ì €ì¥ ì‹œ 30ì´ˆ ì†Œìš”
- ê° SET ëª…ë ¹ë§ˆë‹¤ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ (RTT)
- RTT 3ms Ã— 10,000íšŒ = 30ì´ˆ

ì˜í–¥: ì‚¬ìš©ì ì´íƒˆë¥  ì¦ê°€, ì„œë²„ ìì› ë‚­ë¹„
ë¹„ìš©: ì‘ë‹µ ì‹œê°„ 30ë°° ì¦ê°€
```

#### ë¬¸ì œ 3: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```
ì¦ìƒ: ì—¬ëŸ¬ Redis ëª…ë ¹ì„ ì¡°í•©í•´ì•¼ í•˜ëŠ” ê²½ìš°
- 10ë²ˆì˜ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ í•„ìš”
- ê° ë‹¨ê³„ë§ˆë‹¤ ì¡°ê±´ ë¶„ê¸° ì²˜ë¦¬
- ë°ì´í„° ì •í•©ì„± ë³´ì¥ ì–´ë ¤ì›€

ì˜í–¥: ì½”ë“œ ë³µì¡ë„ ì¦ê°€, ë²„ê·¸ ë°œìƒ ê°€ëŠ¥ì„±
ë¹„ìš©: ê°œë°œ ì‹œê°„ 3ë°° ì¦ê°€
```

### í•´ê²°ì±…

#### í•´ê²°ì±… 1: íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë™ì‹œì„± ì œì–´
```
ë°©ë²•: WATCH + MULTI + EXECë¡œ ì›ìì  ì‹¤í–‰ ë³´ì¥
íš¨ê³¼: Race Condition ì™„ì „ ì°¨ë‹¨
ì ˆê°: ì¬ê³  ì˜¤ë¥˜ìœ¨ 100% â†’ 0%
```

#### í•´ê²°ì±… 2: íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
```
ë°©ë²•: ì—¬ëŸ¬ ëª…ë ¹ì„ í•œ ë²ˆì— ì „ì†¡
íš¨ê³¼: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ íšê¸°ì  ê°ì†Œ
ì ˆê°: ì²˜ë¦¬ ì‹œê°„ 30ì´ˆ â†’ 1ì´ˆ (30ë°° ê°œì„ )
```

#### í•´ê²°ì±… 3: Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³µì¡í•œ ë¡œì§ êµ¬í˜„
```
ë°©ë²•: ì„œë²„ì—ì„œ ì›ìì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
íš¨ê³¼: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì•ˆì „í•˜ê²Œ ì‹¤í–‰
ì ˆê°: ì½”ë“œ ë¼ì¸ ìˆ˜ 70% ê°ì†Œ, ë²„ê·¸ìœ¨ 50% ê°ì†Œ
```

### ìˆ˜ì¹˜ë¡œ ë³´ëŠ” íš¨ê³¼

| ì§€í‘œ | Before | After | ê°œì„ ìœ¨ |
|------|--------|-------|--------|
| ì¬ê³  ì˜¤ë¥˜ìœ¨ | 5% | 0% | **100%â†“** |
| ì²˜ë¦¬ ì‹œê°„ (10,000ê±´) | 30ì´ˆ | 1ì´ˆ | **97%â†“** |
| ë„¤íŠ¸ì›Œí¬ ì™•ë³µ | 10,000íšŒ | 1íšŒ | **99.99%â†“** |
| ì½”ë“œ ë³µì¡ë„ | 300ì¤„ | 50ì¤„ | **83%â†“** |
| ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥ ìˆ˜ | 100ëª… | 10,000ëª… | **100ë°°â†‘** |

---

## ğŸŒŸ ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

### ë¹„ìœ  1: ì€í–‰ ATM (íŠ¸ëœì­ì…˜)
```
íŠ¸ëœì­ì…˜ = ì€í–‰ ATM ì´ì²´

ATMì—ì„œ ê³„ì¢Œ ì´ì²´í•  ë•Œ:
1. ì¶œê¸ˆ ê³„ì¢Œì—ì„œ ëˆ ë¹¼ê¸°
2. ì…ê¸ˆ ê³„ì¢Œì— ëˆ ë„£ê¸°

ë‘ ì‘ì—…ì€ ë°˜ë“œì‹œ í•¨ê»˜ ì„±ê³µí•˜ê±°ë‚˜ í•¨ê»˜ ì‹¤íŒ¨í•´ì•¼ í•¨
- ëˆë§Œ ë¹ ì§€ê³  ì…ê¸ˆ ì•ˆ ë˜ë©´? â†’ í°ì¼ë‚¨!
- Redis íŠ¸ëœì­ì…˜ë„ ë§ˆì°¬ê°€ì§€ë¡œ ëª¨ë‘ ì„±ê³µ or ëª¨ë‘ ì‹¤íŒ¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ì€í–‰ ATM ì´ì²´ ê³¼ì •          â”‚
â”‚                                     â”‚
â”‚   [ì¶œê¸ˆ] â”€â”€â”€â”€â”                     â”‚
â”‚              â”œâ”€â”€â†’ [ì„±ê³µ] â†’ ì™„ë£Œ    â”‚
â”‚   [ì…ê¸ˆ] â”€â”€â”€â”€â”˜                     â”‚
â”‚                                     â”‚
â”‚   í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨ ì‹œ â†’ ì „ë¶€ ì·¨ì†Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¹„ìœ  2: íƒë°° ìƒì (íŒŒì´í”„ë¼ì¸)
```
íŒŒì´í”„ë¼ì¸ = íƒë°° ìƒìì— ë¬¼ê±´ ëª¨ì•„ì„œ í•œ ë²ˆì— ë³´ë‚´ê¸°

ì¼ë°˜ì ì¸ ë°©ë²•:
- ë¬¼ê±´ 1ê°œ â†’ íƒë°° ë³´ë‚´ê¸° â†’ ì™•ë³µ
- ë¬¼ê±´ 1ê°œ â†’ íƒë°° ë³´ë‚´ê¸° â†’ ì™•ë³µ
- 10ê°œ ë¬¼ê±´ = 10ë²ˆ ì™•ë³µ

íŒŒì´í”„ë¼ì¸ ë°©ë²•:
- ë¬¼ê±´ 10ê°œë¥¼ ìƒìì— ë‹´ê¸°
- í•œ ë²ˆì— ë³´ë‚´ê¸° â†’ 1ë²ˆ ì™•ë³µ
- ì‹œê°„ê³¼ ë¹„ìš© ì ˆì•½!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ì¼ë°˜ ë°©ì‹ (10ë²ˆ ì™•ë³µ)          â”‚
â”‚   ë¬¼ê±´1 â†’ ë°°ì†¡ â†’ ë„ì°©               â”‚
â”‚   ë¬¼ê±´2 â†’ ë°°ì†¡ â†’ ë„ì°©               â”‚
â”‚   ...                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    íŒŒì´í”„ë¼ì¸ (1ë²ˆ ì™•ë³µ)            â”‚
â”‚   [ë¬¼ê±´1,2,3...10] â†’ ë°°ì†¡ â†’ ë„ì°©   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¹„ìœ  3: ë ˆìŠ¤í† ë‘ ì£¼ë°© (Lua ìŠ¤í¬ë¦½íŠ¸)
```
Lua ìŠ¤í¬ë¦½íŠ¸ = ë ˆìŠ¤í† ë‘ ì£¼ë°©ì˜ ì •í•´ì§„ ë ˆì‹œí”¼

ì¼ë°˜ì ì¸ ë°©ë²•:
- í™€ ì§ì›: "ê°ì ì°ì–´ì£¼ì„¸ìš”"
- ì£¼ë°©ì¥: "ë„¤" (ì™•ë³µ 1)
- í™€ ì§ì›: "ê³ ê¸° êµ¬ì›Œì£¼ì„¸ìš”"
- ì£¼ë°©ì¥: "ë„¤" (ì™•ë³µ 2)
- í™€ ì§ì›: "ì†ŒìŠ¤ ë¿Œë ¤ì£¼ì„¸ìš”"
- ì£¼ë°©ì¥: "ë„¤" (ì™•ë³µ 3)

Lua ìŠ¤í¬ë¦½íŠ¸ ë°©ì‹:
- í™€ ì§ì›: "ìŠ¤í…Œì´í¬ 1ê°œìš”!"
- ì£¼ë°©ì¥: ë ˆì‹œí”¼ëŒ€ë¡œ ì•Œì•„ì„œ ì™„ì„± (ì™•ë³µ 1)
- ëª¨ë“  ê³¼ì •ì„ ì£¼ë°©ì—ì„œ ì¼ê´„ ì²˜ë¦¬

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ì£¼ë°©ì˜ ìŠ¤í…Œì´í¬ ë ˆì‹œí”¼         â”‚
â”‚   1. ê°ì ì°ê¸°                      â”‚
â”‚   2. ê³ ê¸° êµ½ê¸°                      â”‚
â”‚   3. ì†ŒìŠ¤ ë¿Œë¦¬ê¸°                    â”‚
â”‚   â†’ í•œ ë²ˆì— ì‹¤í–‰, ì¤‘ê°„ ë°©í•´ ì—†ìŒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¹„ìœ  4: ì½˜ì„œíŠ¸ í‹°ì¼“íŒ… (WATCH)
```
WATCH = ì½˜ì„œíŠ¸ í‹°ì¼“íŒ… ì‹œ ì¢Œì„ ì„ ì 

ì‹œë‚˜ë¦¬ì˜¤:
- Aì™€ Bê°€ ë™ì‹œì— ë§ˆì§€ë§‰ ì¢Œì„ í´ë¦­
- A: ì¢Œì„ í™•ì¸ (ë¹ˆ ì¢Œì„) â†’ ê²°ì œ ì§„í–‰
- B: ì¢Œì„ í™•ì¸ (ë¹ˆ ì¢Œì„) â†’ ê²°ì œ ì§„í–‰
- ë¬¸ì œ: í•œ ì¢Œì„ì„ ë‘ ëª…ì´ ì˜ˆë§¤?

WATCH ì‚¬ìš©:
- A: ì¢Œì„ WATCH ì‹œì‘
- A: ê²°ì œ ì§„í–‰ ì¤‘...
- B: ì¢Œì„ WATCH ì‹œì‘
- B: ê²°ì œ ì‹œë„ â†’ "ì¢Œì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤" (ì‹¤íŒ¨)
- Aë§Œ ì„±ê³µ!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        í‹°ì¼“íŒ… ì¢Œì„ ì„ ì              â”‚
â”‚                                     â”‚
â”‚   ì¢Œì„ A1 [ë¹ˆ ì¢Œì„]                 â”‚
â”‚      â†“                              â”‚
â”‚   ì‚¬ìš©ì1 WATCH ì‹œì‘                â”‚
â”‚      â†“                              â”‚
â”‚   ì‚¬ìš©ì2 WATCH ì‹œì‘ (ëŒ€ê¸°)         â”‚
â”‚      â†“                              â”‚
â”‚   ì‚¬ìš©ì1 ê²°ì œ ì™„ë£Œ â†’ ì„±ê³µ          â”‚
â”‚      â†“                              â”‚
â”‚   ì‚¬ìš©ì2 ì‹œë„ â†’ ì¢Œì„ ë³€ê²½ë¨ (ì‹¤íŒ¨) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¹„ìœ  5: í¸ì˜ì  ì¬ê³  ê´€ë¦¬ (ì›ìì„±)
```
ì›ìì„± = í¸ì˜ì  ì¬ê³  í™•ì¸ê³¼ íŒë§¤ë¥¼ ë™ì‹œì— ì²˜ë¦¬

ë¬¸ì œ ìƒí™©:
- ì†ë‹˜1: "ë¼ë©´ ìˆë‚˜ìš”?" (ì¬ê³  1ê°œ)
- ì ì›: "ë„¤, ìˆìŠµë‹ˆë‹¤"
- ì†ë‹˜2: "ë¼ë©´ ìˆë‚˜ìš”?" (ì¬ê³  1ê°œ)
- ì ì›: "ë„¤, ìˆìŠµë‹ˆë‹¤"
- ì†ë‹˜1, ì†ë‹˜2 ë™ì‹œì— ê³„ì‚°ëŒ€ë¡œ...
- ê²°ê³¼: ì¬ê³ ëŠ” 1ê°œì¸ë° 2ëª…ì—ê²Œ íŒë§¤?

ì›ìì  ì²˜ë¦¬:
- ì†ë‹˜1: "ë¼ë©´ ì£¼ì„¸ìš”"
- ì‹œìŠ¤í…œ: [ì¬ê³  í™•ì¸ + ì°¨ê°] í•œ ë²ˆì— ì‹¤í–‰
- ì†ë‹˜2: "ë¼ë©´ ì£¼ì„¸ìš”"
- ì‹œìŠ¤í…œ: "ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ì›ìì  ì¬ê³  ì²˜ë¦¬              â”‚
â”‚                                     â”‚
â”‚   [í™•ì¸ + ì°¨ê° + íŒë§¤]              â”‚
â”‚    â†‘                                â”‚
â”‚   ì¤‘ê°„ì— ë‹¤ë¥¸ ì‘ì—… ë¼ì–´ë“¤ê¸° ë¶ˆê°€ëŠ¥  â”‚
â”‚                                     â”‚
â”‚   ë¼ë©´ ì¬ê³ : 1ê°œ                    â”‚
â”‚   ì†ë‹˜1 êµ¬ë§¤ â†’ [1ê°œ â†’ 0ê°œ] ì™„ë£Œ    â”‚
â”‚   ì†ë‹˜2 ì‹œë„ â†’ "ì¬ê³  ì—†ìŒ"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì¢…í•© ë¹„êµí‘œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis ê¸°ëŠ¥   â”‚ ì€í–‰ ATM     â”‚ íƒë°°         â”‚ ë ˆìŠ¤í† ë‘     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ íŠ¸ëœì­ì…˜     â”‚ ê³„ì¢Œ ì´ì²´    â”‚ íƒë°° ì¶”ì     â”‚ ì£¼ë¬¸ ì²˜ë¦¬    â”‚
â”‚ íŒŒì´í”„ë¼ì¸   â”‚ ì¼ê´„ ì²˜ë¦¬    â”‚ ìƒì í¬ì¥    â”‚ ì„¸íŠ¸ ë©”ë‰´    â”‚
â”‚ Lua ìŠ¤í¬ë¦½íŠ¸ â”‚ ìë™ ì´ì²´    â”‚ ë°°ì†¡ ìë™í™”  â”‚ ë ˆì‹œí”¼       â”‚
â”‚ WATCH        â”‚ ì”ì•¡ í™•ì¸    â”‚ ì¬ê³  í™•ì¸    â”‚ ì¢Œì„ ì„ ì     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– Redis íŠ¸ëœì­ì…˜ ì™„ì „ ì´í•´

### 1.1 íŠ¸ëœì­ì…˜ ê¸°ë³¸ ê°œë…

Redis íŠ¸ëœì­ì…˜ì€ **ì›ìì„±(Atomicity)**ì„ ë³´ì¥í•˜ëŠ” ëª…ë ¹ì–´ ê·¸ë£¹ì…ë‹ˆë‹¤.

#### 1.1.1 íŠ¸ëœì­ì…˜ì˜ íŠ¹ì§•

```bash
# 1. ì›ìì„± (Atomicity)
# ëª¨ë“  ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê±°ë‚˜ í•˜ë‚˜ë„ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

# 2. ê²©ë¦¬ì„± (Isolation)
# íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ì—†ìŒ

# 3. ì¼ê´€ì„± (Consistency)
# íŠ¸ëœì­ì…˜ í›„ì—ë„ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¼ê´€ëœ ìƒíƒœ ìœ ì§€

# 4. ë¡¤ë°± ì—†ìŒ (ì£¼ì˜!)
# RedisëŠ” ì»¤ë°‹ í›„ ë¡¤ë°±ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ
```

### 1.2 íŠ¸ëœì­ì…˜ ê¸°ë³¸ ëª…ë ¹ì–´

#### MULTI - íŠ¸ëœì­ì…˜ ì‹œì‘

```bash
# ê¸°ë³¸ ì‚¬ìš©ë²•
127.0.0.1:6379> MULTI
OK

# ì´ì œ ëª¨ë“  ëª…ë ¹ì–´ê°€ íì— ì €ì¥ë¨
127.0.0.1:6379> SET user:1000:name "ê¹€ì² ìˆ˜"
QUEUED
127.0.0.1:6379> SET user:1000:email "kim@example.com"
QUEUED
127.0.0.1:6379> INCR user:count
QUEUED
```

#### EXEC - íŠ¸ëœì­ì…˜ ì‹¤í–‰

```bash
# íì— ì €ì¥ëœ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ í•œ ë²ˆì— ì‹¤í–‰
127.0.0.1:6379> EXEC
1) OK
2) OK
3) (integer) 1

# ëª…ë ¹ì–´ë³„ ê²°ê³¼ê°€ ë°°ì—´ë¡œ ë°˜í™˜ë¨
```

#### DISCARD - íŠ¸ëœì­ì…˜ ì·¨ì†Œ

```bash
# íŠ¸ëœì­ì…˜ ì‹œì‘
127.0.0.1:6379> MULTI
OK

# ëª…ë ¹ì–´ íì‰
127.0.0.1:6379> SET key1 "value1"
QUEUED

# íŠ¸ëœì­ì…˜ ì·¨ì†Œ
127.0.0.1:6379> DISCARD
OK

# ì•„ë¬´ê²ƒë„ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
127.0.0.1:6379> GET key1
(nil)
```

### 1.3 WATCHë¥¼ ì´ìš©í•œ ë‚™ê´€ì  ë½

#### WATCH ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
# í‚¤ë¥¼ ê°ì‹œ ìƒíƒœë¡œ ì„¤ì •
127.0.0.1:6379> WATCH mykey
OK

# í˜„ì¬ ê°’ í™•ì¸
127.0.0.1:6379> GET mykey
"10"

# íŠ¸ëœì­ì…˜ ì‹œì‘
127.0.0.1:6379> MULTI
OK

# ê°’ ë³€ê²½ ëª…ë ¹ì–´ íì‰
127.0.0.1:6379> SET mykey "20"
QUEUED

# ì‹¤í–‰ (ì„±ê³µ)
127.0.0.1:6379> EXEC
1) OK
```

#### WATCH ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤

```bash
# í´ë¼ì´ì–¸íŠ¸ 1
127.0.0.1:6379> WATCH mykey
OK
127.0.0.1:6379> GET mykey
"20"

# ì´ ì‹œì ì—ì„œ í´ë¼ì´ì–¸íŠ¸ 2ê°€ ê°’ì„ ë³€ê²½
# í´ë¼ì´ì–¸íŠ¸ 2: SET mykey "30"

# í´ë¼ì´ì–¸íŠ¸ 1ì—ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> SET mykey "25"
QUEUED

# ì‹¤í–‰ ì‹œ WATCHëœ í‚¤ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨
127.0.0.1:6379> EXEC
(nil)

# ê°’ì´ ë³€ê²½ë˜ì§€ ì•ŠìŒ (í´ë¼ì´ì–¸íŠ¸ 2ì˜ ê°’ ìœ ì§€)
127.0.0.1:6379> GET mykey
"30"
```

### 1.4 ì‹¤ë¬´ íŠ¸ëœì­ì…˜ íŒ¨í„´

#### ê³„ì¢Œ ì´ì²´ ì‹œë®¬ë ˆì´ì…˜

```bash
# ì´ˆê¸° ê³„ì¢Œ ì„¤ì •
127.0.0.1:6379> SET account:1000 500000
OK
127.0.0.1:6379> SET account:2000 300000
OK

# ê³„ì¢Œ ì´ì²´ í”„ë¡œì„¸ìŠ¤ (100,000ì› ì´ì²´)
# 1. ì†¡ê¸ˆ ê³„ì¢Œ ê°ì‹œ
127.0.0.1:6379> WATCH account:1000
OK

# 2. í˜„ì¬ ì”ì•¡ í™•ì¸
127.0.0.1:6379> GET account:1000
"500000"

# 3. íŠ¸ëœì­ì…˜ ì‹œì‘
127.0.0.1:6379> MULTI
OK

# 4. ì†¡ê¸ˆ ê³„ì¢Œì—ì„œ ì°¨ê°
127.0.0.1:6379> DECRBY account:1000 100000
QUEUED

# 5. ìˆ˜ì‹  ê³„ì¢Œì— ì¶”ê°€
127.0.0.1:6379> INCRBY account:2000 100000
QUEUED

# 6. ì‹¤í–‰
127.0.0.1:6379> EXEC
1) (integer) 400000
2) (integer) 400000
```

---

## ğŸ’» Redis íŒŒì´í”„ë¼ì¸ ì™„ì „ ë§ˆìŠ¤í„°

### 2.1 íŒŒì´í”„ë¼ì¸ ê¸°ë³¸ ê°œë…

íŒŒì´í”„ë¼ì¸ì€ **ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ í•œ ë²ˆì— ì„œë²„ë¡œ ì „ì†¡**í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì‹œê°„(RTT)ì„ ì¤„ì´ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

#### ì¼ë°˜ì ì¸ ëª…ë ¹ì–´ ì‹¤í–‰ vs íŒŒì´í”„ë¼ì¸

```bash
# ì¼ë°˜ì ì¸ ì‹¤í–‰ (3ë²ˆì˜ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ)
# Client -> Server: SET key1 value1
# Server -> Client: OK
# Client -> Server: SET key2 value2
# Server -> Client: OK
# Client -> Server: SET key3 value3
# Server -> Client: OK

# íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (1ë²ˆì˜ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ)
# Client -> Server: SET key1 value1; SET key2 value2; SET key3 value3
# Server -> Client: OK; OK; OK
```

### 2.2 redis-cliì—ì„œ íŒŒì´í”„ë¼ì¸ ì‚¬ìš©

```bash
# ë°©ë²• 1: echoì™€ íŒŒì´í”„ ì‚¬ìš©
echo -e "SET key1 value1\nSET key2 value2\nSET key3 value3" | redis-cli --pipe

# ë°©ë²• 2: ëŒ€ëŸ‰ ë°ì´í„° ì‚½ì…
for i in {1..1000}; do
    echo "SET key:$i value:$i"
done | redis-cli --pipe
```

### 2.3 ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì´í”„ë¼ì¸ êµ¬í˜„

#### Python Redis íŒŒì´í”„ë¼ì¸

```python
import redis
import time

# Redis ì—°ê²°
r = redis.Redis(host='localhost', port=6379, db=0)

# ì¼ë°˜ì ì¸ ë°©ë²• (ëŠë¦¼)
start_time = time.time()
for i in range(1000):
    r.set(f"normal:key:{i}", f"value:{i}")
normal_time = time.time() - start_time

# íŒŒì´í”„ë¼ì¸ ë°©ë²• (ë¹ ë¦„)
start_time = time.time()
pipe = r.pipeline()
for i in range(1000):
    pipe.set(f"pipeline:key:{i}", f"value:{i}")
pipe.execute()
pipeline_time = time.time() - start_time

print(f"ì¼ë°˜ ë°©ë²•: {normal_time:.2f}ì´ˆ")
print(f"íŒŒì´í”„ë¼ì¸: {pipeline_time:.2f}ì´ˆ")
print(f"ì„±ëŠ¥ í–¥ìƒ: {normal_time/pipeline_time:.1f}ë°°")

# ì¶œë ¥ ì˜ˆì‹œ:
# ì¼ë°˜ ë°©ë²•: 2.45ì´ˆ
# íŒŒì´í”„ë¼ì¸: 0.12ì´ˆ
# ì„±ëŠ¥ í–¥ìƒ: 20.4ë°°
```

### 2.4 ì„±ëŠ¥ ë¹„êµ

| ë°©ë²• | 1,000ê±´ ì²˜ë¦¬ | 10,000ê±´ ì²˜ë¦¬ | ë„¤íŠ¸ì›Œí¬ ì™•ë³µ |
|------|-------------|--------------|--------------|
| ì¼ë°˜ ë°©ì‹ | 2.5ì´ˆ | 25ì´ˆ | 10,000íšŒ |
| íŒŒì´í”„ë¼ì¸ | 0.12ì´ˆ | 1.2ì´ˆ | 1íšŒ |
| **ê°œì„ ** | **95%â†“** | **95%â†“** | **99.99%â†“** |

---

## ğŸ”§ Redis Lua ìŠ¤í¬ë¦½íŠ¸ ì™„ì „ ì •ë³µ

### 3.1 Lua ìŠ¤í¬ë¦½íŠ¸ ê¸°ë³¸ ê°œë…

Redis Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” **ì›ìì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ ë¡œì§**ì„ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

#### Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì¥ì 

```lua
-- 1. ì›ìì„±: ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ê°€ í•˜ë‚˜ì˜ ì›ìì  ì—°ì‚°
-- 2. ì„±ëŠ¥: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ ê°ì†Œ
-- 3. ì¼ê´€ì„±: ë³µì¡í•œ ë¡œì§ì„ ì„œë²„ì—ì„œ ì‹¤í–‰
-- 4. ì¡°ê±´ë¶€ ì‹¤í–‰: ë™ì  ë¡œì§ êµ¬í˜„ ê°€ëŠ¥
```

### 3.2 EVALì„ ì´ìš©í•œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

#### ê¸°ë³¸ Lua ìŠ¤í¬ë¦½íŠ¸

```bash
# ë‹¨ìˆœí•œ ê°’ ë°˜í™˜
127.0.0.1:6379> EVAL "return 'Hello Redis Lua!'" 0
"Hello Redis Lua!"

# ìˆ«ì ê³„ì‚°
127.0.0.1:6379> EVAL "return 10 + 20" 0
(integer) 30

# í‚¤ ì‚¬ìš©í•˜ê¸°
127.0.0.1:6379> EVAL "return redis.call('get', KEYS[1])" 1 mykey
(nil)

# í‚¤ì— ê°’ ì„¤ì •í•˜ê³  ë°˜í™˜
127.0.0.1:6379> EVAL "redis.call('set', KEYS[1], ARGV[1]); return redis.call('get', KEYS[1])" 1 mykey "Hello World"
"Hello World"
```

#### KEYSì™€ ARGV ì´í•´í•˜ê¸°

```bash
# KEYS[1], KEYS[2], ... : í‚¤ ë§¤ê°œë³€ìˆ˜
# ARGV[1], ARGV[2], ... : ê°’ ë§¤ê°œë³€ìˆ˜

# ì˜ˆì‹œ: ë‘ í‚¤ì˜ ê°’ì„ êµí™˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
127.0.0.1:6379> SET key1 "value1"
OK
127.0.0.1:6379> SET key2 "value2"
OK

127.0.0.1:6379> EVAL "
local val1 = redis.call('get', KEYS[1])
local val2 = redis.call('get', KEYS[2])
redis.call('set', KEYS[1], val2)
redis.call('set', KEYS[2], val1)
return {val1, val2}
" 2 key1 key2

1) "value1"
2) "value2"
```

### 3.3 ê³ ê¸‰ Lua ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´

#### ì¡°ê±´ë¶€ ë¡œì§ êµ¬í˜„

```bash
# ì•ˆì „í•œ ì¹´ìš´í„° ì¦ê°€ (ìµœëŒ€ê°’ ì œí•œ)
127.0.0.1:6379> EVAL "
local current = redis.call('get', KEYS[1])
if current == false then
    current = 0
else
    current = tonumber(current)
end

local max_value = tonumber(ARGV[1])
local increment = tonumber(ARGV[2])

if current + increment <= max_value then
    return redis.call('incrby', KEYS[1], increment)
else
    return -1  -- ìµœëŒ€ê°’ ì´ˆê³¼
end
" 1 counter 100 5

(integer) 5
```

### 3.4 EVALSHAì™€ ìŠ¤í¬ë¦½íŠ¸ ìºì‹±

```bash
# ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„œë²„ì— ë¡œë“œ
127.0.0.1:6379> SCRIPT LOAD "
local current = redis.call('get', KEYS[1])
if current == false then
    current = 0
else
    current = tonumber(current)
end
return current + tonumber(ARGV[1])
"
"2f31ba2bb6d6a0f42cc159d2e2dad55440778de3"

# SHA1 í•´ì‹œë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ë” íš¨ìœ¨ì )
127.0.0.1:6379> EVALSHA 2f31ba2bb6d6a0f42cc159d2e2dad55440778de3 1 mycounter 10
(integer) 10
```

---

## ğŸ‘¨â€ğŸ’» ì£¼ë‹ˆì–´ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: íŠ¸ëœì­ì…˜ ì¤‘ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì˜ëª»í•œ ê²½ìš°

**ìƒí™©**: ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì¬ê³  ì°¨ê° ì‹œìŠ¤í…œì„ êµ¬í˜„í–ˆëŠ”ë°, ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```python
# ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œ
import redis

r = redis.Redis()

def decrease_stock(product_id, quantity):
    """ì¬ê³  ì°¨ê° (ë¬¸ì œ ìˆëŠ” ì½”ë“œ)"""
    r.multi()
    r.decrby(f"product:{product_id}:stock", quantity)
    r.incr(f"product:{product_id}:sold")
    result = r.execute()
    return result
```

**ë¬¸ì œì **:
- ë¬¸ì œ 1: ì¬ê³ ê°€ ìŒìˆ˜ê°€ ë˜ëŠ” ê²½ìš°ë¥¼ ì²´í¬í•˜ì§€ ì•ŠìŒ
- ë¬¸ì œ 2: WATCHë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ ë™ì‹œì„± ë¬¸ì œ ë°œìƒ
- ë¬¸ì œ 3: ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ ì‹œ ì¼ë¶€ë§Œ ì‹¤í–‰ë  ìˆ˜ ìˆìŒ
- ì™œ ì´ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê°€: Redis íŠ¸ëœì­ì…˜ì€ ëŸ°íƒ€ì„ ì—ëŸ¬ ì‹œ ë¡¤ë°±í•˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
```python
# ì˜¬ë°”ë¥¸ ì½”ë“œ
import redis

r = redis.Redis()

def decrease_stock(product_id, quantity):
    """ì¬ê³  ì°¨ê° (ì˜¬ë°”ë¥¸ ì½”ë“œ)"""
    while True:
        # 1. WATCHë¡œ ì¬ê³  ê°ì‹œ
        r.watch(f"product:{product_id}:stock")

        # 2. í˜„ì¬ ì¬ê³  í™•ì¸
        current_stock = r.get(f"product:{product_id}:stock")
        if current_stock is None:
            r.unwatch()
            return False, "ìƒí’ˆì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"

        current_stock = int(current_stock)

        # 3. ì¬ê³  ë¶€ì¡± ì²´í¬
        if current_stock < quantity:
            r.unwatch()
            return False, f"ì¬ê³  ë¶€ì¡± (í˜„ì¬: {current_stock}, ìš”ì²­: {quantity})"

        try:
            # 4. íŠ¸ëœì­ì…˜ ì‹œì‘
            pipe = r.pipeline()
            pipe.decrby(f"product:{product_id}:stock", quantity)
            pipe.incr(f"product:{product_id}:sold")
            result = pipe.execute()

            # 5. ì„±ê³µ
            return True, f"ì¬ê³  ì°¨ê° ì„±ê³µ (ë‚¨ì€ ì¬ê³ : {current_stock - quantity})"

        except redis.WatchError:
            # 6. WATCH ì¶©ëŒ ì‹œ ì¬ì‹œë„
            continue

# ì‚¬ìš© ì˜ˆì‹œ
success, message = decrease_stock("1001", 5)
print(f"ê²°ê³¼: {success}, ë©”ì‹œì§€: {message}")
```

**ë°°ìš´ ì **:
- íŠ¸ëœì­ì…˜ ì „ì— WATCHë¡œ í‚¤ë¥¼ ê°ì‹œí•´ì•¼ ë™ì‹œì„± ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦(ì¬ê³  í™•ì¸)ì€ íŠ¸ëœì­ì…˜ ì „ì— ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤
- WatchError ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì—¬ ì¬ì‹œë„ ë¡œì§ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤

### ì‹œë‚˜ë¦¬ì˜¤ 2: íŒŒì´í”„ë¼ì¸ì„ ì˜ëª» ì‚¬ìš©í•œ ê²½ìš°

**ìƒí™©**: ì£¼ë‹ˆì–´ ê°œë°œìê°€ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ëŒ€ëŸ‰ ë°ì´í„°ë¥¼ ì‚½ì…í•˜ë‹¤ê°€ ë©”ëª¨ë¦¬ ë¶€ì¡± ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```python
# ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œ
import redis

r = redis.Redis()

def insert_million_users():
    """100ë§Œ ëª… ì‚¬ìš©ì ë°ì´í„° ì‚½ì… (ë¬¸ì œ ìˆëŠ” ì½”ë“œ)"""
    pipe = r.pipeline()

    # 100ë§Œ ê°œì˜ ëª…ë ¹ì–´ë¥¼ ëª¨ë‘ íì— ì €ì¥
    for i in range(1000000):
        pipe.hset(f"user:{i}", mapping={
            "name": f"user{i}",
            "email": f"user{i}@example.com",
            "age": 20 + (i % 60)
        })

    # í•œ ë²ˆì— ì‹¤í–‰
    pipe.execute()
    print("ì™„ë£Œ!")
```

**ë¬¸ì œì **:
- ë¬¸ì œ 1: 100ë§Œ ê°œì˜ ëª…ë ¹ì–´ë¥¼ ë©”ëª¨ë¦¬ì— ëª¨ë‘ ë¡œë“œí•˜ì—¬ ë©”ëª¨ë¦¬ ë¶€ì¡± ë°œìƒ
- ë¬¸ì œ 2: ì¤‘ê°„ì— ì—ëŸ¬ ë°œìƒ ì‹œ ëª¨ë“  ì‘ì—…ì´ ì‹¤íŒ¨
- ë¬¸ì œ 3: ì§„í–‰ ìƒí™©ì„ ì•Œ ìˆ˜ ì—†ìŒ
- ì™œ ì´ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê°€: íŒŒì´í”„ë¼ì¸ì€ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ ë©”ëª¨ë¦¬ì— íì‰í•˜ê¸° ë•Œë¬¸

**í•´ê²°ì±…**:
```python
# ì˜¬ë°”ë¥¸ ì½”ë“œ
import redis

r = redis.Redis()

def insert_million_users():
    """100ë§Œ ëª… ì‚¬ìš©ì ë°ì´í„° ì‚½ì… (ì˜¬ë°”ë¥¸ ì½”ë“œ)"""
    batch_size = 1000  # ë°°ì¹˜ í¬ê¸° ì„¤ì •
    total = 1000000

    for batch_start in range(0, total, batch_size):
        # ë°°ì¹˜ë§ˆë‹¤ ìƒˆë¡œìš´ íŒŒì´í”„ë¼ì¸ ìƒì„±
        pipe = r.pipeline()

        batch_end = min(batch_start + batch_size, total)

        for i in range(batch_start, batch_end):
            pipe.hset(f"user:{i}", mapping={
                "name": f"user{i}",
                "email": f"user{i}@example.com",
                "age": 20 + (i % 60)
            })

        # ë°°ì¹˜ ì‹¤í–‰
        pipe.execute()

        # ì§„í–‰ ìƒí™© ì¶œë ¥
        if (batch_start + batch_size) % 10000 == 0:
            progress = ((batch_start + batch_size) / total) * 100
            print(f"ì§„í–‰ë¥ : {progress:.1f}% ({batch_start + batch_size}/{total})")

    print("ì™„ë£Œ!")

# ì‹¤í–‰
insert_million_users()

# ì¶œë ¥:
# ì§„í–‰ë¥ : 1.0% (10000/1000000)
# ì§„í–‰ë¥ : 2.0% (20000/1000000)
# ...
# ì§„í–‰ë¥ : 100.0% (1000000/1000000)
# ì™„ë£Œ!
```

**ë°°ìš´ ì **:
- íŒŒì´í”„ë¼ì¸ì€ ì ì ˆí•œ ë°°ì¹˜ í¬ê¸°(1000~5000)ë¡œ ë‚˜ëˆ„ì–´ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤
- ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°±ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ê³ ë ¤í•˜ì—¬ ë°°ì¹˜ í¬ê¸°ë¥¼ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤

### ì‹œë‚˜ë¦¬ì˜¤ 3: Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í‚¤ë¥¼ ì˜ëª» ì‚¬ìš©í•œ ê²½ìš°

**ìƒí™©**: ì£¼ë‹ˆì–´ ê°œë°œìê°€ Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ KEYSë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ARGVë¡œ í‚¤ë¥¼ ì „ë‹¬í•˜ì—¬ í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```lua
-- ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ (ë¬¸ì œ ìˆëŠ” ì½”ë“œ)
-- increment_counter.lua
local key = ARGV[1]  -- í‚¤ë¥¼ ARGVë¡œ ì „ë‹¬ (ì˜ëª»ë¨!)
local increment = tonumber(ARGV[2])

local current = redis.call('GET', key)
if current == false then
    current = 0
else
    current = tonumber(current)
end

redis.call('SET', key, current + increment)
return current + increment
```

**ë¬¸ì œì **:
- ë¬¸ì œ 1: Redis í´ëŸ¬ìŠ¤í„°ì—ì„œ í‚¤ë¥¼ ARGVë¡œ ì „ë‹¬í•˜ë©´ ì˜¬ë°”ë¥¸ ë…¸ë“œë¡œ ë¼ìš°íŒ…ë˜ì§€ ì•ŠìŒ
- ë¬¸ì œ 2: RedisëŠ” KEYSë¥¼ ë¶„ì„í•˜ì—¬ ì–´ëŠ ë…¸ë“œì— í‚¤ê°€ ìˆëŠ”ì§€ íŒë‹¨í•¨
- ë¬¸ì œ 3: í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ "CROSSSLOT Keys in request don't hash to the same slot" ì—ëŸ¬ ë°œìƒ
- ì™œ ì´ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê°€: Redis í´ëŸ¬ìŠ¤í„°ëŠ” KEYS ë°°ì—´ì„ ê¸°ë°˜ìœ¼ë¡œ ë¼ìš°íŒ…ì„ ìˆ˜í–‰í•¨

**í•´ê²°ì±…**:
```lua
-- ì˜¬ë°”ë¥¸ ìŠ¤í¬ë¦½íŠ¸
-- increment_counter.lua
local key = KEYS[1]  -- í‚¤ë¥¼ KEYSë¡œ ì „ë‹¬ (ì˜¬ë°”ë¦„!)
local increment = tonumber(ARGV[1])

local current = redis.call('GET', key)
if current == false then
    current = 0
else
    current = tonumber(current)
end

redis.call('SET', key, current + increment)
return current + increment
```

```bash
# ì˜ëª»ëœ ì‚¬ìš©ë²•
127.0.0.1:6379> EVAL "$(cat increment_counter.lua)" 0 "counter:1001" 5
# í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ì—ëŸ¬ ë°œìƒ!

# ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²•
127.0.0.1:6379> EVAL "$(cat increment_counter.lua)" 1 "counter:1001" 5
(integer) 5
```

**ë°°ìš´ ì **:
- Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í‚¤ëŠ” ë°˜ë“œì‹œ KEYS ë°°ì—´ë¡œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤
- ARGVëŠ” ê°’(value)ì´ë‚˜ ë§¤ê°œë³€ìˆ˜ë§Œ ì „ë‹¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
- í´ëŸ¬ìŠ¤í„° í™˜ê²½ì„ ê³ ë ¤í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤

### ì‹œë‚˜ë¦¬ì˜¤ 4: íŠ¸ëœì­ì…˜ì—ì„œ ì¡°ê±´ ë¶„ê¸°ë¥¼ ì˜ëª» êµ¬í˜„í•œ ê²½ìš°

**ìƒí™©**: ì£¼ë‹ˆì–´ ê°œë°œìê°€ íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ì¡°ê±´ ë¶„ê¸°ë¥¼ ì‹œë„í–ˆëŠ”ë°, Redis íŠ¸ëœì­ì…˜ì€ ì¡°ê±´ ë¶„ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```python
# ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œ (ë¬¸ì œ ìˆëŠ” ì½”ë“œ)
import redis

r = redis.Redis()

def conditional_update(user_id, new_score):
    """ì ìˆ˜ê°€ ë” ë†’ì„ ë•Œë§Œ ì—…ë°ì´íŠ¸ (ì˜ëª»ëœ ë°©ë²•)"""
    pipe = r.pipeline()

    # íŠ¸ëœì­ì…˜ ì‹œì‘
    pipe.multi()

    # í˜„ì¬ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸° (íì‰ë§Œ ë¨, ì‹¤ì œ ê°’ì€ ì–»ì„ ìˆ˜ ì—†ìŒ!)
    pipe.get(f"user:{user_id}:score")

    # ì¡°ê±´ ë¶„ê¸°ë¥¼ ì‹œë„ (ë¶ˆê°€ëŠ¥!)
    # current_score = ??? (ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ê°’ì´ ì—†ìŒ)

    pipe.set(f"user:{user_id}:score", new_score)

    result = pipe.execute()
    return result
```

**ë¬¸ì œì **:
- ë¬¸ì œ 1: íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œëŠ” ëª…ë ¹ì–´ê°€ íì‰ë§Œ ë˜ê³  ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
- ë¬¸ì œ 2: GET ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê±´ ë¶„ê¸°ë¥¼ í•  ìˆ˜ ì—†ìŒ
- ë¬¸ì œ 3: ëª¨ë“  ëª…ë ¹ì–´ê°€ ë¬´ì¡°ê±´ ì‹¤í–‰ë¨
- ì™œ ì´ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê°€: Redis íŠ¸ëœì­ì…˜ì€ ëª…ë ¹ì–´ë¥¼ íì‰í•˜ê³  EXEC ì‹œì ì— ì¼ê´„ ì‹¤í–‰í•¨

**í•´ê²°ì±… 1: WATCH + Python ì¡°ê±´ ë¶„ê¸°**
```python
# í•´ê²°ì±… 1: WATCH ì‚¬ìš©
import redis

r = redis.Redis()

def conditional_update_with_watch(user_id, new_score):
    """ì ìˆ˜ê°€ ë” ë†’ì„ ë•Œë§Œ ì—…ë°ì´íŠ¸ (WATCH ë°©ì‹)"""
    while True:
        # 1. í‚¤ ê°ì‹œ
        r.watch(f"user:{user_id}:score")

        # 2. í˜„ì¬ ì ìˆ˜ í™•ì¸ (íŠ¸ëœì­ì…˜ ë°–ì—ì„œ)
        current_score = r.get(f"user:{user_id}:score")
        if current_score is None:
            current_score = 0
        else:
            current_score = int(current_score)

        # 3. ì¡°ê±´ í™•ì¸
        if new_score <= current_score:
            r.unwatch()
            return False, f"ì ìˆ˜ê°€ ë” ë‚®ìŠµë‹ˆë‹¤ (í˜„ì¬: {current_score}, ìƒˆë¡œìš´: {new_score})"

        try:
            # 4. íŠ¸ëœì­ì…˜ ì‹¤í–‰
            pipe = r.pipeline()
            pipe.set(f"user:{user_id}:score", new_score)
            pipe.execute()

            return True, f"ì ìˆ˜ ì—…ë°ì´íŠ¸ ì„±ê³µ ({current_score} â†’ {new_score})"

        except redis.WatchError:
            # 5. ì¶©ëŒ ì‹œ ì¬ì‹œë„
            continue

# ì‚¬ìš© ì˜ˆì‹œ
success, message = conditional_update_with_watch("1001", 150)
print(message)
```

**í•´ê²°ì±… 2: Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©**
```lua
-- conditional_update.lua
local user_id = ARGV[1]
local new_score = tonumber(ARGV[2])
local score_key = 'user:' .. user_id .. ':score'

-- í˜„ì¬ ì ìˆ˜ í™•ì¸
local current_score = redis.call('GET', score_key)
if current_score == false then
    current_score = 0
else
    current_score = tonumber(current_score)
end

-- ì¡°ê±´ ë¶„ê¸°
if new_score > current_score then
    redis.call('SET', score_key, new_score)
    return {1, current_score, new_score}
else
    return {0, current_score, new_score}
end
```

```python
# Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¡°ê±´ ë¶„ê¸° êµ¬í˜„
import redis

r = redis.Redis()

# Lua ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
with open('conditional_update.lua', 'r') as f:
    script = f.read()

update_script = r.register_script(script)

# ì‹¤í–‰
result = update_script(args=["1001", 150])
success, old_score, new_score = result

if success:
    print(f"ì ìˆ˜ ì—…ë°ì´íŠ¸ ì„±ê³µ ({old_score} â†’ {new_score})")
else:
    print(f"ì ìˆ˜ê°€ ë” ë‚®ìŠµë‹ˆë‹¤ (í˜„ì¬: {old_score}, ìƒˆë¡œìš´: {new_score})")
```

**ë°°ìš´ ì **:
- Redis íŠ¸ëœì­ì…˜ì€ ì¡°ê±´ ë¶„ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ WATCH + Python ì¡°ê±´ ë¶„ê¸° ë˜ëŠ” Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
- ë³µì¡í•œ ì¡°ê±´ ë¡œì§ì´ í•„ìš”í•˜ë©´ Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤
- íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œëŠ” ëª…ë ¹ì–´ê°€ íì‰ë§Œ ë˜ê³  ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤

---

## ğŸ› ï¸ ì‹¤ì „ í”„ë¡œì íŠ¸

### í”„ë¡œì íŠ¸ 1: ì „ììƒê±°ë˜ ì¬ê³ ê´€ë¦¬ ì‹œìŠ¤í…œ

**ë‚œì´ë„**: â­â­â­â­â˜†
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 3-4ì‹œê°„
**í•™ìŠµ ëª©í‘œ**: Redis íŠ¸ëœì­ì…˜ê³¼ Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

#### ìš”êµ¬ì‚¬í•­ ë¶„ì„

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­**
- [x] ì‹¤ì‹œê°„ ì¬ê³  ì¶”ì 
- [x] ë™ì‹œ ì£¼ë¬¸ ì²˜ë¦¬ (Race Condition ë°©ì§€)
- [x] ì¬ê³  ë¶€ì¡± ì‹œ ëŒ€ê¸°ì—´ ê´€ë¦¬
- [x] ì£¼ë¬¸ ì´ë ¥ ì¶”ì 
- [x] ì¬ê³  ì•Œë¦¼ ì‹œìŠ¤í…œ

**ê¸°ìˆ  ìš”êµ¬ì‚¬í•­**
- [x] Redis íŠ¸ëœì­ì…˜ (WATCH + MULTI + EXEC)
- [x] Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- [x] íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”

**ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­**
- [x] ì„±ëŠ¥: ë™ì‹œ 1000ëª… ì£¼ë¬¸ ì²˜ë¦¬ ê°€ëŠ¥
- [x] ë³´ì•ˆ: ì¬ê³  ì˜¤ë²„ì…€ë§ ë°©ì§€
- [x] í™•ì¥ì„±: ìƒí’ˆ ìˆ˜ ì œí•œ ì—†ìŒ

#### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
inventory-system/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ order_process.lua
â”‚   â”œâ”€â”€ payment_complete.lua
â”‚   â””â”€â”€ inventory_dashboard.lua
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ inventory_manager.py
â”‚   â””â”€â”€ test_inventory.py
â”œâ”€â”€ config/
â”‚   â””â”€â”€ redis.conf
â””â”€â”€ README.md
```

#### ì„¤ê³„ ì˜ì‚¬ê²°ì •

**ê²°ì • 1: Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©**
- ì´ìœ : ì¬ê³  í™•ì¸ê³¼ ì°¨ê°ì„ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨
- ëŒ€ì•ˆ: Pythonì—ì„œ WATCH + MULTI ì‚¬ìš©
- ì„ íƒ ê·¼ê±°: Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ë” ê°„ê²°í•˜ê³  ì„±ëŠ¥ì´ ìš°ìˆ˜í•¨

**ê²°ì • 2: ëŒ€ê¸°ì—´ì„ LISTë¡œ êµ¬í˜„**
- ì´ìœ : FIFO ë°©ì‹ìœ¼ë¡œ ëŒ€ê¸° ìˆœì„œ ë³´ì¥
- ëŒ€ì•ˆ: Sorted Setìœ¼ë¡œ ìš°ì„ ìˆœìœ„ êµ¬í˜„
- ì„ íƒ ê·¼ê±°: ê°„ë‹¨í•œ ëŒ€ê¸°ì—´ì€ LISTê°€ ë” íš¨ìœ¨ì 

#### ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ

**1ë‹¨ê³„: Lua ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±**

```lua
-- order_process.lua
local product_id = ARGV[1]
local quantity = tonumber(ARGV[2])
local user_id = ARGV[3]
local order_id = ARGV[4]
local timestamp = ARGV[5]

-- í‚¤ ì •ì˜
local stock_key = 'product:' .. product_id .. ':stock'
local reserved_key = 'product:' .. product_id .. ':reserved'
local waitlist_key = 'product:' .. product_id .. ':waitlist'
local orders_key = 'orders:' .. string.sub(timestamp, 1, 10)
local log_key = 'product:' .. product_id .. ':stock_log'

-- í˜„ì¬ ì¬ê³  í™•ì¸
local current_stock = redis.call('GET', stock_key)
if current_stock == false then
    return {0, 'PRODUCT_NOT_FOUND', 0}
end
current_stock = tonumber(current_stock)

-- ì˜ˆì•½ëœ ì¬ê³  í™•ì¸
local reserved = redis.call('GET', reserved_key)
if reserved == false then
    reserved = 0
else
    reserved = tonumber(reserved)
end

-- ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ì¬ê³ 
local available = current_stock - reserved

if available >= quantity then
    -- ì£¼ë¬¸ ê°€ëŠ¥: ì¬ê³  ì˜ˆì•½
    redis.call('INCRBY', reserved_key, quantity)
    redis.call('EXPIRE', reserved_key, 1800)  -- 30ë¶„ ì˜ˆì•½ ìœ íš¨

    -- ì£¼ë¬¸ ê¸°ë¡
    local order_data = order_id .. ':' .. user_id .. ':' .. product_id .. ':' .. quantity
    redis.call('ZADD', orders_key, timestamp, order_data)

    -- ë¡œê·¸ ê¸°ë¡
    local log_entry = timestamp .. ':RESERVED:' .. quantity .. ':' .. user_id
    redis.call('LPUSH', log_key, log_entry)
    redis.call('LTRIM', log_key, 0, 999)  -- ìµœê·¼ 1000ê°œë§Œ ë³´ê´€

    return {1, 'ORDER_RESERVED', available - quantity}
else
    -- ì¬ê³  ë¶€ì¡±: ëŒ€ê¸°ì—´ì— ì¶”ê°€
    local waitlist_data = user_id .. ':' .. quantity .. ':' .. timestamp
    redis.call('RPUSH', waitlist_key, waitlist_data)

    -- ëŒ€ê¸°ì—´ ìœ„ì¹˜ ë°˜í™˜
    local position = redis.call('LLEN', waitlist_key)

    return {0, 'WAITLISTED', position}
end
```

```lua
-- payment_complete.lua
local product_id = ARGV[1]
local quantity = tonumber(ARGV[2])
local user_id = ARGV[3]
local order_id = ARGV[4]
local timestamp = ARGV[5]

local stock_key = 'product:' .. product_id .. ':stock'
local reserved_key = 'product:' .. product_id .. ':reserved'
local sold_key = 'product:' .. product_id .. ':sold'
local log_key = 'product:' .. product_id .. ':stock_log'

-- ì˜ˆì•½ëœ ì¬ê³ ì—ì„œ ì°¨ê°
local reserved = redis.call('GET', reserved_key)
if reserved == false or tonumber(reserved) < quantity then
    return {0, 'RESERVATION_NOT_FOUND'}
end

-- ì‹¤ì œ ì¬ê³  ì°¨ê°
redis.call('DECRBY', stock_key, quantity)
redis.call('DECRBY', reserved_key, quantity)

-- íŒë§¤ ìˆ˜ëŸ‰ ì¦ê°€
redis.call('INCRBY', sold_key, quantity)

-- ë¡œê·¸ ê¸°ë¡
local log_entry = timestamp .. ':SOLD:' .. quantity .. ':' .. user_id .. ':' .. order_id
redis.call('LPUSH', log_key, log_entry)

return {1, 'PAYMENT_COMPLETE', redis.call('GET', stock_key)}
```

**2ë‹¨ê³„: Python ì¬ê³  ê´€ë¦¬ì êµ¬í˜„**

```python
# inventory_manager.py
import redis
import time
from datetime import datetime

class InventoryManager:
    def __init__(self, redis_host='localhost', redis_port=6379):
        self.redis_client = redis.Redis(
            host=redis_host,
            port=redis_port,
            db=0,
            decode_responses=True
        )

        # Lua ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
        with open('scripts/order_process.lua', 'r') as f:
            self.order_script = self.redis_client.register_script(f.read())

        with open('scripts/payment_complete.lua', 'r') as f:
            self.payment_script = self.redis_client.register_script(f.read())

    def create_product(self, product_id, name, price, initial_stock):
        """ìƒí’ˆ ìƒì„±"""
        pipe = self.redis_client.pipeline()
        pipe.hset(f"product:{product_id}", mapping={
            "name": name,
            "price": price,
            "category": "general"
        })
        pipe.set(f"product:{product_id}:stock", initial_stock)
        pipe.set(f"product:{product_id}:sold", 0)
        pipe.execute()

        return {
            "product_id": product_id,
            "name": name,
            "stock": initial_stock
        }

    def place_order(self, product_id, quantity, user_id):
        """ì£¼ë¬¸ ì²˜ë¦¬"""
        order_id = f"ORD_{int(time.time() * 1000)}"
        timestamp = str(int(time.time()))

        result = self.order_script(
            args=[product_id, quantity, user_id, order_id, timestamp]
        )

        success, status, info = result

        if success:
            return {
                "success": True,
                "order_id": order_id,
                "status": status,
                "available_stock": info
            }
        else:
            return {
                "success": False,
                "status": status,
                "waitlist_position": info if status == "WAITLISTED" else None
            }

    def complete_payment(self, product_id, quantity, user_id, order_id):
        """ê²°ì œ ì™„ë£Œ ì²˜ë¦¬"""
        timestamp = str(int(time.time()))

        result = self.payment_script(
            args=[product_id, quantity, user_id, order_id, timestamp]
        )

        success, status = result[0], result[1]

        if success:
            return {
                "success": True,
                "status": status,
                "remaining_stock": result[2]
            }
        else:
            return {
                "success": False,
                "status": status
            }

    def get_product_info(self, product_id):
        """ìƒí’ˆ ì •ë³´ ì¡°íšŒ"""
        pipe = self.redis_client.pipeline()
        pipe.hgetall(f"product:{product_id}")
        pipe.get(f"product:{product_id}:stock")
        pipe.get(f"product:{product_id}:reserved")
        pipe.get(f"product:{product_id}:sold")
        pipe.llen(f"product:{product_id}:waitlist")

        results = pipe.execute()

        product_info = results[0]
        stock = int(results[1]) if results[1] else 0
        reserved = int(results[2]) if results[2] else 0
        sold = int(results[3]) if results[3] else 0
        waitlist = results[4]

        return {
            "product_id": product_id,
            "name": product_info.get("name", "Unknown"),
            "price": product_info.get("price", "0"),
            "stock": stock,
            "reserved": reserved,
            "available": stock - reserved,
            "sold": sold,
            "waitlist_count": waitlist
        }

    def get_stock_logs(self, product_id, limit=10):
        """ì¬ê³  ë³€ê²½ ë¡œê·¸ ì¡°íšŒ"""
        logs = self.redis_client.lrange(
            f"product:{product_id}:stock_log",
            0,
            limit - 1
        )

        parsed_logs = []
        for log in logs:
            parts = log.split(':')
            parsed_logs.append({
                "timestamp": datetime.fromtimestamp(int(parts[0])).strftime('%Y-%m-%d %H:%M:%S'),
                "action": parts[1],
                "quantity": parts[2],
                "user_id": parts[3] if len(parts) > 3 else "N/A"
            })

        return parsed_logs


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    manager = InventoryManager()

    # ìƒí’ˆ ìƒì„±
    print("=== ìƒí’ˆ ìƒì„± ===")
    product = manager.create_product(
        product_id="1001",
        name="iPhone 15 Pro",
        price="1290000",
        initial_stock=100
    )
    print(f"ìƒí’ˆ ìƒì„±: {product}")

    # ì£¼ë¬¸ ì²˜ë¦¬
    print("\n=== ì£¼ë¬¸ ì²˜ë¦¬ ===")
    order1 = manager.place_order("1001", 5, "user123")
    print(f"ì£¼ë¬¸ 1: {order1}")

    order2 = manager.place_order("1001", 3, "user456")
    print(f"ì£¼ë¬¸ 2: {order2}")

    # ê²°ì œ ì™„ë£Œ
    print("\n=== ê²°ì œ ì™„ë£Œ ===")
    if order1["success"]:
        payment = manager.complete_payment(
            "1001", 5, "user123", order1["order_id"]
        )
        print(f"ê²°ì œ ì™„ë£Œ: {payment}")

    # ìƒí’ˆ ì •ë³´ ì¡°íšŒ
    print("\n=== ìƒí’ˆ ì •ë³´ ===")
    info = manager.get_product_info("1001")
    print(f"ìƒí’ˆ ì •ë³´: {info}")

    # ì¬ê³  ë¡œê·¸ ì¡°íšŒ
    print("\n=== ì¬ê³  ë¡œê·¸ ===")
    logs = manager.get_stock_logs("1001", 5)
    for log in logs:
        print(f"  {log}")
```

**3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì‘ì„±**

```python
# test_inventory.py
import pytest
import threading
import time
from inventory_manager import InventoryManager

class TestInventorySystem:
    @pytest.fixture
    def manager(self):
        """í…ŒìŠ¤íŠ¸ìš© InventoryManager ì¸ìŠ¤í„´ìŠ¤"""
        return InventoryManager()

    def test_create_product(self, manager):
        """ìƒí’ˆ ìƒì„± í…ŒìŠ¤íŠ¸"""
        product = manager.create_product(
            product_id="TEST001",
            name="Test Product",
            price="10000",
            initial_stock=50
        )

        assert product["product_id"] == "TEST001"
        assert product["name"] == "Test Product"
        assert product["stock"] == 50

    def test_place_order_success(self, manager):
        """ì •ìƒ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸"""
        manager.create_product("TEST002", "Product 2", "20000", 100)

        order = manager.place_order("TEST002", 10, "user001")

        assert order["success"] == True
        assert order["status"] == "ORDER_RESERVED"
        assert order["available_stock"] == 90

    def test_place_order_insufficient_stock(self, manager):
        """ì¬ê³  ë¶€ì¡± ì£¼ë¬¸ í…ŒìŠ¤íŠ¸"""
        manager.create_product("TEST003", "Product 3", "30000", 5)

        order = manager.place_order("TEST003", 10, "user002")

        assert order["success"] == False
        assert order["status"] == "WAITLISTED"
        assert order["waitlist_position"] == 1

    def test_concurrent_orders(self, manager):
        """ë™ì‹œ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ (Race Condition ë°©ì§€ í™•ì¸)"""
        manager.create_product("TEST004", "Product 4", "40000", 10)

        results = []

        def place_order_thread(user_id):
            order = manager.place_order("TEST004", 5, user_id)
            results.append(order)

        # 10ëª…ì´ ë™ì‹œì— 5ê°œì”© ì£¼ë¬¸ (ì´ 50ê°œ, ì¬ê³ ëŠ” 10ê°œ)
        threads = []
        for i in range(10):
            t = threading.Thread(target=place_order_thread, args=(f"user{i}",))
            threads.append(t)
            t.start()

        for t in threads:
            t.join()

        # ì„±ê³µí•œ ì£¼ë¬¸ í™•ì¸ (ìµœëŒ€ 2ëª…ë§Œ ì„±ê³µí•´ì•¼ í•¨: 10ê°œ / 5ê°œ = 2ëª…)
        successful_orders = [r for r in results if r["success"]]
        assert len(successful_orders) <= 2

        # ìµœì¢… ì¬ê³  í™•ì¸
        info = manager.get_product_info("TEST004")
        assert info["stock"] >= 0  # ì¬ê³ ê°€ ìŒìˆ˜ê°€ ë˜ë©´ ì•ˆ ë¨

    def test_payment_complete(self, manager):
        """ê²°ì œ ì™„ë£Œ í…ŒìŠ¤íŠ¸"""
        manager.create_product("TEST005", "Product 5", "50000", 20)

        order = manager.place_order("TEST005", 8, "user003")
        assert order["success"] == True

        payment = manager.complete_payment(
            "TEST005", 8, "user003", order["order_id"]
        )

        assert payment["success"] == True
        assert payment["status"] == "PAYMENT_COMPLETE"
        assert int(payment["remaining_stock"]) == 12


# ì‹¤í–‰
if __name__ == "__main__":
    pytest.main([__file__, "-v"])
```

**4ë‹¨ê³„: ì‹¤í–‰ ë° ê²€ì¦**

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python test_inventory.py

# ì˜ˆìƒ ì¶œë ¥:
# test_inventory.py::TestInventorySystem::test_create_product PASSED
# test_inventory.py::TestInventorySystem::test_place_order_success PASSED
# test_inventory.py::TestInventorySystem::test_place_order_insufficient_stock PASSED
# test_inventory.py::TestInventorySystem::test_concurrent_orders PASSED
# test_inventory.py::TestInventorySystem::test_payment_complete PASSED
```

#### í™•ì¥ ì•„ì´ë””ì–´

**ì¶”ê°€ ê¸°ëŠ¥ 1: ì¬ê³  ìë™ ë³´ì¶© ì‹œìŠ¤í…œ**
**ë‚œì´ë„**: â­â­â­â­â˜†
**êµ¬í˜„ íŒíŠ¸**: Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¬ê³ ê°€ ì„ê³„ê°’ ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ ìë™ìœ¼ë¡œ ë³´ì¶© ì•Œë¦¼ ì „ì†¡

**ì¶”ê°€ ê¸°ëŠ¥ 2: í• ì¸ ì¿ í° ì ìš©**
**ë‚œì´ë„**: â­â­â­â˜†â˜†
**êµ¬í˜„ íŒíŠ¸**: ì¿ í° ì‚¬ìš© ì—¬ë¶€ë¥¼ Redis Setìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ ì¤‘ë³µ ì‚¬ìš© ë°©ì§€

**ì¶”ê°€ ê¸°ëŠ¥ 3: ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**
**ë‚œì´ë„**: â­â­â­â­â­
**êµ¬í˜„ íŒíŠ¸**: Redis Pub/Subë¡œ ì¬ê³  ë³€ê²½ ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸

### í”„ë¡œì íŠ¸ 2: ë¶„ì‚° ë½ì„ ì´ìš©í•œ ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬

**ë‚œì´ë„**: â­â­â­â­â­
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 4-5ì‹œê°„
**í•™ìŠµ ëª©í‘œ**: Redis ë¶„ì‚° ë½ì„ í™œìš©í•œ ì¤‘ë³µ ì‘ì—… ë°©ì§€ ì‹œìŠ¤í…œ êµ¬ì¶•

#### ìš”êµ¬ì‚¬í•­

- ì—¬ëŸ¬ ì›Œì»¤ê°€ ë™ì‹œì— ì‘ì—… íì—ì„œ ì‘ì—…ì„ ê°€ì ¸ê°
- ê°™ì€ ì‘ì—…ì„ ì¤‘ë³µ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
- ì‘ì—… ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- ì‘ì—… ì²˜ë¦¬ ì‹œê°„ ëª¨ë‹ˆí„°ë§

#### í•µì‹¬ êµ¬í˜„

```python
# job_scheduler.py
import redis
import time
import uuid

class DistributedJobScheduler:
    def __init__(self, redis_host='localhost', redis_port=6379):
        self.redis_client = redis.Redis(host=redis_host, port=redis_port, db=0, decode_responses=True)
        self.worker_id = str(uuid.uuid4())

    def acquire_lock(self, job_id, ttl=300000):
        """ë¶„ì‚° ë½ íšë“ (TTL: ë°€ë¦¬ì´ˆ)"""
        lock_key = f"lock:job:{job_id}"
        result = self.redis_client.set(
            lock_key,
            self.worker_id,
            px=ttl,
            nx=True
        )
        return result is not None

    def release_lock(self, job_id):
        """ë¶„ì‚° ë½ í•´ì œ"""
        lock_key = f"lock:job:{job_id}"

        # Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì•ˆì „í•˜ê²Œ ë½ í•´ì œ
        release_script = """
        local lock_key = KEYS[1]
        local worker_id = ARGV[1]

        local current_value = redis.call('GET', lock_key)
        if current_value == worker_id then
            redis.call('DEL', lock_key)
            return 1
        else
            return 0
        end
        """

        script = self.redis_client.register_script(release_script)
        result = script(keys=[lock_key], args=[self.worker_id])
        return result == 1

    def get_job(self, queue_name='job:queue'):
        """ì‘ì—… íì—ì„œ ì‘ì—… ê°€ì ¸ì˜¤ê¸°"""
        job_id = self.redis_client.lpop(queue_name)

        if job_id:
            # ë½ íšë“ ì‹œë„
            if self.acquire_lock(job_id):
                return job_id
            else:
                # ë½ íšë“ ì‹¤íŒ¨ ì‹œ ì‘ì—…ì„ í ë’¤ë¡œ ëŒë¦¼
                self.redis_client.rpush(queue_name, job_id)
                return None

        return None

    def process_job(self, job_id):
        """ì‘ì—… ì²˜ë¦¬"""
        print(f"[Worker {self.worker_id[:8]}] Processing job: {job_id}")
        time.sleep(2)  # ì‹¤ì œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
        print(f"[Worker {self.worker_id[:8]}] Completed job: {job_id}")

    def run_worker(self):
        """ì›Œì»¤ ì‹¤í–‰"""
        print(f"Worker {self.worker_id[:8]} started")

        while True:
            job_id = self.get_job()

            if job_id:
                try:
                    self.process_job(job_id)
                finally:
                    self.release_lock(job_id)
            else:
                time.sleep(1)  # ì‘ì—…ì´ ì—†ìœ¼ë©´ ëŒ€ê¸°


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    import sys

    scheduler = DistributedJobScheduler()

    if len(sys.argv) > 1 and sys.argv[1] == "add_jobs":
        # ì‘ì—… ì¶”ê°€
        for i in range(10):
            scheduler.redis_client.rpush("job:queue", f"job_{i}")
        print("10ê°œ ì‘ì—… ì¶”ê°€ ì™„ë£Œ")
    else:
        # ì›Œì»¤ ì‹¤í–‰
        scheduler.run_worker()
```

---

## â“ FAQ

<details>
<summary><strong>Q1: Redis íŠ¸ëœì­ì…˜ì€ ACIDë¥¼ ëª¨ë‘ ì§€ì›í•˜ë‚˜ìš”?</strong></summary>

**A**: Redis íŠ¸ëœì­ì…˜ì€ ACID ì¤‘ ì¼ë¶€ë§Œ ì§€ì›í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- ì›ìì„± (Atomicity): âœ… ì§€ì› - ëª¨ë“  ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê±°ë‚˜ í•˜ë‚˜ë„ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
- ì¼ê´€ì„± (Consistency): âœ… ì§€ì› - íŠ¸ëœì­ì…˜ í›„ì—ë„ ë°ì´í„° ì¼ê´€ì„± ìœ ì§€
- ê²©ë¦¬ì„± (Isolation): âœ… ì§€ì› - íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ì—†ìŒ
- ì§€ì†ì„± (Durability): âš ï¸ ë¶€ë¶„ ì§€ì› - RDB/AOF ì„¤ì •ì— ë”°ë¼ ë‹¤ë¦„

**ì˜ˆì‹œ**:
```bash
# ì›ìì„± ì˜ˆì‹œ
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> SET key1 "value1"
QUEUED
127.0.0.1:6379> SET key2 "value2"
QUEUED
127.0.0.1:6379> EXEC
1) OK
2) OK

# ëª¨ë“  ëª…ë ¹ì–´ê°€ í•¨ê»˜ ì‹¤í–‰ë¨
```

**ì‹¤ë¬´ íŒ**:
- ì¤‘ìš”í•œ ë°ì´í„°ëŠ” AOF persistenceë¥¼ í™œì„±í™”í•˜ì—¬ ì§€ì†ì„±ì„ ë³´ì¥í•˜ì„¸ìš”
- RedisëŠ” ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ì´ë¯€ë¡œ ì™„ë²½í•œ ì§€ì†ì„±ì„ ê¸°ëŒ€í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤

</details>

<details>
<summary><strong>Q2: íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë¡¤ë°±ë˜ë‚˜ìš”?</strong></summary>

**A**: RedisëŠ” **ë¬¸ë²• ì—ëŸ¬**ì™€ **ëŸ°íƒ€ì„ ì—ëŸ¬**ë¥¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- ë¬¸ë²• ì—ëŸ¬: ì „ì²´ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ (ìœ ì‚¬ ë¡¤ë°±)
- ëŸ°íƒ€ì„ ì—ëŸ¬: ì—ëŸ¬ ë‚œ ëª…ë ¹ì–´ë§Œ ì‹¤íŒ¨, ë‚˜ë¨¸ì§€ëŠ” ì •ìƒ ì‹¤í–‰ (ë¡¤ë°± ì—†ìŒ!)

**ì˜ˆì‹œ**:
```bash
# ë¬¸ë²• ì—ëŸ¬ - ì „ì²´ ì‹¤íŒ¨
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> SET key1 "value1"
QUEUED
127.0.0.1:6379> WRONGCOMMAND
(error) ERR unknown command 'WRONGCOMMAND'
127.0.0.1:6379> EXEC
(error) EXECABORT Transaction discarded

# ëŸ°íƒ€ì„ ì—ëŸ¬ - ì¼ë¶€ ì‹¤í–‰
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> SET mykey "hello"
QUEUED
127.0.0.1:6379> INCR mykey  # ë¬¸ìì—´ì— INCR ì‹œë„
QUEUED
127.0.0.1:6379> SET another "world"
QUEUED
127.0.0.1:6379> EXEC
1) OK
2) (error) ERR value is not an integer
3) OK  # 3ë²ˆì§¸ ëª…ë ¹ì–´ëŠ” ì •ìƒ ì‹¤í–‰ë¨!
```

**ì‹¤ë¬´ íŒ**:
- ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½ìš° Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ì „ ê²€ì¦í•˜ì„¸ìš”
- ì¤‘ìš”í•œ ì‘ì—…ì€ WATCHë¡œ í‚¤ë¥¼ ê°ì‹œí•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•˜ì„¸ìš”

</details>

<details>
<summary><strong>Q3: íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</strong></summary>

**A**: ëª©ì ê³¼ ë³´ì¥í•˜ëŠ” íŠ¹ì„±ì´ ë‹¤ë¦…ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

| íŠ¹ì„± | íŒŒì´í”„ë¼ì¸ | íŠ¸ëœì­ì…˜ |
|------|-----------|---------|
| ëª©ì  | ì„±ëŠ¥ ìµœì í™” (RTT ê°ì†Œ) | ì›ìì„± ë³´ì¥ |
| ì›ìì„± | âŒ ë³´ì¥ ì•ˆ ë¨ | âœ… ë³´ì¥ë¨ |
| ì¤‘ê°„ ë°©í•´ | âš ï¸ ê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ |
| ì¡°ê±´ë¶€ ì‹¤í–‰ | âŒ ë¶ˆê°€ëŠ¥ | âš ï¸ WATCHë¡œ ê°€ëŠ¥ |
| ì„±ëŠ¥ | â­â­â­â­â­ ë§¤ìš° ë¹ ë¦„ | â­â­â­â­ ë¹ ë¦„ |

**ì˜ˆì‹œ**:
```python
# íŒŒì´í”„ë¼ì¸ - ì„±ëŠ¥ ìµœì í™”
pipe = r.pipeline(transaction=False)  # íŠ¸ëœì­ì…˜ ì—†ì´
pipe.set("key1", "value1")
pipe.set("key2", "value2")
pipe.execute()
# ì¤‘ê°„ì— ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ìˆìŒ!

# íŠ¸ëœì­ì…˜ - ì›ìì„± ë³´ì¥
pipe = r.pipeline(transaction=True)  # íŠ¸ëœì­ì…˜ í¬í•¨
pipe.multi()
pipe.set("key1", "value1")
pipe.set("key2", "value2")
pipe.execute()
# ì¤‘ê°„ì— ë‹¤ë¥¸ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ì—†ìŒ!
```

**ì‹¤ë¬´ íŒ**:
- ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê³  ì›ìì„±ì´ í•„ìš” ì—†ìœ¼ë©´ íŒŒì´í”„ë¼ì¸ ì‚¬ìš©
- ì›ìì„±ì´ í•„ìš”í•˜ë©´ íŠ¸ëœì­ì…˜ ì‚¬ìš©
- ë‘˜ ë‹¤ í•„ìš”í•˜ë©´ íŒŒì´í”„ë¼ì¸ + íŠ¸ëœì­ì…˜ ì¡°í•© ì‚¬ìš©

</details>

<details>
<summary><strong>Q4: Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” ì–¸ì œ ì‚¬ìš©í•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**A**: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì›ìì ìœ¼ë¡œ ì‹¤í–‰í•´ì•¼ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- ì¡°ê±´ ë¶„ê¸°ê°€ í•„ìš”í•œ ê²½ìš°
- ì—¬ëŸ¬ Redis ëª…ë ¹ì–´ë¥¼ ì¡°í•©í•´ì•¼ í•˜ëŠ” ê²½ìš°
- ë„¤íŠ¸ì›Œí¬ ì™•ë³µì„ ìµœì†Œí™”í•˜ë ¤ëŠ” ê²½ìš°
- ë³µì¡í•œ ë°ì´í„° ë³€í™˜ì´ í•„ìš”í•œ ê²½ìš°

**ì‚¬ìš© ì‹œê¸°**:
1. âœ… ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸ (ì˜ˆ: ê°’ì´ í¬ë©´ ì—…ë°ì´íŠ¸)
2. âœ… ë³µì¡í•œ ì§‘ê³„ ì—°ì‚° (ì˜ˆ: ì—¬ëŸ¬ í‚¤ì˜ ê°’ì„ í•©ì‚°)
3. âœ… ë ˆì´íŠ¸ ë¦¬ë¯¸í„° êµ¬í˜„
4. âœ… ë¶„ì‚° ë½ êµ¬í˜„
5. âœ… ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ

**ì˜ˆì‹œ**:
```lua
-- ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸
local current = redis.call('GET', KEYS[1])
if current == false then
    current = 0
else
    current = tonumber(current)
end

local new_value = tonumber(ARGV[1])

if new_value > current then
    redis.call('SET', KEYS[1], new_value)
    return {1, new_value}
else
    return {0, current}
end
```

**ì‹¤ë¬´ íŒ**:
- ë‹¨ìˆœí•œ ì‘ì—…ì€ ì¼ë°˜ ëª…ë ¹ì–´ ì‚¬ìš©
- ë³µì¡í•œ ë¡œì§ì€ Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
- ìŠ¤í¬ë¦½íŠ¸ëŠ” SCRIPT LOADë¡œ ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ

</details>

<details>
<summary><strong>Q5: WATCHë¥¼ ì‚¬ìš©í•  ë•Œ ë¬´í•œ ë£¨í”„ì— ë¹ ì§ˆ ê°€ëŠ¥ì„±ì€ ì—†ë‚˜ìš”?</strong></summary>

**A**: ê°€ëŠ¥ì„±ì€ ìˆì§€ë§Œ ì ì ˆí•œ ì¬ì‹œë„ ë¡œì§ìœ¼ë¡œ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- ë™ì‹œ ì ‘ê·¼ì´ ë§¤ìš° ë§ìœ¼ë©´ WATCH ì¶©ëŒì´ ë°˜ë³µë  ìˆ˜ ìˆìŒ
- ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì„¤ì •í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€
- ì§€ìˆ˜ ë°±ì˜¤í”„ ì „ëµìœ¼ë¡œ ì¶©ëŒ í™•ë¥  ê°ì†Œ

**ì˜ˆì‹œ**:
```python
# ë¬´í•œ ë£¨í”„ ë°©ì§€ íŒ¨í„´
import redis
import time

r = redis.Redis()

def safe_update_with_watch(key, max_retries=10):
    """WATCHë¥¼ ì‚¬ìš©í•œ ì•ˆì „í•œ ì—…ë°ì´íŠ¸ (ì¬ì‹œë„ ì œí•œ)"""
    for attempt in range(max_retries):
        try:
            # WATCH ì‹œì‘
            r.watch(key)

            current_value = r.get(key)
            if current_value is None:
                current_value = 0
            else:
                current_value = int(current_value)

            # íŠ¸ëœì­ì…˜ ì‹¤í–‰
            pipe = r.pipeline()
            pipe.set(key, current_value + 1)
            pipe.execute()

            # ì„±ê³µ
            return True, f"ì—…ë°ì´íŠ¸ ì„±ê³µ (ì‹œë„: {attempt + 1}íšŒ)"

        except redis.WatchError:
            # WATCH ì¶©ëŒ ì‹œ ì¬ì‹œë„
            if attempt < max_retries - 1:
                # ì§€ìˆ˜ ë°±ì˜¤í”„
                time.sleep(0.01 * (2 ** attempt))
                continue
            else:
                return False, f"ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ({max_retries}íšŒ)"

        finally:
            r.unwatch()

    return False, "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"

# ì‚¬ìš©
success, message = safe_update_with_watch("counter")
print(message)
```

**ì‹¤ë¬´ íŒ**:
- ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ 5~10íšŒë¡œ ì œí•œ
- ì¬ì‹œë„ ê°„ê²©ì„ ì ì§„ì ìœ¼ë¡œ ëŠ˜ë ¤ì„œ ì¶©ëŒ í™•ë¥  ê°ì†Œ
- ì¶©ëŒì´ ìì£¼ ë°œìƒí•˜ë©´ Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³€ê²½ ê³ ë ¤

</details>

<details>
<summary><strong>Q6: íŒŒì´í”„ë¼ì¸ ë°°ì¹˜ í¬ê¸°ëŠ” ì–´ë–»ê²Œ ì •í•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**A**: ì¼ë°˜ì ìœ¼ë¡œ 1000~5000ê°œê°€ ì ì ˆí•˜ë©°, í™˜ê²½ì— ë”°ë¼ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- ë„ˆë¬´ ì‘ìœ¼ë©´: ë„¤íŠ¸ì›Œí¬ ì™•ë³µì´ ë§ì•„ì ¸ ì„±ëŠ¥ ì €í•˜
- ë„ˆë¬´ í¬ë©´: ë©”ëª¨ë¦¬ ë¶€ì¡±, íƒ€ì„ì•„ì›ƒ ë°œìƒ ê°€ëŠ¥
- ìµœì ê°’ì€ ë°ì´í„° í¬ê¸°ì™€ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì— ë”°ë¼ ë‹¤ë¦„

**ì‹¤í—˜ì„ í†µí•œ ìµœì í™”**:
```python
import redis
import time

r = redis.Redis()

def benchmark_batch_size(total_items=100000):
    """ë°°ì¹˜ í¬ê¸°ë³„ ì„±ëŠ¥ ì¸¡ì •"""
    batch_sizes = [100, 500, 1000, 2000, 5000, 10000]
    results = []

    for batch_size in batch_sizes:
        start_time = time.time()

        for batch_start in range(0, total_items, batch_size):
            pipe = r.pipeline()

            batch_end = min(batch_start + batch_size, total_items)
            for i in range(batch_start, batch_end):
                pipe.set(f"test:batch{batch_size}:key{i}", f"value{i}")

            pipe.execute()

        elapsed_time = time.time() - start_time
        results.append((batch_size, elapsed_time))
        print(f"ë°°ì¹˜ í¬ê¸° {batch_size}: {elapsed_time:.2f}ì´ˆ")

    # ìµœì  ë°°ì¹˜ í¬ê¸° ì°¾ê¸°
    optimal = min(results, key=lambda x: x[1])
    print(f"\nìµœì  ë°°ì¹˜ í¬ê¸°: {optimal[0]} (ì†Œìš” ì‹œê°„: {optimal[1]:.2f}ì´ˆ)")

benchmark_batch_size()

# ì¶œë ¥ ì˜ˆì‹œ:
# ë°°ì¹˜ í¬ê¸° 100: 12.45ì´ˆ
# ë°°ì¹˜ í¬ê¸° 500: 3.21ì´ˆ
# ë°°ì¹˜ í¬ê¸° 1000: 2.15ì´ˆ
# ë°°ì¹˜ í¬ê¸° 2000: 1.98ì´ˆ
# ë°°ì¹˜ í¬ê¸° 5000: 1.85ì´ˆ
# ë°°ì¹˜ í¬ê¸° 10000: 2.10ì´ˆ
#
# ìµœì  ë°°ì¹˜ í¬ê¸°: 5000 (ì†Œìš” ì‹œê°„: 1.85ì´ˆ)
```

**ì‹¤ë¬´ íŒ**:
- ì¼ë°˜ì ìœ¼ë¡œ 1000~5000 ì‚¬ì´ì—ì„œ ì‹œì‘
- ì‹¤í—˜ì„ í†µí•´ í™˜ê²½ì— ë§ëŠ” ìµœì ê°’ ì°¾ê¸°
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ ì„±ëŠ¥ì˜ ê· í˜• ê³ ë ¤

</details>

<details>
<summary><strong>Q7: Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ëœë¤ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?</strong></summary>

**A**: ì œí•œì ìœ¼ë¡œ ê°€ëŠ¥í•˜ì§€ë§Œ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëœë¤ ê°’ì„ ìƒì„±í•˜ì—¬ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- Redis LuaëŠ” ë¹„ê²°ì •ì  í•¨ìˆ˜(math.random ë“±) ì‚¬ìš©ì„ ì œí•œí•¨
- ë³µì œì™€ AOF ì¬ìƒ ì‹œ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•¨
- í•´ê²°ì±…: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëœë¤ ê°’ ìƒì„± í›„ ARGVë¡œ ì „ë‹¬

**ì˜ˆì‹œ**:
```lua
-- ì˜ëª»ëœ ë°©ë²• (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
-- math.random() ì§ì ‘ ì‚¬ìš©ì€ ì œí•œë¨

-- í•´ê²° ë°©ë²• 1: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëœë¤ ê°’ ì „ë‹¬
local random_value = tonumber(ARGV[1])  -- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•œ ëœë¤ ê°’
local key = 'random:' .. random_value
redis.call('SET', key, 'value')
return random_value

-- í•´ê²° ë°©ë²• 2: í˜„ì¬ ì‹œê°„ ê¸°ë°˜ ì˜ì‚¬ ëœë¤
local time_info = redis.call('TIME')
local seed = tonumber(time_info[2])  -- ë§ˆì´í¬ë¡œì´ˆ
local pseudo_random = (seed * 1103515245 + 12345) % 2147483648
return pseudo_random
```

```python
# Pythonì—ì„œ ëœë¤ ê°’ ì „ë‹¬
import redis
import random

r = redis.Redis()

# Lua ìŠ¤í¬ë¦½íŠ¸
script = """
local random_value = tonumber(ARGV[1])
local key = 'random:' .. random_value
redis.call('SET', key, 'value')
return random_value
"""

# í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëœë¤ ê°’ ìƒì„±
random_num = random.randint(1, 1000000)

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
result = r.eval(script, 0, random_num)
print(f"ëœë¤ ê°’: {result}")
```

**ì‹¤ë¬´ íŒ**:
- ëœë¤ ê°’ì´ í•„ìš”í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•˜ì—¬ ì „ë‹¬
- ì‹œê°„ ê¸°ë°˜ ì˜ì‚¬ ëœë¤ì€ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ë¯€ë¡œ ë³´ì•ˆì´ ì¤‘ìš”í•œ ê²½ìš° ì‚¬ìš© ê¸ˆì§€
- UUIDë‚˜ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ í™œìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ëŒ€ì•ˆ

</details>

<details>
<summary><strong>Q8: íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ GET ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê±´ ë¶„ê¸°ë¥¼ í•  ìˆ˜ ìˆë‚˜ìš”?</strong></summary>

**A**: ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ ë‚´ë¶€ì˜ ëª…ë ¹ì–´ëŠ” íì‰ë§Œ ë˜ê³  ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:
- MULTI ì´í›„ ëª…ë ¹ì–´ëŠ” QUEUED ìƒíƒœë¡œ ì €ì¥ë¨
- EXEC ì‹œì ì— ì¼ê´„ ì‹¤í–‰ë¨
- ì¤‘ê°„ ê²°ê³¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ

**í•´ê²°ì±…**:
1. WATCH + Python ì¡°ê±´ ë¶„ê¸°
2. Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

**ì˜ˆì‹œ**:
```python
# í•´ê²°ì±… 1: WATCH + Python ì¡°ê±´ ë¶„ê¸°
import redis

r = redis.Redis()

def conditional_update(key, new_value):
    """ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸ (WATCH ì‚¬ìš©)"""
    while True:
        # WATCHë¡œ í‚¤ ê°ì‹œ
        r.watch(key)

        # í˜„ì¬ ê°’ í™•ì¸ (íŠ¸ëœì­ì…˜ ë°–ì—ì„œ)
        current = r.get(key)
        if current is None:
            current = 0
        else:
            current = int(current)

        # ì¡°ê±´ í™•ì¸
        if new_value > current:
            try:
                pipe = r.pipeline()
                pipe.set(key, new_value)
                pipe.execute()
                return True, f"ì—…ë°ì´íŠ¸ ì„±ê³µ ({current} â†’ {new_value})"
            except redis.WatchError:
                continue
        else:
            r.unwatch()
            return False, f"ê°’ì´ ë” ì‘ìŒ (í˜„ì¬: {current}, ìƒˆë¡œìš´: {new_value})"
```

```lua
-- í•´ê²°ì±… 2: Lua ìŠ¤í¬ë¦½íŠ¸
local key = KEYS[1]
local new_value = tonumber(ARGV[1])

local current = redis.call('GET', key)
if current == false then
    current = 0
else
    current = tonumber(current)
end

if new_value > current then
    redis.call('SET', key, new_value)
    return {1, current, new_value}
else
    return {0, current, new_value}
end
```

**ì‹¤ë¬´ íŒ**:
- ê°„ë‹¨í•œ ì¡°ê±´: WATCH + Python
- ë³µì¡í•œ ì¡°ê±´: Lua ìŠ¤í¬ë¦½íŠ¸
- Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ë” íš¨ìœ¨ì ì´ê³  ì›ìì„± ë³´ì¥

</details>

---

## ğŸ’¼ ë©´ì ‘ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸

### ğŸ“˜ ì£¼ë‹ˆì–´/ì‹ ì… ê°œë°œììš©

<details>
<summary><strong>1. Redis íŠ¸ëœì­ì…˜ì˜ ê¸°ë³¸ ëª…ë ¹ì–´(MULTI, EXEC, DISCARD)ë¥¼ ì„¤ëª…í•˜ê³ , ê°ê°ì˜ ì—­í• ì„ ë§ì”€í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- MULTI: íŠ¸ëœì­ì…˜ ì‹œì‘, ì´í›„ ëª…ë ¹ì–´ë“¤ì´ íì— ì €ì¥ë¨
- EXEC: íì— ì €ì¥ëœ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ í•œ ë²ˆì— ì‹¤í–‰
- DISCARD: íì— ì €ì¥ëœ ëª…ë ¹ì–´ë“¤ì„ ëª¨ë‘ ì·¨ì†Œ

**ì˜ˆì‹œ ë‹µë³€**
> "Redis íŠ¸ëœì­ì…˜ì€ MULTI ëª…ë ¹ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. MULTIë¥¼ ì‹¤í–‰í•˜ë©´ ê·¸ ì´í›„ì˜ ëª¨ë“  ëª…ë ¹ì–´ë“¤ì´ ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šê³  íì— ì €ì¥ë©ë‹ˆë‹¤. EXEC ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ íì— ì €ì¥ëœ ëª¨ë“  ëª…ë ¹ì–´ê°€ í•œ ë²ˆì— ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ì¤‘ê°„ì— ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§Œì•½ íŠ¸ëœì­ì…˜ì„ ì·¨ì†Œí•˜ê³  ì‹¶ë‹¤ë©´ DISCARD ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ íì— ì €ì¥ëœ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ íê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: MULTI ì´í›„ EXEC ì—†ì´ ë‹¤ë¥¸ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
- A: ê³„ì†í•´ì„œ íì— ì €ì¥ë˜ê³ , EXECë¥¼ ì‹¤í–‰í•  ë•Œê¹Œì§€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- ì‹¤ë¬´ì—ì„œëŠ” ê³„ì¢Œ ì´ì²´, ì¬ê³  ì°¨ê° ë“± ì—¬ëŸ¬ ì‘ì—…ì„ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>2. íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì˜ ì°¨ì´ì ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- íŒŒì´í”„ë¼ì¸: ì„±ëŠ¥ ìµœì í™”(ë„¤íŠ¸ì›Œí¬ RTT ê°ì†Œ)ê°€ ëª©ì 
- íŠ¸ëœì­ì…˜: ì›ìì„± ë³´ì¥ì´ ëª©ì 
- íŒŒì´í”„ë¼ì¸ì€ ì¤‘ê°„ì— ë‹¤ë¥¸ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ìˆì§€ë§Œ, íŠ¸ëœì­ì…˜ì€ ë¶ˆê°€ëŠ¥
- íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì€ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥

**ì˜ˆì‹œ ë‹µë³€**
> "íŒŒì´í”„ë¼ì¸ì€ ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ í•œ ë²ˆì— ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì‹œê°„ì„ ì¤„ì´ëŠ” ì„±ëŠ¥ ìµœì í™” ê¸°ë²•ì…ë‹ˆë‹¤. ë°˜ë©´ íŠ¸ëœì­ì…˜ì€ ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ ì›ìì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì¤‘ê°„ì— ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ì§€ ëª»í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤. íŒŒì´í”„ë¼ì¸ì€ ì„±ëŠ¥ì´ ì¤‘ìš”í•  ë•Œ, íŠ¸ëœì­ì…˜ì€ ë°ì´í„° ì¼ê´€ì„±ì´ ì¤‘ìš”í•  ë•Œ ì‚¬ìš©í•˜ë©°, í•„ìš”ì— ë”°ë¼ ë‘ ê°€ì§€ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ì„¸ìš”.
- A: Python redis-pyì—ì„œ `r.pipeline(transaction=True)`ë¡œ íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- ëŒ€ëŸ‰ ë°ì´í„° ì‚½ì…ì€ íŒŒì´í”„ë¼ì¸, ê²°ì œ ì²˜ë¦¬ëŠ” íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>3. WATCH ëª…ë ¹ì–´ì˜ ì—­í• ê³¼ ë™ì‘ ì›ë¦¬ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- WATCHëŠ” ë‚™ê´€ì  ë½(Optimistic Locking) êµ¬í˜„
- í‚¤ë¥¼ ê°ì‹œí•˜ì—¬ íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì „ì— ê°’ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
- ê°’ì´ ë³€ê²½ë˜ì—ˆìœ¼ë©´ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ (EXECê°€ nil ë°˜í™˜)
- ë™ì‹œì„± ì œì–´ì— ì‚¬ìš©

**ì˜ˆì‹œ ë‹µë³€**
> "WATCHëŠ” Redisì˜ ë‚™ê´€ì  ë½ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. WATCHë¡œ í‚¤ë¥¼ ê°ì‹œí•˜ë©´, EXEC ì‹¤í–‰ ì‹œì ì— í•´ë‹¹ í‚¤ì˜ ê°’ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì¤‘ê°„ì— ê°’ì„ ë³€ê²½í–ˆë‹¤ë©´ íŠ¸ëœì­ì…˜ì´ ì‹¤íŒ¨í•˜ê³  EXECëŠ” nilì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ í•  ë•Œ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: WATCH ì¶©ëŒ ì‹œ ì–´ë–»ê²Œ ì¬ì‹œë„í•´ì•¼ í•˜ë‚˜ìš”?
- A: while ë£¨í”„ë¡œ ê°ì‹¸ì„œ WatchError ì˜ˆì™¸ ë°œìƒ ì‹œ ì¬ì‹œë„í•˜ë˜, ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- ì¬ê³  ì°¨ê°, ì¢‹ì•„ìš” ì¹´ìš´íŠ¸ ì¦ê°€ ë“± ë™ì‹œì„± ì œì–´ê°€ í•„ìš”í•œ ê²½ìš°ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>4. Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì¥ì ê³¼ ì‚¬ìš© ì‚¬ë¡€ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- ì›ìì„±: ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ê°€ í•˜ë‚˜ì˜ ì›ìì  ì—°ì‚°ìœ¼ë¡œ ì‹¤í–‰
- ì„±ëŠ¥: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ ê°ì†Œ
- ì¡°ê±´ ë¶„ê¸°: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì„œë²„ì—ì„œ ì‹¤í–‰
- ì‚¬ìš© ì‚¬ë¡€: ë ˆì´íŠ¸ ë¦¬ë¯¸í„°, ë¶„ì‚° ë½, ì¬ê³  ê´€ë¦¬

**ì˜ˆì‹œ ë‹µë³€**
> "Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” Redis ì„œë²„ì—ì„œ ì›ìì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ì£¼ìš” ì¥ì ì€ ì„¸ ê°€ì§€ì…ë‹ˆë‹¤. ì²«ì§¸, ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ê°€ í•˜ë‚˜ì˜ ì›ìì  ì—°ì‚°ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ì¤‘ê°„ì— ë‹¤ë¥¸ ëª…ë ¹ì–´ê°€ ë¼ì–´ë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‘˜ì§¸, ì—¬ëŸ¬ Redis ëª…ë ¹ì–´ë¥¼ ì¡°í•©í•  ë•Œ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì—†ì´ ì„œë²„ì—ì„œ ë°”ë¡œ ì‹¤í–‰ë˜ì–´ ì„±ëŠ¥ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤. ì…‹ì§¸, ì¡°ê±´ ë¶„ê¸°ë‚˜ ë°˜ë³µë¬¸ ë“± ë³µì¡í•œ ë¡œì§ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ë¬´ì—ì„œëŠ” ë ˆì´íŠ¸ ë¦¬ë¯¸í„°, ë¶„ì‚° ë½, ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ ë“±ì—ì„œ í™œìš©ë©ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: EVALê³¼ EVALSHAì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?
- A: EVALì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì „ë‹¬í•˜ê³ , EVALSHAëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•œ í›„ SHA í•´ì‹œë¡œ ì‹¤í–‰í•˜ì—¬ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- API ìš”ì²­ íšŸìˆ˜ ì œí•œ, ë™ì‹œ ì ‘ê·¼ ì œì–´ ë“± ë³µì¡í•œ ë¡œì§ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>5. íŒŒì´í”„ë¼ì¸ ì‚¬ìš© ì‹œ ë°°ì¹˜ í¬ê¸°ë¥¼ ì–´ë–»ê²Œ ì •í•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- ì¼ë°˜ì ìœ¼ë¡œ 1000~5000ê°œê°€ ì ì ˆ
- ë„ˆë¬´ ì‘ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì™•ë³µì´ ë§ì•„ì§
- ë„ˆë¬´ í¬ë©´ ë©”ëª¨ë¦¬ ë¶€ì¡±, íƒ€ì„ì•„ì›ƒ ë°œìƒ
- í™˜ê²½ì— ë”°ë¼ ì‹¤í—˜ì„ í†µí•´ ìµœì ê°’ ì°¾ê¸°

**ì˜ˆì‹œ ë‹µë³€**
> "íŒŒì´í”„ë¼ì¸ì˜ ë°°ì¹˜ í¬ê¸°ëŠ” ì¼ë°˜ì ìœ¼ë¡œ 1000~5000ê°œ ì‚¬ì´ê°€ ì ì ˆí•©ë‹ˆë‹¤. ë°°ì¹˜ í¬ê¸°ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ê°€ ì¦ê°€í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ íš¨ê³¼ê°€ ì¤„ì–´ë“¤ê³ , ë„ˆë¬´ í¬ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê³  íƒ€ì„ì•„ì›ƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì ê°’ì€ ë°ì´í„° í¬ê¸°, ë„¤íŠ¸ì›Œí¬ í™˜ê²½, ì„œë²„ ì„±ëŠ¥ì— ë”°ë¼ ë‹¤ë¥´ë¯€ë¡œ ì‹¤í—˜ì„ í†µí•´ í™˜ê²½ì— ë§ëŠ” ë°°ì¹˜ í¬ê¸°ë¥¼ ì°¾ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: 100ë§Œ ê°œì˜ ë°ì´í„°ë¥¼ ì‚½ì…í•  ë•Œ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?
- A: ë°°ì¹˜ í¬ê¸°(ì˜ˆ: 5000)ë¡œ ë‚˜ëˆ„ì–´ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ê³ , ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- ëŒ€ëŸ‰ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜, ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹œ ì‚¬ìš©ë©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>6. Redis íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ì„ ì§€ì›í•˜ë‚˜ìš”?</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- ë¬¸ë²• ì—ëŸ¬: ì „ì²´ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ (ìœ ì‚¬ ë¡¤ë°±)
- ëŸ°íƒ€ì„ ì—ëŸ¬: ì—ëŸ¬ ë‚œ ëª…ë ¹ì–´ë§Œ ì‹¤íŒ¨, ë‚˜ë¨¸ì§€ëŠ” ì •ìƒ ì‹¤í–‰ (ë¡¤ë°± ì—†ìŒ)
- ì „í†µì ì¸ RDBMSì˜ ë¡¤ë°±ê³¼ëŠ” ë‹¤ë¦„
- ëŒ€ì•ˆ: Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ì „ ê²€ì¦

**ì˜ˆì‹œ ë‹µë³€**
> "Redis íŠ¸ëœì­ì…˜ì€ ì „í†µì ì¸ RDBMSì˜ ë¡¤ë°±ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë™ì‘í•©ë‹ˆë‹¤. ëª…ë ¹ì–´ ë¬¸ë²• ì—ëŸ¬ê°€ ìˆìœ¼ë©´ ì „ì²´ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ, ëŸ°íƒ€ì„ ì—ëŸ¬(ì˜ˆ: ë¬¸ìì—´ì— INCR ì‹¤í–‰)ê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ê°€ ë‚œ ëª…ë ¹ì–´ë§Œ ì‹¤íŒ¨í•˜ê³  ë‚˜ë¨¸ì§€ ëª…ë ¹ì–´ëŠ” ì •ìƒ ì‹¤í–‰ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì¤‘ìš”í•œ ì‘ì—…ì€ Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ì „ ê²€ì¦ì„ ìˆ˜í–‰í•˜ê±°ë‚˜, WATCHë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?
- A: íŠ¸ëœì­ì…˜ ì „ì— ë°ì´í„° íƒ€ì…ê³¼ ê°’ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê±°ë‚˜, Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- ê²°ì œ ì‹œìŠ¤í…œì—ì„œëŠ” Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì”ì•¡ í™•ì¸ í›„ ì°¨ê°í•˜ì—¬ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>7. Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ KEYSì™€ ARGVì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- KEYS: Redis í‚¤ë¥¼ ì „ë‹¬, í´ëŸ¬ìŠ¤í„° ë¼ìš°íŒ…ì— ì‚¬ìš©
- ARGV: ê°’ì´ë‚˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬
- KEYSëŠ” ë°˜ë“œì‹œ í‚¤ë§Œ ì „ë‹¬í•´ì•¼ í•¨ (í´ëŸ¬ìŠ¤í„° í™˜ê²½)
- ARGVëŠ” ì–´ë–¤ ê°’ì´ë“  ì „ë‹¬ ê°€ëŠ¥

**ì˜ˆì‹œ ë‹µë³€**
> "Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ KEYSëŠ” Redis í‚¤ë¥¼ ì „ë‹¬í•˜ëŠ” ë°°ì—´ì´ê³ , ARGVëŠ” ê°’ì´ë‚˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë°°ì—´ì…ë‹ˆë‹¤. ê°€ì¥ í° ì°¨ì´ì ì€ Redis í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ KEYS ë°°ì—´ì„ ë¶„ì„í•˜ì—¬ ì–´ëŠ ë…¸ë“œì— í‚¤ê°€ ìˆëŠ”ì§€ íŒë‹¨í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ í‚¤ëŠ” ë°˜ë“œì‹œ KEYSë¡œ ì „ë‹¬í•´ì•¼ í•˜ë©°, ARGVë¡œ í‚¤ë¥¼ ì „ë‹¬í•˜ë©´ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì˜¬ë°”ë¥´ê²Œ ë¼ìš°íŒ…ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ARGVëŠ” ìˆ«ì, ë¬¸ìì—´ ë“± ì–´ë–¤ ê°’ì´ë“  ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: KEYSë¥¼ ARGVë¡œ ì˜ëª» ì „ë‹¬í•˜ë©´ ì–´ë–¤ ì—ëŸ¬ê°€ ë°œìƒí•˜ë‚˜ìš”?
- A: í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ "CROSSSLOT Keys in request don't hash to the same slot" ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì—°ê´€**
- í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ë°˜ë“œì‹œ KEYSì™€ ARGVë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

</details>

---

### ğŸ“— ì¤‘ê¸‰ ê°œë°œììš©

<details>
<summary><strong>1. Redis í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ íŠ¸ëœì­ì…˜ê³¼ Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- ëª¨ë“  í‚¤ê°€ ê°™ì€ í•´ì‹œ ìŠ¬ë¡¯ì— ìˆì–´ì•¼ í•¨
- í•´ì‹œ íƒœê·¸ ì‚¬ìš© (ì˜ˆ: {user:1000}:name, {user:1000}:email)
- KEYS ë°°ì—´ë¡œ í‚¤ë¥¼ ì „ë‹¬í•´ì•¼ ì˜¬ë°”ë¥¸ ë…¸ë“œë¡œ ë¼ìš°íŒ…
- ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì¹œ íŠ¸ëœì­ì…˜ì€ ë¶ˆê°€ëŠ¥

**ì˜ˆì‹œ ë‹µë³€**
> "Redis í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œëŠ” íŠ¸ëœì­ì…˜ì´ë‚˜ Lua ìŠ¤í¬ë¦½íŠ¸ì— í¬í•¨ëœ ëª¨ë“  í‚¤ê°€ ê°™ì€ í•´ì‹œ ìŠ¬ë¡¯ì— ìœ„ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ í•´ì‹œ íƒœê·¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ '{user:1000}:name'ê³¼ '{user:1000}:email'ì€ ì¤‘ê´„í˜¸ ì•ˆì˜ 'user:1000'ì„ ê¸°ì¤€ìœ¼ë¡œ í•´ì‹œ ìŠ¬ë¡¯ì´ ê²°ì •ë˜ì–´ ê°™ì€ ë…¸ë“œì— ì €ì¥ë©ë‹ˆë‹¤. ë˜í•œ Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” í‚¤ë¥¼ KEYS ë°°ì—´ë¡œ ì „ë‹¬í•´ì•¼ í´ëŸ¬ìŠ¤í„°ê°€ ì˜¬ë°”ë¥¸ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì¹œ íŠ¸ëœì­ì…˜ì€ Redis í´ëŸ¬ìŠ¤í„°ì—ì„œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì„¤ê³„ ë‹¨ê³„ì—ì„œ ì´ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: í•´ì‹œ íƒœê·¸ ì—†ì´ ì—¬ëŸ¬ í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
- A: "CROSSSLOT Keys in request don't hash to the same slot" ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì˜ˆì‹œ**
```lua
-- ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (í´ëŸ¬ìŠ¤í„° í™˜ê²½)
local user_id = ARGV[1]
local name_key = '{user:' .. user_id .. '}:name'
local email_key = '{user:' .. user_id .. '}:email'

redis.call('SET', name_key, ARGV[2])
redis.call('SET', email_key, ARGV[3])
return {name_key, email_key}
```

**ì‹¤ë¬´ ì—°ê´€**
- ëŒ€ê·œëª¨ ì„œë¹„ìŠ¤ì—ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¬ìš©í•  ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ì‚¬í•­ì…ë‹ˆë‹¤.

</details>

<details>
<summary><strong>2. ë¶„ì‚° ë½ êµ¬í˜„ ì‹œ ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ê³¼ Redlock ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- ê¸°ë³¸ ë¶„ì‚° ë½: SET NX PX ì‚¬ìš©
- ë½ í•´ì œ ì‹œ ì†Œìœ ì í™•ì¸ í•„ìš” (Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©)
- Redlock: ì—¬ëŸ¬ Redis ì¸ìŠ¤í„´ìŠ¤ì— ë½ íšë“í•˜ì—¬ ì•ˆì •ì„± í–¥ìƒ
- ê³¼ë°˜ìˆ˜ ì´ìƒì—ì„œ ë½ íšë“ ì‹œ ì„±ê³µ
- TTL ì„¤ì •ìœ¼ë¡œ ë°ë“œë½ ë°©ì§€

**ì˜ˆì‹œ ë‹µë³€**
> "ë¶„ì‚° ë½ì„ êµ¬í˜„í•  ë•ŒëŠ” ë¨¼ì € 'SET key value PX milliseconds NX' ëª…ë ¹ìœ¼ë¡œ ë½ì„ íšë“í•©ë‹ˆë‹¤. ë½ì„ í•´ì œí•  ë•ŒëŠ” Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ í˜„ì¬ ë½ì˜ ì†Œìœ ìë¥¼ í™•ì¸í•œ í›„ ì‚­ì œí•´ì•¼ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ë½ì„ ì‹¤ìˆ˜ë¡œ í•´ì œí•˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ì¼ Redis ì¸ìŠ¤í„´ìŠ¤ì—ì„œëŠ” ì¥ì•  ì‹œ ë½ì´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, Redlock ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ Redis ì¸ìŠ¤í„´ìŠ¤(ì¼ë°˜ì ìœ¼ë¡œ 5ê°œ)ì— ë™ì‹œì— ë½ì„ íšë“í•˜ê³ , ê³¼ë°˜ìˆ˜ ì´ìƒì—ì„œ ì„±ê³µí•˜ë©´ ë½ íšë“ìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤. TTLì„ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë¹„ì •ìƒ ì¢…ë£Œë˜ì–´ë„ ì¼ì • ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ë½ì´ í•´ì œë˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: Redlockì˜ ë‹¨ì ì€ ë¬´ì—‡ì¸ê°€ìš”?
- A: ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ì™€ í†µì‹ í•´ì•¼ í•˜ë¯€ë¡œ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ê³ , êµ¬í˜„ ë³µì¡ë„ê°€ ë†’ìŠµë‹ˆë‹¤.

**ì‹¤ë¬´ ì˜ˆì‹œ**
```python
# ì•ˆì „í•œ ë½ í•´ì œ ìŠ¤í¬ë¦½íŠ¸
unlock_script = """
local lock_key = KEYS[1]
local identifier = ARGV[1]

if redis.call('GET', lock_key) == identifier then
    return redis.call('DEL', lock_key)
else
    return 0
end
"""
```

**ì‹¤ë¬´ ì—°ê´€**
- ì¤‘ë³µ ì‘ì—… ë°©ì§€, í¬ë¡  ì¡ ë™ê¸°í™”, ë¶„ì‚° í™˜ê²½ì—ì„œì˜ ìì› ì ‘ê·¼ ì œì–´ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>3. Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì„±ëŠ¥ ìµœì í™” ë°©ë²•ê³¼ ì£¼ì˜ì‚¬í•­ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- SCRIPT LOADë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ì „ ë¡œë“œ
- EVALSHAë¡œ ì‹¤í–‰í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ì „ì†¡ëŸ‰ ê°ì†Œ
- ìŠ¤í¬ë¦½íŠ¸ëŠ” ì§§ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±
- ë¬´í•œ ë£¨í”„ ë°©ì§€ (lua-time-limit ì„¤ì •)
- ë¹„ê²°ì •ì  í•¨ìˆ˜(random) ì‚¬ìš© ì œí•œ

**ì˜ˆì‹œ ë‹µë³€**
> "Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì„±ëŠ¥ì„ ìµœì í™”í•˜ë ¤ë©´ ë¨¼ì € SCRIPT LOADë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ Redis ì„œë²„ì— ë¯¸ë¦¬ ë¡œë“œí•˜ê³ , EVALSHAë¡œ SHA í•´ì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ë©´ ë§¤ë²ˆ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì „ì†¡í•˜ì§€ ì•Šì•„ ë„¤íŠ¸ì›Œí¬ ì „ì†¡ëŸ‰ì´ ê°ì†Œí•©ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ëŠ” ê°€ëŠ¥í•œ ì§§ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì—¬ ì‹¤í–‰ ì‹œê°„ì„ ìµœì†Œí™”í•´ì•¼ í•˜ë©°, ë¬´í•œ ë£¨í”„ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°˜ë³µë¬¸ì— ìµœëŒ€ íšŸìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. RedisëŠ” lua-time-limit ì„¤ì •ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œê°„ì„ ì œí•œí•˜ë¯€ë¡œ, ë³µì¡í•œ ì‘ì—…ì€ ì—¬ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë˜í•œ ë¹„ê²°ì •ì  í•¨ìˆ˜(math.random ë“±)ëŠ” ë³µì œì™€ AOF ì¬ìƒ ì‹œ ì¼ê´€ì„± ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê°’ì„ ìƒì„±í•˜ì—¬ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: lua-time-limitì„ ì´ˆê³¼í•˜ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
- A: SCRIPT KILLë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°•ì œ ì¢…ë£Œí•  ìˆ˜ ìˆì§€ë§Œ, ì“°ê¸° ì‘ì—…ì´ ìˆì—ˆë‹¤ë©´ ì¢…ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

**ì‹¤ë¬´ ì˜ˆì‹œ**
```python
# ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ë° ì¬ì‚¬ìš©
import redis

r = redis.Redis()

script = """
local key = KEYS[1]
local increment = tonumber(ARGV[1])
return redis.call('INCRBY', key, increment)
"""

# ìŠ¤í¬ë¦½íŠ¸ ë“±ë¡
increment_script = r.register_script(script)

# SHAë¡œ ì‹¤í–‰ (íš¨ìœ¨ì )
result = increment_script(keys=['counter'], args=[5])
```

**ì‹¤ë¬´ ì—°ê´€**
- ê³ ì„±ëŠ¥ APIì—ì„œ Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬ ì‘ë‹µ ì‹œê°„ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>4. ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì˜ ì¡°í•© ì „ëµì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ê°ì†Œ
- íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì›ìì„± ë³´ì¥
- ë°°ì¹˜ í¬ê¸° ìµœì í™” (1000~5000)
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§
- ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§

**ì˜ˆì‹œ ë‹µë³€**
> "ëŒ€ëŸ‰ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ê³¼ ë°ì´í„° ì¼ê´€ì„±ì„ ëª¨ë‘ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Python redis-pyì—ì„œëŠ” `r.pipeline(transaction=True)`ë¡œ íŒŒì´í”„ë¼ì¸ê³¼ íŠ¸ëœì­ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ í¬ê¸°ëŠ” 1000~5000ê°œë¡œ ì„¤ì •í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ ì„±ëŠ¥ì˜ ê· í˜•ì„ ë§ì¶”ê³ , ê° ë°°ì¹˜ë§ˆë‹¤ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ì—¬ ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤. ì—ëŸ¬ ë°œìƒ ì‹œ ì¬ì‹œë„ ë¡œì§ì„ êµ¬í˜„í•˜ê³ , ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì„¤ì •í•˜ì—¬ ë¬´í•œ ë£¨í”„ë¥¼ ë°©ì§€í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ ì¤‘ìš”í•œ ì‘ì—…ì€ ë¡œê·¸ë¥¼ ë‚¨ê²¨ ì¶”ì  ê°€ëŠ¥í•˜ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: 100ë§Œ ê±´ì˜ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì‚½ì…í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- A: ë°°ì¹˜ í¬ê¸° 5000ìœ¼ë¡œ ë‚˜ëˆ„ì–´ 200ë²ˆ ì‹¤í–‰í•˜ë©°, ê° ë°°ì¹˜ë§ˆë‹¤ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ë¡œê¹…í•˜ê³  ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„í•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì˜ˆì‹œ**
```python
import redis

r = redis.Redis()

def bulk_insert_with_transaction(data_generator, batch_size=5000):
    """ëŒ€ëŸ‰ ë°ì´í„° ì•ˆì „ ì‚½ì…"""
    total = 0

    while True:
        pipe = r.pipeline(transaction=True)
        batch = []

        # ë°°ì¹˜ í¬ê¸°ë§Œí¼ ë°ì´í„° ìˆ˜ì§‘
        for _ in range(batch_size):
            try:
                item = next(data_generator)
                batch.append(item)
            except StopIteration:
                break

        if not batch:
            break

        # íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë°°ì¹˜ ì‹¤í–‰
        pipe.multi()
        for key, value in batch:
            pipe.set(key, value)

        try:
            pipe.execute()
            total += len(batch)
            print(f"ì²˜ë¦¬ë¨: {total}ê±´")
        except Exception as e:
            print(f"ì—ëŸ¬ ë°œìƒ: {e}")
            # ì¬ì‹œë„ ë¡œì§...

    return total
```

**ì‹¤ë¬´ ì—°ê´€**
- ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜, ì´ˆê¸° ë°ì´í„° ë¡œë“œ, ë°°ì¹˜ ì‘ì—…ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

</details>

<details>
<summary><strong>5. Redis íŠ¸ëœì­ì…˜ê³¼ Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì„±ëŠ¥ ì°¨ì´ì™€ ì„ íƒ ê¸°ì¤€ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</strong></summary>

**ëª¨ë²” ë‹µì•ˆ í¬ì¸íŠ¸**
- Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ì¼ë°˜ì ìœ¼ë¡œ ë” ë¹ ë¦„ (ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì—†ìŒ)
- íŠ¸ëœì­ì…˜ì€ WATCH ì‚¬ìš© ì‹œ ì¬ì‹œë„ ì˜¤ë²„í—¤ë“œ ë°œìƒ
- ì¡°ê±´ ë¶„ê¸°ê°€ í•„ìš”í•˜ë©´ Lua ìŠ¤í¬ë¦½íŠ¸ í•„ìˆ˜
- ê°„ë‹¨í•œ ì‘ì—…ì€ íŠ¸ëœì­ì…˜, ë³µì¡í•œ ë¡œì§ì€ Lua ìŠ¤í¬ë¦½íŠ¸

**ì˜ˆì‹œ ë‹µë³€**
> "ì„±ëŠ¥ ì¸¡ë©´ì—ì„œëŠ” Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ì¼ë°˜ì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤. Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„œë²„ì—ì„œ í•œ ë²ˆì— ì‹¤í–‰ë˜ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ ì™•ë³µì´ ì—†ì§€ë§Œ, WATCHë¥¼ ì‚¬ìš©í•˜ëŠ” íŠ¸ëœì­ì…˜ì€ ì¶©ëŒ ì‹œ ì¬ì‹œë„ë¡œ ì¸í•œ ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•©ë‹ˆë‹¤. ì„ íƒ ê¸°ì¤€ì€ ë³µì¡ë„ì™€ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ê°„ë‹¨í•œ ì›ìì  ì‘ì—…(ì—¬ëŸ¬ SET ëª…ë ¹)ì€ íŠ¸ëœì­ì…˜ìœ¼ë¡œë„ ì¶©ë¶„í•˜ì§€ë§Œ, ì¡°ê±´ ë¶„ê¸°ë‚˜ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í•„ìš”í•˜ë©´ Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” í•œ ë²ˆ ë¡œë“œí•˜ë©´ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ë°˜ë³µì ì¸ ì‘ì—…ì—ì„œ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤."

**ê¼¬ë¦¬ ì§ˆë¬¸**
- Q: WATCHë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê°„ë‹¨í•œ íŠ¸ëœì­ì…˜ê³¼ Lua ìŠ¤í¬ë¦½íŠ¸ì˜ ì„±ëŠ¥ ì°¨ì´ëŠ”?
- A: í° ì°¨ì´ëŠ” ì—†ì§€ë§Œ, Lua ìŠ¤í¬ë¦½íŠ¸ê°€ ì•½ê°„ ë” ë¹ ë¥´ê³  ì½”ë“œê°€ ê°„ê²°í•©ë‹ˆë‹¤.

**ì‹¤ë¬´ ì˜ˆì‹œ**
| ì‘ì—… | ì¶”ì²œ ë°©ë²• | ì´ìœ  |
|------|-----------|------|
| ì—¬ëŸ¬ í‚¤ ì¼ê´„ ì €ì¥ | íŠ¸ëœì­ì…˜ | ê°„ë‹¨í•˜ê³  ì¶©ë¶„í•¨ |
| ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸ | Lua ìŠ¤í¬ë¦½íŠ¸ | ì¡°ê±´ ë¶„ê¸° í•„ìš” |
| ì¬ê³  ì°¨ê° | Lua ìŠ¤í¬ë¦½íŠ¸ | ì¬ê³  í™•ì¸ + ì°¨ê° ì›ìì„± |
| ë ˆì´íŠ¸ ë¦¬ë¯¸í„° | Lua ìŠ¤í¬ë¦½íŠ¸ | ë³µì¡í•œ ì‹œê°„ ìœˆë„ìš° ê³„ì‚° |

**ì‹¤ë¬´ ì—°ê´€**
- API ì„±ëŠ¥ ìµœì í™”, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ ì‹œ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•©ë‹ˆë‹¤.

</details>

---

## ğŸ“ í•µì‹¬ ì •ë¦¬

### ì´ ì¥ì—ì„œ ë°°ìš´ í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… | í•µì‹¬ í‚¤ì›Œë“œ |
|------|------|-------------|
| íŠ¸ëœì­ì…˜ | ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ ì›ìì ìœ¼ë¡œ ì‹¤í–‰ | MULTI, EXEC, WATCH, ì›ìì„± |
| íŒŒì´í”„ë¼ì¸ | ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì‹œê°„ ìµœì†Œí™” | RTT ê°ì†Œ, ì„±ëŠ¥ ìµœì í™”, ë°°ì¹˜ ì²˜ë¦¬ |
| Lua ìŠ¤í¬ë¦½íŠ¸ | ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì›ìì  ìŠ¤í¬ë¦½íŠ¸ | EVAL, EVALSHA, ì¡°ê±´ ë¶„ê¸°, ë³µì¡í•œ ë¡œì§ |
| WATCH | ë‚™ê´€ì  ë½ êµ¬í˜„ | ë™ì‹œì„± ì œì–´, Race Condition ë°©ì§€ |
| ë¶„ì‚° ë½ | ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ì˜ ìì› ì ‘ê·¼ ì œì–´ | SET NX PX, Redlock, ì¤‘ë³µ ë°©ì§€ |

### í•„ìˆ˜ ëª…ë ¹ì–´/ì½”ë“œ ì •ë¦¬

| ëª…ë ¹ì–´/ì½”ë“œ | ìš©ë„ | ì˜ˆì‹œ |
|-------------|------|------|
| MULTI | íŠ¸ëœì­ì…˜ ì‹œì‘ | `MULTI` |
| EXEC | íŠ¸ëœì­ì…˜ ì‹¤í–‰ | `EXEC` |
| WATCH | í‚¤ ê°ì‹œ | `WATCH mykey` |
| EVAL | Lua ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ | `EVAL "return 'hello'" 0` |
| SCRIPT LOAD | ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ | `SCRIPT LOAD "script..."` |
| pipeline() | íŒŒì´í”„ë¼ì¸ ìƒì„± | `r.pipeline()` |

### ì‹¤ë¬´ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

#### í•´ì•¼ í•  ê²ƒ
- [x] WATCHë¡œ ë™ì‹œì„± ë¬¸ì œë¥¼ ë°©ì§€í•˜ì„¸ìš”
- [x] íŒŒì´í”„ë¼ì¸ ë°°ì¹˜ í¬ê¸°ë¥¼ 1000~5000ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”
- [x] Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” SCRIPT LOADë¡œ ë¯¸ë¦¬ ë¡œë“œí•˜ì„¸ìš”
- [x] ë¶„ì‚° ë½ í•´ì œ ì‹œ ì†Œìœ ìë¥¼ í™•ì¸í•˜ì„¸ìš”
- [x] ì¬ì‹œë„ ë¡œì§ì— ìµœëŒ€ íšŸìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”

#### í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ
- [x] ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ì§€ ì•Šì€ ì±„ íŠ¸ëœì­ì…˜ ì‹¤í–‰
- [x] íŒŒì´í”„ë¼ì¸ì„ ë„ˆë¬´ í° ë°°ì¹˜ë¡œ ì‹¤í–‰ (ë©”ëª¨ë¦¬ ë¶€ì¡±)
- [x] Lua ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¬´í•œ ë£¨í”„ ì‘ì„±
- [x] KEYSì™€ ARGVë¥¼ ì˜ëª» ì‚¬ìš© (í´ëŸ¬ìŠ¤í„° í™˜ê²½)
- [x] íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ì¡°ê±´ ë¶„ê¸° ì‹œë„

### ì„±ëŠ¥/ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ì„±ëŠ¥
- [x] íŒŒì´í”„ë¼ì¸ ë°°ì¹˜ í¬ê¸° ìµœì í™”
- [x] Lua ìŠ¤í¬ë¦½íŠ¸ ì‚¬ì „ ë¡œë“œ (SCRIPT LOAD)
- [x] WATCH ì¬ì‹œë„ íšŸìˆ˜ ì œí•œ
- [x] ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ ìµœì†Œí™”

#### ë³´ì•ˆ
- [x] ë¶„ì‚° ë½ ì†Œìœ ì í™•ì¸
- [x] TTL ì„¤ì •ìœ¼ë¡œ ë°ë“œë½ ë°©ì§€
- [x] ì¬ê³  ì˜¤ë²„ì…€ë§ ë°©ì§€
- [x] Race Condition ì°¨ë‹¨

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ë‹¤ìŒ ì¥ ë¯¸ë¦¬ë³´ê¸°: Redis 10ì¥ - Pub/Subê³¼ ìŠ¤íŠ¸ë¦¼
- **ë°°ìš¸ ë‚´ìš© 1**: Redis Pub/Sub ë©”ì‹œì§• ì‹œìŠ¤í…œ
- **ë°°ìš¸ ë‚´ìš© 2**: Redis Streamì„ ì´ìš©í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬
- **ë°°ìš¸ ë‚´ìš© 3**: ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•
- **ì‹¤ì „ í”„ë¡œì íŠ¸**: ì‹¤ì‹œê°„ ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜

### ì´ ì¥ê³¼ì˜ ì—°ê²°ì 
```
09ì¥: íŠ¸ëœì­ì…˜, íŒŒì´í”„ë¼ì¸, ìŠ¤í¬ë¦½íŠ¸
    â†“
10ì¥: Pub/Subê³¼ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬
    â†“
ìµœì¢…ì ìœ¼ë¡œ: ê³ ì„±ëŠ¥ ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•
```

### ì¤€ë¹„í•˜ë©´ ì¢‹ì„ ê²ƒë“¤
```bash
# Redis ìŠ¤íŠ¸ë¦¼ í™œì„±í™” í™•ì¸
redis-cli INFO stream

# Pub/Sub í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„
redis-cli SUBSCRIBE test_channel
```

---

## ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!

**ì´ì œ ì—¬ëŸ¬ë¶„ì€**:
- âœ… Redis íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ëŒ€ëŸ‰ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… ë¶„ì‚° ë½ìœ¼ë¡œ ì¤‘ë³µ ì‘ì—…ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… ì‹¤ë¬´ì—ì„œ ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

**ë‹¤ìŒ ë‹¨ê³„**:
- [x] ë‹¤ìŒ ì¥(Redis Pub/Sub)ìœ¼ë¡œ ì§„í–‰
- [x] ì‹¤ì „ í”„ë¡œì íŠ¸ í™•ì¥ (ëŒ€ì‹œë³´ë“œ, ì•Œë¦¼ ì‹œìŠ¤í…œ)
- [x] ë©´ì ‘ ì§ˆë¬¸ ë³µìŠµ ë° ë‹µë³€ ì—°ìŠµ

---

**ë‹¤ìŒ ì¥ìœ¼ë¡œ ì´ë™**: [ë‹¤ìŒ: 10ì¥ Pub/Subê³¼ ìŠ¤íŠ¸ë¦¼ â†’](10-pubsub-stream.md)

**ì´ì „ ì¥ìœ¼ë¡œ ëŒì•„ê°€ê¸°**: [â† ì´ì „: 08ì¥ ë³´ì•ˆ â†’](08-security.md)

**ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°**: [ğŸ“š ì „ì²´ ëª©ì°¨](README.md)
