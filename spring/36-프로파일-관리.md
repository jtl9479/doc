# 36ì¥: í”„ë¡œíŒŒì¼ ê´€ë¦¬

**ğŸ“š í•™ìŠµ ëª©í‘œ**
- Spring Boot í”„ë¡œíŒŒì¼ì˜ ê°œë…ê³¼ í•„ìš”ì„±ì„ ì´í•´í•©ë‹ˆë‹¤
- í”„ë¡œíŒŒì¼ í™œì„±í™” ë°©ë²•ì„ ë‹¤ì–‘í•˜ê²Œ ìµí™ë‹ˆë‹¤
- í”„ë¡œíŒŒì¼ë³„ ì„¤ì • íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ìŠµë“í•©ë‹ˆë‹¤
- @Profile ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì¡°ê±´ë¶€ ë¹ˆì„ ë“±ë¡í•©ë‹ˆë‹¤
- ì‹¤ë¬´ í™˜ê²½ë³„ í”„ë¡œíŒŒì¼ ì „ëµì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤

**â±ï¸ ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: 3-4ì‹œê°„
**ğŸ“Š ë‚œì´ë„**: â­â­â­ (ì¤‘ê¸‰)

---

## ì™œ í”„ë¡œíŒŒì¼ ê´€ë¦¬ê°€ í•„ìš”í•œê°€?

ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê°œë°œ(dev), ìŠ¤í…Œì´ì§•(staging), ìš´ì˜(prod) ë“± ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ê° í™˜ê²½ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ URL, ë¡œê·¸ ë ˆë²¨, API ì—”ë“œí¬ì¸íŠ¸ ë“± ì„¤ì • ê°’ì´ ë‹¤ë¦…ë‹ˆë‹¤.

**í”„ë¡œíŒŒì¼ ì—†ì´ í™˜ê²½ë³„ ì„¤ì •ì„ ê´€ë¦¬í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ**:
```java
// âŒ í•˜ë“œì½”ë”© ë˜ëŠ” ë§¤ë²ˆ ìˆ˜ë™ ë³€ê²½
@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        // ìš´ì˜ ë°°í¬ ì „ì— ë§¤ë²ˆ ì£¼ì„ ë³€ê²½ í•„ìš”
        // return devDataSource();
        return prodDataSource(); // ì‹¤ìˆ˜ë¡œ dev ì„¤ì •ìœ¼ë¡œ ë°°í¬í•˜ë©´ ëŒ€ì°¸ì‚¬!
    }
}
```

**í”„ë¡œíŒŒì¼ì„ ì‚¬ìš©í•˜ë©´**:
```yaml
# application-dev.yml (ìë™ìœ¼ë¡œ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©)
spring:
  datasource:
    url: jdbc:h2:mem:devdb

# application-prod.yml (ìë™ìœ¼ë¡œ ìš´ì˜ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©)
spring:
  datasource:
    url: jdbc:mysql://prod-server:3306/proddb
```

**Spring Boot í”„ë¡œíŒŒì¼ì˜ í•µì‹¬ ê°€ì¹˜**:
- âœ… **í™˜ê²½ ë¶„ë¦¬**: ê°œë°œ/ìŠ¤í…Œì´ì§•/ìš´ì˜ ì„¤ì •ì„ ëª…í™•íˆ ë¶„ë¦¬
- âœ… **ìë™ ì ìš©**: í™œì„± í”„ë¡œíŒŒì¼ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì„¤ì • ë¡œë“œ
- âœ… **ì•ˆì „ì„±**: í™˜ê²½ë³„ ì‹¤ìˆ˜ ë°©ì§€ (dev ì„¤ì •ìœ¼ë¡œ prod ë°°í¬ ë¶ˆê°€)
- âœ… **ìœ ì—°ì„±**: ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ì„ ë™ì‹œ í™œì„±í™” ê°€ëŠ¥
- âœ… **ì¡°ê±´ë¶€ ë¹ˆ**: í™˜ê²½ì— ë”°ë¼ ë‹¤ë¥¸ êµ¬í˜„ì²´ ìë™ ì£¼ì…

---

## ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ëŠ” í”„ë¡œíŒŒì¼

### 1. ìë™ì°¨ ì£¼í–‰ ëª¨ë“œ (ë“œë¼ì´ë¸Œ ëª¨ë“œ ì„ íƒ)

í˜„ëŒ€ ìë™ì°¨ì—ëŠ” **ì—ì½”/ìŠ¤í¬ì¸ /ì»´í¬íŠ¸ ëª¨ë“œ**ê°€ ìˆìŠµë‹ˆë‹¤.

```java
// ğŸš— ìë™ì°¨ ì£¼í–‰ ëª¨ë“œ
class Car {
    void setDriveMode(String mode) {
        switch(mode) {
            case "ECO":    // ì—°ë¹„ ìš°ì„ , ì¶œë ¥ ì œí•œ
            case "SPORT":  // ì„±ëŠ¥ ìš°ì„ , ì—°ë£Œ ì†Œë¹„ ì¦ê°€
            case "COMFORT": // ê· í˜• ëª¨ë“œ
        }
    }
}

// ğŸŒ± Spring Boot í”„ë¡œíŒŒì¼
@Profile("dev")    // ê°œë°œ: ë¹ ë¥¸ ì¬ì‹œì‘, H2 ì¸ë©”ëª¨ë¦¬ DB
@Profile("prod")   // ìš´ì˜: ì„±ëŠ¥ ìµœì í™”, ì‹¤ì œ DB
@Profile("test")   // í…ŒìŠ¤íŠ¸: Mock ë°ì´í„°
```

**ë¹„ìœ  í•µì‹¬**:
- ë²„íŠ¼ í•˜ë‚˜ë¡œ ì°¨ëŸ‰ ì „ì²´ ì„¸íŒ…ì´ ë³€ê²½ë˜ë“¯, í”„ë¡œíŒŒì¼ í•˜ë‚˜ë¡œ ì•± ì „ì²´ ì„¤ì • ë³€ê²½
- ê° ëª¨ë“œëŠ” ë…ë¦½ì ì¸ ì„¤ì • ì„¸íŠ¸ë¥¼ ê°€ì§
- ìš´ì „ìê°€ ìƒí™©ì— ë§ê²Œ ì„ íƒ (í™˜ê²½ì— ë§ê²Œ í”„ë¡œíŒŒì¼ ì„ íƒ)

---

### 2. ì˜·ì¥ ì •ë¦¬ (ê³„ì ˆë³„ ì˜· ê´€ë¦¬)

ì˜·ì¥ì„ **ë´„/ì—¬ë¦„/ê°€ì„/ê²¨ìš¸**ë¡œ ë‚˜ëˆ ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```yaml
# ğŸ‘” ì˜·ì¥ ë¹„ìœ 
wardrobe:
  spring: [ê°€ë””ê±´, ì–‡ì€ ì¬í‚·]
  summer: [ë°˜íŒ”, ë°˜ë°”ì§€]
  winter: [íŒ¨ë”©, ëª©ë„ë¦¬]

# ğŸŒ± Spring Boot ì„¤ì •
---
# application-dev.yml
logging.level.root: DEBUG  # ê°œë°œ: ëª¨ë“  ë¡œê·¸ ì¶œë ¥
---
# application-prod.yml
logging.level.root: WARN   # ìš´ì˜: ê²½ê³  ì´ìƒë§Œ ì¶œë ¥
```

**ë¹„ìœ  í•µì‹¬**:
- ê³„ì ˆ(í™˜ê²½)ì´ ë°”ë€Œë©´ ìë™ìœ¼ë¡œ í•„ìš”í•œ ì˜·(ì„¤ì •)ì„ êº¼ëƒ„
- ê²¨ìš¸ì— ë°˜íŒ”ì„ ì…ì§€ ì•Šë“¯, prod í™˜ê²½ì—ì„œ dev ì„¤ì •ì„ ì“°ì§€ ì•ŠìŒ
- ê°™ì€ ì˜·ì¥(ì• í”Œë¦¬ì¼€ì´ì…˜)ì´ì§€ë§Œ ë‚´ìš©ë¬¼(ì„¤ì •)ì´ ë‹¤ë¦„

---

### 3. ë ˆìŠ¤í† ë‘ ë©”ë‰´íŒ (ì‹œê°„ëŒ€ë³„ ë©”ë‰´)

ë ˆìŠ¤í† ë‘ì€ **ì•„ì¹¨/ì ì‹¬/ì €ë…**ë§ˆë‹¤ ë‹¤ë¥¸ ë©”ë‰´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

```java
// ğŸ½ï¸ ë ˆìŠ¤í† ë‘ ë©”ë‰´
@Component
class Restaurant {
    @TimeSlot("breakfast")
    Menu getBreakfastMenu() { return new Menu("í† ìŠ¤íŠ¸", "ì»¤í”¼"); }

    @TimeSlot("dinner")
    Menu getDinnerMenu() { return new Menu("ìŠ¤í…Œì´í¬", "ì™€ì¸"); }
}

// ğŸŒ± Spring Boot
@Configuration
class DataSourceConfig {
    @Bean
    @Profile("dev")
    DataSource h2DataSource() { /* ê°€ë²¼ìš´ H2 */ }

    @Bean
    @Profile("prod")
    DataSource mysqlDataSource() { /* ì‹¤ì œ MySQL */ }
}
```

**ë¹„ìœ  í•µì‹¬**:
- ì‹œê°„ëŒ€(í”„ë¡œíŒŒì¼)ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë©”ë‰´(ë¹ˆ) ì œê³µ
- ì•„ì¹¨ì— ìŠ¤í…Œì´í¬ë¥¼ ì£¼ë¬¸í•  ìˆ˜ ì—†ë“¯, devì—ì„œ prod ë¹ˆì€ ìƒì„± ì•ˆ ë¨
- ê°™ì€ ì£¼ë°©(ì• í”Œë¦¬ì¼€ì´ì…˜)ì—ì„œ ë‹¤ë¥¸ ìŒì‹(êµ¬í˜„ì²´) ì œê³µ

---

## í•µì‹¬ ê°œë…

### ì´ˆê¸‰: í”„ë¡œíŒŒì¼ ê¸°ë³¸ ì‚¬ìš©

#### 1. í”„ë¡œíŒŒì¼ë³„ ì„¤ì • íŒŒì¼

```
src/main/resources/
â”œâ”€â”€ application.yml          # ê³µí†µ ì„¤ì •
â”œâ”€â”€ application-dev.yml      # ê°œë°œ í™˜ê²½
â”œâ”€â”€ application-staging.yml  # ìŠ¤í…Œì´ì§• í™˜ê²½
â””â”€â”€ application-prod.yml     # ìš´ì˜ í™˜ê²½
```

```yaml
# application.yml (ê³µí†µ ì„¤ì •)
spring:
  application:
    name: myapp

server:
  port: 8080

---
# application-dev.yml (ê°œë°œ í™˜ê²½)
spring:
  datasource:
    url: jdbc:h2:mem:devdb
    username: sa
    password:
  h2:
    console:
      enabled: true

logging:
  level:
    root: DEBUG
    com.myapp: TRACE

---
# application-prod.yml (ìš´ì˜ í™˜ê²½)
spring:
  datasource:
    url: jdbc:mysql://prod-db-server:3306/myapp
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 20

logging:
  level:
    root: WARN
    com.myapp: INFO
```

#### 2. í”„ë¡œíŒŒì¼ í™œì„±í™” ë°©ë²•

```bash
# ë°©ë²• 1: application.ymlì—ì„œ ê¸°ë³¸ í”„ë¡œíŒŒì¼ ì§€ì •
spring:
  profiles:
    active: dev

# ë°©ë²• 2: ëª…ë ¹í–‰ ì¸ìˆ˜
java -jar myapp.jar --spring.profiles.active=prod

# ë°©ë²• 3: í™˜ê²½ ë³€ìˆ˜
export SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# ë°©ë²• 4: IDE ì„¤ì • (IntelliJ IDEA)
Run > Edit Configurations > Environment variables
SPRING_PROFILES_ACTIVE=dev

# ë°©ë²• 5: ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ ë™ì‹œ í™œì„±í™”
java -jar myapp.jar --spring.profiles.active=prod,monitoring
```

#### 3. @Profile ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì¡°ê±´ë¶€ ë¹ˆ ë“±ë¡

```java
@Configuration
public class DataSourceConfig {

    // ê°œë°œ í™˜ê²½: H2 ì¸ë©”ëª¨ë¦¬ DB
    @Bean
    @Profile("dev")
    public DataSource h2DataSource() {
        return DataSourceBuilder.create()
                .driverClassName("org.h2.Driver")
                .url("jdbc:h2:mem:devdb")
                .username("sa")
                .password("")
                .build();
    }

    // ìš´ì˜ í™˜ê²½: MySQL
    @Bean
    @Profile("prod")
    public DataSource mysqlDataSource(
            @Value("${spring.datasource.url}") String url,
            @Value("${spring.datasource.username}") String username,
            @Value("${spring.datasource.password}") String password) {

        HikariConfig config = new HikariConfig();
        config.setJdbcUrl(url);
        config.setUsername(username);
        config.setPassword(password);
        config.setMaximumPoolSize(20);
        config.setMinimumIdle(5);

        return new HikariDataSource(config);
    }
}
```

```java
// ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸ - í™˜ê²½ë³„ ë‹¤ë¥¸ êµ¬í˜„ì²´
@Component
@Profile("dev")
public class MockPaymentClient implements PaymentClient {
    @Override
    public PaymentResult processPayment(PaymentRequest request) {
        log.info("ğŸ§ª Mock Payment: {}", request);
        return PaymentResult.success("MOCK-" + UUID.randomUUID());
    }
}

@Component
@Profile("prod")
public class RealPaymentClient implements PaymentClient {

    @Value("${payment.api.url}")
    private String apiUrl;

    @Override
    public PaymentResult processPayment(PaymentRequest request) {
        log.info("ğŸ’³ Real Payment Processing: {}", request);
        // ì‹¤ì œ PGì‚¬ API í˜¸ì¶œ
        return restTemplate.postForObject(
            apiUrl + "/payment",
            request,
            PaymentResult.class
        );
    }
}
```

---

### ì¤‘ê¸‰: ê³ ê¸‰ í”„ë¡œíŒŒì¼ ì „ëµ

#### 1. í”„ë¡œíŒŒì¼ í‘œí˜„ì‹ (Profile Expressions)

```java
// NOT ì—°ì‚°ì
@Component
@Profile("!prod")  // prodê°€ ì•„ë‹Œ ëª¨ë“  í™˜ê²½ì—ì„œ í™œì„±í™”
public class DevToolsConfig {
    // ê°œë°œ í¸ì˜ ê¸°ëŠ¥ (ìš´ì˜ì—ì„œëŠ” ë¹„í™œì„±í™”)
}

// AND ì—°ì‚°ì
@Component
@Profile("prod & monitoring")  // prodì´ë©´ì„œ monitoringë„ í™œì„±í™”ëœ ê²½ìš°
public class ProductionMonitoringConfig {
    @Bean
    public MeterRegistry prometheusMeterRegistry() {
        return new PrometheusMeterRegistry(PrometheusConfig.DEFAULT);
    }
}

// OR ì—°ì‚°ì
@Component
@Profile("dev | test")  // dev ë˜ëŠ” test í™˜ê²½
public class TestDataInitializer implements CommandLineRunner {
    @Override
    public void run(String... args) {
        log.info("ğŸŒ± Initializing test data...");
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
    }
}

// ë³µì¡í•œ í‘œí˜„ì‹
@Profile("(prod | staging) & monitoring")
public class AdvancedMonitoringConfig {
    // prod ë˜ëŠ” stagingì´ë©´ì„œ monitoringì´ í™œì„±í™”ëœ ê²½ìš°
}
```

#### 2. í”„ë¡œíŒŒì¼ ê·¸ë£¹ (Profile Groups) - Spring Boot 2.4+

```yaml
# application.yml
spring:
  profiles:
    group:
      local: [dev, h2db, debug]
      production: [prod, mysql, monitoring, security]
      staging: [staging, mysql, monitoring]

# ì‚¬ìš©ë²•
# java -jar myapp.jar --spring.profiles.active=local
# â†’ dev, h2db, debug ëª¨ë‘ í™œì„±í™”ë¨
```

```java
// ê° í”„ë¡œíŒŒì¼ë³„ ì„¤ì •
@Configuration
@Profile("h2db")
public class H2DatabaseConfig {
    // H2 ì „ìš© ì„¤ì •
}

@Configuration
@Profile("mysql")
public class MySQLDatabaseConfig {
    // MySQL ì „ìš© ì„¤ì •
}

@Configuration
@Profile("monitoring")
public class MonitoringConfig {
    // Prometheus, Grafana ì„¤ì •
}

@Configuration
@Profile("security")
public class ProductionSecurityConfig {
    // ìš´ì˜ ë³´ì•ˆ ê°•í™” ì„¤ì •
}
```

#### 3. í”„ë¡œíŒŒì¼ë³„ ë‹¤ì¤‘ ë¬¸ì„œ (Multi-Document)

```yaml
# application.yml (í•œ íŒŒì¼ì— ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ ì •ì˜)

# ê³µí†µ ì„¤ì •
spring:
  application:
    name: myapp

---
# ê°œë°œ í™˜ê²½
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:h2:mem:devdb

logging:
  level:
    root: DEBUG

---
# ìŠ¤í…Œì´ì§• í™˜ê²½
spring:
  config:
    activate:
      on-profile: staging

  datasource:
    url: jdbc:mysql://staging-db:3306/myapp
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

logging:
  level:
    root: INFO

---
# ìš´ì˜ í™˜ê²½
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: jdbc:mysql://prod-db-cluster:3306/myapp
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 50

logging:
  level:
    root: WARN
```

#### 4. @ActiveProfilesë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ í”„ë¡œíŒŒì¼

```java
// í…ŒìŠ¤íŠ¸ì—ì„œ í”„ë¡œíŒŒì¼ í™œì„±í™”
@SpringBootTest
@ActiveProfiles("test")
class OrderServiceTest {

    @Autowired
    private PaymentClient paymentClient;

    @Test
    void test_with_mock_payment() {
        // test í”„ë¡œíŒŒì¼ í™œì„±í™” ì‹œ MockPaymentClient ì£¼ì…ë¨
        assertThat(paymentClient).isInstanceOf(MockPaymentClient.class);
    }
}

// í…ŒìŠ¤íŠ¸ ì „ìš© ì„¤ì •
@TestConfiguration
@Profile("test")
public class TestConfig {

    @Bean
    public Clock fixedClock() {
        // í…ŒìŠ¤íŠ¸ì—ì„œ ì‹œê°„ ê³ ì •
        return Clock.fixed(
            Instant.parse("2025-01-01T00:00:00Z"),
            ZoneId.of("Asia/Seoul")
        );
    }
}
```

---

### ê³ ê¸‰: ì‹¤ë¬´ í”„ë¡œíŒŒì¼ ì„¤ê³„ íŒ¨í„´

#### 1. ê³„ì¸µí˜• í”„ë¡œíŒŒì¼ ì „ëµ

```yaml
# ê¸°ë³¸ í”„ë¡œíŒŒì¼ ê³„ì¸µ êµ¬ì¡°
# base (ê³µí†µ) â†’ env (í™˜ê²½) â†’ feature (ê¸°ëŠ¥)

spring:
  profiles:
    group:
      # í™˜ê²½ë³„ í”„ë¡œíŒŒì¼
      local: [base, dev, h2db, debug, mock-external-api]
      dev-server: [base, dev, mysql, debug]
      staging: [base, staging, mysql, monitoring]
      production: [base, prod, mysql, monitoring, security, cache]

      # ê¸°ëŠ¥ë³„ í”„ë¡œíŒŒì¼
      mock-external-api: []  # ì™¸ë¶€ API Mock
      debug: []              # ë””ë²„ê¹… ê¸°ëŠ¥
      monitoring: []         # ëª¨ë‹ˆí„°ë§
      security: []           # ë³´ì•ˆ ê°•í™”
      cache: []              # ìºì‹œ í™œì„±í™”
```

```java
// base í”„ë¡œíŒŒì¼ (í•­ìƒ í•„ìš”í•œ ê¸°ë³¸ ì„¤ì •)
@Configuration
@Profile("base")
public class BaseConfig {
    @Bean
    public ObjectMapper objectMapper() {
        return new ObjectMapper()
                .registerModule(new JavaTimeModule())
                .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
    }
}

// í™˜ê²½ë³„ í”„ë¡œíŒŒì¼
@Configuration
@Profile("dev")
public class DevConfig {
    @Bean
    public CommandLineRunner devDataInitializer() {
        return args -> log.info("ğŸŒ± Dev environment ready");
    }
}

@Configuration
@Profile("prod")
public class ProdConfig {
    @Bean
    public CommandLineRunner prodStartupLogger() {
        return args -> log.warn("ğŸš€ Production environment started");
    }
}

// ê¸°ëŠ¥ë³„ í”„ë¡œíŒŒì¼
@Configuration
@Profile("mock-external-api")
public class MockExternalApiConfig {
    @Bean
    public ExternalApiClient mockApiClient() {
        return new MockExternalApiClient();
    }
}

@Configuration
@Profile("cache")
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        return new ConcurrentMapCacheManager("users", "products");
    }
}
```

#### 2. í™˜ê²½ ë³€ìˆ˜ ìš°ì„ ìˆœìœ„ í™œìš©

```bash
# ìš°ì„ ìˆœìœ„ (ë†’ì€ ìˆœì„œëŒ€ë¡œ)
# 1. ëª…ë ¹í–‰ ì¸ìˆ˜ (--spring.profiles.active=prod)
# 2. í™˜ê²½ ë³€ìˆ˜ (SPRING_PROFILES_ACTIVE=prod)
# 3. application.yml (spring.profiles.active: dev)
# 4. @ActiveProfiles (í…ŒìŠ¤íŠ¸)

# Kubernetes ConfigMap ì˜ˆì œ
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  SPRING_PROFILES_ACTIVE: "prod,monitoring,cache"

---
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:1.0.0
        envFrom:
        - configMapRef:
            name: app-config
```

#### 3. í”„ë¡œíŒŒì¼ë³„ ë¡œê¹… ì „ëµ

```xml
<!-- logback-spring.xml -->
<configuration>
    <!-- ê°œë°œ í™˜ê²½: ì½˜ì†” ì¶œë ¥ + ìƒì„¸ ë¡œê·¸ -->
    <springProfile name="dev">
        <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>

        <root level="DEBUG">
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>

    <!-- ìš´ì˜ í™˜ê²½: íŒŒì¼ ì¶œë ¥ + JSON í¬ë§· -->
    <springProfile name="prod">
        <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <file>/var/log/myapp/application.log</file>
            <encoder class="net.logstash.logback.encoder.LogstashEncoder">
                <includeMdcKeyName>traceId</includeMdcKeyName>
                <includeMdcKeyName>userId</includeMdcKeyName>
            </encoder>
            <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                <fileNamePattern>/var/log/myapp/application.%d{yyyy-MM-dd}.log</fileNamePattern>
                <maxHistory>30</maxHistory>
            </rollingPolicy>
        </appender>

        <root level="WARN">
            <appender-ref ref="FILE"/>
        </root>

        <logger name="com.myapp" level="INFO"/>
    </springProfile>
</configuration>
```

#### 4. ë™ì  í”„ë¡œíŒŒì¼ í™•ì¸ ë° ê²€ì¦

```java
@Component
public class ProfileValidator implements ApplicationListener<ApplicationReadyEvent> {

    @Autowired
    private Environment environment;

    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        String[] activeProfiles = environment.getActiveProfiles();

        log.info("========================================");
        log.info("ğŸŒ± Active Profiles: {}", Arrays.toString(activeProfiles));
        log.info("========================================");

        // ìš´ì˜ í™˜ê²½ ê²€ì¦
        if (Arrays.asList(activeProfiles).contains("prod")) {
            validateProductionConfig();
        }
    }

    private void validateProductionConfig() {
        // í•„ìˆ˜ ì„¤ì • ê²€ì¦
        requireProperty("spring.datasource.url");
        requireProperty("spring.datasource.username");

        // ìœ„í—˜í•œ ì„¤ì • ì²´í¬
        if (environment.getProperty("spring.h2.console.enabled", Boolean.class, false)) {
            throw new IllegalStateException(
                "âŒ H2 Console must be disabled in production!"
            );
        }

        log.info("âœ… Production configuration validated");
    }

    private void requireProperty(String key) {
        if (!environment.containsProperty(key)) {
            throw new IllegalStateException(
                String.format("âŒ Required property '%s' is missing!", key)
            );
        }
    }
}
```

```java
// í”„ë¡œíŒŒì¼ ê¸°ë°˜ ì¡°ê±´ë¶€ ë¡œì§
@Service
public class EmailService {

    @Autowired
    private Environment environment;

    public void sendEmail(String to, String subject, String body) {
        if (environment.acceptsProfiles(Profiles.of("dev"))) {
            // ê°œë°œ í™˜ê²½: ì‹¤ì œ ë°œì†¡ ì•ˆ í•¨
            log.info("ğŸ“§ [DEV] Email to {}: {}", to, subject);
            return;
        }

        if (environment.acceptsProfiles(Profiles.of("prod"))) {
            // ìš´ì˜ í™˜ê²½: ì‹¤ì œ ë°œì†¡
            log.info("ğŸ“§ [PROD] Sending email to {}", to);
            actualEmailSender.send(to, subject, body);
        }
    }
}
```

---

## ê¸°ë³¸ ì‹¤ìŠµ

### ì‹¤ìŠµ 1: í™˜ê²½ë³„ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

**ëª©í‘œ**: dev/prod í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±

```yaml
# src/main/resources/application.yml
spring:
  application:
    name: profile-demo

server:
  port: 8080

---
# src/main/resources/application-dev.yml
spring:
  datasource:
    url: jdbc:h2:mem:devdb
    username: sa
    password:
    driver-class-name: org.h2.Driver

  h2:
    console:
      enabled: true
      path: /h2-console

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true

logging:
  level:
    root: INFO
    com.example: DEBUG
    org.hibernate.SQL: DEBUG

---
# src/main/resources/application-prod.yml
spring:
  datasource:
    url: jdbc:mysql://prod-mysql-server:3306/myapp?useSSL=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false

logging:
  level:
    root: WARN
    com.example: INFO
```

```java
// Entity
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String email;

    // getters, setters
}

// Repository
public interface UserRepository extends JpaRepository<User, Long> {
}

// Service
@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository userRepository;

    public User createUser(String name, String email) {
        User user = new User();
        user.setName(name);
        user.setEmail(email);
        return userRepository.save(user);
    }

    public List<User> findAll() {
        return userRepository.findAll();
    }
}

// í™˜ê²½ë³„ ì´ˆê¸° ë°ì´í„° ì„¤ì •
@Component
@Profile("dev")
@RequiredArgsConstructor
public class DevDataInitializer implements CommandLineRunner {

    private final UserService userService;

    @Override
    public void run(String... args) {
        log.info("ğŸŒ± Initializing dev data...");

        userService.createUser("í™ê¸¸ë™", "hong@example.com");
        userService.createUser("ê¹€ì² ìˆ˜", "kim@example.com");
        userService.createUser("ì´ì˜í¬", "lee@example.com");

        log.info("âœ… Dev data initialized: {} users", userService.findAll().size());
    }
}

// ìš´ì˜ í™˜ê²½ ì‹œì‘ ë¡œê±°
@Component
@Profile("prod")
public class ProductionStartupLogger implements ApplicationListener<ApplicationReadyEvent> {

    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        log.warn("========================================");
        log.warn("ğŸš€ Production application started");
        log.warn("========================================");
    }
}
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# ê°œë°œ í™˜ê²½ ì‹¤í–‰
./mvnw spring-boot:run -Dspring-boot.run.profiles=dev

# H2 Console ì ‘ì†: http://localhost:8080/h2-console
# JDBC URL: jdbc:h2:mem:devdb

# ìš´ì˜ í™˜ê²½ ì‹¤í–‰ (í™˜ê²½ ë³€ìˆ˜ í•„ìš”)
export DB_USERNAME=prod_user
export DB_PASSWORD=prod_password
./mvnw spring-boot:run -Dspring-boot.run.profiles=prod
```

**ê²°ê³¼ í™•ì¸**:
```bash
# dev í”„ë¡œíŒŒì¼ í™œì„±í™” ì‹œ
# 2025-01-20 10:00:00.123 DEBUG - Hibernate: create table users (...)
# 2025-01-20 10:00:01.456 INFO  - ğŸŒ± Initializing dev data...
# 2025-01-20 10:00:01.789 INFO  - âœ… Dev data initialized: 3 users

# prod í”„ë¡œíŒŒì¼ í™œì„±í™” ì‹œ
# 2025-01-20 10:00:00.123 WARN  - ğŸš€ Production application started
```

---

### ì‹¤ìŠµ 2: ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸ - Mock vs Real

**ëª©í‘œ**: ê°œë°œ í™˜ê²½ì—ì„œëŠ” Mock APIë¥¼ ì‚¬ìš©í•˜ê³ , ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ APIë¥¼ í˜¸ì¶œ

```java
// ê³µí†µ ì¸í„°í˜ì´ìŠ¤
public interface WeatherApiClient {
    WeatherInfo getWeather(String city);
}

@Data
@AllArgsConstructor
public class WeatherInfo {
    private String city;
    private double temperature;
    private String condition;
}

// ê°œë°œ í™˜ê²½: Mock êµ¬í˜„ì²´
@Component
@Profile("dev")
@Slf4j
public class MockWeatherApiClient implements WeatherApiClient {

    private final Random random = new Random();

    @Override
    public WeatherInfo getWeather(String city) {
        log.info("ğŸ§ª [MOCK] Getting weather for {}", city);

        // ëœë¤ ë‚ ì”¨ ë°ì´í„° ìƒì„±
        double temp = 15 + random.nextInt(20);
        String[] conditions = {"ë§‘ìŒ", "íë¦¼", "ë¹„", "ëˆˆ"};
        String condition = conditions[random.nextInt(conditions.length)];

        return new WeatherInfo(city, temp, condition);
    }
}

// ìš´ì˜ í™˜ê²½: ì‹¤ì œ API êµ¬í˜„ì²´
@Component
@Profile("prod")
@Slf4j
public class RealWeatherApiClient implements WeatherApiClient {

    @Value("${weather.api.url}")
    private String apiUrl;

    @Value("${weather.api.key}")
    private String apiKey;

    private final RestTemplate restTemplate = new RestTemplate();

    @Override
    public WeatherInfo getWeather(String city) {
        log.info("ğŸŒ [REAL] Calling external weather API for {}", city);

        String url = String.format("%s/weather?city=%s&apiKey=%s",
            apiUrl, city, apiKey);

        try {
            WeatherApiResponse response = restTemplate.getForObject(
                url, WeatherApiResponse.class);

            return new WeatherInfo(
                city,
                response.getMain().getTemp(),
                response.getWeather().get(0).getDescription()
            );
        } catch (Exception e) {
            log.error("Failed to call weather API", e);
            throw new RuntimeException("Weather API error", e);
        }
    }
}

// Controller
@RestController
@RequestMapping("/api/weather")
@RequiredArgsConstructor
public class WeatherController {

    private final WeatherApiClient weatherApiClient;
    private final Environment environment;

    @GetMapping("/{city}")
    public ResponseEntity<WeatherResponse> getWeather(@PathVariable String city) {
        String activeProfile = environment.getActiveProfiles()[0];

        WeatherInfo weather = weatherApiClient.getWeather(city);

        return ResponseEntity.ok(WeatherResponse.builder()
                .city(weather.getCity())
                .temperature(weather.getTemperature())
                .condition(weather.getCondition())
                .source(activeProfile.equals("dev") ? "MOCK" : "REAL")
                .build());
    }
}
```

```yaml
# application-prod.yml
weather:
  api:
    url: https://api.openweathermap.org/data/2.5
    key: ${WEATHER_API_KEY}
```

**í…ŒìŠ¤íŠ¸**:
```bash
# dev í™˜ê²½
curl http://localhost:8080/api/weather/Seoul
# Response:
# {
#   "city": "Seoul",
#   "temperature": 23.5,
#   "condition": "ë§‘ìŒ",
#   "source": "MOCK"
# }

# prod í™˜ê²½
curl http://localhost:8080/api/weather/Seoul
# Response:
# {
#   "city": "Seoul",
#   "temperature": 18.2,
#   "condition": "Partly cloudy",
#   "source": "REAL"
# }
```

---

### ì‹¤ìŠµ 3: í”„ë¡œíŒŒì¼ ê·¸ë£¹ê³¼ ë‹¤ì¤‘ í”„ë¡œíŒŒì¼ í™œìš©

**ëª©í‘œ**: í”„ë¡œíŒŒì¼ ê·¸ë£¹ì„ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ í™˜ê²½ êµ¬ì„±ì„ ë‹¨ìˆœí™”

```yaml
# application.yml
spring:
  profiles:
    group:
      # ë¡œì»¬ ê°œë°œ í™˜ê²½
      local: [base, dev, h2, mock-api, debug]

      # ê°œë°œ ì„œë²„ í™˜ê²½
      dev-server: [base, dev, mysql, mock-api, monitoring]

      # ìŠ¤í…Œì´ì§• í™˜ê²½
      staging: [base, staging, mysql, real-api, monitoring]

      # ìš´ì˜ í™˜ê²½
      production: [base, prod, mysql, real-api, monitoring, security, cache]

---
# base í”„ë¡œíŒŒì¼ (ê³µí†µ ì„¤ì •)
spring:
  config:
    activate:
      on-profile: base

# ê³µí†µ ì„¤ì •
  application:
    name: multi-profile-demo

---
# h2 í”„ë¡œíŒŒì¼
spring:
  config:
    activate:
      on-profile: h2

  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver

  h2:
    console:
      enabled: true

---
# mysql í”„ë¡œíŒŒì¼
spring:
  config:
    activate:
      on-profile: mysql

  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:3306/${DB_NAME:myapp}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

---
# monitoring í”„ë¡œíŒŒì¼
spring:
  config:
    activate:
      on-profile: monitoring

management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true

---
# cache í”„ë¡œíŒŒì¼
spring:
  config:
    activate:
      on-profile: cache

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=10m

---
# security í”„ë¡œíŒŒì¼
spring:
  config:
    activate:
      on-profile: security

  security:
    require-ssl: true
```

```java
// base í”„ë¡œíŒŒì¼ ì„¤ì •
@Configuration
@Profile("base")
public class BaseConfig {
    @Bean
    public ObjectMapper objectMapper() {
        return new ObjectMapper()
                .registerModule(new JavaTimeModule());
    }
}

// debug í”„ë¡œíŒŒì¼ ì„¤ì •
@Configuration
@Profile("debug")
public class DebugConfig {
    @Bean
    public FilterRegistrationBean<RequestLoggingFilter> loggingFilter() {
        FilterRegistrationBean<RequestLoggingFilter> registration =
            new FilterRegistrationBean<>();
        registration.setFilter(new RequestLoggingFilter());
        registration.addUrlPatterns("/*");
        return registration;
    }
}

// cache í”„ë¡œíŒŒì¼ ì„¤ì •
@Configuration
@Profile("cache")
@EnableCaching
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager("users", "products");
        cacheManager.setCaffeine(Caffeine.newBuilder()
                .maximumSize(1000)
                .expireAfterWrite(Duration.ofMinutes(10)));
        return cacheManager;
    }
}

// security í”„ë¡œíŒŒì¼ ì„¤ì •
@Configuration
@Profile("security")
public class ProductionSecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .requiresChannel(channel -> channel
                .anyRequest().requiresSecure()  // HTTPS ê°•ì œ
            )
            .headers(headers -> headers
                .httpStrictTransportSecurity(hsts -> hsts
                    .maxAgeInSeconds(31536000)
                    .includeSubDomains(true)
                )
            );
        return http.build();
    }
}

// í”„ë¡œíŒŒì¼ ì •ë³´ API
@RestController
@RequestMapping("/api/info")
public class ProfileInfoController {

    @Autowired
    private Environment environment;

    @GetMapping("/profiles")
    public Map<String, Object> getActiveProfiles() {
        return Map.of(
            "activeProfiles", environment.getActiveProfiles(),
            "defaultProfiles", environment.getDefaultProfiles()
        );
    }
}
```

**ì‹¤í–‰ ì˜ˆì œ**:
```bash
# ë¡œì»¬ ê°œë°œ
java -jar app.jar --spring.profiles.active=local
# í™œì„±í™”: base, dev, h2, mock-api, debug

# ìŠ¤í…Œì´ì§• ì„œë²„
java -jar app.jar --spring.profiles.active=staging
# í™œì„±í™”: base, staging, mysql, real-api, monitoring

# ìš´ì˜ ì„œë²„
java -jar app.jar --spring.profiles.active=production
# í™œì„±í™”: base, prod, mysql, real-api, monitoring, security, cache
```

**í”„ë¡œíŒŒì¼ í™•ì¸ API**:
```bash
curl http://localhost:8080/api/info/profiles

# local í™˜ê²½ ì‘ë‹µ
{
  "activeProfiles": ["local", "base", "dev", "h2", "mock-api", "debug"],
  "defaultProfiles": ["default"]
}

# production í™˜ê²½ ì‘ë‹µ
{
  "activeProfiles": ["production", "base", "prod", "mysql", "real-api", "monitoring", "security", "cache"],
  "defaultProfiles": ["default"]
}
```

---

## ì£¼ë‹ˆì–´ ê°œë°œì ì‹œë‚˜ë¦¬ì˜¤: "ê°œë°œ í™˜ê²½ê³¼ ìš´ì˜ í™˜ê²½ DBê°€ ì„ì˜€ì–´ìš”!"

**ìƒí™©**:
ì…ì‚¬ 2ê°œì›”ì°¨ ì£¼ë‹ˆì–´ ê°œë°œìê°€ ì‹¤ìˆ˜ë¡œ **ë¡œì»¬ ê°œë°œ ì¤‘ ìš´ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°**í•˜ì—¬ ì‹¤ì œ ê³ ê° ë°ì´í„°ë¥¼ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤.

```java
// âŒ í•˜ë“œì½”ë”©ëœ ì„¤ì • (ìœ„í—˜!)
@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        // ê°œë°œ ì¤‘ ì‹¤ìˆ˜ë¡œ ìš´ì˜ DB URL ì…ë ¥
        return DataSourceBuilder.create()
                .url("jdbc:mysql://prod-db.company.com:3306/production")
                .username("prod_user")
                .password("prod_password")
                .build();
    }
}
```

**ë¬¸ì œì **:
- âŒ ë¡œì»¬ ê°œë°œ ì¤‘ ìš´ì˜ DBì— ì ‘ê·¼
- âŒ ì‹¤ìˆ˜ë¡œ ìš´ì˜ ë°ì´í„° ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- âŒ í™˜ê²½ë³„ ì„¤ì • êµ¬ë¶„ ì—†ìŒ
- âŒ ì½”ë“œì— ë¯¼ê° ì •ë³´ í•˜ë“œì½”ë”©

**ì‹œë‹ˆì–´ì˜ í”„ë¡œíŒŒì¼ ê¸°ë°˜ í•´ê²°ì±…**:

```yaml
# application.yml (ê³µí†µ ì„¤ì •ë§Œ)
spring:
  application:
    name: user-service

  profiles:
    active: dev  # ê¸°ë³¸ê°’ì€ í•­ìƒ dev

---
# application-dev.yml (ê°œë°œ í™˜ê²½)
spring:
  datasource:
    url: jdbc:h2:mem:devdb
    username: sa
    password:
    driver-class-name: org.h2.Driver

  h2:
    console:
      enabled: true

  jpa:
    hibernate:
      ddl-auto: create-drop  # í…Œì´ë¸” ìë™ ìƒì„±/ì‚­ì œ
    show-sql: true

---
# application-prod.yml (ìš´ì˜ í™˜ê²½)
spring:
  datasource:
    # í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ ì„¤ì • (ì½”ë“œì— ë…¸ì¶œ ì•ˆ ë¨)
    url: ${PROD_DB_URL}
    username: ${PROD_DB_USERNAME}
    password: ${PROD_DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: validate  # í…Œì´ë¸” ë³€ê²½ ë¶ˆê°€
    show-sql: false
```

```java
// ì•ˆì „í•œ DataSource ì„¤ì •
@Configuration
public class DataSourceConfig {

    // ê°œë°œ í™˜ê²½: H2 (ì•ˆì „)
    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        log.info("ğŸŒ± [DEV] Using H2 in-memory database");
        return DataSourceBuilder.create()
                .driverClassName("org.h2.Driver")
                .url("jdbc:h2:mem:devdb")
                .username("sa")
                .password("")
                .build();
    }

    // ìš´ì˜ í™˜ê²½: MySQL (í™˜ê²½ ë³€ìˆ˜ í•„ìˆ˜)
    @Bean
    @Profile("prod")
    public DataSource prodDataSource(Environment env) {
        log.warn("ğŸš€ [PROD] Connecting to production database");

        // í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
        String url = requireEnv(env, "PROD_DB_URL");
        String username = requireEnv(env, "PROD_DB_USERNAME");
        String password = requireEnv(env, "PROD_DB_PASSWORD");

        return DataSourceBuilder.create()
                .url(url)
                .username(username)
                .password(password)
                .build();
    }

    private String requireEnv(Environment env, String key) {
        String value = env.getProperty(key);
        if (value == null || value.isBlank()) {
            throw new IllegalStateException(
                String.format("âŒ Required environment variable '%s' is not set!", key)
            );
        }
        return value;
    }
}

// ìš´ì˜ í™˜ê²½ ì•ˆì „ ì¥ì¹˜
@Component
@Profile("prod")
public class ProductionSafetyGuard implements ApplicationListener<ApplicationReadyEvent> {

    @Autowired
    private Environment environment;

    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        // ìœ„í—˜í•œ ì„¤ì • ì²´í¬
        checkDangerousSettings();

        log.warn("========================================");
        log.warn("âš ï¸  PRODUCTION ENVIRONMENT");
        log.warn("âš ï¸  Be careful with database operations!");
        log.warn("========================================");
    }

    private void checkDangerousSettings() {
        // H2 Consoleì´ ìš´ì˜ì—ì„œ í™œì„±í™”ë˜ë©´ ì—ëŸ¬
        if (environment.getProperty("spring.h2.console.enabled", Boolean.class, false)) {
            throw new IllegalStateException(
                "âŒ H2 Console must be disabled in production!"
            );
        }

        // DDL autoê°€ create/create-dropì´ë©´ ì—ëŸ¬
        String ddlAuto = environment.getProperty("spring.jpa.hibernate.ddl-auto", "none");
        if (ddlAuto.equals("create") || ddlAuto.equals("create-drop")) {
            throw new IllegalStateException(
                "âŒ DDL auto must be 'validate' or 'none' in production!"
            );
        }
    }
}
```

**ì•ˆì „í•œ ì‹¤í–‰ ë°©ë²•**:
```bash
# ë¡œì»¬ ê°œë°œ (ê¸°ë³¸ê°’ dev)
./mvnw spring-boot:run
# â†’ H2 ì¸ë©”ëª¨ë¦¬ DB ì‚¬ìš©, ì•ˆì „

# ìš´ì˜ ë°°í¬ (í™˜ê²½ ë³€ìˆ˜ í•„ìˆ˜)
export PROD_DB_URL=jdbc:mysql://prod-db.company.com:3306/production
export PROD_DB_USERNAME=prod_user
export PROD_DB_PASSWORD=secure_password
java -jar app.jar --spring.profiles.active=prod
# â†’ í™˜ê²½ ë³€ìˆ˜ ì—†ìœ¼ë©´ ì‹œì‘ ì‹¤íŒ¨ (ì•ˆì „)
```

**ë°°ìš´ êµí›ˆ**:
1. âœ… **ê¸°ë³¸ í”„ë¡œíŒŒì¼ì€ í•­ìƒ devë¡œ ì„¤ì •** â†’ ì‹¤ìˆ˜ë¡œ prod ì‹¤í–‰ ë°©ì§€
2. âœ… **ìš´ì˜ ì„¤ì •ì€ í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ ê´€ë¦¬** â†’ ì½”ë“œì— ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€
3. âœ… **í”„ë¡œíŒŒì¼ë³„ë¡œ ì™„ì „íˆ ë‹¤ë¥¸ DataSource ì‚¬ìš©** â†’ í™˜ê²½ ê²©ë¦¬
4. âœ… **ìš´ì˜ í™˜ê²½ ì‹œì‘ ì‹œ ì•ˆì „ ì¥ì¹˜ ì‘ë™** â†’ ìœ„í—˜í•œ ì„¤ì • ì°¨ë‹¨
5. âœ… **í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ ì‹œ ì¦‰ì‹œ ì‹¤íŒ¨** â†’ ì˜ëª»ëœ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰ ë°©ì§€

---

## ê¸°ì—… ì‚¬ë¡€

### ì‚¬ë¡€ 1: Netflix - ìˆ˜ì²œ ê°œì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í”„ë¡œíŒŒì¼ ê´€ë¦¬

**ê³¼ì œ**:
NetflixëŠ” **ìˆ˜ì²œ ê°œì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤**ë¥¼ ìš´ì˜í•˜ë©°, ê° ì„œë¹„ìŠ¤ê°€ dev/test/staging/prod í™˜ê²½ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ì„¤ì •ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

**Netflixì˜ í”„ë¡œíŒŒì¼ ì „ëµ**:

```yaml
# Netflix Archaius (ë™ì  ì„¤ì • ê´€ë¦¬) + Spring Cloud Config
spring:
  application:
    name: movie-recommendation-service

  profiles:
    group:
      dev: [base, dev, eureka-dev, mock-data]
      test: [base, test, eureka-test, test-data]
      prod: [base, prod, eureka-prod, chaos-monkey, monitoring]

  cloud:
    config:
      uri: http://config-server:8888
      profile: ${ENVIRONMENT:dev}
      label: main
```

```java
// í™˜ê²½ë³„ Eureka ì„¤ì •
@Configuration
@Profile("eureka-dev")
public class EurekaDevConfig {
    @Bean
    public EurekaClientConfigBean eurekaClientConfig() {
        EurekaClientConfigBean config = new EurekaClientConfigBean();
        config.setServiceUrl(Map.of(
            "defaultZone", "http://eureka-dev:8761/eureka/"
        ));
        return config;
    }
}

@Configuration
@Profile("eureka-prod")
public class EurekaProdConfig {
    @Bean
    public EurekaClientConfigBean eurekaClientConfig() {
        EurekaClientConfigBean config = new EurekaClientConfigBean();
        // ìš´ì˜: 3ê°œì˜ Eureka ì„œë²„ í´ëŸ¬ìŠ¤í„°
        config.setServiceUrl(Map.of(
            "defaultZone", "http://eureka-prod-1:8761/eureka/," +
                          "http://eureka-prod-2:8761/eureka/," +
                          "http://eureka-prod-3:8761/eureka/"
        ));
        return config;
    }
}

// Chaos Monkey (ìš´ì˜ í™˜ê²½ì—ì„œë§Œ í™œì„±í™”)
@Configuration
@Profile("chaos-monkey")
public class ChaosMonkeyConfig {
    // ë¬´ì‘ìœ„ ì¥ì•  ì£¼ì…ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë³µì›ë ¥ í…ŒìŠ¤íŠ¸
}
```

**ê²°ê³¼**:
- âœ… ìˆ˜ì²œ ê°œ ì„œë¹„ìŠ¤ì˜ í™˜ê²½ë³„ ì„¤ì • ìë™ ê´€ë¦¬
- âœ… ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„¤ì • ì„œë²„ (Spring Cloud Config)
- âœ… ìš´ì˜ í™˜ê²½ì—ì„œë§Œ Chaos Engineering í™œì„±í™”
- âœ… í™˜ê²½ë³„ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ë¶„ë¦¬

---

### ì‚¬ë¡€ 2: Airbnb - ê¸€ë¡œë²Œ ë¦¬ì „ë³„ í”„ë¡œíŒŒì¼ ê´€ë¦¬

**ê³¼ì œ**:
AirbnbëŠ” **ì „ ì„¸ê³„ ì—¬ëŸ¬ ë¦¬ì „**(ë¯¸êµ­, ìœ ëŸ½, ì•„ì‹œì•„)ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ë©°, ê° ë¦¬ì „ë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤, ê²°ì œ ì‹œìŠ¤í…œ, ë²•ê·œë¥¼ ì¤€ìˆ˜í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

**Airbnbì˜ ë¦¬ì „ë³„ í”„ë¡œíŒŒì¼ ì „ëµ**:

```yaml
spring:
  profiles:
    group:
      # ë¯¸êµ­ ìš´ì˜ í™˜ê²½
      us-prod: [base, prod, region-us, payment-stripe, db-us-east]

      # ìœ ëŸ½ ìš´ì˜ í™˜ê²½ (GDPR ì¤€ìˆ˜)
      eu-prod: [base, prod, region-eu, payment-adyen, db-eu-west, gdpr]

      # ì•„ì‹œì•„ ìš´ì˜ í™˜ê²½
      asia-prod: [base, prod, region-asia, payment-local, db-asia-pacific]
```

```java
// ë¦¬ì „ë³„ ê²°ì œ ì‹œìŠ¤í…œ
@Component
@Profile("payment-stripe")
public class StripePaymentProcessor implements PaymentProcessor {
    @Override
    public PaymentResult process(PaymentRequest request) {
        log.info("ğŸ’³ Processing payment via Stripe (US)");
        // Stripe API í˜¸ì¶œ
        return stripeClient.charge(request);
    }
}

@Component
@Profile("payment-adyen")
public class AdyenPaymentProcessor implements PaymentProcessor {
    @Override
    public PaymentResult process(PaymentRequest request) {
        log.info("ğŸ’³ Processing payment via Adyen (EU)");
        // Adyen API í˜¸ì¶œ (ìœ ëŸ½ í˜„ì§€ ê²°ì œ ì§€ì›)
        return adyenClient.charge(request);
    }
}

@Component
@Profile("payment-local")
public class LocalPaymentProcessor implements PaymentProcessor {
    @Override
    public PaymentResult process(PaymentRequest request) {
        log.info("ğŸ’³ Processing payment via local providers (Asia)");
        // Alipay, WeChat Pay ë“± í˜„ì§€ ê²°ì œ ìˆ˜ë‹¨
        return localPaymentClient.charge(request);
    }
}

// GDPR ê·œì • ì¤€ìˆ˜ (ìœ ëŸ½ë§Œ)
@Configuration
@Profile("gdpr")
public class GdprConfig {

    @Bean
    public DataRetentionPolicy gdprRetentionPolicy() {
        // ê°œì¸ì •ë³´ ë³´ê´€ ê¸°ê°„ ì œí•œ
        return new DataRetentionPolicy(Duration.ofDays(90));
    }

    @Bean
    public UserDataExporter gdprDataExporter() {
        // ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ (GDPR ìš”êµ¬ì‚¬í•­)
        return new UserDataExporter();
    }
}

// ë¦¬ì „ë³„ ë°ì´í„°ë² ì´ìŠ¤
@Configuration
@Profile("db-us-east")
public class UsEastDatabaseConfig {
    @Bean
    public DataSource dataSource() {
        return DataSourceBuilder.create()
                .url("jdbc:mysql://us-east-1-db-cluster:3306/airbnb")
                .build();
    }
}

@Configuration
@Profile("db-eu-west")
public class EuWestDatabaseConfig {
    @Bean
    public DataSource dataSource() {
        return DataSourceBuilder.create()
                .url("jdbc:mysql://eu-west-1-db-cluster:3306/airbnb")
                .build();
    }
}
```

**ë°°í¬ ìŠ¤í¬ë¦½íŠ¸**:
```bash
# ë¯¸êµ­ ë¦¬ì „ ë°°í¬
kubectl set env deployment/booking-service \
  SPRING_PROFILES_ACTIVE=us-prod \
  -n us-east-1

# ìœ ëŸ½ ë¦¬ì „ ë°°í¬ (GDPR í¬í•¨)
kubectl set env deployment/booking-service \
  SPRING_PROFILES_ACTIVE=eu-prod \
  -n eu-west-1

# ì•„ì‹œì•„ ë¦¬ì „ ë°°í¬
kubectl set env deployment/booking-service \
  SPRING_PROFILES_ACTIVE=asia-prod \
  -n asia-pacific-1
```

**ê²°ê³¼**:
- âœ… ë¦¬ì „ë³„ë¡œ ì™„ì „íˆ ë‹¤ë¥¸ ì¸í”„ë¼/ì„œë¹„ìŠ¤ ì‚¬ìš©
- âœ… ë²•ê·œ ì¤€ìˆ˜ (GDPR, í˜„ì§€ ê²°ì œ ê·œì •)
- âœ… ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ë¡œ ì „ ì„¸ê³„ ì„œë¹„ìŠ¤
- âœ… í”„ë¡œíŒŒì¼ ê·¸ë£¹ìœ¼ë¡œ ë³µì¡í•œ ì„¤ì • ê°„ì†Œí™”

---

## FAQ

### Q1: í”„ë¡œíŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ë™ì‹œì— í™œì„±í™”í•  ìˆ˜ ìˆë‚˜ìš”?

**A**: ë„¤, ê°€ëŠ¥í•©ë‹ˆë‹¤.

```bash
# ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ í™œì„±í™”
java -jar app.jar --spring.profiles.active=prod,monitoring,cache

# ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜
export SPRING_PROFILES_ACTIVE=prod,monitoring,cache
```

```yaml
# application.yml
spring:
  profiles:
    active: dev,debug,mock-api
```

**í™œìš© ì˜ˆì‹œ**:
```java
@Component
@Profile("prod")
public class ProdConfig { }

@Component
@Profile("monitoring")
public class MonitoringConfig { }

@Component
@Profile("cache")
public class CacheConfig { }

// prod,monitoring,cache í™œì„±í™” ì‹œ
// â†’ ì„¸ ê°€ì§€ ì„¤ì • ëª¨ë‘ ì ìš©ë¨
```

---

### Q2: í”„ë¡œíŒŒì¼ ìš°ì„ ìˆœìœ„ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?

**A**: ì„¤ì • ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤ (ë†’ì€ ìˆœì„œëŒ€ë¡œ):

```
1. ëª…ë ¹í–‰ ì¸ìˆ˜ (--spring.profiles.active=prod)
2. SPRING_PROFILES_ACTIVE í™˜ê²½ ë³€ìˆ˜
3. application.ymlì˜ spring.profiles.active
4. @ActiveProfiles (í…ŒìŠ¤íŠ¸ ì „ìš©)
5. ê¸°ë³¸ í”„ë¡œíŒŒì¼ (default)
```

**ì˜ˆì‹œ**:
```yaml
# application.yml
spring:
  profiles:
    active: dev  # ìš°ì„ ìˆœìœ„ 3
```

```bash
# í™˜ê²½ ë³€ìˆ˜ê°€ ìš°ì„  (ìš°ì„ ìˆœìœ„ 2)
export SPRING_PROFILES_ACTIVE=staging
java -jar app.jar  # â†’ staging ì ìš©

# ëª…ë ¹í–‰ ì¸ìˆ˜ê°€ ìµœìš°ì„  (ìš°ì„ ìˆœìœ„ 1)
java -jar app.jar --spring.profiles.active=prod  # â†’ prod ì ìš©
```

**íŒŒì¼ ìš°ì„ ìˆœìœ„**:
```
application-{profile}.ymlì´ application.ymlë³´ë‹¤ ìš°ì„ 

1. application-prod.yml (í”„ë¡œíŒŒì¼ ì „ìš©)
2. application.yml (ê³µí†µ ì„¤ì •)
```

---

### Q3: í”„ë¡œíŒŒì¼ ì—†ì´ í•­ìƒ ì‹¤í–‰ë˜ëŠ” ì„¤ì •ì€ ì–´ë–»ê²Œ ë§Œë“œë‚˜ìš”?

**A**: `@Profile` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, `!` (NOT) ì—°ì‚°ìë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
// ë°©ë²• 1: @Profile ì–´ë…¸í…Œì´ì…˜ ì—†ìŒ (í•­ìƒ ì‹¤í–‰)
@Configuration
public class CommonConfig {
    @Bean
    public ObjectMapper objectMapper() {
        return new ObjectMapper();
    }
}

// ë°©ë²• 2: @Profile("!none") (í•­ìƒ ì‹¤í–‰)
@Configuration
@Profile("!none")
public class AlwaysActiveConfig {
    // "none" í”„ë¡œíŒŒì¼ì´ ì•„ë‹Œ ëª¨ë“  ê²½ìš° ì‹¤í–‰
}

// ë°©ë²• 3: ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ì— ê³µí†µ ì ìš©
@Configuration
@Profile({"dev", "prod", "test"})
public class MultiProfileConfig {
    // dev, prod, test ëª¨ë‘ì—ì„œ ì‹¤í–‰
}
```

**application.yml**:
```yaml
# ê³µí†µ ì„¤ì • (í”„ë¡œíŒŒì¼ êµ¬ë¶„ ì—†ì´ í•­ìƒ ì ìš©)
spring:
  application:
    name: myapp

server:
  port: 8080

---
# í”„ë¡œíŒŒì¼ë³„ ì„¤ì • (ë®ì–´ì“°ê¸°)
spring:
  config:
    activate:
      on-profile: dev

server:
  port: 8081  # devì—ì„œë§Œ 8081 í¬íŠ¸ ì‚¬ìš©
```

---

### Q4: í…ŒìŠ¤íŠ¸ì—ì„œ í”„ë¡œíŒŒì¼ì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?

**A**: `@ActiveProfiles` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
// ë‹¨ì¼ í”„ë¡œíŒŒì¼
@SpringBootTest
@ActiveProfiles("test")
class UserServiceTest {
    // test í”„ë¡œíŒŒì¼ í™œì„±í™”
}

// ì—¬ëŸ¬ í”„ë¡œíŒŒì¼
@SpringBootTest
@ActiveProfiles({"test", "mock-api"})
class IntegrationTest {
    // test, mock-api í”„ë¡œíŒŒì¼ ëª¨ë‘ í™œì„±í™”
}

// í…ŒìŠ¤íŠ¸ ì „ìš© ì„¤ì •
@TestConfiguration
@Profile("test")
public class TestConfig {

    @Bean
    public Clock fixedClock() {
        return Clock.fixed(
            Instant.parse("2025-01-01T00:00:00Z"),
            ZoneId.of("Asia/Seoul")
        );
    }

    @Bean
    public PaymentClient mockPaymentClient() {
        return new MockPaymentClient();
    }
}
```

```yaml
# src/test/resources/application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true

logging:
  level:
    root: INFO
    com.myapp: DEBUG
```

---

### Q5: í”„ë¡œíŒŒì¼ í™œì„±í™” ì—¬ë¶€ë¥¼ ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‚˜ìš”?

**A**: `Environment`ë¥¼ ì£¼ì…ë°›ì•„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Service
@RequiredArgsConstructor
public class EmailService {

    private final Environment environment;

    public void sendEmail(String to, String subject, String body) {
        // ë°©ë²• 1: acceptsProfiles() ì‚¬ìš©
        if (environment.acceptsProfiles(Profiles.of("dev"))) {
            log.info("ğŸ“§ [DEV] Mock email to {}: {}", to, subject);
            return;
        }

        // ë°©ë²• 2: getActiveProfiles() ì‚¬ìš©
        String[] activeProfiles = environment.getActiveProfiles();
        boolean isProd = Arrays.asList(activeProfiles).contains("prod");

        if (isProd) {
            log.info("ğŸ“§ [PROD] Sending real email to {}", to);
            actualEmailSender.send(to, subject, body);
        }
    }
}

// í‘œí˜„ì‹ ì‚¬ìš©
if (environment.acceptsProfiles(Profiles.of("prod & monitoring"))) {
    // prodì´ë©´ì„œ monitoringë„ í™œì„±í™”ëœ ê²½ìš°
}

if (environment.acceptsProfiles(Profiles.of("dev | test"))) {
    // dev ë˜ëŠ” test í™˜ê²½
}
```

```java
// Startup ì‹œ í”„ë¡œíŒŒì¼ ì¶œë ¥
@Component
public class ProfileLogger implements ApplicationListener<ApplicationReadyEvent> {

    @Autowired
    private Environment environment;

    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        log.info("========================================");
        log.info("Active Profiles: {}", Arrays.toString(environment.getActiveProfiles()));
        log.info("Default Profiles: {}", Arrays.toString(environment.getDefaultProfiles()));
        log.info("========================================");
    }
}
```

---

## ë©´ì ‘ ì§ˆë¬¸

### ì´ˆê¸‰ ì§ˆë¬¸

**Q1: Spring Boot í”„ë¡œíŒŒì¼ì´ ë¬´ì—‡ì´ê³ , ì™œ ì‚¬ìš©í•˜ë‚˜ìš”?**

**A**: Spring Boot í”„ë¡œíŒŒì¼ì€ **í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ì„¤ì •ì„ ì ìš©**í•˜ê¸° ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

**ì‚¬ìš© ì´ìœ **:
- ê°œë°œ/ìŠ¤í…Œì´ì§•/ìš´ì˜ í™˜ê²½ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤, API ì—”ë“œí¬ì¸íŠ¸, ë¡œê·¸ ë ˆë²¨ ë“±ì´ ë‹¤ë¦„
- í•˜ë“œì½”ë”© ëŒ€ì‹  í”„ë¡œíŒŒì¼ë¡œ í™˜ê²½ì„ ìë™ êµ¬ë¶„
- ì‹¤ìˆ˜ë¡œ dev ì„¤ì •ìœ¼ë¡œ prod ë°°í¬í•˜ëŠ” ê²ƒì„ ë°©ì§€

**ì˜ˆì‹œ**:
```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:h2:mem:devdb  # ê°œë°œ: ì¸ë©”ëª¨ë¦¬ DB

# application-prod.yml
spring:
  datasource:
    url: jdbc:mysql://prod-server:3306/db  # ìš´ì˜: ì‹¤ì œ DB
```

**í™œì„±í™” ë°©ë²•**:
```bash
java -jar app.jar --spring.profiles.active=prod
```

---

**Q2: í”„ë¡œíŒŒì¼ì„ í™œì„±í™”í•˜ëŠ” ë°©ë²• 3ê°€ì§€ë¥¼ ë§í•´ë³´ì„¸ìš”.**

**A**:

**1. application.ymlì—ì„œ ê¸°ë³¸ í”„ë¡œíŒŒì¼ ì§€ì •**:
```yaml
spring:
  profiles:
    active: dev
```

**2. ëª…ë ¹í–‰ ì¸ìˆ˜**:
```bash
java -jar app.jar --spring.profiles.active=prod
```

**3. í™˜ê²½ ë³€ìˆ˜**:
```bash
export SPRING_PROFILES_ACTIVE=prod
java -jar app.jar
```

**ì¶”ê°€ ë°©ë²•**:
- IDE ì„¤ì • (IntelliJ IDEA Run Configuration)
- í…ŒìŠ¤íŠ¸: `@ActiveProfiles("test")`
- ì—¬ëŸ¬ í”„ë¡œíŒŒì¼: `--spring.profiles.active=prod,monitoring`

---

### ì¤‘ê¸‰ ì§ˆë¬¸

**Q3: @Profile ì–´ë…¸í…Œì´ì…˜ì˜ ë™ì‘ ì›ë¦¬ì™€ í‘œí˜„ì‹ ì‚¬ìš©ë²•ì„ ì„¤ëª…í•´ë³´ì„¸ìš”.**

**A**: `@Profile`ì€ **ì¡°ê±´ë¶€ë¡œ ë¹ˆì„ ë“±ë¡**í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ `@Conditional`ì„ ì‚¬ìš©í•˜ì—¬ í™œì„± í”„ë¡œíŒŒì¼ì„ í™•ì¸í•©ë‹ˆë‹¤.

**ê¸°ë³¸ ì‚¬ìš©**:
```java
@Component
@Profile("dev")
public class DevConfig { }  // dev í”„ë¡œíŒŒì¼ì—ì„œë§Œ ë¹ˆ ë“±ë¡

@Component
@Profile("prod")
public class ProdConfig { }  // prod í”„ë¡œíŒŒì¼ì—ì„œë§Œ ë¹ˆ ë“±ë¡
```

**í‘œí˜„ì‹**:
```java
// NOT ì—°ì‚°ì
@Profile("!prod")  // prodê°€ ì•„ë‹Œ ëª¨ë“  í™˜ê²½

// AND ì—°ì‚°ì
@Profile("prod & monitoring")  // prodì´ë©´ì„œ monitoringë„ í™œì„±í™”

// OR ì—°ì‚°ì
@Profile("dev | test")  // dev ë˜ëŠ” test

// ë³µì¡í•œ í‘œí˜„ì‹
@Profile("(prod | staging) & monitoring")
```

**ë™ì‘ ì›ë¦¬**:
```java
// Spring ë‚´ë¶€ ë™ì‘
public class ProfileCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        String[] activeProfiles = context.getEnvironment().getActiveProfiles();
        String profileExpression = metadata.get("value");

        // í‘œí˜„ì‹ í‰ê°€
        return Profiles.of(profileExpression).matches(activeProfiles);
    }
}
```

---

**Q4: í”„ë¡œíŒŒì¼ ê·¸ë£¹(Profile Groups)ì˜ ê°œë…ê³¼ ì‹¤ë¬´ í™œìš© ë°©ë²•ì„ ì„¤ëª…í•´ë³´ì„¸ìš”.**

**A**: í”„ë¡œíŒŒì¼ ê·¸ë£¹ì€ **ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬**í•˜ëŠ” Spring Boot 2.4+ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

**ë¬¸ì œ ìƒí™©**:
```bash
# ìš´ì˜ í™˜ê²½ ì‹¤í–‰ ì‹œ ë§¤ë²ˆ ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ ì…ë ¥ í•„ìš”
java -jar app.jar --spring.profiles.active=prod,mysql,monitoring,security,cache
# ğŸ‘ ê¸¸ê³  ì‹¤ìˆ˜í•˜ê¸° ì‰¬ì›€
```

**í”„ë¡œíŒŒì¼ ê·¸ë£¹ í™œìš©**:
```yaml
spring:
  profiles:
    group:
      production: [prod, mysql, monitoring, security, cache]
      local: [dev, h2, debug, mock-api]
      staging: [staging, mysql, monitoring]
```

```bash
# í•˜ë‚˜ì˜ í”„ë¡œíŒŒì¼ë¡œ ì—¬ëŸ¬ ì„¤ì • í™œì„±í™”
java -jar app.jar --spring.profiles.active=production
# ğŸ‘ ê°„ê²°í•˜ê³  ì‹¤ìˆ˜ ë°©ì§€
```

**ì‹¤ë¬´ í™œìš©**:
```yaml
spring:
  profiles:
    group:
      # ê³„ì¸µí˜• êµ¬ì¡°
      base: [common, logging]

      # í™˜ê²½ë³„
      local: [base, dev, h2, mock-external]
      dev-server: [base, dev, mysql, real-external, monitoring]
      production: [base, prod, mysql-cluster, real-external, monitoring, security, cache]
```

**ì¥ì **:
- âœ… ë³µì¡í•œ í”„ë¡œíŒŒì¼ ì¡°í•©ì„ ë‹¨ìˆœí™”
- âœ… í™˜ê²½ë³„ í‘œì¤€ ì„¤ì • ì •ì˜
- âœ… ì‹¤ìˆ˜ë¡œ í•„ìˆ˜ í”„ë¡œíŒŒì¼ ëˆ„ë½ ë°©ì§€
- âœ… íŒ€ ì „ì²´ê°€ ë™ì¼í•œ í™˜ê²½ ì„¤ì • ì‚¬ìš©

---

**Q5: ìš´ì˜ í™˜ê²½ ë°°í¬ ì‹œ í”„ë¡œíŒŒì¼ ê´€ë ¨ ì•ˆì „ ì¥ì¹˜ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•˜ë‚˜ìš”?**

**A**: ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ì¸µ ì•ˆì „ ì¥ì¹˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

**1. ê¸°ë³¸ í”„ë¡œíŒŒì¼ì„ devë¡œ ê³ ì •**:
```yaml
# application.yml
spring:
  profiles:
    active: dev  # ì‹¤ìˆ˜ë¡œ í”„ë¡œíŒŒì¼ ì—†ì´ ì‹¤í–‰ ì‹œ dev ì ìš©
```

**2. ìš´ì˜ í™˜ê²½ ê²€ì¦ ë¡œì§**:
```java
@Component
@Profile("prod")
public class ProductionSafetyGuard implements ApplicationListener<ApplicationReadyEvent> {

    @Autowired
    private Environment environment;

    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        validateProductionConfig();
    }

    private void validateProductionConfig() {
        // ìœ„í—˜í•œ ì„¤ì • ì²´í¬
        if (environment.getProperty("spring.h2.console.enabled", Boolean.class, false)) {
            throw new IllegalStateException("âŒ H2 Console must be disabled in production!");
        }

        String ddlAuto = environment.getProperty("spring.jpa.hibernate.ddl-auto", "none");
        if (ddlAuto.equals("create") || ddlAuto.equals("create-drop")) {
            throw new IllegalStateException("âŒ DDL auto must be 'validate' in production!");
        }

        // í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ì²´í¬
        requireEnv("DB_PASSWORD");
        requireEnv("API_KEY");

        log.warn("âœ… Production configuration validated");
    }

    private void requireEnv(String key) {
        if (!environment.containsProperty(key)) {
            throw new IllegalStateException(
                String.format("âŒ Required property '%s' is missing!", key)
            );
        }
    }
}
```

**3. ë¯¼ê° ì •ë³´ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ**:
```yaml
# application-prod.yml
spring:
  datasource:
    url: ${PROD_DB_URL}  # í™˜ê²½ ë³€ìˆ˜ í•„ìˆ˜
    username: ${PROD_DB_USERNAME}
    password: ${PROD_DB_PASSWORD}
# í•˜ë“œì½”ë”© ì ˆëŒ€ ê¸ˆì§€!
```

**4. Kubernetes ë°°í¬ ê²€ì¦**:
```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:1.0.0
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "production"  # ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
```

**5. CI/CD íŒŒì´í”„ë¼ì¸ ì²´í¬**:
```yaml
# .gitlab-ci.yml
deploy-prod:
  stage: deploy
  script:
    - |
      # í”„ë¡œíŒŒì¼ ì²´í¬
      if [ "$SPRING_PROFILES_ACTIVE" != "production" ]; then
        echo "âŒ Invalid profile for production deployment!"
        exit 1
      fi
    - kubectl apply -f k8s/production/
  only:
    - main
```

**ê²°ê³¼**:
- âœ… ì˜ëª»ëœ í”„ë¡œíŒŒì¼ë¡œ ìš´ì˜ ë°°í¬ ë¶ˆê°€
- âœ… í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ ì‹œ ì‹œì‘ ì‹¤íŒ¨
- âœ… ìœ„í—˜í•œ ì„¤ì • ìë™ ì°¨ë‹¨
- âœ… ë‹¤ì¸µ ì•ˆì „ ì¥ì¹˜ë¡œ íœ´ë¨¼ ì—ëŸ¬ ë°©ì§€

---

## ë§ˆì¹˜ë©°

í”„ë¡œíŒŒì¼ ê´€ë¦¬ëŠ” **Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬**ë¥¼ ìœ„í•œ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

**í•µì‹¬ ìš”ì•½**:
1. âœ… **í™˜ê²½ ë¶„ë¦¬**: dev/staging/prod ì„¤ì •ì„ ëª…í™•íˆ êµ¬ë¶„
2. âœ… **ì¡°ê±´ë¶€ ë¹ˆ**: @Profileë¡œ í™˜ê²½ë³„ ë‹¤ë¥¸ êµ¬í˜„ì²´ ìë™ ì£¼ì…
3. âœ… **í”„ë¡œíŒŒì¼ ê·¸ë£¹**: ë³µì¡í•œ ì„¤ì • ì¡°í•©ì„ ë‹¨ìˆœí™”
4. âœ… **ì•ˆì „ ì¥ì¹˜**: ìš´ì˜ í™˜ê²½ ê²€ì¦ìœ¼ë¡œ ì‹¤ìˆ˜ ë°©ì§€
5. âœ… **ìœ ì—°ì„±**: ì—¬ëŸ¬ í”„ë¡œíŒŒì¼ ë™ì‹œ í™œì„±í™” ê°€ëŠ¥

**ì‹¤ë¬´ íŒ**:
- ê¸°ë³¸ í”„ë¡œíŒŒì¼ì€ í•­ìƒ `dev`ë¡œ ì„¤ì •
- ìš´ì˜ ì„¤ì •ì€ í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ ê´€ë¦¬ (ì½”ë“œì— ë…¸ì¶œ ê¸ˆì§€)
- í”„ë¡œíŒŒì¼ ê·¸ë£¹ìœ¼ë¡œ í‘œì¤€ í™˜ê²½ ì •ì˜
- ìš´ì˜ í™˜ê²½ ì‹œì‘ ì‹œ ì•ˆì „ ê²€ì¦ ë¡œì§ í•„ìˆ˜

**ë‹¤ìŒ ë‹¨ê³„**:
- Spring Cloud Configë¡œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„¤ì • ê´€ë¦¬
- Kubernetes ConfigMap/Secret ì—°ë™
- ë™ì  í”„ë¡œíŒŒì¼ ì „í™˜ (ëŸ°íƒ€ì„ ì„¤ì • ë³€ê²½)

**ì¶•í•˜í•©ë‹ˆë‹¤! Spring Boot ì „ì²´ ê³¼ì •(29-36ì¥)ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!** ğŸ‰