# 3-3. ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

**ì¶œì²˜**: ì¸í”„ëŸ° - ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ ê¸°ë³¸í¸
**ì±•í„°**: 3. ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ ì´í•´2 - ê°ì²´ ì§€í–¥ ì›ë¦¬ ì ìš©

---

## í•™ìŠµ ëª©í‘œ

- [ ] ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ ê°œë…ì„ ì´í•´í•œë‹¤
- [ ] AppConfigì˜ ì—­í• ê³¼ í•„ìš”ì„±ì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ìƒì„±ì ì£¼ì… ë°©ì‹ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
- [ ] DI(ì˜ì¡´ê´€ê³„ ì£¼ì…) ê°œë…ì„ ì´í•´í•œë‹¤

---

## ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê³µì—°ìœ¼ë¡œ ë¹„ìœ í•˜ê¸°

### ì˜ëª»ëœ ì„¤ê³„ (í˜„ì¬ ìƒí™©)

**ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ ê³µì—° ì˜ˆì‹œ**:

```mermaid
graph LR
    A[ë¡œë¯¸ì˜¤ ì—­í• <br/>ë ˆì˜¤ë‚˜ë¥´ë„ ë””ì¹´í”„ë¦¬ì˜¤]
    B[ì¤„ë¦¬ì—£ ì—­í• <br/>?]

    A -->|ì§ì ‘ ì„­ì™¸!| B

    style A fill:#ffcccc
```

**ë¬¸ì œì **:
- ë¡œë¯¸ì˜¤ ì—­í• (ì¸í„°í˜ì´ìŠ¤)ì„ í•˜ëŠ” ë””ì¹´í”„ë¦¬ì˜¤(êµ¬í˜„ì²´, ë°°ìš°)ê°€
- ì¤„ë¦¬ì—£ ì—­í• (ì¸í„°í˜ì´ìŠ¤)ì„ í•  ì—¬ë°°ìš°(êµ¬í˜„ì²´, ë°°ìš°)ë¥¼ **ì§ì ‘ ì´ˆë¹™**
- ë°°ìš°ê°€ **ê³µì—°ë„ í•˜ê³ , ì„­ì™¸ë„ í•˜ëŠ”** ë‹¤ì–‘í•œ ì±…ì„ì„ ê°€ì§

### ì˜¬ë°”ë¥¸ ì„¤ê³„ (ê°œì„  ë°©í–¥)

**ê³µì—° ê¸°íšìì˜ ì—­í• **:

```mermaid
graph TB
    A[ê³µì—° ê¸°íšì]
    B[ë¡œë¯¸ì˜¤ ì—­í• <br/>ë””ì¹´í”„ë¦¬ì˜¤]
    C[ì¤„ë¦¬ì—£ ì—­í• <br/>ê¹€íƒœí¬]

    A -.ì„­ì™¸.-> B
    A -.ì„­ì™¸.-> C
    B -->|ê³µì—°| C

    style A fill:#e1f5ff
```

**ê°œì„ ëœ ì **:
- ë°°ìš°ëŠ” ë³¸ì¸ì˜ **ì—­í• (ë°°ì—­)ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì—ë§Œ ì§‘ì¤‘**
- ë””ì¹´í”„ë¦¬ì˜¤ëŠ” ì–´ë–¤ ì—¬ì ì£¼ì¸ê³µì´ ì„ íƒë˜ë”ë¼ë„ **ë˜‘ê°™ì´ ê³µì—° ê°€ëŠ¥**
- **ê³µì—° ê¸°íšì**ê°€ ë‹´ë‹¹ ë°°ìš°ë¥¼ ì„­ì™¸í•˜ê³ , ì—­í• ì— ë§ëŠ” ë°°ìš°ë¥¼ ì§€ì •

---

## ê´€ì‹¬ì‚¬ ë¶„ë¦¬í•˜ê¸°

### í•„ìš”í•œ ê²ƒ

**ê³µì—° ê¸°íšìì²˜ëŸ¼**:
- ê³µì—°ì„ êµ¬ì„±í•˜ê³ 
- ë‹´ë‹¹ ë°°ìš°ë¥¼ ì„­ì™¸í•˜ê³ 
- ì—­í• ì— ë§ëŠ” ë°°ìš°ë¥¼ ì§€ì •í•˜ëŠ”
- **ë³„ë„ì˜ ì±…ì„ì„ ë‹´ë‹¹í•˜ëŠ” ì¡´ì¬**

### AppConfig ë“±ì¥

**ì—­í• **:
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì²´ ë™ì‘ ë°©ì‹ì„ **êµ¬ì„±(config)**
- **êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±**í•˜ê³ , **ì—°ê²°**í•˜ëŠ” ì±…ì„ì„ ê°€ì§€ëŠ” ë³„ë„ì˜ ì„¤ì • í´ë˜ìŠ¤

---

## AppConfig êµ¬í˜„

### AppConfig ì½”ë“œ

**AppConfig.java**:

```java
package hello.core;

import hello.core.discount.FixDiscountPolicy;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;

public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(
            new MemoryMemberRepository(),
            new FixDiscountPolicy()
        );
    }
}
```

### AppConfigì˜ ì—­í• 

**1. êµ¬í˜„ ê°ì²´ ìƒì„±**:
- `MemberServiceImpl`
- `MemoryMemberRepository`
- `OrderServiceImpl`
- `FixDiscountPolicy`

**2. ìƒì„±ìë¥¼ í†µí•´ ì˜ì¡´ê´€ê³„ ì£¼ì…(ì—°ê²°)**:
- `MemberServiceImpl` â†’ `MemoryMemberRepository`
- `OrderServiceImpl` â†’ `MemoryMemberRepository`, `FixDiscountPolicy`

---

## ìƒì„±ì ì£¼ì… ì ìš©

### MemberServiceImpl ë³€ê²½

**ë³€ê²½ ì „ - ì§ì ‘ ìƒì„±**:
```java
public class MemberServiceImpl implements MemberService {

    // êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ìƒì„± - DIP ìœ„ë°˜!
    private final MemberRepository memberRepository
        = new MemoryMemberRepository();

    public void join(Member member) {
        memberRepository.save(member);
    }

    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

**ë³€ê²½ í›„ - ìƒì„±ì ì£¼ì…**:
```java
package hello.core.member;

public class MemberServiceImpl implements MemberService {

    // ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´ - DIP ì¤€ìˆ˜!
    private final MemberRepository memberRepository;

    // ìƒì„±ìë¥¼ í†µí•´ êµ¬í˜„ ê°ì²´ ì£¼ì…
    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    public void join(Member member) {
        memberRepository.save(member);
    }

    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

**ê°œì„  íš¨ê³¼**:
- âœ… `MemoryMemberRepository`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- âœ… `MemberRepository` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´
- âœ… ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ì£¼ì…ë ì§€ëŠ” ì™¸ë¶€(`AppConfig`)ì—ì„œ ê²°ì •
- âœ… **ì˜ì¡´ê´€ê³„ì— ëŒ€í•œ ê³ ë¯¼ì€ ì™¸ë¶€ì— ë§¡ê¸°ê³  ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘**

---

### OrderServiceImpl ë³€ê²½

**ë³€ê²½ í›„ - ìƒì„±ì ì£¼ì…**:
```java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;

public class OrderServiceImpl implements OrderService {

    // ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´ - DIP ì¤€ìˆ˜!
    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    // ìƒì„±ìë¥¼ í†µí•´ êµ¬í˜„ ê°ì²´ ì£¼ì…
    public OrderServiceImpl(MemberRepository memberRepository,
                           DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}
```

**ê°œì„  íš¨ê³¼**:
- âœ… `FixDiscountPolicy`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- âœ… `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´
- âœ… ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ì£¼ì…ë ì§€ëŠ” ì™¸ë¶€ì—ì„œ ê²°ì •
- âœ… **ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘**

---

## í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### ì „ì²´ êµ¬ì¡°

```mermaid
classDiagram
    class MemberService {
        <<interface>>
    }
    class MemberServiceImpl {
        -MemberRepository memberRepository
        +MemberServiceImpl(MemberRepository)
    }
    class MemberRepository {
        <<interface>>
    }
    class MemoryMemberRepository {
        +save()
        +findById()
    }
    class AppConfig {
        +memberService()
        +orderService()
    }

    MemberService <|.. MemberServiceImpl
    MemberServiceImpl --> MemberRepository
    MemberRepository <|.. MemoryMemberRepository
    AppConfig ..> MemberServiceImpl : ìƒì„±
    AppConfig ..> MemoryMemberRepository : ìƒì„±
```

**ì—­í•  ë¶„ë¦¬**:
- `AppConfig`: ê°ì²´ ìƒì„±ê³¼ ì—°ê²°
- `MemberServiceImpl`: ì‹¤í–‰ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

---

## ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### íšŒì› ê°ì²´ ì¸ìŠ¤í„´ìŠ¤

```mermaid
graph TB
    A[appConfig]
    B[memoryMemberRepository<br/>x001]
    C[memberServiceImpl]

    A -.1. ìƒì„±.-> B
    A -.2. ìƒì„± + ì£¼ì…<br/>memoryMemberRepository x001.-> C
    C --> B

    style A fill:#e1f5ff
    style B fill:#fff5e1
    style C fill:#f5e1ff
```

**íë¦„**:
1. `appConfig`ê°€ `memoryMemberRepository` ê°ì²´ ìƒì„±
2. `appConfig`ê°€ `memberServiceImpl` ìƒì„±í•˜ë©´ì„œ ìƒì„±ìë¡œ `memoryMemberRepository` ì°¸ì¡°ê°’ ì „ë‹¬
3. `memberServiceImpl` ì…ì¥ì—ì„œëŠ” ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ëŠ” ê²ƒ

---

## DI (Dependency Injection)

### ì˜ì¡´ê´€ê³„ ì£¼ì…

**í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ**:
- `memberServiceImpl` ì…ì¥ì—ì„œ ë³´ë©´
- ì˜ì¡´ê´€ê³„ë¥¼ ë§ˆì¹˜ **ì™¸ë¶€ì—ì„œ ì£¼ì…í•´ì£¼ëŠ” ê²ƒ** ê°™ìŒ

**ìš©ì–´**:
- **DI (Dependency Injection)**
- ìš°ë¦¬ë§ë¡œ **ì˜ì¡´ê´€ê³„ ì£¼ì…** ë˜ëŠ” **ì˜ì¡´ì„± ì£¼ì…**

---

## AppConfig ì‹¤í–‰

### MemberApp ë³€ê²½

**ë³€ê²½ ì „**:
```java
public class MemberApp {
    public static void main(String[] args) {
        MemberService memberService = new MemberServiceImpl();
        // ...
    }
}
```

**ë³€ê²½ í›„**:
```java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;

public class MemberApp {

    public static void main(String[] args) {
        // AppConfigë¥¼ í†µí•´ MemberService ì¡°íšŒ
        AppConfig appConfig = new AppConfig();
        MemberService memberService = appConfig.memberService();

        Member member = new Member(1L, "memberA", Grade.VIP);
        memberService.join(member);

        Member findMember = memberService.findMember(1L);
        System.out.println("new member = " + member.getName());
        System.out.println("find Member = " + findMember.getName());
    }
}
```

---

### OrderApp ë³€ê²½

**ë³€ê²½ í›„**:
```java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;
import hello.core.order.Order;
import hello.core.order.OrderService;

public class OrderApp {

    public static void main(String[] args) {
        // AppConfigë¥¼ í†µí•´ Service ì¡°íšŒ
        AppConfig appConfig = new AppConfig();
        MemberService memberService = appConfig.memberService();
        OrderService orderService = appConfig.orderService();

        long memberId = 1L;
        Member member = new Member(memberId, "memberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 10000);

        System.out.println("order = " + order);
    }
}
```

---

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜ì •

**MemberServiceTest**:
```java
class MemberServiceTest {

    MemberService memberService;

    @BeforeEach
    public void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
    }

    // í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ...
}
```

**OrderServiceTest**:
```java
class OrderServiceTest {

    MemberService memberService;
    OrderService orderService;

    @BeforeEach
    public void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
        orderService = appConfig.orderService();
    }

    // í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ...
}
```

**`@BeforeEach`**:
- ê° í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— í˜¸ì¶œë¨
- AppConfigë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê°ì²´ ìƒì„±

---

## ğŸ’¡ í•µì‹¬ ì •ë¦¬

### ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

**ë°°ì—­ê³¼ ë°°ìš°ì˜ ë¹„ìœ **:

| ì—­í•  | ì±…ì„ | ë¹„ìœ  |
|------|------|------|
| **AppConfig** | - êµ¬í˜„ ê°ì²´ ìƒì„±<br/>- ì˜ì¡´ê´€ê³„ ì—°ê²°<br/>- ì „ì²´ êµ¬ì„± ì±…ì„ | ê³µì—° ê¸°íšì |
| **ServiceImpl** | - ìì‹ ì˜ ê¸°ëŠ¥ ì‹¤í–‰<br/>- ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘ | ë°°ìš° |

### DIP ì™„ì„±

**MemberServiceImpl**:
- âœ… `MemoryMemberRepository`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- âœ… `MemberRepository` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´
- âœ… êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ëª°ë¼ë„ ë¨

### ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

**ì—­í•  ë¶„ë¦¬**:
- âœ… ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ì—­í• : `AppConfig`
- âœ… ì‹¤í–‰í•˜ëŠ” ì—­í• : `MemberServiceImpl`, `OrderServiceImpl`
- âœ… ê´€ì‹¬ì‚¬ê°€ ëª…í™•íˆ ë¶„ë¦¬ë¨

---

## ì •ë¦¬

### AppConfigë¥¼ í†µí•œ ê°œì„ 

**Before**:
```java
// ServiceImplì´ ì§ì ‘ ìƒì„± - ì±…ì„ ê³¼ë‹¤
private final MemberRepository memberRepository
    = new MemoryMemberRepository();
```

**After**:
```java
// AppConfigê°€ ìƒì„±í•˜ì—¬ ì£¼ì… - ì±…ì„ ë¶„ë¦¬
public MemberServiceImpl(MemberRepository memberRepository) {
    this.memberRepository = memberRepository;
}
```

### ì´ì œ ê° ë°°ìš°ë“¤ì€...

- ë‹´ë‹¹ **ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ì±…ì„ë§Œ** ì§€ë©´ ë¨
- `OrderServiceImpl`ì€ **ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ì±…ì„ë§Œ** ì§€ë©´ ë¨
- ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ì£¼ì…ë ì§€ëŠ” **ì•Œ í•„ìš” ì—†ìŒ**
- **ì˜¤ì§ ì™¸ë¶€(AppConfig)ì—ì„œ ê²°ì •**

---

## ë‹¤ìŒ í•™ìŠµ

â¡ï¸ **[3-4. AppConfig ë¦¬íŒ©í„°ë§](./3-4-AppConfigë¦¬íŒ©í„°ë§.md)**
- ì¤‘ë³µ ì œê±°
- ì—­í• ê³¼ êµ¬í˜„ ëª…í™•íˆ ë¶„ë¦¬
- ê°€ë…ì„± í–¥ìƒ
