# 22. 일일 개발 루틴

## 목차
1. [아침: 개발 환경 시작](#아침-개발-환경-시작)
2. [개발 중: 모니터링과 디버깅](#개발-중-모니터링과-디버깅)
3. [코드 변경 시: 재빌드 전략](#코드-변경-시-재빌드-전략)
4. [점심/휴식: 리소스 관리](#점심휴식-리소스-관리)
5. [퇴근 전: 정리 및 백업](#퇴근-전-정리-및-백업)
6. [주간 유지보수](#주간-유지보수)
7. [효율적인 워크플로우 팁](#효율적인-워크플로우-팁)

---

## 아침: 개발 환경 시작

### 빠른 시작 루틴

```bash
#!/bin/bash
# scripts/morning-start.sh

echo "☀️ 좋은 아침입니다! 개발 환경을 시작합니다..."

# 1. Git 최신 상태 확인
echo "📥 Git Pull..."
git pull origin develop

# 2. 환경 변수 확인
if [ ! -f .env.dev ]; then
    echo "❌ .env.dev 파일이 없습니다!"
    exit 1
fi

# 3. Docker 상태 확인
echo "🐳 Docker 상태 확인..."
if ! docker info > /dev/null 2>&1; then
    echo "❌ Docker가 실행 중이 아닙니다."
    echo "Docker Desktop을 시작하세요."
    exit 1
fi

# 4. 불필요한 컨테이너 정리
echo "🧹 이전 컨테이너 정리..."
docker-compose down

# 5. 최신 이미지 확인 (선택사항)
read -p "이미지를 pull 하시겠습니까? (y/N) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "📦 이미지 Pull..."
    docker-compose pull
fi

# 6. 개발 환경 시작
echo "🚀 개발 환경 시작..."
docker-compose -f docker-compose.dev.yml up -d

# 7. 서비스 준비 대기
echo "⏳ 서비스 준비 중..."
sleep 15

# 8. 헬스체크
echo "🏥 헬스체크..."
SERVICES=("user-service:8081" "account-service:8082" "trade-service:8083")
ALL_HEALTHY=true

for service_port in "${SERVICES[@]}"; do
    IFS=':' read -r service port <<< "$service_port"

    if curl -f http://localhost:$port/actuator/health > /dev/null 2>&1; then
        echo "  ✅ $service"
    else
        echo "  ❌ $service (포트 $port 응답 없음)"
        ALL_HEALTHY=false
    fi
done

# 9. 결과 출력
echo ""
if [ "$ALL_HEALTHY" = true ]; then
    echo "✅ 모든 서비스가 정상 작동 중입니다!"
    echo ""
    echo "📋 개발 환경 정보:"
    echo "  - User Service:    http://localhost:8081"
    echo "  - Account Service: http://localhost:8082"
    echo "  - Trade Service:   http://localhost:8083"
    echo "  - AI Service:      http://localhost:8084"
    echo "  - Scraper Service: http://localhost:8085"
    echo "  - pgAdmin:         http://localhost:5050"
    echo "  - Redis Commander: http://localhost:8090"
    echo ""
    echo "💡 유용한 명령어:"
    echo "  - 로그 확인: docker-compose logs -f"
    echo "  - 재시작:   docker-compose restart <service>"
    echo "  - 중지:     docker-compose stop"
else
    echo "⚠️  일부 서비스에 문제가 있습니다."
    echo "로그를 확인하세요: docker-compose logs"
fi
```

### 선택적 시작 (Makefile)

```makefile
# Makefile

.PHONY: morning morning-full morning-minimal

# 기본 시작 (백엔드만)
morning:
	@echo "☀️ 개발 환경 시작 (백엔드만)..."
	@git pull origin develop
	@docker-compose down
	@docker-compose -f docker-compose.dev.yml up -d postgres redis user-service
	@sleep 10
	@make health-check

# 전체 시작 (프론트엔드 포함)
morning-full:
	@echo "☀️ 전체 개발 환경 시작..."
	@git pull origin develop
	@docker-compose down
	@docker-compose -f docker-compose.dev.yml --profile tools up -d
	@sleep 15
	@make health-check

# 최소 시작 (DB만)
morning-minimal:
	@echo "☀️ 최소 환경 시작 (DB만)..."
	@docker-compose -f docker-compose.dev.yml up -d postgres redis
	@sleep 5
	@echo "✅ 데이터베이스 준비 완료"

health-check:
	@echo "🏥 헬스체크 중..."
	@curl -f http://localhost:8081/actuator/health && echo "  ✅ User Service" || echo "  ❌ User Service"
```

### VSCode 자동 시작 설정

```json
// .vscode/tasks.json

{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Dev Environment",
      "type": "shell",
      "command": "make morning",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "runOptions": {
        "runOn": "folderOpen"  // 폴더 열 때 자동 실행
      }
    }
  ]
}
```

---

## 개발 중: 모니터링과 디버깅

### 실시간 로그 모니터링

```bash
# 모든 서비스 로그 (tmux/screen 사용)
docker-compose logs -f

# 특정 서비스만
docker-compose logs -f user-service

# 여러 서비스
docker-compose logs -f user-service account-service

# 컬러 로그 (grc 사용)
grc docker-compose logs -f

# 에러만 필터링
docker-compose logs -f | grep -i error
```

### 터미널 멀티플렉서 설정

```bash
#!/bin/bash
# scripts/dev-tmux.sh

# tmux 세션 생성
tmux new-session -d -s dev

# 윈도우 1: 로그 모니터링
tmux rename-window -t dev:0 'logs'
tmux send-keys -t dev:0 'docker-compose logs -f user-service' C-m

# 윈도우 2: 데이터베이스
tmux new-window -t dev:1 -n 'db'
tmux send-keys -t dev:1 'docker-compose exec postgres psql -U lkuser -d lktrade_dev' C-m

# 윈도우 3: Redis
tmux new-window -t dev:2 -n 'redis'
tmux send-keys -t dev:2 'docker-compose exec redis redis-cli' C-m

# 윈도우 4: 개발 셸
tmux new-window -t dev:3 -n 'dev'

# tmux 세션 연결
tmux attach-session -t dev
```

### 개발 대시보드 (lazydocker)

```bash
# lazydocker 실행
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v ~/.config/lazydocker:/.config/jesseduffield/lazydocker \
    lazyteam/lazydocker

# 단축키:
# - [↑/↓]: 탐색
# - [l]: 로그 보기
# - [r]: 재시작
# - [s]: 중지
# - [e]: 셸 진입
# - [x]: 삭제
```

### 리소스 사용량 모니터링

```bash
#!/bin/bash
# scripts/monitor-resources.sh

watch -n 2 'docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.NetIO}}\t{{.BlockIO}}"'

# 또는 ctop 사용
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    quay.io/vektorlab/ctop:latest
```

---

## 코드 변경 시: 재빌드 전략

### 핫 리로드 활용 (변경 즉시 반영)

**Spring Boot DevTools (자동 재시작)**:

```yaml
# docker-compose.dev.yml

services:
  user-service:
    build:
      context: ./modules/user
      dockerfile: Dockerfile.dev
    volumes:
      - ./modules/user/api/src:/app/api/src:cached  # 소스 코드 마운트
    environment:
      - SPRING_DEVTOOLS_RESTART_ENABLED=true
    # 코드 변경 → 자동 재시작 (5초 이내)
```

**Node.js nodemon (자동 재시작)**:

```yaml
services:
  backend:
    command: nodemon --watch src src/index.js
    volumes:
      - ./src:/app/src:cached
    # 코드 변경 → 즉시 재시작
```

### 수동 재빌드가 필요한 경우

**1. 의존성 변경 (package.json, build.gradle.kts)**:

```bash
# 이미지 재빌드
docker-compose build user-service

# 컨테이너 재시작
docker-compose up -d user-service

# 또는 한 번에
docker-compose up -d --build user-service
```

**2. Dockerfile 변경**:

```bash
# 캐시 없이 재빌드 (완전 재빌드)
docker-compose build --no-cache user-service
docker-compose up -d user-service
```

**3. 환경 변수 변경 (.env)**:

```bash
# 컨테이너 재생성 (재빌드 불필요)
docker-compose up -d --force-recreate user-service
```

### 빠른 재빌드 스크립트

```bash
#!/bin/bash
# scripts/quick-rebuild.sh

SERVICE=$1

if [ -z "$SERVICE" ]; then
    echo "Usage: ./quick-rebuild.sh <service-name>"
    echo "Example: ./quick-rebuild.sh user-service"
    exit 1
fi

echo "🔨 $SERVICE 재빌드 중..."

# 1. 서비스 중지
docker-compose stop $SERVICE

# 2. 이미지 재빌드 (캐시 활용)
docker-compose build $SERVICE

# 3. 서비스 시작
docker-compose up -d $SERVICE

# 4. 로그 확인
echo "📋 로그:"
docker-compose logs -f --tail 50 $SERVICE
```

### Makefile로 간편하게

```makefile
# Makefile

.PHONY: rebuild restart rebuild-all

# 특정 서비스 재빌드
rebuild:
	@read -p "서비스 이름: " service; \
	docker-compose build $$service && \
	docker-compose up -d $$service && \
	docker-compose logs -f $$service

# 특정 서비스 재시작 (재빌드 없이)
restart:
	@read -p "서비스 이름: " service; \
	docker-compose restart $$service && \
	docker-compose logs -f $$service

# 전체 재빌드
rebuild-all:
	@echo "🔨 전체 재빌드 중..."
	@docker-compose build
	@docker-compose up -d
	@echo "✅ 재빌드 완료"

# 빠른 재시작 (주로 사용)
rr:
	@docker-compose restart user-service
	@docker-compose logs -f --tail 50 user-service
```

---

## 점심/휴식: 리소스 관리

### 일시 정지 (리소스 절약)

```bash
# 모든 컨테이너 일시 정지
docker-compose pause

# 특정 컨테이너만 일시 정지
docker-compose pause user-service account-service

# 재개
docker-compose unpause

# 완전 중지 (더 많은 리소스 절약)
docker-compose stop
```

### 리소스 자동 정리 스크립트

```bash
#!/bin/bash
# scripts/lunch-cleanup.sh

echo "🍱 점심시간 리소스 정리..."

# 1. 개발 서비스 일시 정지 (DB는 유지)
docker-compose pause user-service account-service trade-service ai-service scraper-service

# 2. 불필요한 이미지 정리
docker image prune -f

# 3. 중지된 컨테이너 정리
docker container prune -f

# 4. 로그 정리
for container in $(docker ps -a -q); do
    docker logs $container --tail 0 > /dev/null 2>&1
done

# 5. 디스크 사용량 확인
echo ""
echo "💾 Docker 디스크 사용량:"
docker system df

echo ""
echo "✅ 정리 완료! 즐거운 점심시간 되세요 🍴"
```

### cron으로 자동 정리

```bash
# crontab -e

# 매일 점심시간(12:00)에 자동 정리
0 12 * * * cd /path/to/project && ./scripts/lunch-cleanup.sh

# 매주 금요일 퇴근 전(17:00) 전체 정리
0 17 * * 5 cd /path/to/project && docker system prune -af
```

---

## 퇴근 전: 정리 및 백업

### 퇴근 루틴

```bash
#!/bin/bash
# scripts/evening-cleanup.sh

echo "🌙 퇴근 전 정리 시작..."

# 1. Git 상태 확인
echo "📝 Git 상태:"
git status

# 2. 커밋되지 않은 변경사항 확인
if ! git diff-index --quiet HEAD --; then
    echo "⚠️  커밋되지 않은 변경사항이 있습니다!"
    read -p "계속하시겠습니까? (y/N) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 0
    fi
fi

# 3. 로그 백업 (선택사항)
read -p "로그를 백업하시겠습니까? (y/N) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "📋 로그 백업 중..."
    mkdir -p ./logs/$(date +%Y%m%d)

    for service in user-service account-service trade-service; do
        docker-compose logs --no-color $service > ./logs/$(date +%Y%m%d)/${service}.log
    done

    echo "✅ 로그 백업 완료: ./logs/$(date +%Y%m%d)/"
fi

# 4. 데이터베이스 백업 (선택사항)
read -p "데이터베이스를 백업하시겠습니까? (y/N) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "🗄️ 데이터베이스 백업 중..."
    docker-compose exec -T postgres pg_dump -U lkuser lktrade_dev > ./backup/db_$(date +%Y%m%d_%H%M%S).sql
    echo "✅ 백업 완료: ./backup/db_$(date +%Y%m%d_%H%M%S).sql"
fi

# 5. 컨테이너 중지 선택
echo ""
echo "컨테이너를 어떻게 하시겠습니까?"
echo "  1) 모두 중지 (메모리 완전 해제)"
echo "  2) 일시 정지 (빠른 재시작 가능)"
echo "  3) 실행 유지 (내일 바로 시작)"
read -p "선택 (1-3): " -n 1 -r
echo

case $REPLY in
    1)
        echo "🛑 모든 컨테이너 중지..."
        docker-compose down
        ;;
    2)
        echo "⏸️  컨테이너 일시 정지..."
        docker-compose pause
        ;;
    3)
        echo "▶️  컨테이너 실행 유지"
        ;;
    *)
        echo "❌ 잘못된 선택. 실행 유지합니다."
        ;;
esac

# 6. 정리
echo ""
echo "🧹 불필요한 리소스 정리..."
docker system prune -f

# 7. 리소스 사용량 확인
echo ""
echo "💾 Docker 디스크 사용량:"
docker system df

echo ""
echo "✅ 정리 완료! 내일 봐요 👋"
```

### 자동 백업 설정

```bash
#!/bin/bash
# scripts/auto-backup.sh

BACKUP_DIR="./backup"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# 데이터베이스 백업
docker-compose exec -T postgres pg_dump -U lkuser lktrade_dev | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# 볼륨 백업
docker run --rm -v lk-trade_postgres-data:/data -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/postgres-data_$DATE.tar.gz -C /data .

# 오래된 백업 삭제 (7일 이상)
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "✅ 백업 완료: $DATE"
```

---

## 주간 유지보수

### 월요일: 이미지 업데이트

```bash
#!/bin/bash
# scripts/weekly-update.sh

echo "🔄 주간 업데이트 시작..."

# 1. Git 최신화
git pull origin develop

# 2. 베이스 이미지 업데이트
docker-compose pull postgres redis

# 3. 개발 이미지 재빌드
docker-compose build --pull

# 4. 재시작
docker-compose down
docker-compose up -d

# 5. 헬스체크
sleep 20
make health-check

echo "✅ 업데이트 완료!"
```

### 금요일: 전체 정리

```bash
#!/bin/bash
# scripts/friday-cleanup.sh

echo "🧹 주간 대청소..."

# 1. 모든 컨테이너 중지
docker-compose down -v

# 2. 미사용 리소스 정리
docker system prune -af --volumes

# 3. 빌드 캐시 정리
docker builder prune -af

# 4. 디스크 사용량 확인
echo ""
echo "💾 정리 후 디스크 사용량:"
docker system df

# 5. 다음 주 준비
echo ""
echo "📦 다음 주를 위한 이미지 다운로드..."
docker-compose pull

echo ""
echo "✅ 대청소 완료! 즐거운 주말 보내세요 🎉"
```

---

## 효율적인 워크플로우 팁

### 1. 쉘 Alias 설정

```bash
# ~/.bashrc 또는 ~/.zshrc

# Docker Compose 단축어
alias dc='docker-compose'
alias dcu='docker-compose up -d'
alias dcd='docker-compose down'
alias dcl='docker-compose logs -f'
alias dcr='docker-compose restart'
alias dce='docker-compose exec'

# 자주 사용하는 명령어
alias dcup='docker-compose -f docker-compose.dev.yml up -d'
alias dcdown='docker-compose -f docker-compose.dev.yml down'

# LK-Trade 프로젝트 전용
alias lk-start='cd ~/projects/lk-trade && make morning'
alias lk-logs='cd ~/projects/lk-trade && dc logs -f user-service'
alias lk-db='cd ~/projects/lk-trade && dc exec postgres psql -U lkuser -d lktrade_dev'
```

### 2. 커스텀 명령어 (functions)

```bash
# ~/.bashrc

# 서비스별 로그 보기
dclogs() {
    if [ -z "$1" ]; then
        docker-compose logs -f
    else
        docker-compose logs -f "$1"
    fi
}

# 서비스 재시작 + 로그
dcrestart() {
    if [ -z "$1" ]; then
        echo "Usage: dcrestart <service-name>"
        return 1
    fi
    docker-compose restart "$1"
    docker-compose logs -f --tail 50 "$1"
}

# 컨테이너 셸 진입
dcsh() {
    if [ -z "$1" ]; then
        echo "Usage: dcsh <service-name>"
        return 1
    fi
    docker-compose exec "$1" sh
}
```

### 3. Git Hooks 활용

```bash
#!/bin/bash
# .git/hooks/post-merge

# Pull 후 자동으로 컨테이너 재시작

echo "🔄 코드 업데이트 감지. 컨테이너 재시작 중..."

# 의존성 변경 확인
if git diff HEAD@{1} HEAD --name-only | grep -E "package.json|build.gradle.kts"; then
    echo "📦 의존성 변경 감지. 이미지 재빌드..."
    docker-compose build
fi

# 컨테이너 재시작
docker-compose up -d

echo "✅ 재시작 완료!"
```

### 4. 개발 체크리스트

```markdown
## 일일 개발 체크리스트

### 시작 (9:00)
- [ ] Git Pull
- [ ] 개발 환경 시작 (`make morning`)
- [ ] 헬스체크 확인
- [ ] 어제 작업 내용 확인

### 개발 중
- [ ] 로그 모니터링 (에러 확인)
- [ ] 리소스 사용량 확인 (1시간마다)
- [ ] 코드 변경 후 동작 확인
- [ ] 테스트 작성 및 실행

### 점심 (12:00-13:00)
- [ ] 작업 중인 내용 커밋
- [ ] 컨테이너 일시 정지 (선택)

### 퇴근 전 (18:00)
- [ ] Git 커밋 및 푸시
- [ ] 로그 백업 (필요시)
- [ ] 컨테이너 정리
- [ ] 내일 할 일 정리

### 주간 (금요일)
- [ ] 전체 리소스 정리
- [ ] 이미지 업데이트
- [ ] 주간 회고
```

### 5. 모니터링 대시보드

```bash
#!/bin/bash
# scripts/dashboard.sh

# tmux 대시보드 생성

tmux new-session -d -s dashboard

# 상단: 리소스 모니터링
tmux send-keys -t dashboard 'docker stats' C-m

# 하단 왼쪽: 로그
tmux split-window -v -t dashboard
tmux send-keys -t dashboard 'docker-compose logs -f user-service' C-m

# 하단 오른쪽: 명령어 입력
tmux split-window -h -t dashboard

tmux attach-session -t dashboard
```

### 6. VSCode 통합

```json
// .vscode/settings.json

{
  "docker.explorerRefreshInterval": 1000,
  "docker.showExplorer": true,

  // 작업 공간 자동 명령어
  "emeraldwalk.runonsave": {
    "commands": [
      {
        "match": ".*\\.kt$",
        "cmd": "echo 'Kotlin 파일 변경 감지. DevTools가 자동 재시작합니다.'"
      }
    ]
  }
}
```

```json
// .vscode/launch.json

{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Attach to User Service",
      "type": "kotlin",
      "request": "attach",
      "hostName": "localhost",
      "port": 5005,
      "timeout": 30000
    }
  ]
}
```

---

## 트러블슈팅: 일상적인 문제들

### 문제 1: 아침에 컨테이너가 시작 안됨

```bash
# 원인: 이전 컨테이너가 비정상 종료

# 해결
docker-compose down -v  # 볼륨 포함 완전 삭제
docker-compose up -d

# 또는
docker system prune -f
docker-compose up -d
```

### 문제 2: 핫 리로드가 작동 안함

```bash
# 원인: 파일 감시 설정 문제

# 해결 (Mac/Windows)
# docker-compose.yml
volumes:
  - ./src:/app/src:cached  # cached 옵션 추가

# nodemon.json
{
  "legacyWatch": true,
  "polling": true
}
```

### 문제 3: 디스크 공간 부족

```bash
# 진단
docker system df

# 해결
docker system prune -af --volumes  # 전체 정리 (주의!)

# 또는 선택적 정리
docker image prune -a     # 미사용 이미지
docker volume prune       # 미사용 볼륨
docker builder prune -a   # 빌드 캐시
```

---

## 다음 단계

### 23. 팀 협업
- 공통 개발 환경 구성
- Git을 통한 설정 공유
- 환경 변수 관리 전략

### 학습 자료

**생산성 도구**:
- [tmux 가이드](https://github.com/tmux/tmux/wiki)
- [lazydocker](https://github.com/jesseduffield/lazydocker)
- [ctop](https://github.com/bcicen/ctop)

**자동화**:
- [GitHub Actions](https://docs.github.com/en/actions)
- [Git Hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)

---

**축하합니다! 🎉** 효율적인 일일 개발 루틴을 마스터했습니다!