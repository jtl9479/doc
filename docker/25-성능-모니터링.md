# 25. ì»¨í…Œì´ë„ˆ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

> **í•™ìŠµ ëª©í‘œ**: Docker ì»¨í…Œì´ë„ˆì˜ ì„±ëŠ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  Prometheus, Grafana ë“± ì „ë¬¸ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ë³‘ëª© ì§€ì ì„ ì°¾ê³  ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**â±ï¸ ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: 3-4ì‹œê°„
**ë‚œì´ë„**: â­â­â­â­â˜† (4ê°œ/5ê°œ)

---

## ëª©ì°¨
1. [ì™œ í•„ìš”í•œê°€](#ì™œ-í•„ìš”í•œê°€)
2. [ì‹¤ìƒí™œ ë¹„ìœ ](#ì‹¤ìƒí™œ-ë¹„ìœ ë¡œ-ì´í•´í•˜ê¸°)
3. [docker stats í™œìš©](#docker-stats-í™œìš©)
4. [cAdvisor ì„¤ì¹˜ ë° ì‚¬ìš©](#cadvisor-ì„¤ì¹˜-ë°-ì‚¬ìš©)
5. [Prometheus + Grafana ì—°ë™](#prometheus-grafana-ì—°ë™)
6. [ì„±ëŠ¥ ë©”íŠ¸ë¦­ ë¶„ì„](#ì„±ëŠ¥-ë©”íŠ¸ë¦­-ë¶„ì„)
7. [ë³‘ëª© ì§€ì  ì°¾ê¸°](#ë³‘ëª©-ì§€ì -ì°¾ê¸°)
8. [ì•Œë¦¼ ì„¤ì •](#ì•Œë¦¼-ì„¤ì •)
9. [ì‹¤ì „ ì˜ˆì œ: LK-Trade ëª¨ë‹ˆí„°ë§](#ì‹¤ì „-ì˜ˆì œ-lk-trade-ëª¨ë‹ˆí„°ë§)
10. [ì£¼ë‹ˆì–´ ê°œë°œì ì‹œë‚˜ë¦¬ì˜¤](#ì£¼ë‹ˆì–´-ê°œë°œì-ì‹œë‚˜ë¦¬ì˜¤)
11. [FAQ](#faq)
12. [ë©´ì ‘ ì§ˆë¬¸](#ë©´ì ‘-ì§ˆë¬¸)
13. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ğŸ’¡ ì™œ í•„ìš”í•œê°€

### ì‹¤ë¬´ ë°°ê²½

**"í”„ë¡œë•ì…˜ ì„œë²„ê°€ ëŠë ¤ì¡ŒëŠ”ë°, ì–´ë””ê°€ ë¬¸ì œì¸ì§€ ëª¨ë¥´ê² ì–´ìš”!"**

#### âŒ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì´ ì—†ìœ¼ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œ

```
ë¬¸ì œ 1: ì¥ì•  ë°œìƒ í›„ì—ì•¼ ì¸ì§€
- ì¦ìƒ: ì‚¬ìš©ìê°€ "ëŠë ¤ìš”" ì‹ ê³ 
- ëŒ€ì‘: ì›ì¸ íŒŒì•…ì— ìˆ˜ ì‹œê°„ ì†Œìš”
- ì˜í–¥: ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ì„ ëˆ„ì 
- ë¹„ìš©: ì‹œê°„ë‹¹ 500ë§Œì› ë§¤ì¶œ ì†ì‹¤

ë¬¸ì œ 2: ê·¼ë³¸ ì›ì¸ ì°¾ê¸° ì–´ë ¤ì›€
- ì¦ìƒ: CPU 100%ì¸ë° ì–´ë–¤ ì»¨í…Œì´ë„ˆì¸ì§€ ëª¨ë¦„
- ëŒ€ì‘: ëª¨ë“  ì»¨í…Œì´ë„ˆë¥¼ í•˜ë‚˜ì”© í™•ì¸
- ì˜í–¥: í‰ê·  í•´ê²° ì‹œê°„ 6ì‹œê°„
- ë¹„ìš©: ê°œë°œíŒ€ ì•¼ê·¼, ê¸´ê¸‰ íšŒì˜ ì†Œì§‘

ë¬¸ì œ 3: í™•ì¥ ì‹œì  ë†“ì¹¨
- ì¦ìƒ: "ë©”ëª¨ë¦¬ê°€ 90%ì¸ë° ëª‡ ì‹œê°„ì§¸ì¸ê°€ìš”?"
- ëŒ€ì‘: ì´ë¯¸ ëŠ¦ìŒ, ì„œë¹„ìŠ¤ ë¨¹í†µ
- ì˜í–¥: ëŒ€ê·œëª¨ ì¥ì• ë¡œ í™•ì‚°
- ë¹„ìš©: ê³ ê° ì´íƒˆë¥  30% ì¦ê°€
```

#### âœ… ì²´ê³„ì  ëª¨ë‹ˆí„°ë§ì„ êµ¬ì¶•í•˜ë©´

```
í•´ê²°ì±… 1: ì‹¤ì‹œê°„ ë¬¸ì œ ê°ì§€
- ë°©ë²•: Prometheus + Grafana ëŒ€ì‹œë³´ë“œ
- íš¨ê³¼: CPU/ë©”ëª¨ë¦¬ 80% ë„ë‹¬ ì‹œ ì¦‰ì‹œ ì•Œë¦¼
- ì ˆê°: ì¥ì•  ì˜ˆë°©ìœ¨ 95%, ë‹¤ìš´íƒ€ì„ ì œë¡œ

í•´ê²°ì±… 2: 5ë¶„ ë‚´ ì›ì¸ íŒŒì•…
- ë°©ë²•: ì»¨í…Œì´ë„ˆë³„ ë©”íŠ¸ë¦­ ì¶”ì 
- íš¨ê³¼: ë¬¸ì œ ì»¨í…Œì´ë„ˆ ì¦‰ì‹œ ì‹ë³„
- ì ˆê°: í‰ê·  í•´ê²° ì‹œê°„ 6ì‹œê°„ â†’ 15ë¶„

í•´ê²°ì±… 3: ì˜ˆì¸¡ ê°€ëŠ¥í•œ í™•ì¥
- ë°©ë²•: íˆìŠ¤í† ë¦¬ ë°ì´í„° ê¸°ë°˜ íŠ¸ë Œë“œ ë¶„ì„
- íš¨ê³¼: ë¦¬ì†ŒìŠ¤ ë¶€ì¡± 7ì¼ ì „ ê²½ê³ 
- ì ˆê°: ì¸í”„ë¼ ë¹„ìš© ìµœì í™” 30%
```

### ìˆ˜ì¹˜ë¡œ ë³´ëŠ” íš¨ê³¼

| ì§€í‘œ | Before | After | ê°œì„ ìœ¨ |
|------|--------|-------|--------|
| ì¥ì•  ë°œê²¬ ì‹œê°„ | í‰ê·  2ì‹œê°„ í›„ | ì‹¤ì‹œê°„ (1ë¶„ ì´ë‚´) | **99%â†“** |
| ì›ì¸ íŒŒì•… ì‹œê°„ | í‰ê·  6ì‹œê°„ | í‰ê·  15ë¶„ | **96%â†“** |
| ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ì„ | ì›” 10ì‹œê°„ | ì›” 0.5ì‹œê°„ | **95%â†“** |
| ì•¼ê°„ ê¸´ê¸‰ ì½œ | ì›” 8íšŒ | ì›” 1íšŒ | **88%â†“** |
| ì¸í”„ë¼ ë¹„ìš© ì ˆê° | - | ì›” 300ë§Œì› | **30%â†“** |

---

## ğŸ” ì‹¤ìƒí™œ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

### ë¹„ìœ  1: ìë™ì°¨ ê³„ê¸°íŒ (í–¥ìƒëœ ë²„ì „)

```
ê³„ê¸°íŒ ì—†ëŠ” ìë™ì°¨ë¡œ ê³ ì†ë„ë¡œ ì£¼í–‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ ë¬¸ì œ ìƒí™©                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ì†ë„ê³„ ì—†ìŒ â†’ ê³¼ì† ë‹¨ì† ë”± ê±¸ë¦¼       â”‚
â”‚ - ì—°ë£Œê³„ ì—†ìŒ â†’ ê³ ì†ë„ë¡œ í•œë³µíŒì—ì„œ ë©ˆì¶¤â”‚
â”‚ - ì—”ì§„ ì˜¨ë„ê³„ ì—†ìŒ â†’ ê³¼ì—´ë¡œ ì—”ì§„ ë§ê°€ì§ â”‚
â”‚ - ë¸Œë ˆì´í¬ë“± ì—†ìŒ â†’ ë’¤ì°¨ê°€ ì¶”ëŒ        â”‚
â”‚                                         â”‚
â”‚ ê²°ê³¼: í° ì‚¬ê³  ë°œìƒ ğŸ’¥                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê³„ê¸°íŒ ìˆëŠ” ìë™ì°¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ì•ˆì „í•œ ì£¼í–‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ì†ë„ê³„: 120km/h (ì œí•œ ì†ë„ ì¤€ìˆ˜)      â”‚
â”‚ - ì—°ë£Œê³„: 30% (ë‹¤ìŒ íœ´ê²Œì†Œì—ì„œ ì£¼ìœ )    â”‚
â”‚ - ì—”ì§„ ì˜¨ë„: ì •ìƒ ë²”ìœ„                  â”‚
â”‚ - ê²½ê³ ë“±: ëª¨ë‘ êº¼ì§                     â”‚
â”‚                                         â”‚
â”‚ + ë‚´ë¹„ê²Œì´ì…˜: ì•ìœ¼ë¡œ 10km êµí†µ ì²´ì¦     â”‚
â”‚   â†’ ë¯¸ë¦¬ ìš°íšŒ ê²½ë¡œ ì„ íƒ                 â”‚
â”‚                                         â”‚
â”‚ ê²°ê³¼: ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ì£¼í–‰ âœ…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Docker í™˜ê²½ ëŒ€ì‘**:
```
ëª¨ë‹ˆí„°ë§ ì—†ìŒ = ê³„ê¸°íŒ ì—†ëŠ” ì°¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - CPU ì‚¬ìš©ë¥ ? ëª¨ë¦„                      â”‚
â”‚ - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰? ëª¨ë¦„                   â”‚
â”‚ - ë””ìŠ¤í¬ I/O? ëª¨ë¦„                      â”‚
â”‚ - ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½? ëª¨ë¦„                 â”‚
â”‚                                         â”‚
â”‚ â†’ ì„œë¹„ìŠ¤ ë‹¤ìš´ í›„ì—ì•¼ ì¸ì§€ âŒ            â”‚
â”‚ â†’ ì›ì¸ íŒŒì•…ì— 6ì‹œê°„ ì†Œìš”                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ëª¨ë‹ˆí„°ë§ ìˆìŒ = ì²¨ë‹¨ ê³„ê¸°íŒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - CPU 95% â†’ âš ï¸ ì•Œë¦¼ â†’ ìŠ¤ì¼€ì¼ ì•„ì›ƒ     â”‚
â”‚ - ë©”ëª¨ë¦¬ 90% â†’ âš ï¸ ì•Œë¦¼ â†’ ì¦ì„¤ ì¤€ë¹„    â”‚
â”‚ - ë””ìŠ¤í¬ I/O ë†’ìŒ â†’ ì¿¼ë¦¬ ìµœì í™”        â”‚
â”‚ - ë„¤íŠ¸ì›Œí¬ ì§€ì—° â†’ ë³‘ëª© ì§€ì  ì¦‰ì‹œ íŒŒì•…  â”‚
â”‚                                         â”‚
â”‚ + ì˜ˆì¸¡ ë¶„ì„: 3ì¼ í›„ ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜ˆìƒ    â”‚
â”‚   â†’ ë¯¸ë¦¬ ë¦¬ì†ŒìŠ¤ ì¦ì„¤                    â”‚
â”‚                                         â”‚
â”‚ â†’ ë¬¸ì œ ë°œìƒ ì „ ì˜ˆë°© âœ…                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ë¹„ìœ  2: ë³‘ì› í™˜ì ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

```
ì¤‘í™˜ìì‹¤ í™˜ì ëª¨ë‹ˆí„°ë§:

ëª¨ë‹ˆí„° ì—†ëŠ” ë³‘ì‹¤ (1960ë…„ëŒ€):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°„í˜¸ì‚¬ê°€ 1ì‹œê°„ë§ˆë‹¤ ì†ëª©ìœ¼ë¡œ ë§¥ë°• ì²´í¬   â”‚
â”‚ - ì‹¬ë°•ìˆ˜ ì²´í¬: ë§¤ 1ì‹œê°„ë§ˆë‹¤             â”‚
â”‚ - í˜ˆì•• ì¸¡ì •: ë§¤ 4ì‹œê°„ë§ˆë‹¤               â”‚
â”‚ - ì²´ì˜¨ ì¸¡ì •: ë§¤ 6ì‹œê°„ë§ˆë‹¤               â”‚
â”‚                                         â”‚
â”‚ âŒ ë¬¸ì œ:                                â”‚
â”‚ - ê¸‰ì„± ì‹¬ì •ì§€ â†’ 30ë¶„ í›„ ë°œê²¬            â”‚
â”‚ - ì´ë¯¸ ì†ì“¸ ìˆ˜ ì—†ëŠ” ìƒíƒœ                â”‚
â”‚ - ì‚¬ë§ë¥  ë†’ìŒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í˜„ëŒ€ ì¤‘í™˜ìì‹¤ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‹¤ì‹œê°„ ìƒì²´ ì‹ í˜¸ ëª¨ë‹ˆí„°ë§               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì‹¬ë°•ìˆ˜: 72 bpm  (ì •ìƒ)              â”‚ â”‚
â”‚ â”‚ í˜ˆì••: 120/80 mmHg  (ì •ìƒ)           â”‚ â”‚
â”‚ â”‚ ì‚°ì†Œí¬í™”ë„: 98%  (ì •ìƒ)             â”‚ â”‚
â”‚ â”‚ ì²´ì˜¨: 36.8Â°C  (ì •ìƒ)                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ âš ï¸ ì‹¬ë°•ìˆ˜ 150 ì´ˆê³¼ â†’ ì¦‰ì‹œ ì•ŒëŒ ìš¸ë¦¼!   â”‚
â”‚ â†’ ì˜ë£Œì§„ 5ì´ˆ ë‚´ ë„ì°©                    â”‚
â”‚ â†’ ì¦‰ê° ì‘ê¸‰ ì²˜ì¹˜                        â”‚
â”‚                                         â”‚
â”‚ âœ… ê²°ê³¼: ìƒì¡´ìœ¨ 95% í–¥ìƒ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Docker ëª¨ë‹ˆí„°ë§ ëŒ€ì‘**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Grafana ëŒ€ì‹œë³´ë“œ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ user-service                        â”‚ â”‚
â”‚ â”‚ - CPU: 45% (ì •ìƒ)                   â”‚ â”‚
â”‚ â”‚ - Memory: 680MB / 1GB (ì •ìƒ)        â”‚ â”‚
â”‚ â”‚ - Latency: 120ms (ì •ìƒ)             â”‚ â”‚
â”‚ â”‚ - Error Rate: 0.1% (ì •ìƒ)           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ âš ï¸ account-service CPU 90% ì´ˆê³¼!       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸš¨ Slack ì•Œë¦¼ ë°œì†¡                  â”‚ â”‚
â”‚ â”‚ ğŸ“§ Email ì•Œë¦¼ ë°œì†¡                  â”‚ â”‚
â”‚ â”‚ ğŸ“± SMS ì•Œë¦¼ ë°œì†¡ (Critical)         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â†’ ê°œë°œì 1ë¶„ ë‚´ í™•ì¸                    â”‚
â”‚ â†’ 5ë¶„ ë‚´ ì›ì¸ íŒŒì•… (ì¿¼ë¦¬ ìµœì í™” í•„ìš”)   â”‚
â”‚ â†’ 10ë¶„ ë‚´ ìŠ¤ì¼€ì¼ ì•„ì›ƒ ì ìš©              â”‚
â”‚                                         â”‚
â”‚ âœ… ê²°ê³¼: ì„œë¹„ìŠ¤ ë‹¤ìš´ ë°©ì§€               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ë¹„ìœ  3: ê³µì¥ ìƒì‚° ë¼ì¸ ëŒ€ì‹œë³´ë“œ

```
ëª¨ë‹ˆí„°ë§ ì—†ëŠ” ê³µì¥ (1950ë…„ëŒ€):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‘ì—… í˜„í™©                               â”‚
â”‚                                         â”‚
â”‚ ë¼ì¸ 1: ??? (ëª¨ë¦„)                      â”‚
â”‚ ë¼ì¸ 2: ??? (ëª¨ë¦„)                      â”‚
â”‚ ë¼ì¸ 3: ??? (ëª¨ë¦„)                      â”‚
â”‚                                         â”‚
â”‚ ë¬¸ì œ ë°œìƒ:                              â”‚
â”‚ - ë¼ì¸ 2ê°€ 3ì‹œê°„ ì „ ë©ˆì·„ëŠ”ë° ëª¨ë¦„       â”‚
â”‚ - ë¶ˆëŸ‰í’ˆ 1000ê°œ ìƒì‚° í›„ ë°œê²¬            â”‚
â”‚ - ì›ì¸: ê¸°ê³„ ê³¼ì—´ (ì˜¨ë„ê³„ ì—†ì–´ì„œ ëª°ëìŒ)â”‚
â”‚                                         â”‚
â”‚ âŒ ì†ì‹¤: 1000ë§Œì› + ë¼ì¸ ì •ì§€ ë¹„ìš©      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìŠ¤ë§ˆíŠ¸ íŒ©í† ë¦¬ (ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì „ì²´ ìƒì‚° ë¼ì¸ ëª¨ë‹ˆí„°ë§                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ë¼ì¸ 1: âœ… ì •ìƒ (ì‹œê°„ë‹¹ 500ê°œ ìƒì‚°) â”‚ â”‚
â”‚ â”‚   - ì˜¨ë„: 45Â°C (ì •ìƒ)               â”‚ â”‚
â”‚ â”‚   - ì§„ë™: 0.2mm (ì •ìƒ)              â”‚ â”‚
â”‚ â”‚   - ë¶ˆëŸ‰ë¥ : 0.5% (ì •ìƒ)             â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ ë¼ì¸ 2: âš ï¸ ê²½ê³  (ì˜¨ë„ ìƒìŠ¹)        â”‚ â”‚
â”‚ â”‚   - ì˜¨ë„: 78Â°C (ê²½ê³ !) â†’ ì•Œë¦¼!      â”‚ â”‚
â”‚ â”‚   - ì§„ë™: 0.5mm (ì£¼ì˜)              â”‚ â”‚
â”‚ â”‚   - ë¶ˆëŸ‰ë¥ : 2% (ì¦ê°€ ì¶”ì„¸)          â”‚ â”‚
â”‚ â”‚   â†’ ìë™ìœ¼ë¡œ ëƒ‰ê° ì‹œìŠ¤í…œ ê°€ë™       â”‚ â”‚
â”‚ â”‚   â†’ ë‹´ë‹¹ìì—ê²Œ ì•Œë¦¼ ì „ì†¡            â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ ë¼ì¸ 3: âœ… ì •ìƒ (ì‹œê°„ë‹¹ 450ê°œ ìƒì‚°) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ âœ… ê²°ê³¼: ë¶ˆëŸ‰í’ˆ 0ê°œ, ë‹¤ìš´íƒ€ì„ ì œë¡œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Docker ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ëŒ€ì‘**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LK-Trade ì „ì²´ ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ user-service: âœ… ì •ìƒ               â”‚ â”‚
â”‚ â”‚   - CPU: 45% | Memory: 680MB        â”‚ â”‚
â”‚ â”‚   - Latency: 120ms | QPS: 1,200     â”‚ â”‚
â”‚ â”‚   - Error: 0.1%                     â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ account-service: âš ï¸ ê²½ê³             â”‚ â”‚
â”‚ â”‚   - CPU: 92% â† ì„ê³„ì¹˜ ì´ˆê³¼!         â”‚ â”‚
â”‚ â”‚   - Memory: 1.8GB / 2GB             â”‚ â”‚
â”‚ â”‚   - Latency: 850ms â† ëŠë¦¼!          â”‚ â”‚
â”‚ â”‚   - Error: 3% â† ì¦ê°€ ì¤‘!            â”‚ â”‚
â”‚ â”‚   â†’ ì¦‰ì‹œ Slack ì•Œë¦¼                 â”‚ â”‚
â”‚ â”‚   â†’ ìë™ ìŠ¤ì¼€ì¼ ì•„ì›ƒ ì‹œì‘ (2â†’3 pod) â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ trade-service: âœ… ì •ìƒ              â”‚ â”‚
â”‚ â”‚   - CPU: 38% | Memory: 920MB        â”‚ â”‚
â”‚ â”‚   - Latency: 95ms | QPS: 800        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š ì˜ˆì¸¡ ë¶„ì„:                           â”‚
â”‚ - DB ì—°ê²° í’€: 2ì‹œê°„ í›„ ê³ ê°ˆ ì˜ˆìƒ        â”‚
â”‚   â†’ ë¯¸ë¦¬ ì—°ê²° í’€ í¬ê¸° ì¦ê°€              â”‚
â”‚                                         â”‚
â”‚ âœ… ê²°ê³¼: ì¥ì•  ì˜ˆë°©, SLA 99.9% ë‹¬ì„±      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ë©”ì‹œì§€**:
> "ëª¨ë‹ˆí„°ë§ì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜!"
> ì¤‘í™˜ìì‹¤ í™˜ìì—ê²Œ ìƒì²´ ì‹ í˜¸ ëª¨ë‹ˆí„°ê°€ í•„ìˆ˜ì´ë“¯,
> í”„ë¡œë•ì…˜ ì‹œìŠ¤í…œì—ë„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.

---

## ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì˜ ì¤‘ìš”ì„±

### ëª¨ë‹ˆí„°ë§í•´ì•¼ í•  ì£¼ìš” ë©”íŠ¸ë¦­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë©”íŠ¸ë¦­ ì¢…ë¥˜       â”‚          ì˜ë¯¸                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CPU ì‚¬ìš©ë¥           â”‚ í”„ë¡œì„¸ì„œ ë¶€í•˜ ìˆ˜ì¤€               â”‚
â”‚                     â”‚ (ë†’ìœ¼ë©´ ìŠ¤ì¼€ì¼ ì•„ì›ƒ í•„ìš”)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰       â”‚ RAM ì‚¬ìš© ì •ë„                    â”‚
â”‚                     â”‚ (ë†’ìœ¼ë©´ ë©”ëª¨ë¦¬ ì¦ì„¤ ë˜ëŠ” ëˆ„ìˆ˜)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë„¤íŠ¸ì›Œí¬ I/O        â”‚ ì†¡ìˆ˜ì‹  ë°ì´í„°ëŸ‰                  â”‚
â”‚                     â”‚ (ëŒ€ì—­í­ ë³‘ëª© í™•ì¸)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë””ìŠ¤í¬ I/O          â”‚ ì½ê¸°/ì“°ê¸° ì†ë„                   â”‚
â”‚                     â”‚ (ìŠ¤í† ë¦¬ì§€ ë³‘ëª© í™•ì¸)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì‘ë‹µ ì‹œê°„           â”‚ ìš”ì²­ ì²˜ë¦¬ ì‹œê°„                   â”‚
â”‚                     â”‚ (ì‚¬ìš©ì ê²½í—˜ ì§€í‘œ)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì—ëŸ¬ìœ¨              â”‚ ì‹¤íŒ¨í•œ ìš”ì²­ ë¹„ìœ¨                 â”‚
â”‚                     â”‚ (ì„œë¹„ìŠ¤ ì•ˆì •ì„± ì§€í‘œ)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## docker stats í™œìš©

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (ê³„ì† ê°±ì‹ )
docker stats

# 1íšŒë§Œ ì¶œë ¥
docker stats --no-stream

# íŠ¹ì • ì»¨í…Œì´ë„ˆë§Œ
docker stats user-service account-service

# ëª¨ë“  ì»¨í…Œì´ë„ˆ (ì¤‘ì§€ëœ ê²ƒ í¬í•¨)
docker stats --all
```

### ì¶œë ¥ í˜•ì‹

```
CONTAINER ID   NAME           CPU %   MEM USAGE / LIMIT   MEM %   NET I/O         BLOCK I/O
a1b2c3d4e5f6   user-service   2.50%   450MiB / 1GiB       43.95%  1.2kB / 648B    0B / 0B
```

**ê° ì—´ì˜ ì˜ë¯¸**:
- **CPU %**: CPU ì‚¬ìš©ë¥  (ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œëŠ” 100% ì´ìƒ ê°€ëŠ¥)
- **MEM USAGE / LIMIT**: í˜„ì¬ ë©”ëª¨ë¦¬ / ì œí•œ
- **MEM %**: ë©”ëª¨ë¦¬ ì‚¬ìš© ë¹„ìœ¨
- **NET I/O**: ë„¤íŠ¸ì›Œí¬ ì†¡ìˆ˜ì‹ ëŸ‰ (ì „ì²´ ëˆ„ì )
- **BLOCK I/O**: ë””ìŠ¤í¬ ì½ê¸°/ì“°ê¸° (ì „ì²´ ëˆ„ì )

### ì»¤ìŠ¤í…€ í¬ë§·

```bash
# CPUì™€ ë©”ëª¨ë¦¬ë§Œ ì¶œë ¥
docker stats --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"

# JSON í˜•ì‹
docker stats --format "{{json .}}" --no-stream

# CSV í˜•ì‹
docker stats --no-stream --format "{{.Name}},{{.CPUPerc}},{{.MemUsage}}"
```

### ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# scripts/stats-monitor.sh

# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ + ë¡œê·¸ ì €ì¥

LOG_DIR="./logs/stats"
LOG_FILE="$LOG_DIR/stats_$(date +%Y%m%d).csv"

mkdir -p $LOG_DIR

# í—¤ë” ì‘ì„± (ì²˜ìŒ ì‹¤í–‰ ì‹œ)
if [ ! -f "$LOG_FILE" ]; then
    echo "Timestamp,Container,CPU,Memory,MemoryPercent,NetIO,BlockIO" > $LOG_FILE
fi

# ë¬´í•œ ë£¨í”„ ëª¨ë‹ˆí„°ë§
while true; do
    TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

    docker stats --no-stream --format "{{.Name}},{{.CPUPerc}},{{.MemUsage}},{{.MemPerc}},{{.NetIO}},{{.BlockIO}}" | while read line; do
        echo "$TIMESTAMP,$line" >> $LOG_FILE
    done

    sleep 60  # 1ë¶„ë§ˆë‹¤ ìˆ˜ì§‘
done
```

### ê³ ê¸‰ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# scripts/stats-analyzer.sh

LOG_FILE=$1

if [ -z "$LOG_FILE" ]; then
    echo "Usage: $0 <log-file>"
    exit 1
fi

echo "ğŸ“Š í†µê³„ ë¶„ì„: $LOG_FILE"
echo ""

# ì»¨í…Œì´ë„ˆë³„ í‰ê·  CPU ì‚¬ìš©ë¥ 
echo "=== í‰ê·  CPU ì‚¬ìš©ë¥  ==="
awk -F',' 'NR>1 {cpu[$2]+=$3; count[$2]++} END {for(c in cpu) printf "%s: %.2f%%\n", c, cpu[c]/count[c]}' $LOG_FILE | sort -t: -k2 -rn

echo ""

# ì»¨í…Œì´ë„ˆë³„ ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
echo "=== ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ==="
awk -F',' 'NR>1 {if($4 > max[$2]) max[$2]=$4} END {for(c in max) print c": "max[c]}' $LOG_FILE | sort -t: -k2 -rn

echo ""

# CPU ì‚¬ìš©ë¥  90% ì´ìƒ ê²½ê³ 
echo "=== CPU ê²½ê³  (90% ì´ìƒ) ==="
awk -F',' 'NR>1 {gsub("%","",$3); if($3+0 > 90) print $1, $2, $3"%"}' $LOG_FILE
```

---

## cAdvisor ì„¤ì¹˜ ë° ì‚¬ìš©

### cAdvisorë€?

Googleì´ ê°œë°œí•œ ì»¨í…Œì´ë„ˆ ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¡œ, ë” ìƒì„¸í•œ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤.

```
docker stats vs cAdvisor:

docker stats:
- ê¸°ë³¸ ë©”íŠ¸ë¦­ (CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬)
- CLI ê¸°ë°˜
- íˆìŠ¤í† ë¦¬ ì—†ìŒ

cAdvisor:
- ìƒì„¸ ë©”íŠ¸ë¦­ (íŒŒì¼ì‹œìŠ¤í…œ, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë³„ ë“±)
- Web UI ì œê³µ
- ì§§ì€ íˆìŠ¤í† ë¦¬ ì œê³µ (ìµœê·¼ 1ë¶„)
- Prometheus ì—°ë™ ê°€ëŠ¥
```

### cAdvisor ì„¤ì¹˜

```yaml
# docker-compose.monitoring.yml

version: '3.8'

services:
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: cadvisor
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
      - /dev/disk/:/dev/disk:ro
    privileged: true
    devices:
      - /dev/kmsg
    command:
      - '--housekeeping_interval=10s'
      - '--docker_only=true'
      - '--disable_metrics=disk,network,tcp,udp,percpu,sched,process'
```

**Windows (Docker Desktop)**:
```yaml
services:
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    ports:
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /var/lib/docker/:/var/lib/docker:ro
```

### cAdvisor ì‹¤í–‰

```bash
# ì‹¤í–‰
docker-compose -f docker-compose.monitoring.yml up -d cadvisor

# í™•ì¸
curl http://localhost:8080/containers/
```

### cAdvisor Web UI

ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: `http://localhost:8080`

**ì£¼ìš” ê¸°ëŠ¥**:
- **Docker Containers**: ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡ ë° ìƒì„¸ ì •ë³´
- **Metrics**: CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬, íŒŒì¼ì‹œìŠ¤í…œ ê·¸ë˜í”„
- **Subcontainers**: ì»¨í…Œì´ë„ˆ ê³„ì¸µ êµ¬ì¡°

### cAdvisor API

```bash
# ì „ì²´ ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­
curl http://localhost:8080/api/v2.0/stats?count=1

# íŠ¹ì • ì»¨í…Œì´ë„ˆ
curl http://localhost:8080/api/v2.0/docker/<container_id>

# Prometheus í˜•ì‹ ë©”íŠ¸ë¦­
curl http://localhost:8080/metrics
```

---

## Prometheus + Grafana ì—°ë™

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Grafana (ì‹œê°í™”)                 â”‚
â”‚            http://localhost:3000                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ì¿¼ë¦¬
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Prometheus (ë©”íŠ¸ë¦­ ì €ì¥)             â”‚
â”‚            http://localhost:9090                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ìŠ¤í¬ë© (ìˆ˜ì§‘)
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cAdvisor   â”‚      â”‚   Node      â”‚
â”‚  (ì»¨í…Œì´ë„ˆ)  â”‚      â”‚  Exporter   â”‚
â”‚             â”‚      â”‚  (í˜¸ìŠ¤íŠ¸)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Prometheus ì„¤ì •

```yaml
# docker-compose.monitoring.yml

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'

volumes:
  prometheus-data:
```

```yaml
# prometheus/prometheus.yml

global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # cAdvisor (ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­)
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']

  # Node Exporter (í˜¸ìŠ¤íŠ¸ ë©”íŠ¸ë¦­)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # Spring Boot Actuator (ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­)
  - job_name: 'user-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['user-service:8080']

  - job_name: 'account-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['account-service:8080']

  - job_name: 'trade-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['trade-service:8080']
```

### Grafana ì„¤ì •

```yaml
# docker-compose.monitoring.yml

services:
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning:ro
      - ./grafana/dashboards:/var/lib/grafana/dashboards:ro
    depends_on:
      - prometheus

volumes:
  grafana-data:
```

### Grafana ë°ì´í„° ì†ŒìŠ¤ ìë™ ì„¤ì •

```yaml
# grafana/provisioning/datasources/prometheus.yml

apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: false
```

### ì „ì²´ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ

```yaml
# docker-compose.monitoring.yml (ì™„ì „íŒ)

version: '3.8'

services:
  # cAdvisor (ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­)
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: cadvisor
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    privileged: true
    networks:
      - monitoring

  # Node Exporter (í˜¸ìŠ¤íŠ¸ ë©”íŠ¸ë¦­)
  node-exporter:
    image: prom/node-exporter:latest
    container_name: node-exporter
    restart: unless-stopped
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    networks:
      - monitoring

  # Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥)
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - ./prometheus/alerts.yml:/etc/prometheus/alerts.yml:ro
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'
    networks:
      - monitoring
    depends_on:
      - cadvisor
      - node-exporter

  # Grafana (ì‹œê°í™”)
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD:-admin}
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning:ro
    networks:
      - monitoring
    depends_on:
      - prometheus

  # Alertmanager (ì•Œë¦¼)
  alertmanager:
    image: prom/alertmanager:latest
    container_name: alertmanager
    restart: unless-stopped
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml:ro
      - alertmanager-data:/alertmanager
    command:
      - '--config.file=/etc/alertmanager/alertmanager.yml'
      - '--storage.path=/alertmanager'
    networks:
      - monitoring

networks:
  monitoring:
    driver: bridge

volumes:
  prometheus-data:
  grafana-data:
  alertmanager-data:
```

---

## ì„±ëŠ¥ ë©”íŠ¸ë¦­ ë¶„ì„

### ì£¼ìš” PromQL ì¿¼ë¦¬

#### CPU ë©”íŠ¸ë¦­

```promql
# ì»¨í…Œì´ë„ˆë³„ CPU ì‚¬ìš©ë¥  (%)
rate(container_cpu_usage_seconds_total[5m]) * 100

# 5ë¶„ í‰ê·  CPU ì‚¬ìš©ë¥ 
avg(rate(container_cpu_usage_seconds_total[5m])) by (name) * 100

# CPU ì‚¬ìš©ë¥  ìƒìœ„ 5ê°œ ì»¨í…Œì´ë„ˆ
topk(5, rate(container_cpu_usage_seconds_total[5m])) * 100
```

#### ë©”ëª¨ë¦¬ ë©”íŠ¸ë¦­

```promql
# ì»¨í…Œì´ë„ˆë³„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (MB)
container_memory_usage_bytes / 1024 / 1024

# ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  (%)
(container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100

# ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  80% ì´ìƒ
(container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 80
```

#### ë„¤íŠ¸ì›Œí¬ ë©”íŠ¸ë¦­

```promql
# ë„¤íŠ¸ì›Œí¬ ìˆ˜ì‹  ì†ë„ (bytes/sec)
rate(container_network_receive_bytes_total[5m])

# ë„¤íŠ¸ì›Œí¬ ì†¡ì‹  ì†ë„ (bytes/sec)
rate(container_network_transmit_bytes_total[5m])

# ì´ ë„¤íŠ¸ì›Œí¬ I/O
rate(container_network_receive_bytes_total[5m]) + rate(container_network_transmit_bytes_total[5m])
```

#### ë””ìŠ¤í¬ I/O ë©”íŠ¸ë¦­

```promql
# ë””ìŠ¤í¬ ì½ê¸° ì†ë„ (bytes/sec)
rate(container_fs_reads_bytes_total[5m])

# ë””ìŠ¤í¬ ì“°ê¸° ì†ë„ (bytes/sec)
rate(container_fs_writes_bytes_total[5m])
```

### Grafana ëŒ€ì‹œë³´ë“œ JSON

```json
{
  "dashboard": {
    "title": "LK-Trade Docker ëª¨ë‹ˆí„°ë§",
    "panels": [
      {
        "title": "CPU ì‚¬ìš©ë¥ ",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(container_cpu_usage_seconds_total{name=~\".*-service\"}[5m]) * 100",
            "legendFormat": "{{name}}"
          }
        ],
        "yaxes": [
          {
            "format": "percent",
            "max": 100
          }
        ]
      },
      {
        "title": "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰",
        "type": "graph",
        "targets": [
          {
            "expr": "container_memory_usage_bytes{name=~\".*-service\"} / 1024 / 1024",
            "legendFormat": "{{name}}"
          }
        ],
        "yaxes": [
          {
            "format": "megabytes"
          }
        ]
      },
      {
        "title": "ë„¤íŠ¸ì›Œí¬ I/O",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(container_network_receive_bytes_total{name=~\".*-service\"}[5m])",
            "legendFormat": "{{name}} RX"
          },
          {
            "expr": "rate(container_network_transmit_bytes_total{name=~\".*-service\"}[5m])",
            "legendFormat": "{{name}} TX"
          }
        ],
        "yaxes": [
          {
            "format": "Bps"
          }
        ]
      },
      {
        "title": "ì»¨í…Œì´ë„ˆ ìƒíƒœ",
        "type": "stat",
        "targets": [
          {
            "expr": "count(container_last_seen{name=~\".*-service\"})"
          }
        ]
      }
    ]
  }
}
```

---

## ë³‘ëª© ì§€ì  ì°¾ê¸°

### 1. CPU ë³‘ëª©

**ì¦ìƒ**:
- API ì‘ë‹µ ì‹œê°„ ì¦ê°€
- docker statsì—ì„œ CPU 90% ì´ìƒ

**ì§„ë‹¨**:
```bash
# CPU ì‚¬ìš©ë¥  ë†’ì€ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}" | sort -k2 -rn | head -5

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í”„ë¡œì„¸ìŠ¤ í™•ì¸
docker exec container_id top -bn1

# JVM ìŠ¤ë ˆë“œ ë¤í”„
docker exec container_id jstack 1 > thread-dump.txt
```

**í•´ê²°**:
```yaml
# CPU ì¦ê°€
services:
  user-service:
    cpus: 2.0  # 1.0 â†’ 2.0

# ë˜ëŠ” ìŠ¤ì¼€ì¼ ì•„ì›ƒ
docker-compose up -d --scale user-service=3
```

### 2. ë©”ëª¨ë¦¬ ë³‘ëª©

**ì¦ìƒ**:
- OOM Killed (Exit Code 137)
- ìŠ¤ì™‘ ì‚¬ìš© ì¦ê°€

**ì§„ë‹¨**:
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  í™•ì¸
docker stats --no-stream --format "table {{.Name}}\t{{.MemUsage}}\t{{.MemPerc}}"

# JVM í™ ë¤í”„
docker exec container_id jmap -dump:format=b,file=/tmp/heap.hprof 1
docker cp container_id:/tmp/heap.hprof ./heap.hprof
```

**í•´ê²°**:
```yaml
# ë©”ëª¨ë¦¬ ì¦ê°€
services:
  user-service:
    mem_limit: 2g  # 1g â†’ 2g
    environment:
      - JAVA_OPTS=-XX:MaxRAMPercentage=75.0
```

### 3. ë„¤íŠ¸ì›Œí¬ ë³‘ëª©

**ì¦ìƒ**:
- ë†’ì€ ë„¤íŠ¸ì›Œí¬ ì§€ì—°
- íŒ¨í‚· ì†ì‹¤

**ì§„ë‹¨**:
```bash
# ë„¤íŠ¸ì›Œí¬ I/O í™•ì¸
docker stats --no-stream --format "table {{.Name}}\t{{.NetIO}}"

# ë„¤íŠ¸ì›Œí¬ ì§€ì—° í…ŒìŠ¤íŠ¸
docker exec container_a ping -c 10 container_b

# ëŒ€ì—­í­ í…ŒìŠ¤íŠ¸
docker exec container_a iperf3 -c container_b
```

**í•´ê²°**:
- ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ ë³€ê²½ (bridge â†’ host)
- ë„¤íŠ¸ì›Œí¬ ìµœì í™” ì„¤ì •

### 4. ë””ìŠ¤í¬ I/O ë³‘ëª©

**ì¦ìƒ**:
- ëŠë¦° ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
- íŒŒì¼ ì½ê¸°/ì“°ê¸° ì§€ì—°

**ì§„ë‹¨**:
```bash
# ë””ìŠ¤í¬ I/O í™•ì¸
docker stats --no-stream --format "table {{.Name}}\t{{.BlockIO}}"

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
docker exec container_id df -h

# I/O ëŒ€ê¸° ì‹œê°„
docker exec container_id iostat -x 1 10
```

**í•´ê²°**:
```yaml
# SSD ì‚¬ìš©, I/O ì œí•œ í•´ì œ
services:
  postgres:
    volumes:
      - postgres-data:/var/lib/postgresql/data  # SSD ë³¼ë¥¨ ì‚¬ìš©
```

---

## ì•Œë¦¼ ì„¤ì •

### Prometheus Alert ê·œì¹™

```yaml
# prometheus/alerts.yml

groups:
  - name: container_alerts
    interval: 30s
    rules:
      # CPU ì‚¬ìš©ë¥  80% ì´ìƒ
      - alert: HighCPUUsage
        expr: rate(container_cpu_usage_seconds_total[5m]) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ì»¨í…Œì´ë„ˆ CPU ì‚¬ìš©ë¥  ë†’ìŒ"
          description: "{{ $labels.name }} CPU ì‚¬ìš©ë¥ ì´ {{ $value }}% ì…ë‹ˆë‹¤."

      # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  90% ì´ìƒ
      - alert: HighMemoryUsage
        expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 90
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë†’ìŒ"
          description: "{{ $labels.name }} ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ {{ $value }}% ì…ë‹ˆë‹¤."

      # ì»¨í…Œì´ë„ˆ ë‹¤ìš´
      - alert: ContainerDown
        expr: up{job="cadvisor"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ì»¨í…Œì´ë„ˆ ë‹¤ìš´"
          description: "{{ $labels.instance }} ì»¨í…Œì´ë„ˆê°€ ë‹¤ìš´ë˜ì—ˆìŠµë‹ˆë‹¤."

      # ë””ìŠ¤í¬ ì‚¬ìš©ë¥  85% ì´ìƒ
      - alert: HighDiskUsage
        expr: (container_fs_usage_bytes / container_fs_limit_bytes) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ë””ìŠ¤í¬ ì‚¬ìš©ë¥  ë†’ìŒ"
          description: "{{ $labels.name }} ë””ìŠ¤í¬ ì‚¬ìš©ë¥ ì´ {{ $value }}% ì…ë‹ˆë‹¤."
```

### Alertmanager ì„¤ì •

```yaml
# alertmanager/alertmanager.yml

global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'severity']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'slack'

receivers:
  # Slack ì•Œë¦¼
  - name: 'slack'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts'
        title: '{{ .GroupLabels.alertname }}'
        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
        send_resolved: true

  # ì´ë©”ì¼ ì•Œë¦¼
  - name: 'email'
    email_configs:
      - to: 'admin@lktrade.com'
        from: 'alertmanager@lktrade.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'alertmanager@lktrade.com'
        auth_password: 'password'
        headers:
          Subject: '[LK-Trade] {{ .GroupLabels.alertname }}'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname']
```

---

## ì‹¤ì „ ì˜ˆì œ: LK-Trade ëª¨ë‹ˆí„°ë§

### ëª¨ë‹ˆí„°ë§ ì‹œì‘

```bash
#!/bin/bash
# scripts/start-monitoring.sh

echo "ğŸ“Š LK-Trade ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘..."

# 1. ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘
docker-compose -f docker-compose.monitoring.yml up -d

# 2. ì„œë¹„ìŠ¤ ì¤€ë¹„ ëŒ€ê¸°
echo "â³ ì„œë¹„ìŠ¤ ì¤€ë¹„ ì¤‘..."
sleep 15

# 3. í—¬ìŠ¤ì²´í¬
echo "ğŸ¥ í—¬ìŠ¤ì²´í¬..."
curl -f http://localhost:8080/containers/ > /dev/null 2>&1 && echo "  âœ… cAdvisor" || echo "  âŒ cAdvisor"
curl -f http://localhost:9090/-/healthy > /dev/null 2>&1 && echo "  âœ… Prometheus" || echo "  âŒ Prometheus"
curl -f http://localhost:3000/api/health > /dev/null 2>&1 && echo "  âœ… Grafana" || echo "  âŒ Grafana"

echo ""
echo "âœ… ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘ ì™„ë£Œ!"
echo ""
echo "ğŸ“‹ ì ‘ì† ì •ë³´:"
echo "  - cAdvisor:    http://localhost:8080"
echo "  - Prometheus:  http://localhost:9090"
echo "  - Grafana:     http://localhost:3000 (admin/admin)"
echo "  - Alertmanager: http://localhost:9093"
```

### Makefile í†µí•©

```makefile
# Makefile

.PHONY: monitoring monitoring-stop monitoring-logs

# ëª¨ë‹ˆí„°ë§ ì‹œì‘
monitoring:
	@echo "ğŸ“Š ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘..."
	@docker-compose -f docker-compose.monitoring.yml up -d
	@sleep 10
	@echo "âœ… ëª¨ë‹ˆí„°ë§ ì¤€ë¹„ ì™„ë£Œ"
	@echo ""
	@echo "ì ‘ì† URL:"
	@echo "  Grafana: http://localhost:3000"
	@echo "  Prometheus: http://localhost:9090"

# ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
monitoring-stop:
	@docker-compose -f docker-compose.monitoring.yml down

# ëª¨ë‹ˆí„°ë§ ë¡œê·¸
monitoring-logs:
	@docker-compose -f docker-compose.monitoring.yml logs -f
```

---

## ì£¼ë‹ˆì–´ ê°œë°œì ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì²« Prometheus + Grafana ì„¤ì •

**ìƒí™©**:
```
íŒ€ì¥: "ìš°ë¦¬ ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì¢€ êµ¬ì¶•í•´ë´ìš”. Prometheus + Grafana ì¨ì„œ."
ì£¼ë‹ˆì–´ A (ë‹¹í™©): "ë„¤... ê·¼ë° ì–´ë–»ê²Œ ì‹œì‘í•˜ì£ ?"
```

**ë‹¨ê³„ë³„ í•´ê²°**:
```bash
# Step 1: docker-compose.monitoring.yml ì‘ì„±
$ cat > docker-compose.monitoring.yml <<EOF
version: '3.8'

services:
  # cAdvisor: ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    ports:
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /var/lib/docker/:/var/lib/docker:ro
    networks:
      - monitoring

  # Prometheus: ë©”íŠ¸ë¦­ ì €ì¥
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus
    networks:
      - monitoring
    depends_on:
      - cadvisor

  # Grafana: ì‹œê°í™”
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - monitoring
    depends_on:
      - prometheus

networks:
  monitoring:

volumes:
  prometheus-data:
  grafana-data:
EOF

# Step 2: Prometheus ì„¤ì • íŒŒì¼
$ mkdir prometheus
$ cat > prometheus/prometheus.yml <<EOF
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
EOF

# Step 3: ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘
$ docker-compose -f docker-compose.monitoring.yml up -d

Creating network "monitoring_monitoring" ... done
Creating volume "monitoring_prometheus-data" ... done
Creating volume "monitoring_grafana-data" ... done
Creating monitoring_cadvisor_1 ... done
Creating monitoring_prometheus_1 ... done
Creating monitoring_grafana_1 ... done

# Step 4: ì„œë¹„ìŠ¤ ì¤€ë¹„ ëŒ€ê¸°
$ sleep 15

# Step 5: ì ‘ì† í™•ì¸
$ curl http://localhost:9090/-/healthy
Prometheus is Healthy.

$ curl http://localhost:3000/api/health
{"database":"ok","version":"9.3.0"}

âœ… ì„±ê³µ!
```

**Step 6: Grafanaì—ì„œ ëŒ€ì‹œë³´ë“œ ì„¤ì •**
```
1. http://localhost:3000 ì ‘ì†
2. ë¡œê·¸ì¸: admin / admin
3. Configuration > Data Sources > Add data source
4. Prometheus ì„ íƒ
5. URL: http://prometheus:9090
6. Save & Test

7. Create > Dashboard > Add new panel
8. ì¿¼ë¦¬ ì…ë ¥:
   rate(container_cpu_usage_seconds_total[5m]) * 100

9. ì €ì¥!
```

**ë°°ìš´ ì **:
- Prometheusê°€ ë©”íŠ¸ë¦­ ì €ì¥ì†Œ, Grafanaê°€ ì‹œê°í™” ë„êµ¬
- cAdvisorëŠ” ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°
- docker-composeë¡œ í•œ ë²ˆì— êµ¬ì¶• ê°€ëŠ¥
- 3000, 8080, 9090 í¬íŠ¸ë§Œ ê¸°ì–µí•˜ë©´ ë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: CPU 100% ì•Œë¦¼ì— ì²« ëŒ€ì‘

**ìƒí™©**:
```
ğŸš¨ Slack ì•Œë¦¼:
"[CRITICAL] user-service CPU ì‚¬ìš©ë¥  95% ì´ˆê³¼!"

ì£¼ë‹ˆì–´ B (ìƒˆë²½ 3ì‹œ): "ë­ì§€? ì–´ë–»ê²Œ í•˜ì§€?"
```

**ë‹¨ê³„ë³„ ëŒ€ì‘**:
```bash
# Step 1: ìƒí™© íŒŒì•… (Grafana ëŒ€ì‹œë³´ë“œ í™•ì¸)
$ open http://localhost:3000
# user-service CPU ê·¸ë˜í”„ í™•ì¸: 98%!

# Step 2: ì‹¤ì‹œê°„ ë¦¬ì†ŒìŠ¤ í™•ì¸
$ docker stats user-service --no-stream
CONTAINER      CPU %   MEM USAGE / LIMIT
user-service   98.5%   680MiB / 1GiB

# CPU ê±°ì˜ 100%!

# Step 3: ë¡œê·¸ í™•ì¸
$ docker logs user-service --tail 100
[ERROR] Slow query detected: 5000ms
[ERROR] Slow query detected: 4800ms
[ERROR] Slow query detected: 5200ms
...

# ë°˜ë³µì ì¸ ëŠë¦° ì¿¼ë¦¬ ë°œê²¬!

# Step 4: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™•ì¸
$ docker exec user-service ps aux
USER  PID  %CPU  %MEM  COMMAND
root    1  98.0  11.2  java -jar app.jar

# Java í”„ë¡œì„¸ìŠ¤ê°€ CPU 100% ì‚¬ìš© ì¤‘

# Step 5: ìŠ¤ë ˆë“œ ë¤í”„ (ì›ì¸ íŒŒì•…)
$ docker exec user-service jstack 1 > thread-dump.txt
$ grep -A 10 "RUNNABLE" thread-dump.txt

# ë°œê²¬: DB ì¿¼ë¦¬ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ìŠ¤ë ˆë“œ

# Step 6: ì„ì‹œ ëŒ€ì‘ (ìŠ¤ì¼€ì¼ ì•„ì›ƒ)
$ docker-compose up -d --scale user-service=3
Creating user-service_2 ... done
Creating user-service_3 ... done

# CPU ë¶„ì‚°ë¨: 98% â†’ ê°ê° 30%

âœ… ì„ì‹œ í•´ê²°!

# Step 7: ê·¼ë³¸ ì›ì¸ í•´ê²° (ë‹¤ìŒë‚  ì˜¤ì „)
# - ì¿¼ë¦¬ ìµœì í™” (ì¸ë±ìŠ¤ ì¶”ê°€)
# - ìºì‹± ì¶”ê°€ (Redis)
# - ì¬ë°°í¬

âœ… ê·¼ë³¸ í•´ê²°!
```

**ë°°ìš´ ì **:
- ì•Œë¦¼ ë°›ìœ¼ë©´ ë¨¼ì € Grafana ëŒ€ì‹œë³´ë“œ í™•ì¸
- `docker stats`ë¡œ ì‹¤ì‹œê°„ ë¦¬ì†ŒìŠ¤ í™•ì¸
- ë¡œê·¸ì—ì„œ ë‹¨ì„œ ì°¾ê¸°
- ì„ì‹œ ëŒ€ì‘: ìŠ¤ì¼€ì¼ ì•„ì›ƒ, ê·¼ë³¸ í•´ê²°: ì½”ë“œ ìˆ˜ì •
- ìƒˆë²½ì—ëŠ” ì„ì‹œ ëŒ€ì‘, ì˜¤ì „ì— ê·¼ë³¸ í•´ê²°

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œê²¬ ë° ëŒ€ì‘

**ìƒí™©**:
```
íŒ€ì¥: "account-service ë©”ëª¨ë¦¬ê°€ ê³„ì† ì¦ê°€í•˜ëŠ”ë°... ë©”ëª¨ë¦¬ ë¦­ ê°™ì€ë°?"
ì£¼ë‹ˆì–´ C: "ì–´ë–»ê²Œ í™•ì¸í•˜ì£ ?"
```

**ë‹¨ê³„ë³„ ì§„ë‹¨**:
```bash
# Step 1: Grafanaì—ì„œ ë©”ëª¨ë¦¬ ì¶”ì´ í™•ì¸
# ê·¸ë˜í”„: ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆ ë©”ëª¨ë¦¬ê°€ 500MB â†’ 1.8GBë¡œ ì¦ê°€
# ì¶”ì„¸: ê³„ì† ì¦ê°€ ì¤‘ (ë¦¬ì…‹ ì—†ìŒ)

# Step 2: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
$ docker stats account-service
CONTAINER         MEM USAGE / LIMIT
account-service   1.85GiB / 2GiB  (92.5%)

# 30ë¶„ í›„ ë‹¤ì‹œ í™•ì¸
$ docker stats account-service --no-stream
CONTAINER         MEM USAGE / LIMIT
account-service   1.92GiB / 2GiB  (96%)

# ê³„ì† ì¦ê°€ ì¤‘! ë©”ëª¨ë¦¬ ë¦­ í™•ì‹¤!

# Step 3: í™ ë¤í”„ ìƒì„± (Java)
$ docker exec account-service jmap -dump:format=b,file=/tmp/heap.hprof 1
Heap dump file created

# Step 4: í™ ë¤í”„ ë³µì‚¬
$ docker cp account-service:/tmp/heap.hprof ./heap.hprof

# Step 5: Eclipse MATë¡œ ë¶„ì„
$ java -jar mat.jar heap.hprof

# ë¶„ì„ ê²°ê³¼:
# - ArrayList ê°ì²´ê°€ 500MB ì°¨ì§€
# - UserSessionCacheê°€ ë¬´í•œì • ì¦ê°€
# - ì›ì¸: ì„¸ì…˜ ì •ë¦¬ ë¡œì§ ëˆ„ë½!

# Step 6: ì„ì‹œ ëŒ€ì‘ (ì¬ì‹œì‘ìœ¼ë¡œ ë©”ëª¨ë¦¬ í•´ì œ)
$ docker-compose restart account-service

# ë©”ëª¨ë¦¬ 1.8GB â†’ 500MBë¡œ ê°ì†Œ

# Step 7: ê·¼ë³¸ í•´ê²° (ì½”ë“œ ìˆ˜ì •)
```java
// âŒ Before: ì„¸ì…˜ ë¬´í•œì • ìŒ“ì„
public class UserSessionCache {
    private Map<String, Session> sessions = new HashMap<>();

    public void addSession(String id, Session session) {
        sessions.put(id, session);  // ì‚­ì œ ë¡œì§ ì—†ìŒ!
    }
}

// âœ… After: TTL + ìµœëŒ€ í¬ê¸° ì œí•œ
public class UserSessionCache {
    private LoadingCache<String, Session> sessions = CacheBuilder.newBuilder()
        .maximumSize(10000)  // ìµœëŒ€ 10,000ê°œ
        .expireAfterWrite(30, TimeUnit.MINUTES)  // 30ë¶„ í›„ ìë™ ì‚­ì œ
        .build();
}
```

```bash
# Step 8: ì¬ë°°í¬ ë° ëª¨ë‹ˆí„°ë§
$ docker-compose up -d --build account-service

# 24ì‹œê°„ í›„ í™•ì¸: ë©”ëª¨ë¦¬ ì•ˆì •ì ìœ¼ë¡œ 500~600MB ìœ ì§€

âœ… ê·¼ë³¸ í•´ê²°!
```

**ë°°ìš´ ì **:
- ë©”ëª¨ë¦¬ê°€ ê³„ì† ì¦ê°€í•˜ë©´ ë©”ëª¨ë¦¬ ë¦­ ì˜ì‹¬
- í™ ë¤í”„ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš© ê°ì²´ í™•ì¸
- ì„ì‹œ: ì¬ì‹œì‘, ê·¼ë³¸: ì½”ë“œ ìˆ˜ì •
- ìºì‹œëŠ” ë°˜ë“œì‹œ í¬ê¸° ì œí•œ + TTL ì„¤ì •

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: Grafana ëŒ€ì‹œë³´ë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§•

**ìƒí™©**:
```
ì‹œë‹ˆì–´: "ëŒ€ì‹œë³´ë“œì— ìš°ë¦¬ê°€ í•„ìš”í•œ ë©”íŠ¸ë¦­ë§Œ ë³´ì´ê²Œ ì •ë¦¬í•´ë´ìš”."
ì£¼ë‹ˆì–´ D: "ì–´ë–¤ ê±¸ ë³´ì—¬ì¤˜ì•¼ í•˜ì£ ?"
```

**ë‹¨ê³„ë³„ ì„¤ì •**:
```bash
# Step 1: í•„ìš”í•œ ë©”íŠ¸ë¦­ ëª©ë¡ ì‘ì„±
í•„ìˆ˜ ë©”íŠ¸ë¦­:
1. CPU ì‚¬ìš©ë¥  (%)
2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (MB)
3. ë„¤íŠ¸ì›Œí¬ I/O (bytes/s)
4. API ì‘ë‹µ ì‹œê°„ (ms)
5. ì—ëŸ¬ìœ¨ (%)

# Step 2: Grafana ëŒ€ì‹œë³´ë“œ ìƒì„±
# http://localhost:3000 > Create > Dashboard

# Panel 1: CPU ì‚¬ìš©ë¥ 
Query: rate(container_cpu_usage_seconds_total{name=~".*-service"}[5m]) * 100
Title: "ì»¨í…Œì´ë„ˆë³„ CPU ì‚¬ìš©ë¥  (%)"
Legend: {{name}}
Y-axis: 0-100%
Threshold:
  - 80% Warning (Yellow)
  - 90% Critical (Red)

# Panel 2: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
Query: container_memory_usage_bytes{name=~".*-service"} / 1024 / 1024
Title: "ì»¨í…Œì´ë„ˆë³„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (MB)"
Legend: {{name}}
Y-axis: MB
Threshold:
  - 800MB Warning
  - 900MB Critical

# Panel 3: ë„¤íŠ¸ì›Œí¬ I/O
Query RX: rate(container_network_receive_bytes_total{name=~".*-service"}[5m])
Query TX: rate(container_network_transmit_bytes_total{name=~".*-service"}[5m])
Title: "ë„¤íŠ¸ì›Œí¬ ì†¡ìˆ˜ì‹ "
Legend: {{name}} RX / TX
Y-axis: bytes/s

# Panel 4: ì»¨í…Œì´ë„ˆ ìƒíƒœ (Stat íŒ¨ë„)
Query: count(container_last_seen{name=~".*-service"})
Title: "ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ìˆ˜"
Display: Big number
Color: Green

# Step 3: ë³€ìˆ˜ ì¶”ê°€ (ë™ì  í•„í„°ë§)
Settings > Variables > Add variable
Name: service
Type: Query
Query: label_values(container_cpu_usage_seconds_total, name)

# ì´ì œ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì„ íƒ ê°€ëŠ¥!

# Step 4: ì•Œë¦¼ ê·œì¹™ ì¶”ê°€
Panel > Alert > Create Alert

Rule:
WHEN avg() OF query(A, 5m, now) IS ABOVE 80
FOR 5m
Send to: Slack

Message: "{{name}} CPU ì‚¬ìš©ë¥  {{value}}% ì´ˆê³¼!"

# Step 5: ëŒ€ì‹œë³´ë“œ ì €ì¥
Title: "LK-Trade Production Monitoring"
Folder: Production
Save

âœ… ì™„ì„±!
```

**í”„ë¡œ íŒ**:
```bash
# ëŒ€ì‹œë³´ë“œ JSON ë‚´ë³´ë‚´ê¸° (ë²„ì „ ê´€ë¦¬)
$ curl -u admin:admin http://localhost:3000/api/dashboards/uid/abc123 > dashboard.json

# Git ì €ì¥
$ git add dashboard.json
$ git commit -m "Add production monitoring dashboard"

# ë‹¤ë¥¸ í™˜ê²½ì— ì ìš©
$ curl -X POST -H "Content-Type: application/json" \
    -d @dashboard.json \
    http://grafana-staging:3000/api/dashboards/db
```

**ë°°ìš´ ì **:
- ëŒ€ì‹œë³´ë“œëŠ” íŒ€ì˜ ë‹ˆì¦ˆì— ë§ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- Thresholdë¡œ ì‹œê°ì  ê²½ê³  í‘œì‹œ
- ë³€ìˆ˜ë¡œ ë™ì  í•„í„°ë§ ê°€ëŠ¥
- JSON ë‚´ë³´ë‚´ê¸°ë¡œ ë²„ì „ ê´€ë¦¬
- ì•Œë¦¼ ê·œì¹™ì€ íŒ¨ë„ë³„ë¡œ ì„¤ì • ê°€ëŠ¥

---

## FAQ

<details>
<summary><strong>Q1: Prometheus vs ELK Stack, ì–´ë–¤ ê±¸ ì„ íƒí•´ì•¼ í•˜ë‚˜ìš”?</strong></summary>

**A**: **ìš©ë„ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤!** ë‘˜ ë‹¤ ì“°ëŠ” ê²ƒë„ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤.

**ìƒì„¸ ë¹„êµ**:

| í•­ëª© | Prometheus + Grafana | ELK Stack |
|------|----------------------|-----------|
| **ì£¼ ìš©ë„** | ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§ (ìˆ«ì) | ë¡œê·¸ ìˆ˜ì§‘ ë° ë¶„ì„ (í…ìŠ¤íŠ¸) |
| **ë°ì´í„° í˜•ì‹** | Time-series (ì‹œê³„ì—´) | JSON ë¡œê·¸ |
| **ì¿¼ë¦¬ ì–¸ì–´** | PromQL | Lucene query / KQL |
| **ì‹œê°í™”** | Grafana | Kibana |
| **ì¥ì ** | ê°€ë³ê³  ë¹ ë¦„, ë©”íŠ¸ë¦­ íŠ¹í™” | ê°•ë ¥í•œ ë¡œê·¸ ê²€ìƒ‰, í’€í…ìŠ¤íŠ¸ ë¶„ì„ |
| **ë‹¨ì ** | ë¡œê·¸ ë¶„ì„ ì•½í•¨ | ë¬´ê±°ì›€, ë¦¬ì†ŒìŠ¤ ë§ì´ ì‚¬ìš© |
| **ì„¤ì¹˜ ë‚œì´ë„** | ì‰¬ì›€ â­â­â˜†â˜†â˜† | ì–´ë ¤ì›€ â­â­â­â­â˜† |
| **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©** | ì ìŒ (1GB ì´í•˜) | ë§ìŒ (4GB ì´ìƒ) |

**ì‚¬ìš© ì‚¬ë¡€ë³„ ê¶Œì¥**:

**ì¼€ì´ìŠ¤ 1: ì‘ì€ í”„ë¡œì íŠ¸ (5ê°œ ì´í•˜ ì„œë¹„ìŠ¤)**
```
âœ… Prometheus + Grafana
- ì´ìœ : ê°€ë³ê³  ì„¤ì¹˜ ì‰¬ì›€
- ì„¤ì •: docker-compose up í•œ ë²ˆì´ë©´ ë
```

**ì¼€ì´ìŠ¤ 2: ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ (10ê°œ ì´ìƒ ì„œë¹„ìŠ¤)**
```
âœ… Prometheus + Grafana (ë©”íŠ¸ë¦­)
âœ… ELK Stack (ë¡œê·¸)
- ì´ìœ : ê°ì ì¥ì ì´ ëª…í™•
- Prometheus: CPU/ë©”ëª¨ë¦¬/ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§
- ELK: ì—ëŸ¬ ë¡œê·¸ ë¶„ì„, ê²€ìƒ‰
```

**ì¼€ì´ìŠ¤ 3: AWS/GCP ì‚¬ìš© ì¤‘**
```
âœ… í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ë„êµ¬
- AWS: CloudWatch
- GCP: Cloud Monitoring
- ì´ìœ : í†µí•© ê´€ë¦¬, ì¶”ê°€ ì¸í”„ë¼ ë¶ˆí•„ìš”
```

**ì‹¤ì „ ê¶Œì¥ ì¡°í•©**:
```yaml
# docker-compose.monitoring.yml

# ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§ (ê°€ë²¼ì›€)
services:
  prometheus:
    image: prom/prometheus:latest
  grafana:
    image: grafana/grafana:latest

# ë¡œê·¸ ìˆ˜ì§‘ (í•„ìš”ì‹œ ì¶”ê°€)
  elasticsearch:
    image: elasticsearch:8.11.0
  kibana:
    image: kibana:8.11.0
  filebeat:
    image: elastic/filebeat:8.11.0
```

**ê²°ë¡ **:
> "ì‘ê²Œ ì‹œì‘: Prometheus + Grafana"
> "ì»¤ì§€ë©´ ì¶”ê°€: ELK Stack"
> "ëˆ ìˆìœ¼ë©´: í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤"

</details>

<details>
<summary><strong>Q2: ì•Œë¦¼ ì„ê³„ê°’ì„ ì–´ë–»ê²Œ ì„¤ì •í•´ì•¼ í•˜ë‚˜ìš”? (CPU 80%? 90%?)</strong></summary>

**A**: **ì„œë¹„ìŠ¤ íŠ¹ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 3ë‹¨ê³„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.**

**ìƒì„¸ ì„¤ëª…**:

**ì•Œë¦¼ ì„ê³„ê°’ ì„¤ì • ì›ì¹™**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ë‹¨ê³„ ì•Œë¦¼ ì‹œìŠ¤í…œ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Warning (ê²½ê³ )                       â”‚
â”‚    - CPU: 70-80%                        â”‚
â”‚    - Memory: 70-80%                     â”‚
â”‚    - ì¡°ì¹˜: ëª¨ë‹ˆí„°ë§ ê°•í™”, ë¡œê·¸ í™•ì¸     â”‚
â”‚    - ì•Œë¦¼: Slack ë©”ì‹œì§€                 â”‚
â”‚                                         â”‚
â”‚ 2. Critical (ê¸´ê¸‰)                      â”‚
â”‚    - CPU: 90%+                          â”‚
â”‚    - Memory: 90%+                       â”‚
â”‚    - ì¡°ì¹˜: ì¦‰ì‹œ ëŒ€ì‘, ìŠ¤ì¼€ì¼ ì•„ì›ƒ       â”‚
â”‚    - ì•Œë¦¼: Slack + Email                â”‚
â”‚                                         â”‚
â”‚ 3. Emergency (ë¹„ìƒ)                     â”‚
â”‚    - CPU: 95%+                          â”‚
â”‚    - Memory: 95%+ (OOM ì„ë°•)            â”‚
â”‚    - ì¡°ì¹˜: ê¸´ê¸‰ ëŒ€ì‘, ìë™ ìŠ¤ì¼€ì¼ ì•„ì›ƒ  â”‚
â”‚    - ì•Œë¦¼: Slack + Email + SMS + ì „í™”   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Prometheus Alert ê·œì¹™ ì˜ˆì‹œ**:
```yaml
# prometheus/alerts.yml

groups:
  - name: container_alerts
    rules:
      # Warning: CPU 80% (5ë¶„ ì§€ì†)
      - alert: HighCPUWarning
        expr: rate(container_cpu_usage_seconds_total[5m]) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPU ì‚¬ìš©ë¥  ë†’ìŒ (ê²½ê³ )"
          description: "{{ $labels.name }} CPU {{ $value }}%"

      # Critical: CPU 90% (3ë¶„ ì§€ì†)
      - alert: HighCPUCritical
        expr: rate(container_cpu_usage_seconds_total[5m]) * 100 > 90
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "CPU ì‚¬ìš©ë¥  ìœ„í—˜ (ê¸´ê¸‰)"
          description: "{{ $labels.name }} CPU {{ $value }}% - ì¦‰ì‹œ ëŒ€ì‘ í•„ìš”!"

      # Warning: Memory 80%
      - alert: HighMemoryWarning
        expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë†’ìŒ (ê²½ê³ )"
          description: "{{ $labels.name }} Memory {{ $value }}%"

      # Critical: Memory 90% (OOM ì„ë°•!)
      - alert: HighMemoryCritical
        expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ìœ„í—˜ (OOM ì„ë°•!)"
          description: "{{ $labels.name }} Memory {{ $value }}% - ì¦‰ì‹œ ëŒ€ì‘!"
```

**ì„œë¹„ìŠ¤ ìœ í˜•ë³„ ì„ê³„ê°’**:

| ì„œë¹„ìŠ¤ ìœ í˜• | CPU Warning | CPU Critical | Memory Warning | Memory Critical |
|-------------|-------------|--------------|----------------|-----------------|
| **API ì„œë²„** | 70% | 85% | 80% | 90% |
| **ë°ì´í„°ë² ì´ìŠ¤** | 60% | 80% | 70% | 85% |
| **ìºì‹œ (Redis)** | 80% | 95% | 80% | 95% |
| **ë°°ì¹˜ ì‘ì—…** | 90% | 95% | 85% | 90% |
| **í”„ë¡ íŠ¸ì—”ë“œ** | 75% | 90% | 75% | 90% |

**for ê¸°ê°„ ì„¤ì •** (ì–¼ë§ˆë‚˜ ì§€ì†ë˜ì–´ì•¼ ì•Œë¦¼?):
```yaml
# ì§§ì€ ìŠ¤íŒŒì´í¬ ë¬´ì‹œ, ì§€ì†ì ì¸ ë¬¸ì œë§Œ ì•Œë¦¼

# âŒ for: 10s (ë„ˆë¬´ ì§§ìŒ)
# â†’ ì¼ì‹œì  ìŠ¤íŒŒì´í¬ì—ë„ ì•Œë¦¼ ë‚¨ë°œ

# âœ… for: 5m (ì ì ˆ)
# â†’ 5ë¶„ ì´ìƒ ì§€ì†ë˜ë©´ ì§„ì§œ ë¬¸ì œ

# âš ï¸ for: 30m (ë„ˆë¬´ ê¹€)
# â†’ ì´ë¯¸ ì¥ì•  ë°œìƒ í›„
```

**ì‹¤ì „ ê¶Œì¥ ì„¤ì •**:
```yaml
# Alertmanager ë¼ìš°íŒ…
route:
  group_by: ['alertname', 'severity']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 4h  # 4ì‹œê°„ë§ˆë‹¤ ì¬ì•Œë¦¼

  routes:
    # Warning: Slackë§Œ
    - match:
        severity: warning
      receiver: 'slack'
      repeat_interval: 12h

    # Critical: Slack + Email
    - match:
        severity: critical
      receiver: 'slack-and-email'
      repeat_interval: 2h

    # Emergency: ëª¨ë“  ì±„ë„ + ì „í™”
    - match:
        severity: emergency
      receiver: 'all-channels'
      repeat_interval: 30m
```

**ê²°ë¡ **:
> "80%ì—ì„œ Warning, 90%ì—ì„œ Critical"
> "5ë¶„ ì´ìƒ ì§€ì†ë˜ë©´ ì•Œë¦¼"
> "ì„œë¹„ìŠ¤ íŠ¹ì„± ê³ ë ¤í•´ì„œ ì¡°ì •"

</details>

<details>
<summary><strong>Q3: Prometheus ë°ì´í„° ë³´ì¡´ ê¸°ê°„ì„ ì–´ë–»ê²Œ ì„¤ì •í•˜ë‚˜ìš”?</strong></summary>

**A**: **retention.time ì„¤ì •ìœ¼ë¡œ ë³´ì¡´ ê¸°ê°„ì„ ì¡°ì ˆ**í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ 15ì¼~30ì¼ì´ ì ì ˆí•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ê¸°ë³¸ ì„¤ì •**:
```yaml
# docker-compose.monitoring.yml

services:
  prometheus:
    image: prom/prometheus:latest
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'  # 30ì¼ ë³´ê´€
      - '--storage.tsdb.retention.size=10GB'  # ìµœëŒ€ 10GB
```

**ë³´ì¡´ ê¸°ê°„ë³„ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰** (ë©”íŠ¸ë¦­ 100ê°œ, 15ì´ˆ ê°„ê²© ê¸°ì¤€):

| ë³´ì¡´ ê¸°ê°„ | ì˜ˆìƒ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ | ì¶”ì²œ ëŒ€ìƒ |
|-----------|-------------------|----------|
| **7ì¼** | ~2GB | ê°œë°œ í™˜ê²½ |
| **15ì¼** | ~4GB | ì†Œê·œëª¨ í”„ë¡œë•ì…˜ |
| **30ì¼** | ~8GB | ì¤‘ê·œëª¨ í”„ë¡œë•ì…˜ (ì¶”ì²œ) |
| **90ì¼** | ~24GB | ëŒ€ê·œëª¨ í”„ë¡œë•ì…˜ |
| **1ë…„** | ~96GB | ì¥ê¸° ì¶”ì„¸ ë¶„ì„ í•„ìš” ì‹œ |

**í™˜ê²½ë³„ ê¶Œì¥ ì„¤ì •**:

**1. ê°œë°œ í™˜ê²½**:
```yaml
prometheus:
  command:
    - '--storage.tsdb.retention.time=7d'  # 7ì¼ì´ë©´ ì¶©ë¶„
    - '--storage.tsdb.retention.size=2GB'
```

**2. ìŠ¤í…Œì´ì§• í™˜ê²½**:
```yaml
prometheus:
  command:
    - '--storage.tsdb.retention.time=15d'  # 15ì¼
    - '--storage.tsdb.retention.size=5GB'
```

**3. í”„ë¡œë•ì…˜ í™˜ê²½**:
```yaml
prometheus:
  command:
    - '--storage.tsdb.retention.time=30d'  # 30ì¼ (ì¶”ì²œ)
    - '--storage.tsdb.retention.size=10GB'
```

**4. ì¥ê¸° ë³´ê´€ í•„ìš” ì‹œ** (Thanos ì‚¬ìš©):
```yaml
# prometheus + thanos ì¡°í•©
# Prometheus: ìµœê·¼ 30ì¼ (ë¹ ë¥¸ ì¿¼ë¦¬)
# Thanos: 1ë…„+ (S3 ì €ì¥)

services:
  prometheus:
    command:
      - '--storage.tsdb.retention.time=30d'
      - '--storage.tsdb.min-block-duration=2h'
      - '--storage.tsdb.max-block-duration=2h'

  thanos-sidecar:
    image: thanosio/thanos:latest
    command:
      - 'sidecar'
      - '--tsdb.path=/prometheus'
      - '--objstore.config-file=/etc/thanos/bucket.yml'

  # Thanosë¡œ S3ì— ì¥ê¸° ì €ì¥
```

**ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§**:
```bash
# í˜„ì¬ Prometheus ë°ì´í„° í¬ê¸° í™•ì¸
$ docker exec prometheus du -sh /prometheus
8.2G    /prometheus

# ìƒì„¸ í™•ì¸
$ docker exec prometheus ls -lh /prometheus
```

**ìë™ ì •ë¦¬ í™•ì¸**:
```bash
# Prometheus ë¡œê·¸ì—ì„œ ì •ë¦¬ í™•ì¸
$ docker logs prometheus | grep "Deleting"
level=info msg="Deleting obsolete block" mint=1234567890000 maxt=1234567899999
```

**ë¹„ìš© ì ˆê° íŒ**:
```yaml
# 1. scrape_interval ëŠ˜ë¦¬ê¸° (ì •ë°€ë„ â†“, ë””ìŠ¤í¬ â†“)
global:
  scrape_interval: 30s  # 15s â†’ 30s

# 2. ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œì™¸
scrape_configs:
  - job_name: 'cadvisor'
    metric_relabel_configs:
      # ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ë“œë¡­
      - source_labels: [__name__]
        regex: 'container_fs_.*'  # íŒŒì¼ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ì œì™¸
        action: drop
```

**ê²°ë¡ **:
> "ê°œë°œ: 7ì¼, í”„ë¡œë•ì…˜: 30ì¼"
> "ì¥ê¸° ë³´ê´€ í•„ìš” ì‹œ: Thanos ì‚¬ìš©"
> "ë””ìŠ¤í¬ í¬ê¸°ëŠ” ì˜ˆìƒì˜ 1.5ë°°ë¡œ ì„¤ì •"

</details>

<details>
<summary><strong>Q4: ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ìì²´ ë¹„ìš©ì„ ì–´ë–»ê²Œ ìµœì í™”í•˜ë‚˜ìš”?</strong></summary>

**A**: **ê°€ë²¼ìš´ ì„¤ì • + ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œê±° + ìƒ˜í”Œë§**ìœ¼ë¡œ 30-50% ë¹„ìš© ì ˆê° ê°€ëŠ¥í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ë¹„ìš© êµ¬ì„± ìš”ì†Œ**:
```
ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ë¹„ìš© =
  + Prometheus ì¸ìŠ¤í„´ìŠ¤ (CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬)
  + Grafana ì¸ìŠ¤í„´ìŠ¤ (CPU, ë©”ëª¨ë¦¬)
  + cAdvisor (CPU, ë©”ëª¨ë¦¬)
  + ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½
  + ìŠ¤í† ë¦¬ì§€ (ì‹œê³„ì—´ ë°ì´í„°)
```

**ìµœì í™” ì „ëµ**:

**1. ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê°„ê²© ì¡°ì •** (ê°€ì¥ íš¨ê³¼ì ):
```yaml
# Before: 15ì´ˆë§ˆë‹¤ ìˆ˜ì§‘
global:
  scrape_interval: 15s
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰: 10GB/ì›”

# After: 30ì´ˆë§ˆë‹¤ ìˆ˜ì§‘
global:
  scrape_interval: 30s
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰: 5GB/ì›” (50% ì ˆê°)

# íŠ¸ë ˆì´ë“œì˜¤í”„: ì •ë°€ë„ ì•½ê°„ ê°ì†Œ
# - Before: 1ë¶„ì— 4ê°œ ë°ì´í„° í¬ì¸íŠ¸
# - After: 1ë¶„ì— 2ê°œ ë°ì´í„° í¬ì¸íŠ¸
# â†’ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì¶©ë¶„í•¨!
```

**2. ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œê±°**:
```yaml
scrape_configs:
  - job_name: 'cadvisor'
    metric_relabel_configs:
      # ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”íŠ¸ë¦­ ë“œë¡­
      - source_labels: [__name__]
        regex: 'container_(file_descriptors|tasks_state|memory_failures_total).*'
        action: drop

      # íŠ¹ì • ì»¨í…Œì´ë„ˆë§Œ ìˆ˜ì§‘ (ë¶ˆí•„ìš”í•œ ì‹œìŠ¤í…œ ì»¨í…Œì´ë„ˆ ì œì™¸)
      - source_labels: [name]
        regex: '^/system.*'
        action: drop

# íš¨ê³¼: ë©”íŠ¸ë¦­ ìˆ˜ 70% ê°ì†Œ â†’ ì €ì¥ ê³µê°„ 70% ì ˆê°
```

**3. cAdvisor ì„¤ì • ìµœì í™”**:
```yaml
services:
  cadvisor:
    command:
      - '--housekeeping_interval=30s'  # 10s â†’ 30s
      - '--docker_only=true'  # Docker ì»¨í…Œì´ë„ˆë§Œ
      - '--disable_metrics=disk,network,tcp,udp,percpu,sched,process'  # ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ë¹„í™œì„±í™”

# íš¨ê³¼: CPU ì‚¬ìš©ëŸ‰ 50% ê°ì†Œ
```

**4. ê²½ëŸ‰ ì´ë¯¸ì§€ ì‚¬ìš©**:
```yaml
services:
  prometheus:
    image: prom/prometheus:latest  # ~200MB

  grafana:
    image: grafana/grafana:latest-ubuntu  # ~350MB
    # Alpine ë²„ì „ì€ ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ í˜¸í™˜ ë¬¸ì œ ìˆìŒ

  # ëŒ€ì‹  ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
  prometheus:
    deploy:
      resources:
        limits:
          memory: 1G  # ì¶©ë¶„
          cpus: '0.5'
```

**5. ë³´ì¡´ ê¸°ê°„ ë‹¨ì¶•**:
```yaml
prometheus:
  command:
    - '--storage.tsdb.retention.time=15d'  # 30d â†’ 15d
    - '--storage.tsdb.retention.size=5GB'  # 10GB â†’ 5GB

# íš¨ê³¼: ë””ìŠ¤í¬ ë¹„ìš© 50% ì ˆê°
```

**ë¹„ìš© ë¹„êµ** (ì†Œê·œëª¨ í”„ë¡œë•ì…˜ ê¸°ì¤€):

| í•­ëª© | Before (ìµœì í™” ì „) | After (ìµœì í™” í›„) | ì ˆê°ìœ¨ |
|------|-------------------|------------------|--------|
| Prometheus ë©”ëª¨ë¦¬ | 2GB | 1GB | 50% |
| Prometheus ë””ìŠ¤í¬ | 20GB | 8GB | 60% |
| cAdvisor CPU | 0.5 core | 0.2 core | 60% |
| ì›” í´ë¼ìš°ë“œ ë¹„ìš© | $80 | $35 | **56%** |

**ìµœì†Œ ì„¤ì • ì˜ˆì‹œ** (ì‘ì€ í”„ë¡œì íŠ¸):
```yaml
# docker-compose.monitoring.yml (minimal)

version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=7d'  # 7ì¼ë§Œ
      - '--storage.tsdb.retention.size=2GB'  # 2GB ì œí•œ
    deploy:
      resources:
        limits:
          memory: 512M  # 512MBë¡œ ì œí•œ
          cpus: '0.3'

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_INSTALL_PLUGINS=  # í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ì•ˆ í•¨
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.2'

volumes:
  prometheus-data:
```

**ê²°ë¡ **:
> "ìˆ˜ì§‘ ê°„ê²© 30ì´ˆë¡œ ì„¤ì •: 50% ì ˆê°"
> "ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œê±°: ì¶”ê°€ 30% ì ˆê°"
> "ë³´ì¡´ ê¸°ê°„ 15ì¼ë¡œ ì„¤ì •: ì¶”ê°€ 20% ì ˆê°"
> "ì´ ë¹„ìš© ì ˆê°: ì•½ 60%"

</details>

<details>
<summary><strong>Q5: í´ë¼ìš°ë“œ í™˜ê²½ (AWS/GCP)ì—ì„œëŠ” ì–´ë–»ê²Œ ëª¨ë‹ˆí„°ë§í•˜ë‚˜ìš”?</strong></summary>

**A**: **ìì²´ êµ¬ì¶• vs í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ë„êµ¬ë¥¼ ìƒí™©ì— ë§ê²Œ ì„ íƒ**í•©ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**ì„ íƒì§€ ë¹„êµ**:

| í•­ëª© | Prometheus + Grafana (ìì²´ êµ¬ì¶•) | AWS CloudWatch | GCP Cloud Monitoring |
|------|----------------------------------|----------------|---------------------|
| **ë¹„ìš©** | ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ | ë©”íŠ¸ë¦­ë‹¹ ê³¼ê¸ˆ | ë©”íŠ¸ë¦­ë‹¹ ê³¼ê¸ˆ |
| **ì„¤ì¹˜** | ì§ì ‘ ì„¤ì¹˜ í•„ìš” | ì¦‰ì‹œ ì‚¬ìš© | ì¦‰ì‹œ ì‚¬ìš© |
| **ì»¤ìŠ¤í„°ë§ˆì´ì§•** | ììœ ë¡œì›€ | ì œí•œì  | ì œí•œì  |
| **í†µí•©** | ìˆ˜ë™ ì„¤ì • | AWS ì„œë¹„ìŠ¤ ìë™ í†µí•© | GCP ì„œë¹„ìŠ¤ ìë™ í†µí•© |
| **í•™ìŠµ ê³¡ì„ ** | ë†’ìŒ | ë‚®ìŒ | ë‚®ìŒ |

**ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥**:

**ì‹œë‚˜ë¦¬ì˜¤ 1: AWS ECS/Fargateì—ì„œ Docker ì‹¤í–‰**
```yaml
# âœ… ê¶Œì¥: CloudWatch Container Insights

# ECS Task Definition
{
  "family": "user-service",
  "containerDefinitions": [{
    "name": "user-service",
    "image": "user-service:latest",
    "logConfiguration": {
      "logDriver": "awslogs",  # CloudWatch Logsë¡œ ìë™ ì „ì†¡
      "options": {
        "awslogs-group": "/ecs/user-service",
        "awslogs-region": "ap-northeast-2",
        "awslogs-stream-prefix": "ecs"
      }
    }
  }]
}

# Container Insights í™œì„±í™”
$ aws ecs update-cluster-settings \
    --cluster lk-trade \
    --settings name=containerInsights,value=enabled

# ë¹„ìš©: ë©”íŠ¸ë¦­ $0.30/GB (ì²« 10GB ë¬´ë£Œ)
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: AWS EC2ì—ì„œ ì§ì ‘ Docker ì‹¤í–‰**
```yaml
# âœ… ê¶Œì¥: Prometheus + Grafana (ìì²´ êµ¬ì¶•)

# ì´ìœ :
# - CloudWatchëŠ” ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ë¹„ìš© ë†’ìŒ
# - EC2ì—ì„œëŠ” ìì²´ êµ¬ì¶•ì´ ë” ì €ë ´

# docker-compose.monitoring.yml
services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - prometheus-data:/prometheus

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"

  cloudwatch-exporter:  # CloudWatch ë©”íŠ¸ë¦­ë„ ê°€ì ¸ì˜¤ê¸°
    image: prom/cloudwatch-exporter:latest
    volumes:
      - ./cloudwatch.yml:/config/config.yml:ro

# ë¹„ìš©: EC2 ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ (ì›” $10~30)
```

**ì‹œë‚˜ë¦¬ì˜¤ 3: GKE (Google Kubernetes Engine)**
```yaml
# âœ… ê¶Œì¥: Cloud Monitoring (Stackdriver)

# GKEì—ì„œëŠ” ê¸°ë³¸ìœ¼ë¡œ í™œì„±í™”ë¨
# ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”!

# Grafanaë¡œ Cloud Monitoring ì—°ë™
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
data:
  datasource.yaml: |
    apiVersion: 1
    datasources:
      - name: Google Cloud Monitoring
        type: stackdriver
        access: proxy
        jsonData:
          authenticationType: gce

# ë¹„ìš©: ë©”íŠ¸ë¦­ 150MB/ì›” ë¬´ë£Œ, ì´ˆê³¼ë¶„ $0.258/MB
```

**í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼** (Best Practice):
```yaml
# í´ë¼ìš°ë“œ + ìì²´ êµ¬ì¶• ì¡°í•©

# 1. í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ë„êµ¬: ì¸í”„ë¼ ë©”íŠ¸ë¦­
#    - AWS: CloudWatchë¡œ EC2, RDS, ELB ëª¨ë‹ˆí„°ë§
#    - GCP: Cloud Monitoringìœ¼ë¡œ GCE, CloudSQL ëª¨ë‹ˆí„°ë§

# 2. Prometheus + Grafana: ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­
#    - ì»¤ìŠ¤í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
#    - ìƒì„¸í•œ ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­

# docker-compose.monitoring.yml
services:
  prometheus:
    image: prom/prometheus:latest
    # ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

  grafana:
    image: grafana/grafana:latest
    # í´ë¼ìš°ë“œ ë©”íŠ¸ë¦­ + Prometheus ë©”íŠ¸ë¦­ í†µí•© ëŒ€ì‹œë³´ë“œ

  cloudwatch-exporter:  # AWS
    image: prom/cloudwatch-exporter:latest

  stackdriver-exporter:  # GCP
    image: prom/stackdriver-exporter:latest
```

**ë¹„ìš© ìµœì í™” íŒ**:

**AWS CloudWatch**:
```bash
# 1. ë©”íŠ¸ë¦­ í•´ìƒë„ ë‚®ì¶”ê¸°
#    - ê¸°ë³¸: 1ë¶„ ê°„ê²© (ìƒì„¸ ëª¨ë‹ˆí„°ë§)
#    - ìµœì í™”: 5ë¶„ ê°„ê²© (ê¸°ë³¸ ëª¨ë‹ˆí„°ë§)
#    - ì ˆê°: 70% ë¹„ìš© ê°ì†Œ

# 2. ë¡œê·¸ ë³´ì¡´ ê¸°ê°„ ë‹¨ì¶•
$ aws logs put-retention-policy \
    --log-group-name /ecs/user-service \
    --retention-in-days 7  # ë¬´ì œí•œ â†’ 7ì¼

# 3. ë¡œê·¸ ìƒ˜í”Œë§
#    - ëª¨ë“  ìš”ì²­ ë¡œê¹… â†’ 10% ìƒ˜í”Œë§
#    - ì—ëŸ¬ëŠ” 100% ë¡œê¹…
```

**ê²°ë¡ **:
> "ì†Œê·œëª¨ (<10 ì„œë¹„ìŠ¤): CloudWatch/Cloud Monitoring"
> "ì¤‘ê·œëª¨ (10-50 ì„œë¹„ìŠ¤): Prometheus + í´ë¼ìš°ë“œ í†µí•©"
> "ëŒ€ê·œëª¨ (50+ ì„œë¹„ìŠ¤): Prometheus + Thanos + í´ë¼ìš°ë“œ"

</details>

---

## ë©´ì ‘ ì§ˆë¬¸

### ì£¼ë‹ˆì–´ ë ˆë²¨

**Q1: docker stats ëª…ë ¹ì–´ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì£¼ìš” ë©”íŠ¸ë¦­ 5ê°€ì§€ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

**A**: CPU ì‚¬ìš©ë¥ , ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, ë„¤íŠ¸ì›Œí¬ I/O, ë””ìŠ¤í¬ I/O, PID ìˆ˜ì…ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:
```bash
$ docker stats
CONTAINER ID   NAME   CPU %   MEM USAGE / LIMIT   MEM %   NET I/O       BLOCK I/O   PIDS
```

**1. CPU % (CPU ì‚¬ìš©ë¥ )**
- ì˜ë¯¸: ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš© ì¤‘ì¸ CPU ë¹„ìœ¨
- ì˜ˆì‹œ: 45% = CPUì˜ 45% ì‚¬ìš© ì¤‘
- ì£¼ì˜: ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œëŠ” 100% ì´ìƒ ê°€ëŠ¥ (2ì½”ì–´ë©´ 200%ê¹Œì§€)

**2. MEM USAGE / LIMIT (ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰)**
- ì˜ë¯¸: í˜„ì¬ ì‚¬ìš© ë©”ëª¨ë¦¬ / ì œí•œ ë©”ëª¨ë¦¬
- ì˜ˆì‹œ: 680MiB / 1GiB
- ì£¼ì˜: ì œí•œ ì—†ìœ¼ë©´ í˜¸ìŠ¤íŠ¸ ì „ì²´ ë©”ëª¨ë¦¬ í‘œì‹œ

**3. MEM % (ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ )**
- ì˜ë¯¸: ì œí•œ ëŒ€ë¹„ ì‚¬ìš© ë¹„ìœ¨
- ì˜ˆì‹œ: 66.4%
- ê²½ê³ : 90% ì´ìƒì´ë©´ OOM Killer ìœ„í—˜

**4. NET I/O (ë„¤íŠ¸ì›Œí¬ I/O)**
- ì˜ë¯¸: ë„¤íŠ¸ì›Œí¬ ì†¡ìˆ˜ì‹  ì´ëŸ‰ (ëˆ„ì )
- ì˜ˆì‹œ: 1.2kB / 648B (ìˆ˜ì‹  / ì†¡ì‹ )
- ë‹¨ìœ„: ì „ì²´ ëˆ„ì ëŸ‰ (ì´ˆë‹¹ ì•„ë‹˜!)

**5. BLOCK I/O (ë””ìŠ¤í¬ I/O)**
- ì˜ë¯¸: ë””ìŠ¤í¬ ì½ê¸°/ì“°ê¸° ì´ëŸ‰ (ëˆ„ì )
- ì˜ˆì‹œ: 10MB / 5MB (ì½ê¸° / ì“°ê¸°)

**ì‹¤ì „ ì‚¬ìš©**:
```bash
# CPU ì‚¬ìš©ë¥  ë†’ì€ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
$ docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}" | sort -k2 -rn

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë§ì€ ì»¨í…Œì´ë„ˆ
$ docker stats --no-stream --format "table {{.Name}}\t{{.MemUsage}}" | sort -k2 -rn

# íŠ¹ì • ì»¨í…Œì´ë„ˆë§Œ ëª¨ë‹ˆí„°ë§
$ docker stats user-service account-service
```

---

**Q2: Prometheus, Grafana, cAdvisorì˜ ì—­í• ì„ ê°ê° ì„¤ëª…í•˜ì„¸ìš”.**

**A**:
- **Prometheus**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥ (DB)
- **Grafana**: ì‹œê°í™” ëŒ€ì‹œë³´ë“œ (UI)
- **cAdvisor**: ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸° (Agent)

**ìƒì„¸ ë‹µë³€**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì•„í‚¤í…ì²˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  ğŸ“Š Grafana (Port 3000)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ì—­í• : ì‹œê°í™”, ëŒ€ì‹œë³´ë“œ                â”‚  â”‚
â”‚  â”‚ ê¸°ëŠ¥:                                 â”‚  â”‚
â”‚  â”‚ - ê·¸ë˜í”„, ì°¨íŠ¸ ìƒì„±                   â”‚  â”‚
â”‚  â”‚ - ì•Œë¦¼ ì„¤ì • ë° ì „ì†¡                   â”‚  â”‚
â”‚  â”‚ - ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ í†µí•©             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚ ì¿¼ë¦¬ (PromQL)              â”‚
â”‚               â†“                            â”‚
â”‚  ğŸ—„ï¸ Prometheus (Port 9090)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ì—­í• : ë©”íŠ¸ë¦­ ì €ì¥ì†Œ (TSDB)            â”‚  â”‚
â”‚  â”‚ ê¸°ëŠ¥:                                 â”‚  â”‚
â”‚  â”‚ - ì‹œê³„ì—´ ë°ì´í„° ì €ì¥                  â”‚  â”‚
â”‚  â”‚ - PromQL ì¿¼ë¦¬ ì²˜ë¦¬                    â”‚  â”‚
â”‚  â”‚ - ì•Œë¦¼ ê·œì¹™ í‰ê°€                      â”‚  â”‚
â”‚  â”‚ - ë°ì´í„° ìŠ¤í¬ë© (Pull ë°©ì‹)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚ HTTP /metrics ì—”ë“œí¬ì¸íŠ¸   â”‚
â”‚               â†“                            â”‚
â”‚  ğŸ“¡ cAdvisor (Port 8080)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ì—­í• : ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°          â”‚  â”‚
â”‚  â”‚ ê¸°ëŠ¥:                                 â”‚  â”‚
â”‚  â”‚ - Docker ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘         â”‚  â”‚
â”‚  â”‚ - CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬, ë””ìŠ¤í¬ ëª¨ë‹ˆí„°â”‚  â”‚
â”‚  â”‚ - Prometheus í˜•ì‹ìœ¼ë¡œ ë…¸ì¶œ            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚ Docker API                 â”‚
â”‚               â†“                            â”‚
â”‚  ğŸ³ Docker Containers                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ user-service                          â”‚  â”‚
â”‚  â”‚ account-service                       â”‚  â”‚
â”‚  â”‚ trade-service                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê°ê°ì˜ ì—­í•  ìƒì„¸**:

**1. cAdvisor (Container Advisor)**:
```
"ê°ì‹œ ì¹´ë©”ë¼" ì—­í• 

- ì»¨í…Œì´ë„ˆë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì‹œ
- CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬, ë””ìŠ¤í¬ I/O ìˆ˜ì§‘
- Docker API ì‚¬ìš©í•˜ì—¬ ì •ë³´ ìˆ˜ì§‘
- http://localhost:8080/metrics ë¡œ ë…¸ì¶œ

ì˜ˆì‹œ ë©”íŠ¸ë¦­:
container_cpu_usage_seconds_total
container_memory_usage_bytes
container_network_receive_bytes_total
```

**2. Prometheus**:
```
"ë°ì´í„°ë² ì´ìŠ¤" ì—­í• 

- cAdvisorì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (Pull)
- ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
- PromQL ì¿¼ë¦¬ ì–¸ì–´ë¡œ ë°ì´í„° ì¡°íšŒ
- ì•Œë¦¼ ê·œì¹™ í‰ê°€

ì˜ˆì‹œ ì¿¼ë¦¬:
rate(container_cpu_usage_seconds_total[5m]) * 100
```

**3. Grafana**:
```
"ëŒ€ì‹œë³´ë“œ" ì—­í• 

- Prometheusì—ì„œ ë°ì´í„° ì¡°íšŒ
- ê·¸ë˜í”„, ì°¨íŠ¸ë¡œ ì‹œê°í™”
- ì•Œë¦¼ ì „ì†¡ (Slack, Email ë“±)
- ì‚¬ìš©ì ì¹œí™”ì ì¸ UI ì œê³µ

ì˜ˆì‹œ ê¸°ëŠ¥:
- CPU ì‚¬ìš©ë¥  ê·¸ë˜í”„
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸
- ì„ê³„ê°’ ì´ˆê³¼ ì‹œ Slack ì•Œë¦¼
```

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°**:
```
cAdvisor = CCTV ì¹´ë©”ë¼
  â†’ í˜„ì¥ì„ ì´¬ì˜

Prometheus = DVR (ë…¹í™”ê¸°)
  â†’ ì˜ìƒì„ ì €ì¥í•˜ê³  ê´€ë¦¬

Grafana = ëª¨ë‹ˆí„°ë§ ì„¼í„°
  â†’ ì˜ìƒì„ ë³´ê³  ë¶„ì„
```

---

### ì¤‘ê¸‰ ë ˆë²¨

**Q3: Prometheusì˜ Pull ë°©ì‹ê³¼ Push ë°©ì‹ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì´ê³ , ê°ê° ì–¸ì œ ì‚¬ìš©í•˜ë‚˜ìš”?**

**A**: PrometheusëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **Pull ë°©ì‹**ì„ ì‚¬ìš©í•˜ë©°, ë‹¨ê¸° ë°°ì¹˜ ì‘ì—…ì—ëŠ” **Pushgatewayë¥¼ í†µí•œ Push ë°©ì‹**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ìƒì„¸ ë‹µë³€**:

**Pull ë°©ì‹ (Prometheus ê¸°ë³¸)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prometheusê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„° ìš”ì²­     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Prometheus                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚             â”‚                        â”‚
â”‚  â”‚  ë§¤ 15ì´ˆë§ˆë‹¤                          â”‚
â”‚  â”‚  HTTP GET   â”‚                        â”‚
â”‚  â”‚  /metrics   â”‚                        â”‚
â”‚  â”‚             â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚ GET http://cadvisor:8080/metrics
â”‚         â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  cAdvisor    â”‚                       â”‚
â”‚  â”‚  (Exporter)  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¥ì :
âœ… ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì‰¬ì›€
âœ… íƒ€ê²Ÿ í—¬ìŠ¤ í™•ì¸ ê°€ëŠ¥
âœ… ì„¤ì •ì´ ê°„ë‹¨
âœ… ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„

ë‹¨ì :
âŒ ë°©í™”ë²½ ëš«ì–´ì•¼ í•¨
âŒ ë‹¨ê¸° ì‹¤í–‰ ì‘ì—… ëª¨ë‹ˆí„°ë§ ì–´ë ¤ì›€
```

**Push ë°©ì‹ (Pushgateway ì‚¬ìš©)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ Pushgatewayë¡œ ì „ì†¡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ë°°ì¹˜ ì‘ì—…                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ Backup Job  â”‚                        â”‚
â”‚  â”‚ (30ë¶„ ì‹¤í–‰) â”‚                        â”‚
â”‚  â”‚             â”‚                        â”‚
â”‚  â”‚ ì™„ë£Œ ì‹œ:     â”‚                        â”‚
â”‚  â”‚ POST ë©”íŠ¸ë¦­ â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚ POST metrics                  â”‚
â”‚         â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Pushgateway    â”‚                   â”‚
â”‚  â”‚ (ì„ì‹œ ì €ì¥ì†Œ)     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚ â† GET (Prometheusê°€ Pull)   â”‚
â”‚           â†“                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  Prometheus  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¥ì :
âœ… ë‹¨ê¸° ì‹¤í–‰ ì‘ì—… ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥
âœ… ë„¤íŠ¸ì›Œí¬ ì œí•œ ì—†ìŒ

ë‹¨ì :
âŒ SPOF (Pushgateway ì¥ì•  ì‹œ ë°ì´í„° ì†ì‹¤)
âŒ ì„¤ì • ë³µì¡
âŒ íƒ€ì„ìŠ¤íƒ¬í”„ ë¬¸ì œ ê°€ëŠ¥
```

**ì‚¬ìš© ì‚¬ë¡€**:

**Pull ë°©ì‹ ì‚¬ìš©**:
```yaml
# 1. ì¥ê¸° ì‹¤í–‰ ì„œë¹„ìŠ¤ (API ì„œë²„, DB ë“±)
scrape_configs:
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']

  - job_name: 'user-service'
    static_configs:
      - targets: ['user-service:8080']

# ì–¸ì œ: í•­ìƒ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤
```

**Push ë°©ì‹ ì‚¬ìš©**:
```yaml
# 2. ë°°ì¹˜ ì‘ì—…, í¬ë¡  ì‘ì—…
# pushgateway ì„¤ì¹˜
services:
  pushgateway:
    image: prom/pushgateway:latest
    ports:
      - "9091:9091"

# ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸
#!/bin/bash
# backup.sh

echo "backup_duration_seconds $(date +%s)" | \
    curl --data-binary @- http://pushgateway:9091/metrics/job/backup

# ì–¸ì œ: ë‹¨ê¸° ì‹¤í–‰ ì‘ì—… (í¬ë¡ , ë°°ì¹˜)
```

**í˜¼í•© ì‚¬ìš© ì˜ˆì‹œ** (ì‹¤ì „):
```yaml
# prometheus.yml

scrape_configs:
  # Pull: í•­ìƒ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤
  - job_name: 'services'
    static_configs:
      - targets:
        - 'user-service:8080'
        - 'account-service:8080'
        - 'trade-service:8080'

  # Pull: Pushgateway (ë°°ì¹˜ ì‘ì—… ë©”íŠ¸ë¦­)
  - job_name: 'pushgateway'
    honor_labels: true  # ì¤‘ìš”!
    static_configs:
      - targets: ['pushgateway:9091']
```

**ê²°ë¡ **:
> "ê¸°ë³¸ì€ Pull ë°©ì‹"
> "ë°°ì¹˜ ì‘ì—…ë§Œ Push ë°©ì‹ (Pushgateway)"
> "99%ëŠ” Pullë¡œ í•´ê²° ê°€ëŠ¥"

---

**Q4: PromQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì„¸ìš”: "ì§€ë‚œ 5ë¶„ê°„ CPU ì‚¬ìš©ë¥ ì´ 80% ì´ìƒì¸ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì•„ë¼"**

**A**:
```promql
rate(container_cpu_usage_seconds_total[5m]) * 100 > 80
```

**ìƒì„¸ ì„¤ëª…**:

**ì¿¼ë¦¬ ë¶„í•´**:
```promql
1. container_cpu_usage_seconds_total
   â†’ CPU ì‚¬ìš© ì‹œê°„ (ëˆ„ì , ë‹¨ìœ„: ì´ˆ)

2. [5m]
   â†’ ì§€ë‚œ 5ë¶„ê°„ì˜ ë°ì´í„°

3. rate(...[5m])
   â†’ ì´ˆë‹¹ ì¦ê°€ìœ¨ ê³„ì‚°
   â†’ 0.45 = ì´ˆë‹¹ 0.45ì´ˆ ì‚¬ìš© (45% CPU)

4. * 100
   â†’ í¼ì„¼íŠ¸ë¡œ ë³€í™˜
   â†’ 0.45 * 100 = 45%

5. > 80
   â†’ 80% ì´ˆê³¼ì¸ ê²ƒë§Œ í•„í„°ë§
```

**ë‹¨ê³„ë³„ ì‹¤í–‰**:
```bash
# Prometheus UI (http://localhost:9090)ì—ì„œ ì‹¤í–‰

# Step 1: ê¸°ë³¸ ë©”íŠ¸ë¦­ í™•ì¸
container_cpu_usage_seconds_total

# ê²°ê³¼:
# container_cpu_usage_seconds_total{name="user-service"} 12345.67
# â†’ ì»¨í…Œì´ë„ˆ ì‹œì‘ í›„ ì´ 12345.67ì´ˆ ë™ì•ˆ CPU ì‚¬ìš©

# Step 2: rate() ì ìš© (ì´ˆë‹¹ ë³€í™”ìœ¨)
rate(container_cpu_usage_seconds_total[5m])

# ê²°ê³¼:
# {name="user-service"} 0.85
# â†’ ì´ˆë‹¹ 0.85ì´ˆ ì‚¬ìš© = 85% CPU

# Step 3: í¼ì„¼íŠ¸ë¡œ ë³€í™˜
rate(container_cpu_usage_seconds_total[5m]) * 100

# ê²°ê³¼:
# {name="user-service"} 85
# â†’ 85%

# Step 4: 80% ì´ìƒë§Œ í•„í„°ë§
rate(container_cpu_usage_seconds_total[5m]) * 100 > 80

# ê²°ê³¼:
# {name="user-service"} 85
# {name="trade-service"} 92
# â†’ CPU 80% ì´ìƒì¸ ì»¨í…Œì´ë„ˆë§Œ í‘œì‹œ
```

**ë‹¤ë¥¸ ìœ ìš©í•œ PromQL ì¿¼ë¦¬**:

**1. ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  80% ì´ìƒ**:
```promql
(container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 80
```

**2. CPU ì‚¬ìš©ë¥  ìƒìœ„ 5ê°œ ì»¨í…Œì´ë„ˆ**:
```promql
topk(5, rate(container_cpu_usage_seconds_total[5m]) * 100)
```

**3. í‰ê·  CPU ì‚¬ìš©ë¥  (ì»¨í…Œì´ë„ˆë³„)**:
```promql
avg(rate(container_cpu_usage_seconds_total[5m]) * 100) by (name)
```

**4. ë„¤íŠ¸ì›Œí¬ ìˆ˜ì‹  ì†ë„ (bytes/sec)**:
```promql
rate(container_network_receive_bytes_total[5m])
```

**5. ë””ìŠ¤í¬ ì“°ê¸° ì†ë„ (bytes/sec)**:
```promql
rate(container_fs_writes_bytes_total[5m])
```

**Grafana íŒ¨ë„ì— ì ìš©**:
```
Query: rate(container_cpu_usage_seconds_total{name=~".*-service"}[5m]) * 100
Legend: {{name}}
Y-axis: 0-100 (%)
Threshold:
  - 80% â†’ Yellow
  - 90% â†’ Red
```

---

**Q5: Grafana ëŒ€ì‹œë³´ë“œ ì„¤ê³„ ì‹œ ê³ ë ¤í•´ì•¼ í•  í•µì‹¬ ì›ì¹™ 5ê°€ì§€ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**

**A**: **ê°€ë…ì„±, ê³„ì¸µí™”, ì»¨í…ìŠ¤íŠ¸, ì•Œë¦¼, ì¼ê´€ì„±**ì…ë‹ˆë‹¤.

**ìƒì„¸ ì„¤ëª…**:

**1. ê°€ë…ì„± (Readability)**
```
ì›ì¹™: "í•œëˆˆì— íŒŒì•… ê°€ëŠ¥í•˜ê²Œ"

âŒ ë‚˜ìœ ì˜ˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ íŒ¨ë„ 20ê°œê°€ ë¹½ë¹½í•˜ê²Œ ë°°ì¹˜           â”‚
â”‚ í…ìŠ¤íŠ¸ ì‘ìŒ, ìƒ‰ìƒ ë‚œì¡              â”‚
â”‚ â†’ ë­˜ ë´ì•¼ í• ì§€ ëª¨ë¥´ê² ìŒ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… ì¢‹ì€ ì˜ˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ]  â† ìƒë‹¨ì— ìš”ì•½   â”‚
â”‚  âœ… All Systems Operational        â”‚
â”‚                                    â”‚
â”‚ [CPU ì‚¬ìš©ë¥ ] [ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ]        â”‚
â”‚  í° ê·¸ë˜í”„, ëª…í™•í•œ ë ˆì´ë¸”           â”‚
â”‚                                    â”‚
â”‚ [ìƒì„¸ ë©”íŠ¸ë¦­] â† í•˜ë‹¨ì— ìƒì„¸ ì •ë³´    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íŒ:
- íŒ¨ë„ë‹¹ 1ê°€ì§€ ë©”íŠ¸ë¦­ë§Œ
- í° í°íŠ¸ ì‚¬ìš© (ìµœì†Œ 14pt)
- ìƒ‰ìƒì€ 3ê°€ì§€ ì´ë‚´ (ì •ìƒ: ì´ˆë¡, ê²½ê³ : ë…¸ë‘, ìœ„í—˜: ë¹¨ê°•)
```

**2. ê³„ì¸µí™” (Hierarchy)**
```
ì›ì¹™: "ìœ„ì—ì„œ ì•„ë˜ë¡œ, ì „ì²´ì—ì„œ ìƒì„¸ë¡œ"

ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [1ë‹¨ê³„] ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ            â”‚
â”‚  - ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ? (í•œ ì¤„)        â”‚
â”‚  - ì•Œë¦¼ ê°œìˆ˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [2ë‹¨ê³„] ì„œë¹„ìŠ¤ë³„ ì£¼ìš” ë©”íŠ¸ë¦­        â”‚
â”‚  - CPU, ë©”ëª¨ë¦¬ (ê° ì„œë¹„ìŠ¤)          â”‚
â”‚  - ê·¸ë˜í”„ë¡œ ì‹œê°í™”                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [3ë‹¨ê³„] ìƒì„¸ ë©”íŠ¸ë¦­                 â”‚
â”‚  - ë„¤íŠ¸ì›Œí¬ I/O                     â”‚
â”‚  - ë””ìŠ¤í¬ I/O                       â”‚
â”‚  - ì—ëŸ¬ìœ¨, ë ˆì´í„´ì‹œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‚¬ìš©ì ê²½í—˜:
1. ëŒ€ì‹œë³´ë“œ ì—´ë©´ â†’ ì „ì²´ ìƒíƒœ ì¦‰ì‹œ íŒŒì•…
2. ë¬¸ì œ ìˆìœ¼ë©´ â†’ 2ë‹¨ê³„ì—ì„œ ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€ í™•ì¸
3. ì›ì¸ íŒŒì•… â†’ 3ë‹¨ê³„ì—ì„œ ìƒì„¸ ë¶„ì„
```

**3. ì»¨í…ìŠ¤íŠ¸ (Context)**
```
ì›ì¹™: "ìˆ«ìë§Œìœ¼ë¡œëŠ” ë¶€ì¡±, ì˜ë¯¸ë¥¼ ì œê³µí•˜ë¼"

âŒ ë‚˜ìœ ì˜ˆ:
CPU: 85%
â†’ 85%ê°€ ë§ì€ ê±´ê°€? ì ì€ ê±´ê°€?

âœ… ì¢‹ì€ ì˜ˆ:
CPU: 85% / 100% (Warning Threshold: 80%)
âš ï¸ ê²½ê³  ìˆ˜ì¤€!
ì¶”ì„¸: ì§€ë‚œ 1ì‹œê°„ ë™ì•ˆ 20% ì¦ê°€ â†‘

ì»¨í…ìŠ¤íŠ¸ ì œê³µ ë°©ë²•:
1. Threshold í‘œì‹œ (80% ì„  ê¸‹ê¸°)
2. ì¶”ì„¸ í™”ì‚´í‘œ (â†‘ ì¦ê°€, â†“ ê°ì†Œ)
3. ë¹„êµê°’ (ì „ì¼ ëŒ€ë¹„, ì „ì£¼ ëŒ€ë¹„)
4. ë‹¨ìœ„ ëª…ì‹œ (%, MB, req/s)
```

**4. ì•Œë¦¼ (Alerting)**
```
ì›ì¹™: "ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ë¶€ì¡±, ì•Œë¦¼ë„ í•¨ê»˜"

Grafana Alert ì„¤ì •:
1. ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ì‹œê°ì  ê²½ê³  (Red ë°°ê²½)
2. Slack/Email ì•Œë¦¼ ì „ì†¡
3. ì•Œë¦¼ ì´ë ¥ í‘œì‹œ

ì˜ˆì‹œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CPU ì‚¬ìš©ë¥                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                          ğŸ”´ 92%â”‚ â”‚ â† ë¹¨ê°„ìƒ‰ ë°°ê²½
â”‚ â”‚        â•±â€¾â€¾â€¾â€¾â€¾â•²                 â”‚ â”‚
â”‚ â”‚   â•±â€¾â€¾â€¾â€¾      â•²                 â”‚ â”‚
â”‚ â”‚ â€¾â€¾           â€¾â€¾â€¾â€¾â€¾â€¾            â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 80% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â† Threshold ì„ 
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â”‚ ğŸš¨ Alert: High CPU Usage           â”‚
â”‚ Sent to: #ops-alerts (Slack)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**5. ì¼ê´€ì„± (Consistency)**
```
ì›ì¹™: "ëª¨ë“  ëŒ€ì‹œë³´ë“œê°€ ê°™ì€ ë””ìì¸ ì–¸ì–´"

í†µì¼í•´ì•¼ í•  ê²ƒ:
1. ìƒ‰ìƒ ìŠ¤í‚´
   - ì •ìƒ: #73BF69 (ì´ˆë¡)
   - ê²½ê³ : #F2CC0C (ë…¸ë‘)
   - ìœ„í—˜: #E02F44 (ë¹¨ê°•)

2. íŒ¨ë„ í¬ê¸°
   - ìƒë‹¨ ìš”ì•½: ì „ì²´ ë„ˆë¹„
   - ì£¼ìš” ë©”íŠ¸ë¦­: 1/2 ë„ˆë¹„
   - ìƒì„¸ ë©”íŠ¸ë¦­: 1/3 ë„ˆë¹„

3. ì‹œê°„ ë²”ìœ„
   - ê¸°ë³¸: ìµœê·¼ 1ì‹œê°„
   - ì˜µì…˜: 1h, 6h, 24h, 7d

4. Yì¶• ë²”ìœ„
   - CPU/Memory: 0-100%
   - ë„¤íŠ¸ì›Œí¬: Auto

5. ë ˆì „ë“œ ìœ„ì¹˜
   - ê·¸ë˜í”„: í•˜ë‹¨
   - Stat: ì—†ìŒ
```

**ì‹¤ì „ ì˜ˆì‹œ (LK-Trade ëŒ€ì‹œë³´ë“œ)**:
```json
{
  "dashboard": {
    "title": "LK-Trade Production Monitoring",
    "panels": [
      {
        "title": "ğŸŸ¢ System Status",
        "type": "stat",
        "gridPos": {"x": 0, "y": 0, "w": 24, "h": 3},
        "targets": [
          {
            "expr": "up{job=\"services\"} == 1",
            "legendFormat": "{{name}}"
          }
        ]
      },
      {
        "title": "CPU Usage (%)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 3, "w": 12, "h": 8},
        "yaxes": [{"max": 100, "min": 0}],
        "thresholds": [
          {"value": 80, "color": "yellow"},
          {"value": 90, "color": "red"}
        ]
      },
      {
        "title": "Memory Usage (MB)",
        "type": "graph",
        "gridPos": {"x": 12, "y": 3, "w": 12, "h": 8}
      }
    ]
  }
}
```

**ê²°ë¡ **:
> "ê°€ë…ì„±: í•œëˆˆì— íŒŒì•…"
> "ê³„ì¸µí™”: ì „ì²´ â†’ ìƒì„¸"
> "ì»¨í…ìŠ¤íŠ¸: ì˜ë¯¸ ì œê³µ"
> "ì•Œë¦¼: ëŠ¥ë™ì  ëŒ€ì‘"
> "ì¼ê´€ì„±: í†µì¼ëœ ê²½í—˜"

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: cAdvisorê°€ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŒ

**ì¦ìƒ**:
```
cAdvisor Web UIì—ì„œ ì»¨í…Œì´ë„ˆ ëª©ë¡ì´ ë¹„ì–´ìˆìŒ
```

**í•´ê²°**:
```yaml
# docker-compose.monitoring.yml
services:
  cadvisor:
    privileged: true  # ê¶Œí•œ ì¶”ê°€
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro  # Docker ì†Œì¼“ ë§ˆìš´íŠ¸
```

### ë¬¸ì œ 2: Prometheusê°€ íƒ€ê²Ÿì„ ìŠ¤í¬ë©í•˜ì§€ ëª»í•¨

**ì§„ë‹¨**:
```bash
# Prometheus íƒ€ê²Ÿ ìƒíƒœ í™•ì¸
curl http://localhost:9090/api/v1/targets | jq
```

**í•´ê²°**:
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']  # ì»¨í…Œì´ë„ˆ ì´ë¦„ ì‚¬ìš©
```

### ë¬¸ì œ 3: Grafana ëŒ€ì‹œë³´ë“œì— ë°ì´í„°ê°€ ì—†ìŒ

**ì§„ë‹¨**:
1. Prometheusì—ì„œ ë°ì´í„° í™•ì¸: `http://localhost:9090/graph`
2. ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸: `up`

**í•´ê²°**:
- ë°ì´í„° ì†ŒìŠ¤ ì—°ê²° í™•ì¸
- PromQL ì¿¼ë¦¬ ìˆ˜ì •

---

## ë‹¤ìŒ ë‹¨ê³„

### 26. ë¡œê·¸ ê´€ë¦¬
- ë¡œê·¸ ë“œë¼ì´ë²„ ì¢…ë¥˜
- ì¤‘ì•™í™”ëœ ë¡œê·¸ ìˆ˜ì§‘
- ELK ìŠ¤íƒ

### í•™ìŠµ ìë£Œ

**ëª¨ë‹ˆí„°ë§**:
- [Prometheus ê³µì‹ ë¬¸ì„œ](https://prometheus.io/docs/introduction/overview/)
- [Grafana ê³µì‹ ë¬¸ì„œ](https://grafana.com/docs/)
- [cAdvisor GitHub](https://github.com/google/cadvisor)

---

**ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰** Docker ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì„ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤!